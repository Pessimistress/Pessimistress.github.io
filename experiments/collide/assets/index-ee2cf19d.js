var AL=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var qW=AL((KW,XM)=>{function CL(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in t)){const l=Object.getOwnPropertyDescriptor(r,o);l&&Object.defineProperty(t,o,l.get?l:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();var IL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ML(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var st={},kL={get exports(){return st},set exports(t){st=t}},jn={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Vw=Object.getOwnPropertySymbols,LL=Object.prototype.hasOwnProperty,RL=Object.prototype.propertyIsEnumerable;function OL(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function zL(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(e).map(function(l){return e[l]});if(r.join("")!=="0123456789")return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(l){o[l]=l}),Object.keys(Object.assign({},o)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var aP=zL()?Object.assign:function(t,e){for(var n,r=OL(t),o,l=1;l<arguments.length;l++){n=Object(arguments[l]);for(var a in n)LL.call(n,a)&&(r[a]=n[a]);if(Vw){o=Vw(n);for(var d=0;d<o.length;d++)RL.call(n,o[d])&&(r[o[d]]=n[o[d]])}}return r};/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z1=aP,ka=typeof Symbol=="function"&&Symbol.for,md=ka?Symbol.for("react.element"):60103,DL=ka?Symbol.for("react.portal"):60106,FL=ka?Symbol.for("react.fragment"):60107,NL=ka?Symbol.for("react.strict_mode"):60108,BL=ka?Symbol.for("react.profiler"):60114,UL=ka?Symbol.for("react.provider"):60109,VL=ka?Symbol.for("react.context"):60110,jL=ka?Symbol.for("react.forward_ref"):60112,GL=ka?Symbol.for("react.suspense"):60113,WL=ka?Symbol.for("react.memo"):60115,HL=ka?Symbol.for("react.lazy"):60116,jw=typeof Symbol=="function"&&Symbol.iterator;function gd(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var sP={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},lP={};function Qh(t,e,n){this.props=t,this.context=e,this.refs=lP,this.updater=n||sP}Qh.prototype.isReactComponent={};Qh.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error(gd(85));this.updater.enqueueSetState(this,t,e,"setState")};Qh.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function uP(){}uP.prototype=Qh.prototype;function D1(t,e,n){this.props=t,this.context=e,this.refs=lP,this.updater=n||sP}var F1=D1.prototype=new uP;F1.constructor=D1;z1(F1,Qh.prototype);F1.isPureReactComponent=!0;var N1={current:null},cP=Object.prototype.hasOwnProperty,hP={key:!0,ref:!0,__self:!0,__source:!0};function fP(t,e,n){var r,o={},l=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(l=""+e.key),e)cP.call(e,r)&&!hP.hasOwnProperty(r)&&(o[r]=e[r]);var d=arguments.length-2;if(d===1)o.children=n;else if(1<d){for(var g=Array(d),x=0;x<d;x++)g[x]=arguments[x+2];o.children=g}if(t&&t.defaultProps)for(r in d=t.defaultProps,d)o[r]===void 0&&(o[r]=d[r]);return{$$typeof:md,type:t,key:l,ref:a,props:o,_owner:N1.current}}function qL(t,e){return{$$typeof:md,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function B1(t){return typeof t=="object"&&t!==null&&t.$$typeof===md}function ZL(t){var e={"=":"=0",":":"=2"};return"$"+(""+t).replace(/[=:]/g,function(n){return e[n]})}var pP=/\/+/g,zg=[];function dP(t,e,n,r){if(zg.length){var o=zg.pop();return o.result=t,o.keyPrefix=e,o.func=n,o.context=r,o.count=0,o}return{result:t,keyPrefix:e,func:n,context:r,count:0}}function mP(t){t.result=null,t.keyPrefix=null,t.func=null,t.context=null,t.count=0,10>zg.length&&zg.push(t)}function $_(t,e,n,r){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var l=!1;if(t===null)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case md:case DL:l=!0}}if(l)return n(r,t,e===""?"."+Xv(t,0):e),1;if(l=0,e=e===""?".":e+":",Array.isArray(t))for(var a=0;a<t.length;a++){o=t[a];var d=e+Xv(o,a);l+=$_(o,d,n,r)}else if(t===null||typeof t!="object"?d=null:(d=jw&&t[jw]||t["@@iterator"],d=typeof d=="function"?d:null),typeof d=="function")for(t=d.call(t),a=0;!(o=t.next()).done;)o=o.value,d=e+Xv(o,a++),l+=$_(o,d,n,r);else if(o==="object")throw n=""+t,Error(gd(31,n==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":n,""));return l}function X_(t,e,n){return t==null?0:$_(t,"",e,n)}function Xv(t,e){return typeof t=="object"&&t!==null&&t.key!=null?ZL(t.key):e.toString(36)}function $L(t,e){t.func.call(t.context,e,t.count++)}function XL(t,e,n){var r=t.result,o=t.keyPrefix;t=t.func.call(t.context,e,t.count++),Array.isArray(t)?Y_(t,r,n,function(l){return l}):t!=null&&(B1(t)&&(t=qL(t,o+(!t.key||e&&e.key===t.key?"":(""+t.key).replace(pP,"$&/")+"/")+n)),r.push(t))}function Y_(t,e,n,r,o){var l="";n!=null&&(l=(""+n).replace(pP,"$&/")+"/"),e=dP(e,l,r,o),X_(t,XL,e),mP(e)}var gP={current:null};function tl(){var t=gP.current;if(t===null)throw Error(gd(321));return t}var YL={ReactCurrentDispatcher:gP,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:N1,IsSomeRendererActing:{current:!1},assign:z1};jn.Children={map:function(t,e,n){if(t==null)return t;var r=[];return Y_(t,r,null,e,n),r},forEach:function(t,e,n){if(t==null)return t;e=dP(null,null,e,n),X_(t,$L,e),mP(e)},count:function(t){return X_(t,function(){return null},null)},toArray:function(t){var e=[];return Y_(t,e,null,function(n){return n}),e},only:function(t){if(!B1(t))throw Error(gd(143));return t}};jn.Component=Qh;jn.Fragment=FL;jn.Profiler=BL;jn.PureComponent=D1;jn.StrictMode=NL;jn.Suspense=GL;jn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=YL;jn.cloneElement=function(t,e,n){if(t==null)throw Error(gd(267,t));var r=z1({},t.props),o=t.key,l=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(l=e.ref,a=N1.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var d=t.type.defaultProps;for(g in e)cP.call(e,g)&&!hP.hasOwnProperty(g)&&(r[g]=e[g]===void 0&&d!==void 0?d[g]:e[g])}var g=arguments.length-2;if(g===1)r.children=n;else if(1<g){d=Array(g);for(var x=0;x<g;x++)d[x]=arguments[x+2];r.children=d}return{$$typeof:md,type:t.type,key:o,ref:l,props:r,_owner:a}};jn.createContext=function(t,e){return e===void 0&&(e=null),t={$$typeof:VL,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider={$$typeof:UL,_context:t},t.Consumer=t};jn.createElement=fP;jn.createFactory=function(t){var e=fP.bind(null,t);return e.type=t,e};jn.createRef=function(){return{current:null}};jn.forwardRef=function(t){return{$$typeof:jL,render:t}};jn.isValidElement=B1;jn.lazy=function(t){return{$$typeof:HL,_ctor:t,_status:-1,_result:null}};jn.memo=function(t,e){return{$$typeof:WL,type:t,compare:e===void 0?null:e}};jn.useCallback=function(t,e){return tl().useCallback(t,e)};jn.useContext=function(t,e){return tl().useContext(t,e)};jn.useDebugValue=function(){};jn.useEffect=function(t,e){return tl().useEffect(t,e)};jn.useImperativeHandle=function(t,e,n){return tl().useImperativeHandle(t,e,n)};jn.useLayoutEffect=function(t,e){return tl().useLayoutEffect(t,e)};jn.useMemo=function(t,e){return tl().useMemo(t,e)};jn.useReducer=function(t,e,n){return tl().useReducer(t,e,n)};jn.useRef=function(t){return tl().useRef(t)};jn.useState=function(t){return tl().useState(t)};jn.version="16.13.1";(function(t){t.exports=jn})(kL);const K_=ML(st);var J_={},KL={get exports(){return J_},set exports(t){J_=t}},la={},Q_={},JL={get exports(){return Q_},set exports(t){Q_=t}},yP={};/** @license React v0.19.1
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){var e,n,r,o,l;if(typeof window>"u"||typeof MessageChannel!="function"){var a=null,d=null,g=function(){if(a!==null)try{var et=t.unstable_now();a(!0,et),a=null}catch(yt){throw setTimeout(g,0),yt}},x=Date.now();t.unstable_now=function(){return Date.now()-x},e=function(et){a!==null?setTimeout(e,0,et):(a=et,setTimeout(g,0))},n=function(et,yt){d=setTimeout(et,yt)},r=function(){clearTimeout(d)},o=function(){return!1},l=t.unstable_forceFrameRate=function(){}}else{var E=window.performance,P=window.Date,A=window.setTimeout,R=window.clearTimeout;if(typeof console<"u"){var j=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),typeof j!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if(typeof E=="object"&&typeof E.now=="function")t.unstable_now=function(){return E.now()};else{var X=P.now();t.unstable_now=function(){return P.now()-X}}var D=!1,F=null,W=-1,J=5,le=0;o=function(){return t.unstable_now()>=le},l=function(){},t.unstable_forceFrameRate=function(et){0>et||125<et?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):J=0<et?Math.floor(1e3/et):5};var ue=new MessageChannel,ye=ue.port2;ue.port1.onmessage=function(){if(F!==null){var et=t.unstable_now();le=et+J;try{F(!0,et)?ye.postMessage(null):(D=!1,F=null)}catch(yt){throw ye.postMessage(null),yt}}else D=!1},e=function(et){F=et,D||(D=!0,ye.postMessage(null))},n=function(et,yt){W=A(function(){et(t.unstable_now())},yt)},r=function(){R(W),W=-1}}function Ee(et,yt){var Qt=et.length;et.push(yt);e:for(;;){var Pt=Qt-1>>>1,Nt=et[Pt];if(Nt!==void 0&&0<ze(Nt,yt))et[Pt]=yt,et[Qt]=Nt,Qt=Pt;else break e}}function Pe(et){return et=et[0],et===void 0?null:et}function we(et){var yt=et[0];if(yt!==void 0){var Qt=et.pop();if(Qt!==yt){et[0]=Qt;e:for(var Pt=0,Nt=et.length;Pt<Nt;){var qt=2*(Pt+1)-1,yn=et[qt],ai=qt+1,Kn=et[ai];if(yn!==void 0&&0>ze(yn,Qt))Kn!==void 0&&0>ze(Kn,yn)?(et[Pt]=Kn,et[ai]=Qt,Pt=ai):(et[Pt]=yn,et[qt]=Qt,Pt=qt);else if(Kn!==void 0&&0>ze(Kn,Qt))et[Pt]=Kn,et[ai]=Qt,Pt=ai;else break e}}return yt}return null}function ze(et,yt){var Qt=et.sortIndex-yt.sortIndex;return Qt!==0?Qt:et.id-yt.id}var Fe=[],Be=[],He=1,We=null,_t=3,gn=!1,pn=!1,$n=!1;function Tn(et){for(var yt=Pe(Be);yt!==null;){if(yt.callback===null)we(Be);else if(yt.startTime<=et)we(Be),yt.sortIndex=yt.expirationTime,Ee(Fe,yt);else break;yt=Pe(Be)}}function lr(et){if($n=!1,Tn(et),!pn)if(Pe(Fe)!==null)pn=!0,e(Jt);else{var yt=Pe(Be);yt!==null&&n(lr,yt.startTime-et)}}function Jt(et,yt){pn=!1,$n&&($n=!1,r()),gn=!0;var Qt=_t;try{for(Tn(yt),We=Pe(Fe);We!==null&&(!(We.expirationTime>yt)||et&&!o());){var Pt=We.callback;if(Pt!==null){We.callback=null,_t=We.priorityLevel;var Nt=Pt(We.expirationTime<=yt);yt=t.unstable_now(),typeof Nt=="function"?We.callback=Nt:We===Pe(Fe)&&we(Fe),Tn(yt)}else we(Fe);We=Pe(Fe)}if(We!==null)var qt=!0;else{var yn=Pe(Be);yn!==null&&n(lr,yn.startTime-yt),qt=!1}return qt}finally{We=null,_t=Qt,gn=!1}}function dn(et){switch(et){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var An=l;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(et){et.callback=null},t.unstable_continueExecution=function(){pn||gn||(pn=!0,e(Jt))},t.unstable_getCurrentPriorityLevel=function(){return _t},t.unstable_getFirstCallbackNode=function(){return Pe(Fe)},t.unstable_next=function(et){switch(_t){case 1:case 2:case 3:var yt=3;break;default:yt=_t}var Qt=_t;_t=yt;try{return et()}finally{_t=Qt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=An,t.unstable_runWithPriority=function(et,yt){switch(et){case 1:case 2:case 3:case 4:case 5:break;default:et=3}var Qt=_t;_t=et;try{return yt()}finally{_t=Qt}},t.unstable_scheduleCallback=function(et,yt,Qt){var Pt=t.unstable_now();if(typeof Qt=="object"&&Qt!==null){var Nt=Qt.delay;Nt=typeof Nt=="number"&&0<Nt?Pt+Nt:Pt,Qt=typeof Qt.timeout=="number"?Qt.timeout:dn(et)}else Qt=dn(et),Nt=Pt;return Qt=Nt+Qt,et={id:He++,callback:yt,priorityLevel:et,startTime:Nt,expirationTime:Qt,sortIndex:-1},Nt>Pt?(et.sortIndex=Nt,Ee(Be,et),Pe(Fe)===null&&et===Pe(Be)&&($n?r():$n=!0,n(lr,Nt-Pt))):(et.sortIndex=Qt,Ee(Fe,et),pn||gn||(pn=!0,e(Jt))),et},t.unstable_shouldYield=function(){var et=t.unstable_now();Tn(et);var yt=Pe(Fe);return yt!==We&&We!==null&&yt!==null&&yt.callback!==null&&yt.startTime<=et&&yt.expirationTime<We.expirationTime||o()},t.unstable_wrapCallback=function(et){var yt=_t;return function(){var Qt=_t;_t=yt;try{return et.apply(this,arguments)}finally{_t=Qt}}}})(yP);(function(t){t.exports=yP})(JL);/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fy=st,no=aP,Si=Q_;function tt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!Fy)throw Error(tt(227));function QL(t,e,n,r,o,l,a,d,g){var x=Array.prototype.slice.call(arguments,3);try{e.apply(n,x)}catch(E){this.onError(E)}}var Cp=!1,Dg=null,Fg=!1,e0=null,eR={onError:function(t){Cp=!0,Dg=t}};function tR(t,e,n,r,o,l,a,d,g){Cp=!1,Dg=null,QL.apply(eR,arguments)}function nR(t,e,n,r,o,l,a,d,g){if(tR.apply(this,arguments),Cp){if(Cp){var x=Dg;Cp=!1,Dg=null}else throw Error(tt(198));Fg||(Fg=!0,e0=x)}}var U1=null,vP=null,_P=null;function Gw(t,e,n){var r=t.type||"unknown-event";t.currentTarget=_P(n),nR(r,e,void 0,t),t.currentTarget=null}var Ng=null,dh={};function xP(){if(Ng)for(var t in dh){var e=dh[t],n=Ng.indexOf(t);if(!(-1<n))throw Error(tt(96,t));if(!Bg[n]){if(!e.extractEvents)throw Error(tt(97,t));Bg[n]=e,n=e.eventTypes;for(var r in n){var o=void 0,l=n[r],a=e,d=r;if(t0.hasOwnProperty(d))throw Error(tt(99,d));t0[d]=l;var g=l.phasedRegistrationNames;if(g){for(o in g)g.hasOwnProperty(o)&&Ww(g[o],a,d);o=!0}else l.registrationName?(Ww(l.registrationName,a,d),o=!0):o=!1;if(!o)throw Error(tt(98,r,t))}}}}function Ww(t,e,n){if(Dh[t])throw Error(tt(100,t));Dh[t]=e,V1[t]=e.eventTypes[n].dependencies}var Bg=[],t0={},Dh={},V1={};function bP(t){var e=!1,n;for(n in t)if(t.hasOwnProperty(n)){var r=t[n];if(!dh.hasOwnProperty(n)||dh[n]!==r){if(dh[n])throw Error(tt(102,n));dh[n]=r,e=!0}}e&&xP()}var iu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),n0=null,Sh=null,Ph=null;function Hw(t){if(t=vP(t)){if(typeof n0!="function")throw Error(tt(280));var e=t.stateNode;e&&(e=U1(e),n0(t.stateNode,t.type,e))}}function wP(t){Sh?Ph?Ph.push(t):Ph=[t]:Sh=t}function EP(){if(Sh){var t=Sh,e=Ph;if(Ph=Sh=null,Hw(t),e)for(t=0;t<e.length;t++)Hw(e[t])}}function j1(t,e){return t(e)}function TP(t,e,n,r,o){return t(e,n,r,o)}function G1(){}var SP=j1,Nu=!1,Yv=!1;function W1(){(Sh!==null||Ph!==null)&&(G1(),EP())}function PP(t,e,n){if(Yv)return t(e,n);Yv=!0;try{return SP(t,e,n)}finally{Yv=!1,W1()}}var rR=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qw=Object.prototype.hasOwnProperty,Zw={},$w={};function iR(t){return qw.call($w,t)?!0:qw.call(Zw,t)?!1:rR.test(t)?$w[t]=!0:(Zw[t]=!0,!1)}function oR(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function aR(t,e,n,r){if(e===null||typeof e>"u"||oR(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ro(t,e,n,r,o,l){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=l}var Pi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Pi[t]=new ro(t,0,!1,t,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Pi[e]=new ro(e,1,!1,t[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Pi[t]=new ro(t,2,!1,t.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Pi[t]=new ro(t,2,!1,t,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Pi[t]=new ro(t,3,!1,t.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(t){Pi[t]=new ro(t,3,!0,t,null,!1)});["capture","download"].forEach(function(t){Pi[t]=new ro(t,4,!1,t,null,!1)});["cols","rows","size","span"].forEach(function(t){Pi[t]=new ro(t,6,!1,t,null,!1)});["rowSpan","start"].forEach(function(t){Pi[t]=new ro(t,5,!1,t.toLowerCase(),null,!1)});var H1=/[\-:]([a-z])/g;function q1(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(H1,q1);Pi[e]=new ro(e,1,!1,t,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(H1,q1);Pi[e]=new ro(e,1,!1,t,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(H1,q1);Pi[e]=new ro(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(t){Pi[t]=new ro(t,1,!1,t.toLowerCase(),null,!1)});Pi.xlinkHref=new ro("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(t){Pi[t]=new ro(t,1,!1,t.toLowerCase(),null,!0)});var Ia=Fy.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;Ia.hasOwnProperty("ReactCurrentDispatcher")||(Ia.ReactCurrentDispatcher={current:null});Ia.hasOwnProperty("ReactCurrentBatchConfig")||(Ia.ReactCurrentBatchConfig={suspense:null});function Z1(t,e,n,r){var o=Pi.hasOwnProperty(e)?Pi[e]:null,l=o!==null?o.type===0:r?!1:!(!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N");l||(aR(e,n,o,r)&&(n=null),r||o===null?iR(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):o.mustUseProperty?t[o.propertyName]=n===null?o.type===3?!1:"":n:(e=o.attributeName,r=o.attributeNamespace,n===null?t.removeAttribute(e):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var sR=/^(.*)[\\\/]/,yo=typeof Symbol=="function"&&Symbol.for,Nm=yo?Symbol.for("react.element"):60103,mh=yo?Symbol.for("react.portal"):60106,Fu=yo?Symbol.for("react.fragment"):60107,AP=yo?Symbol.for("react.strict_mode"):60108,hg=yo?Symbol.for("react.profiler"):60114,CP=yo?Symbol.for("react.provider"):60109,IP=yo?Symbol.for("react.context"):60110,lR=yo?Symbol.for("react.concurrent_mode"):60111,$1=yo?Symbol.for("react.forward_ref"):60112,fg=yo?Symbol.for("react.suspense"):60113,r0=yo?Symbol.for("react.suspense_list"):60120,X1=yo?Symbol.for("react.memo"):60115,MP=yo?Symbol.for("react.lazy"):60116,kP=yo?Symbol.for("react.block"):60121,Xw=typeof Symbol=="function"&&Symbol.iterator;function sp(t){return t===null||typeof t!="object"?null:(t=Xw&&t[Xw]||t["@@iterator"],typeof t=="function"?t:null)}function uR(t){if(t._status===-1){t._status=0;var e=t._ctor;e=e(),t._result=e,e.then(function(n){t._status===0&&(n=n.default,t._status=1,t._result=n)},function(n){t._status===0&&(t._status=2,t._result=n)})}}function Ys(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Fu:return"Fragment";case mh:return"Portal";case hg:return"Profiler";case AP:return"StrictMode";case fg:return"Suspense";case r0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case IP:return"Context.Consumer";case CP:return"Context.Provider";case $1:var e=t.render;return e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case X1:return Ys(t.type);case kP:return Ys(t.render);case MP:if(t=t._status===1?t._result:null)return Ys(t)}return null}function Y1(t){var e="";do{e:switch(t.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var r=t._debugOwner,o=t._debugSource,l=Ys(t.type);n=null,r&&(n=Ys(r.type)),r=l,l="",o?l=" (at "+o.fileName.replace(sR,"")+":"+o.lineNumber+")":n&&(l=" (created by "+n+")"),n=`
    in `+(r||"Unknown")+l}e+=n,t=t.return}while(t);return e}function eu(t){switch(typeof t){case"boolean":case"number":case"object":case"string":case"undefined":return t;default:return""}}function LP(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function cR(t){var e=LP(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,l=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(a){r=""+a,l.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Bm(t){t._valueTracker||(t._valueTracker=cR(t))}function RP(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=LP(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function i0(t,e){var n=e.checked;return no({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Yw(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=eu(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function OP(t,e){e=e.checked,e!=null&&Z1(t,"checked",e,!1)}function o0(t,e){OP(t,e);var n=eu(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?a0(t,e.type,n):e.hasOwnProperty("defaultValue")&&a0(t,e.type,eu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Kw(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function a0(t,e,n){(e!=="number"||t.ownerDocument.activeElement!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}function hR(t){var e="";return Fy.Children.forEach(t,function(n){n!=null&&(e+=n)}),e}function s0(t,e){return t=no({children:void 0},e),(e=hR(e.children))&&(t.children=e),t}function Ah(t,e,n,r){if(t=t.options,e){e={};for(var o=0;o<n.length;o++)e["$"+n[o]]=!0;for(n=0;n<t.length;n++)o=e.hasOwnProperty("$"+t[n].value),t[n].selected!==o&&(t[n].selected=o),o&&r&&(t[n].defaultSelected=!0)}else{for(n=""+eu(n),e=null,o=0;o<t.length;o++){if(t[o].value===n){t[o].selected=!0,r&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function l0(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(tt(91));return no({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Jw(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(tt(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(tt(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:eu(n)}}function zP(t,e){var n=eu(e.value),r=eu(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Qw(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}var DP={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function FP(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function u0(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?FP(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Um,NP=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,o){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,o)})}:t}(function(t,e){if(t.namespaceURI!==DP.svg||"innerHTML"in t)t.innerHTML=e;else{for(Um=Um||document.createElement("div"),Um.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Um.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Gp(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}function Vm(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var gh={animationend:Vm("Animation","AnimationEnd"),animationiteration:Vm("Animation","AnimationIteration"),animationstart:Vm("Animation","AnimationStart"),transitionend:Vm("Transition","TransitionEnd")},Kv={},BP={};iu&&(BP=document.createElement("div").style,"AnimationEvent"in window||(delete gh.animationend.animation,delete gh.animationiteration.animation,delete gh.animationstart.animation),"TransitionEvent"in window||delete gh.transitionend.transition);function Ny(t){if(Kv[t])return Kv[t];if(!gh[t])return t;var e=gh[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in BP)return Kv[t]=e[n];return t}var UP=Ny("animationend"),VP=Ny("animationiteration"),jP=Ny("animationstart"),GP=Ny("transitionend"),Ep="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),eE=new(typeof WeakMap=="function"?WeakMap:Map);function K1(t){var e=eE.get(t);return e===void 0&&(e=new Map,eE.set(t,e)),e}function hc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.effectTag&1026&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function WP(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function tE(t){if(hc(t)!==t)throw Error(tt(188))}function fR(t){var e=t.alternate;if(!e){if(e=hc(t),e===null)throw Error(tt(188));return e!==t?null:t}for(var n=t,r=e;;){var o=n.return;if(o===null)break;var l=o.alternate;if(l===null){if(r=o.return,r!==null){n=r;continue}break}if(o.child===l.child){for(l=o.child;l;){if(l===n)return tE(o),t;if(l===r)return tE(o),e;l=l.sibling}throw Error(tt(188))}if(n.return!==r.return)n=o,r=l;else{for(var a=!1,d=o.child;d;){if(d===n){a=!0,n=o,r=l;break}if(d===r){a=!0,r=o,n=l;break}d=d.sibling}if(!a){for(d=l.child;d;){if(d===n){a=!0,n=l,r=o;break}if(d===r){a=!0,r=l,n=o;break}d=d.sibling}if(!a)throw Error(tt(189))}}if(n.alternate!==r)throw Error(tt(190))}if(n.tag!==3)throw Error(tt(188));return n.stateNode.current===n?t:e}function HP(t){if(t=fR(t),!t)return null;for(var e=t;;){if(e.tag===5||e.tag===6)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===t)break;for(;!e.sibling;){if(!e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function Fh(t,e){if(e==null)throw Error(tt(30));return t==null?e:Array.isArray(t)?Array.isArray(e)?(t.push.apply(t,e),t):(t.push(e),t):Array.isArray(e)?[t].concat(e):[t,e]}function J1(t,e,n){Array.isArray(t)?t.forEach(e,n):t&&e.call(n,t)}var lp=null;function pR(t){if(t){var e=t._dispatchListeners,n=t._dispatchInstances;if(Array.isArray(e))for(var r=0;r<e.length&&!t.isPropagationStopped();r++)Gw(t,e[r],n[r]);else e&&Gw(t,e,n);t._dispatchListeners=null,t._dispatchInstances=null,t.isPersistent()||t.constructor.release(t)}}function By(t){if(t!==null&&(lp=Fh(lp,t)),t=lp,lp=null,t){if(J1(t,pR),lp)throw Error(tt(95));if(Fg)throw t=e0,Fg=!1,e0=null,t}}function Q1(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}function qP(t){if(!iu)return!1;t="on"+t;var e=t in document;return e||(e=document.createElement("div"),e.setAttribute(t,"return;"),e=typeof e[t]=="function"),e}var Ug=[];function ZP(t){t.topLevelType=null,t.nativeEvent=null,t.targetInst=null,t.ancestors.length=0,10>Ug.length&&Ug.push(t)}function $P(t,e,n,r){if(Ug.length){var o=Ug.pop();return o.topLevelType=t,o.eventSystemFlags=r,o.nativeEvent=e,o.targetInst=n,o}return{topLevelType:t,eventSystemFlags:r,nativeEvent:e,targetInst:n,ancestors:[]}}function XP(t){var e=t.targetInst,n=e;do{if(!n){t.ancestors.push(n);break}var r=n;if(r.tag===3)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=r.tag!==3?null:r.stateNode.containerInfo}if(!r)break;e=n.tag,e!==5&&e!==6||t.ancestors.push(n),n=vd(r)}while(n);for(n=0;n<t.ancestors.length;n++){e=t.ancestors[n];var o=Q1(t.nativeEvent);r=t.topLevelType;var l=t.nativeEvent,a=t.eventSystemFlags;n===0&&(a|=64);for(var d=null,g=0;g<Bg.length;g++){var x=Bg[g];x&&(x=x.extractEvents(r,e,l,o,a))&&(d=Fh(d,x))}By(d)}}function c0(t,e,n){if(!n.has(t)){switch(t){case"scroll":Tp(e,"scroll",!0);break;case"focus":case"blur":Tp(e,"focus",!0),Tp(e,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":qP(t)&&Tp(e,t,!0);break;case"invalid":case"submit":case"reset":break;default:Ep.indexOf(t)===-1&&Ar(t,e)}n.set(t,null)}}var YP,ex,KP,h0=!1,os=[],jl=null,Gl=null,Wl=null,Wp=new Map,Hp=new Map,up=[],f0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),dR="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function mR(t,e){var n=K1(e);f0.forEach(function(r){c0(r,e,n)}),dR.forEach(function(r){c0(r,e,n)})}function p0(t,e,n,r,o){return{blockedOn:t,topLevelType:e,eventSystemFlags:n|32,nativeEvent:o,container:r}}function nE(t,e){switch(t){case"focus":case"blur":jl=null;break;case"dragenter":case"dragleave":Gl=null;break;case"mouseover":case"mouseout":Wl=null;break;case"pointerover":case"pointerout":Wp.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hp.delete(e.pointerId)}}function cp(t,e,n,r,o,l){return t===null||t.nativeEvent!==l?(t=p0(e,n,r,o,l),e!==null&&(e=_d(e),e!==null&&ex(e)),t):(t.eventSystemFlags|=r,t)}function gR(t,e,n,r,o){switch(e){case"focus":return jl=cp(jl,t,e,n,r,o),!0;case"dragenter":return Gl=cp(Gl,t,e,n,r,o),!0;case"mouseover":return Wl=cp(Wl,t,e,n,r,o),!0;case"pointerover":var l=o.pointerId;return Wp.set(l,cp(Wp.get(l)||null,t,e,n,r,o)),!0;case"gotpointercapture":return l=o.pointerId,Hp.set(l,cp(Hp.get(l)||null,t,e,n,r,o)),!0}return!1}function yR(t){var e=vd(t.target);if(e!==null){var n=hc(e);if(n!==null){if(e=n.tag,e===13){if(e=WP(n),e!==null){t.blockedOn=e,Si.unstable_runWithPriority(t.priority,function(){KP(n)});return}}else if(e===3&&n.stateNode.hydrate){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function pg(t){if(t.blockedOn!==null)return!1;var e=rx(t.topLevelType,t.eventSystemFlags,t.container,t.nativeEvent);if(e!==null){var n=_d(e);return n!==null&&ex(n),t.blockedOn=e,!1}return!0}function rE(t,e,n){pg(t)&&n.delete(e)}function vR(){for(h0=!1;0<os.length;){var t=os[0];if(t.blockedOn!==null){t=_d(t.blockedOn),t!==null&&YP(t);break}var e=rx(t.topLevelType,t.eventSystemFlags,t.container,t.nativeEvent);e!==null?t.blockedOn=e:os.shift()}jl!==null&&pg(jl)&&(jl=null),Gl!==null&&pg(Gl)&&(Gl=null),Wl!==null&&pg(Wl)&&(Wl=null),Wp.forEach(rE),Hp.forEach(rE)}function hp(t,e){t.blockedOn===e&&(t.blockedOn=null,h0||(h0=!0,Si.unstable_scheduleCallback(Si.unstable_NormalPriority,vR)))}function JP(t){function e(o){return hp(o,t)}if(0<os.length){hp(os[0],t);for(var n=1;n<os.length;n++){var r=os[n];r.blockedOn===t&&(r.blockedOn=null)}}for(jl!==null&&hp(jl,t),Gl!==null&&hp(Gl,t),Wl!==null&&hp(Wl,t),Wp.forEach(e),Hp.forEach(e),n=0;n<up.length;n++)r=up[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<up.length&&(n=up[0],n.blockedOn===null);)yR(n),n.blockedOn===null&&up.shift()}var QP={},eA=new Map,tx=new Map,_R=["abort","abort",UP,"animationEnd",VP,"animationIteration",jP,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",GP,"transitionEnd","waiting","waiting"];function nx(t,e){for(var n=0;n<t.length;n+=2){var r=t[n],o=t[n+1],l="on"+(o[0].toUpperCase()+o.slice(1));l={phasedRegistrationNames:{bubbled:l,captured:l+"Capture"},dependencies:[r],eventPriority:e},tx.set(r,e),eA.set(r,l),QP[o]=l}}nx("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);nx("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);nx(_R,2);for(var iE="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Jv=0;Jv<iE.length;Jv++)tx.set(iE[Jv],0);var xR=Si.unstable_UserBlockingPriority,bR=Si.unstable_runWithPriority,dg=!0;function Ar(t,e){Tp(e,t,!1)}function Tp(t,e,n){var r=tx.get(e);switch(r===void 0?2:r){case 0:r=wR.bind(null,e,1,t);break;case 1:r=ER.bind(null,e,1,t);break;default:r=Uy.bind(null,e,1,t)}n?t.addEventListener(e,r,!0):t.addEventListener(e,r,!1)}function wR(t,e,n,r){Nu||G1();var o=Uy,l=Nu;Nu=!0;try{TP(o,t,e,n,r)}finally{(Nu=l)||W1()}}function ER(t,e,n,r){bR(xR,Uy.bind(null,t,e,n,r))}function Uy(t,e,n,r){if(dg)if(0<os.length&&-1<f0.indexOf(t))t=p0(null,t,e,n,r),os.push(t);else{var o=rx(t,e,n,r);if(o===null)nE(t,r);else if(-1<f0.indexOf(t))t=p0(o,t,e,n,r),os.push(t);else if(!gR(o,t,e,n,r)){nE(t,r),t=$P(t,r,null,e);try{PP(XP,t)}finally{ZP(t)}}}}function rx(t,e,n,r){if(n=Q1(r),n=vd(n),n!==null){var o=hc(n);if(o===null)n=null;else{var l=o.tag;if(l===13){if(n=WP(o),n!==null)return n;n=null}else if(l===3){if(o.stateNode.hydrate)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null)}}t=$P(t,r,n,e);try{PP(XP,t)}finally{ZP(t)}return null}var Ip={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},TR=["Webkit","ms","Moz","O"];Object.keys(Ip).forEach(function(t){TR.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ip[e]=Ip[t]})});function tA(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ip.hasOwnProperty(t)&&Ip[t]?(""+e).trim():e+"px"}function nA(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,o=tA(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,o):t[n]=o}}var SR=no({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function d0(t,e){if(e){if(SR[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(tt(137,t,""));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(tt(60));if(!(typeof e.dangerouslySetInnerHTML=="object"&&"__html"in e.dangerouslySetInnerHTML))throw Error(tt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(tt(62,""))}}function m0(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oE=DP.html;function Gs(t,e){t=t.nodeType===9||t.nodeType===11?t:t.ownerDocument;var n=K1(t);e=V1[e];for(var r=0;r<e.length;r++)c0(e[r],t,n)}function Vg(){}function g0(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function aE(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function sE(t,e){var n=aE(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=aE(n)}}function rA(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?rA(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function lE(){for(var t=window,e=g0();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=g0(t.document)}return e}function y0(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var iA="$",oA="/$",ix="$?",ox="$!",Qv=null,e_=null;function aA(t,e){switch(t){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function v0(t,e){return t==="textarea"||t==="option"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var t_=typeof setTimeout=="function"?setTimeout:void 0,PR=typeof clearTimeout=="function"?clearTimeout:void 0;function Ch(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break}return t}function uE(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n===iA||n===ox||n===ix){if(e===0)return t;e--}else n===oA&&e++}t=t.previousSibling}return null}var ax=Math.random().toString(36).slice(2),Dl="__reactInternalInstance$"+ax,jg="__reactEventHandlers$"+ax,yd="__reactContainere$"+ax;function vd(t){var e=t[Dl];if(e)return e;for(var n=t.parentNode;n;){if(e=n[yd]||n[Dl]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=uE(t);t!==null;){if(n=t[Dl])return n;t=uE(t)}return e}t=n,n=t.parentNode}return null}function _d(t){return t=t[Dl]||t[yd],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Qu(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(tt(33))}function sx(t){return t[jg]||null}function Ws(t){do t=t.return;while(t&&t.tag!==5);return t||null}function sA(t,e){var n=t.stateNode;if(!n)return null;var r=U1(n);if(!r)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(tt(231,e,typeof n));return n}function cE(t,e,n){(e=sA(t,n.dispatchConfig.phasedRegistrationNames[e]))&&(n._dispatchListeners=Fh(n._dispatchListeners,e),n._dispatchInstances=Fh(n._dispatchInstances,t))}function AR(t){if(t&&t.dispatchConfig.phasedRegistrationNames){for(var e=t._targetInst,n=[];e;)n.push(e),e=Ws(e);for(e=n.length;0<e--;)cE(n[e],"captured",t);for(e=0;e<n.length;e++)cE(n[e],"bubbled",t)}}function _0(t,e,n){t&&n&&n.dispatchConfig.registrationName&&(e=sA(t,n.dispatchConfig.registrationName))&&(n._dispatchListeners=Fh(n._dispatchListeners,e),n._dispatchInstances=Fh(n._dispatchInstances,t))}function CR(t){t&&t.dispatchConfig.registrationName&&_0(t._targetInst,null,t)}function Nh(t){J1(t,AR)}var Fl=null,lx=null,mg=null;function lA(){if(mg)return mg;var t,e=lx,n=e.length,r,o="value"in Fl?Fl.value:Fl.textContent,l=o.length;for(t=0;t<n&&e[t]===o[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===o[l-r];r++);return mg=o.slice(t,1<r?1-r:void 0)}function gg(){return!0}function Gg(){return!1}function jo(t,e,n,r){this.dispatchConfig=t,this._targetInst=e,this.nativeEvent=n,t=this.constructor.Interface;for(var o in t)t.hasOwnProperty(o)&&((e=t[o])?this[o]=e(n):o==="target"?this.target=r:this[o]=n[o]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?gg:Gg,this.isPropagationStopped=Gg,this}no(jo.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=gg)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=gg)},persist:function(){this.isPersistent=gg},isPersistent:Gg,destructor:function(){var t=this.constructor.Interface,e;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Gg,this._dispatchInstances=this._dispatchListeners=null}});jo.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};jo.extend=function(t){function e(){}function n(){return r.apply(this,arguments)}var r=this;e.prototype=r.prototype;var o=new e;return no(o,n.prototype),n.prototype=o,n.prototype.constructor=n,n.Interface=no({},r.Interface,t),n.extend=r.extend,uA(n),n};uA(jo);function IR(t,e,n,r){if(this.eventPool.length){var o=this.eventPool.pop();return this.call(o,t,e,n,r),o}return new this(t,e,n,r)}function MR(t){if(!(t instanceof this))throw Error(tt(279));t.destructor(),10>this.eventPool.length&&this.eventPool.push(t)}function uA(t){t.eventPool=[],t.getPooled=IR,t.release=MR}var kR=jo.extend({data:null}),LR=jo.extend({data:null}),RR=[9,13,27,32],ux=iu&&"CompositionEvent"in window,Mp=null;iu&&"documentMode"in document&&(Mp=document.documentMode);var OR=iu&&"TextEvent"in window&&!Mp,cA=iu&&(!ux||Mp&&8<Mp&&11>=Mp),hE=String.fromCharCode(32),Vs={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},fE=!1;function hA(t,e){switch(t){case"keyup":return RR.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function fA(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var yh=!1;function zR(t,e){switch(t){case"compositionend":return fA(e);case"keypress":return e.which!==32?null:(fE=!0,hE);case"textInput":return t=e.data,t===hE&&fE?null:t;default:return null}}function DR(t,e){if(yh)return t==="compositionend"||!ux&&hA(t,e)?(t=lA(),mg=lx=Fl=null,yh=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return cA&&e.locale!=="ko"?null:e.data;default:return null}}var FR={eventTypes:Vs,extractEvents:function(t,e,n,r){var o;if(ux)e:{switch(t){case"compositionstart":var l=Vs.compositionStart;break e;case"compositionend":l=Vs.compositionEnd;break e;case"compositionupdate":l=Vs.compositionUpdate;break e}l=void 0}else yh?hA(t,n)&&(l=Vs.compositionEnd):t==="keydown"&&n.keyCode===229&&(l=Vs.compositionStart);return l?(cA&&n.locale!=="ko"&&(yh||l!==Vs.compositionStart?l===Vs.compositionEnd&&yh&&(o=lA()):(Fl=r,lx="value"in Fl?Fl.value:Fl.textContent,yh=!0)),l=kR.getPooled(l,e,n,r),o?l.data=o:(o=fA(n),o!==null&&(l.data=o)),Nh(l),o=l):o=null,(t=OR?zR(t,n):DR(t,n))?(e=LR.getPooled(Vs.beforeInput,e,n,r),e.data=t,Nh(e)):e=null,o===null?e:e===null?o:[o,e]}},NR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pA(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!NR[t.type]:e==="textarea"}var dA={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function mA(t,e,n){return t=jo.getPooled(dA.change,t,e,n),t.type="change",wP(n),Nh(t),t}var kp=null,qp=null;function BR(t){By(t)}function Vy(t){var e=Qu(t);if(RP(e))return t}function UR(t,e){if(t==="change")return e}var x0=!1;iu&&(x0=qP("input")&&(!document.documentMode||9<document.documentMode));function pE(){kp&&(kp.detachEvent("onpropertychange",gA),qp=kp=null)}function gA(t){if(t.propertyName==="value"&&Vy(qp))if(t=mA(qp,t,Q1(t)),Nu)By(t);else{Nu=!0;try{j1(BR,t)}finally{Nu=!1,W1()}}}function VR(t,e,n){t==="focus"?(pE(),kp=e,qp=n,kp.attachEvent("onpropertychange",gA)):t==="blur"&&pE()}function jR(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Vy(qp)}function GR(t,e){if(t==="click")return Vy(e)}function WR(t,e){if(t==="input"||t==="change")return Vy(e)}var HR={eventTypes:dA,_isInputEventSupported:x0,extractEvents:function(t,e,n,r){var o=e?Qu(e):window,l=o.nodeName&&o.nodeName.toLowerCase();if(l==="select"||l==="input"&&o.type==="file")var a=UR;else if(pA(o))if(x0)a=WR;else{a=jR;var d=VR}else(l=o.nodeName)&&l.toLowerCase()==="input"&&(o.type==="checkbox"||o.type==="radio")&&(a=GR);if(a&&(a=a(t,e)))return mA(a,n,r);d&&d(t,o,e),t==="blur"&&(t=o._wrapperState)&&t.controlled&&o.type==="number"&&a0(o,"number",o.value)}},xd=jo.extend({view:null,detail:null}),qR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ZR(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=qR[t])?!!e[t]:!1}function cx(){return ZR}var dE=0,mE=0,gE=!1,yE=!1,bd=xd.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:cx,button:null,buttons:null,relatedTarget:function(t){return t.relatedTarget||(t.fromElement===t.srcElement?t.toElement:t.fromElement)},movementX:function(t){if("movementX"in t)return t.movementX;var e=dE;return dE=t.screenX,gE?t.type==="mousemove"?t.screenX-e:0:(gE=!0,0)},movementY:function(t){if("movementY"in t)return t.movementY;var e=mE;return mE=t.screenY,yE?t.type==="mousemove"?t.screenY-e:0:(yE=!0,0)}}),yA=bd.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fp={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},$R={eventTypes:fp,extractEvents:function(t,e,n,r,o){var l=t==="mouseover"||t==="pointerover",a=t==="mouseout"||t==="pointerout";if(l&&!(o&32)&&(n.relatedTarget||n.fromElement)||!a&&!l)return null;if(l=r.window===r?r:(l=r.ownerDocument)?l.defaultView||l.parentWindow:window,a){if(a=e,e=(e=n.relatedTarget||n.toElement)?vd(e):null,e!==null){var d=hc(e);(e!==d||e.tag!==5&&e.tag!==6)&&(e=null)}}else a=null;if(a===e)return null;if(t==="mouseout"||t==="mouseover")var g=bd,x=fp.mouseLeave,E=fp.mouseEnter,P="mouse";else(t==="pointerout"||t==="pointerover")&&(g=yA,x=fp.pointerLeave,E=fp.pointerEnter,P="pointer");if(t=a==null?l:Qu(a),l=e==null?l:Qu(e),x=g.getPooled(x,a,n,r),x.type=P+"leave",x.target=t,x.relatedTarget=l,n=g.getPooled(E,e,n,r),n.type=P+"enter",n.target=l,n.relatedTarget=t,r=a,P=e,r&&P)e:{for(g=r,E=P,a=0,t=g;t;t=Ws(t))a++;for(t=0,e=E;e;e=Ws(e))t++;for(;0<a-t;)g=Ws(g),a--;for(;0<t-a;)E=Ws(E),t--;for(;a--;){if(g===E||g===E.alternate)break e;g=Ws(g),E=Ws(E)}g=null}else g=null;for(E=g,g=[];r&&r!==E&&(a=r.alternate,!(a!==null&&a===E));)g.push(r),r=Ws(r);for(r=[];P&&P!==E&&(a=P.alternate,!(a!==null&&a===E));)r.push(P),P=Ws(P);for(P=0;P<g.length;P++)_0(g[P],"bubbled",x);for(P=r.length;0<P--;)_0(r[P],"captured",n);return o&64?[x,n]:[x]}};function XR(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ec=typeof Object.is=="function"?Object.is:XR,YR=Object.prototype.hasOwnProperty;function Zp(t,e){if(ec(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!YR.call(e,n[r])||!ec(t[n[r]],e[n[r]]))return!1;return!0}var KR=iu&&"documentMode"in document&&11>=document.documentMode,vA={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},vh=null,b0=null,Lp=null,w0=!1;function vE(t,e){var n=e.window===e?e.document:e.nodeType===9?e:e.ownerDocument;return w0||vh==null||vh!==g0(n)?null:(n=vh,"selectionStart"in n&&y0(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Lp&&Zp(Lp,n)?null:(Lp=n,t=jo.getPooled(vA.select,b0,t,e),t.type="select",t.target=vh,Nh(t),t))}var JR={eventTypes:vA,extractEvents:function(t,e,n,r,o,l){if(o=l||(r.window===r?r.document:r.nodeType===9?r:r.ownerDocument),!(l=!o)){e:{o=K1(o),l=V1.onSelect;for(var a=0;a<l.length;a++)if(!o.has(l[a])){o=!1;break e}o=!0}l=!o}if(l)return null;switch(o=e?Qu(e):window,t){case"focus":(pA(o)||o.contentEditable==="true")&&(vh=o,b0=e,Lp=null);break;case"blur":Lp=b0=vh=null;break;case"mousedown":w0=!0;break;case"contextmenu":case"mouseup":case"dragend":return w0=!1,vE(n,r);case"selectionchange":if(KR)break;case"keydown":case"keyup":return vE(n,r)}return null}},QR=jo.extend({animationName:null,elapsedTime:null,pseudoElement:null}),eO=jo.extend({clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),tO=xd.extend({relatedTarget:null});function yg(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}var nO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},iO=xd.extend({key:function(t){if(t.key){var e=nO[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=yg(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?rO[t.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:cx,charCode:function(t){return t.type==="keypress"?yg(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?yg(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),oO=bd.extend({dataTransfer:null}),aO=xd.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:cx}),sO=jo.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),lO=bd.extend({deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:null,deltaMode:null}),uO={eventTypes:QP,extractEvents:function(t,e,n,r){var o=eA.get(t);if(!o)return null;switch(t){case"keypress":if(yg(n)===0)return null;case"keydown":case"keyup":t=iO;break;case"blur":case"focus":t=tO;break;case"click":if(n.button===2)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":t=bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":t=oO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":t=aO;break;case UP:case VP:case jP:t=QR;break;case GP:t=sO;break;case"scroll":t=xd;break;case"wheel":t=lO;break;case"copy":case"cut":case"paste":t=eO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":t=yA;break;default:t=jo}return e=t.getPooled(o,e,n,r),Nh(e),e}};if(Ng)throw Error(tt(101));Ng=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));xP();var cO=_d;U1=sx;vP=cO;_P=Qu;bP({SimpleEventPlugin:uO,EnterLeaveEventPlugin:$R,ChangeEventPlugin:HR,SelectEventPlugin:JR,BeforeInputEventPlugin:FR});var E0=[],_h=-1;function gr(t){0>_h||(t.current=E0[_h],E0[_h]=null,_h--)}function Wr(t,e){_h++,E0[_h]=t.current,t.current=e}var tu={},Wi={current:tu},po={current:!1},tc=tu;function Bh(t,e){var n=t.type.contextTypes;if(!n)return tu;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var o={},l;for(l in n)o[l]=e[l];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function mo(t){return t=t.childContextTypes,t!=null}function Wg(){gr(po),gr(Wi)}function _E(t,e,n){if(Wi.current!==tu)throw Error(tt(168));Wr(Wi,e),Wr(po,n)}function _A(t,e,n){var r=t.stateNode;if(t=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var o in r)if(!(o in t))throw Error(tt(108,Ys(e)||"Unknown",o));return no({},n,{},r)}function vg(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||tu,tc=Wi.current,Wr(Wi,t),Wr(po,po.current),!0}function xE(t,e,n){var r=t.stateNode;if(!r)throw Error(tt(169));n?(t=_A(t,e,tc),r.__reactInternalMemoizedMergedChildContext=t,gr(po),gr(Wi),Wr(Wi,t)):gr(po),Wr(po,n)}var hO=Si.unstable_runWithPriority,hx=Si.unstable_scheduleCallback,xA=Si.unstable_cancelCallback,bE=Si.unstable_requestPaint,T0=Si.unstable_now,fO=Si.unstable_getCurrentPriorityLevel,jy=Si.unstable_ImmediatePriority,bA=Si.unstable_UserBlockingPriority,wA=Si.unstable_NormalPriority,EA=Si.unstable_LowPriority,TA=Si.unstable_IdlePriority,SA={},pO=Si.unstable_shouldYield,dO=bE!==void 0?bE:function(){},Hs=null,_g=null,n_=!1,wE=T0(),na=1e4>wE?T0:function(){return T0()-wE};function Gy(){switch(fO()){case jy:return 99;case bA:return 98;case wA:return 97;case EA:return 96;case TA:return 95;default:throw Error(tt(332))}}function PA(t){switch(t){case 99:return jy;case 98:return bA;case 97:return wA;case 96:return EA;case 95:return TA;default:throw Error(tt(332))}}function nu(t,e){return t=PA(t),hO(t,e)}function AA(t,e,n){return t=PA(t),hx(t,e,n)}function EE(t){return Hs===null?(Hs=[t],_g=hx(jy,CA)):Hs.push(t),SA}function gs(){if(_g!==null){var t=_g;_g=null,xA(t)}CA()}function CA(){if(!n_&&Hs!==null){n_=!0;var t=0;try{var e=Hs;nu(99,function(){for(;t<e.length;t++){var n=e[t];do n=n(!0);while(n!==null)}}),Hs=null}catch(n){throw Hs!==null&&(Hs=Hs.slice(t+1)),hx(jy,gs),n}finally{n_=!1}}}function xg(t,e,n){return n/=10,1073741821-(((1073741821-t+e/10)/n|0)+1)*n}function Pa(t,e){if(t&&t.defaultProps){e=no({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n])}return e}var Hg={current:null},qg=null,xh=null,Zg=null;function fx(){Zg=xh=qg=null}function px(t){var e=Hg.current;gr(Hg),t.type._context._currentValue=e}function IA(t,e){for(;t!==null;){var n=t.alternate;if(t.childExpirationTime<e)t.childExpirationTime=e,n!==null&&n.childExpirationTime<e&&(n.childExpirationTime=e);else if(n!==null&&n.childExpirationTime<e)n.childExpirationTime=e;else break;t=t.return}}function Ih(t,e){qg=t,Zg=xh=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.expirationTime>=e&&(as=!0),t.firstContext=null)}function aa(t,e){if(Zg!==t&&e!==!1&&e!==0)if((typeof e!="number"||e===1073741823)&&(Zg=t,e=1073741823),e={context:t,observedBits:e,next:null},xh===null){if(qg===null)throw Error(tt(308));xh=e,qg.dependencies={expirationTime:0,firstContext:e,responders:null}}else xh=xh.next=e;return t._currentValue}var Ol=!1;function dx(t){t.updateQueue={baseState:t.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function mx(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,baseQueue:t.baseQueue,shared:t.shared,effects:t.effects})}function Hl(t,e){return t={expirationTime:t,suspenseConfig:e,tag:0,payload:null,callback:null,next:null},t.next=t}function ql(t,e){if(t=t.updateQueue,t!==null){t=t.shared;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}}function TE(t,e){var n=t.alternate;n!==null&&mx(n,t),t=t.updateQueue,n=t.baseQueue,n===null?(t.baseQueue=e.next=e,e.next=e):(e.next=n.next,n.next=e)}function $p(t,e,n,r){var o=t.updateQueue;Ol=!1;var l=o.baseQueue,a=o.shared.pending;if(a!==null){if(l!==null){var d=l.next;l.next=a.next,a.next=d}l=a,o.shared.pending=null,d=t.alternate,d!==null&&(d=d.updateQueue,d!==null&&(d.baseQueue=a))}if(l!==null){d=l.next;var g=o.baseState,x=0,E=null,P=null,A=null;if(d!==null){var R=d;do{if(a=R.expirationTime,a<r){var j={expirationTime:R.expirationTime,suspenseConfig:R.suspenseConfig,tag:R.tag,payload:R.payload,callback:R.callback,next:null};A===null?(P=A=j,E=g):A=A.next=j,a>x&&(x=a)}else{A!==null&&(A=A.next={expirationTime:1073741823,suspenseConfig:R.suspenseConfig,tag:R.tag,payload:R.payload,callback:R.callback,next:null}),oC(a,R.suspenseConfig);e:{var X=t,D=R;switch(a=e,j=n,D.tag){case 1:if(X=D.payload,typeof X=="function"){g=X.call(j,g,a);break e}g=X;break e;case 3:X.effectTag=X.effectTag&-4097|64;case 0:if(X=D.payload,a=typeof X=="function"?X.call(j,g,a):X,a==null)break e;g=no({},g,a);break e;case 2:Ol=!0}}R.callback!==null&&(t.effectTag|=32,a=o.effects,a===null?o.effects=[R]:a.push(R))}if(R=R.next,R===null||R===d){if(a=o.shared.pending,a===null)break;R=l.next=a.next,a.next=d,o.baseQueue=l=a,o.shared.pending=null}}while(1)}A===null?E=g:A.next=P,o.baseState=E,o.baseQueue=A,$y(x),t.expirationTime=x,t.memoizedState=g}}function SE(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],o=r.callback;if(o!==null){if(r.callback=null,r=o,o=n,typeof r!="function")throw Error(tt(191,r));r.call(o)}}}var Rp=Ia.ReactCurrentBatchConfig,MA=new Fy.Component().refs;function $g(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:no({},e,n),t.memoizedState=n,t.expirationTime===0&&(t.updateQueue.baseState=n)}var Wy={isMounted:function(t){return(t=t._reactInternalFiber)?hc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternalFiber;var r=fs(),o=Rp.suspense;r=Yu(r,t,o),o=Hl(r,o),o.payload=e,n!=null&&(o.callback=n),ql(t,o),$l(t,r)},enqueueReplaceState:function(t,e,n){t=t._reactInternalFiber;var r=fs(),o=Rp.suspense;r=Yu(r,t,o),o=Hl(r,o),o.tag=1,o.payload=e,n!=null&&(o.callback=n),ql(t,o),$l(t,r)},enqueueForceUpdate:function(t,e){t=t._reactInternalFiber;var n=fs(),r=Rp.suspense;n=Yu(n,t,r),r=Hl(n,r),r.tag=2,e!=null&&(r.callback=e),ql(t,r),$l(t,n)}};function PE(t,e,n,r,o,l,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,l,a):e.prototype&&e.prototype.isPureReactComponent?!Zp(n,r)||!Zp(o,l):!0}function kA(t,e,n){var r=!1,o=tu,l=e.contextType;return typeof l=="object"&&l!==null?l=aa(l):(o=mo(e)?tc:Wi.current,r=e.contextTypes,l=(r=r!=null)?Bh(t,o):tu),e=new e(n,l),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Wy,t.stateNode=e,e._reactInternalFiber=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=l),e}function AE(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Wy.enqueueReplaceState(e,e.state,null)}function S0(t,e,n,r){var o=t.stateNode;o.props=n,o.state=t.memoizedState,o.refs=MA,dx(t);var l=e.contextType;typeof l=="object"&&l!==null?o.context=aa(l):(l=mo(e)?tc:Wi.current,o.context=Bh(t,l)),$p(t,n,o,r),o.state=t.memoizedState,l=e.getDerivedStateFromProps,typeof l=="function"&&($g(t,e,l,n),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&Wy.enqueueReplaceState(o,o.state,null),$p(t,n,o,r),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.effectTag|=4)}var jm=Array.isArray;function pp(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(tt(309));var r=n.stateNode}if(!r)throw Error(tt(147,t));var o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(l){var a=r.refs;a===MA&&(a=r.refs={}),l===null?delete a[o]:a[o]=l},e._stringRef=o,e)}if(typeof t!="string")throw Error(tt(284));if(!n._owner)throw Error(tt(290,t))}return t}function Gm(t,e){if(t.type!=="textarea")throw Error(tt(31,Object.prototype.toString.call(e)==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":e,""))}function LA(t){function e(D,F){if(t){var W=D.lastEffect;W!==null?(W.nextEffect=F,D.lastEffect=F):D.firstEffect=D.lastEffect=F,F.nextEffect=null,F.effectTag=8}}function n(D,F){if(!t)return null;for(;F!==null;)e(D,F),F=F.sibling;return null}function r(D,F){for(D=new Map;F!==null;)F.key!==null?D.set(F.key,F):D.set(F.index,F),F=F.sibling;return D}function o(D,F){return D=nc(D,F),D.index=0,D.sibling=null,D}function l(D,F,W){return D.index=W,t?(W=D.alternate,W!==null?(W=W.index,W<F?(D.effectTag=2,F):W):(D.effectTag=2,F)):F}function a(D){return t&&D.alternate===null&&(D.effectTag=2),D}function d(D,F,W,J){return F===null||F.tag!==6?(F=l_(W,D.mode,J),F.return=D,F):(F=o(F,W),F.return=D,F)}function g(D,F,W,J){return F!==null&&F.elementType===W.type?(J=o(F,W.props),J.ref=pp(D,F,W),J.return=D,J):(J=Tg(W.type,W.key,W.props,null,D.mode,J),J.ref=pp(D,F,W),J.return=D,J)}function x(D,F,W,J){return F===null||F.tag!==4||F.stateNode.containerInfo!==W.containerInfo||F.stateNode.implementation!==W.implementation?(F=u_(W,D.mode,J),F.return=D,F):(F=o(F,W.children||[]),F.return=D,F)}function E(D,F,W,J,le){return F===null||F.tag!==7?(F=Ul(W,D.mode,J,le),F.return=D,F):(F=o(F,W),F.return=D,F)}function P(D,F,W){if(typeof F=="string"||typeof F=="number")return F=l_(""+F,D.mode,W),F.return=D,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case Nm:return W=Tg(F.type,F.key,F.props,null,D.mode,W),W.ref=pp(D,null,F),W.return=D,W;case mh:return F=u_(F,D.mode,W),F.return=D,F}if(jm(F)||sp(F))return F=Ul(F,D.mode,W,null),F.return=D,F;Gm(D,F)}return null}function A(D,F,W,J){var le=F!==null?F.key:null;if(typeof W=="string"||typeof W=="number")return le!==null?null:d(D,F,""+W,J);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case Nm:return W.key===le?W.type===Fu?E(D,F,W.props.children,J,le):g(D,F,W,J):null;case mh:return W.key===le?x(D,F,W,J):null}if(jm(W)||sp(W))return le!==null?null:E(D,F,W,J,null);Gm(D,W)}return null}function R(D,F,W,J,le){if(typeof J=="string"||typeof J=="number")return D=D.get(W)||null,d(F,D,""+J,le);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case Nm:return D=D.get(J.key===null?W:J.key)||null,J.type===Fu?E(F,D,J.props.children,le,J.key):g(F,D,J,le);case mh:return D=D.get(J.key===null?W:J.key)||null,x(F,D,J,le)}if(jm(J)||sp(J))return D=D.get(W)||null,E(F,D,J,le,null);Gm(F,J)}return null}function j(D,F,W,J){for(var le=null,ue=null,ye=F,Ee=F=0,Pe=null;ye!==null&&Ee<W.length;Ee++){ye.index>Ee?(Pe=ye,ye=null):Pe=ye.sibling;var we=A(D,ye,W[Ee],J);if(we===null){ye===null&&(ye=Pe);break}t&&ye&&we.alternate===null&&e(D,ye),F=l(we,F,Ee),ue===null?le=we:ue.sibling=we,ue=we,ye=Pe}if(Ee===W.length)return n(D,ye),le;if(ye===null){for(;Ee<W.length;Ee++)ye=P(D,W[Ee],J),ye!==null&&(F=l(ye,F,Ee),ue===null?le=ye:ue.sibling=ye,ue=ye);return le}for(ye=r(D,ye);Ee<W.length;Ee++)Pe=R(ye,D,Ee,W[Ee],J),Pe!==null&&(t&&Pe.alternate!==null&&ye.delete(Pe.key===null?Ee:Pe.key),F=l(Pe,F,Ee),ue===null?le=Pe:ue.sibling=Pe,ue=Pe);return t&&ye.forEach(function(ze){return e(D,ze)}),le}function X(D,F,W,J){var le=sp(W);if(typeof le!="function")throw Error(tt(150));if(W=le.call(W),W==null)throw Error(tt(151));for(var ue=le=null,ye=F,Ee=F=0,Pe=null,we=W.next();ye!==null&&!we.done;Ee++,we=W.next()){ye.index>Ee?(Pe=ye,ye=null):Pe=ye.sibling;var ze=A(D,ye,we.value,J);if(ze===null){ye===null&&(ye=Pe);break}t&&ye&&ze.alternate===null&&e(D,ye),F=l(ze,F,Ee),ue===null?le=ze:ue.sibling=ze,ue=ze,ye=Pe}if(we.done)return n(D,ye),le;if(ye===null){for(;!we.done;Ee++,we=W.next())we=P(D,we.value,J),we!==null&&(F=l(we,F,Ee),ue===null?le=we:ue.sibling=we,ue=we);return le}for(ye=r(D,ye);!we.done;Ee++,we=W.next())we=R(ye,D,Ee,we.value,J),we!==null&&(t&&we.alternate!==null&&ye.delete(we.key===null?Ee:we.key),F=l(we,F,Ee),ue===null?le=we:ue.sibling=we,ue=we);return t&&ye.forEach(function(Fe){return e(D,Fe)}),le}return function(D,F,W,J){var le=typeof W=="object"&&W!==null&&W.type===Fu&&W.key===null;le&&(W=W.props.children);var ue=typeof W=="object"&&W!==null;if(ue)switch(W.$$typeof){case Nm:e:{for(ue=W.key,le=F;le!==null;){if(le.key===ue){switch(le.tag){case 7:if(W.type===Fu){n(D,le.sibling),F=o(le,W.props.children),F.return=D,D=F;break e}break;default:if(le.elementType===W.type){n(D,le.sibling),F=o(le,W.props),F.ref=pp(D,le,W),F.return=D,D=F;break e}}n(D,le);break}else e(D,le);le=le.sibling}W.type===Fu?(F=Ul(W.props.children,D.mode,J,W.key),F.return=D,D=F):(J=Tg(W.type,W.key,W.props,null,D.mode,J),J.ref=pp(D,F,W),J.return=D,D=J)}return a(D);case mh:e:{for(le=W.key;F!==null;){if(F.key===le)if(F.tag===4&&F.stateNode.containerInfo===W.containerInfo&&F.stateNode.implementation===W.implementation){n(D,F.sibling),F=o(F,W.children||[]),F.return=D,D=F;break e}else{n(D,F);break}else e(D,F);F=F.sibling}F=u_(W,D.mode,J),F.return=D,D=F}return a(D)}if(typeof W=="string"||typeof W=="number")return W=""+W,F!==null&&F.tag===6?(n(D,F.sibling),F=o(F,W),F.return=D,D=F):(n(D,F),F=l_(W,D.mode,J),F.return=D,D=F),a(D);if(jm(W))return j(D,F,W,J);if(sp(W))return X(D,F,W,J);if(ue&&Gm(D,W),typeof W>"u"&&!le)switch(D.tag){case 1:case 0:throw D=D.type,Error(tt(152,D.displayName||D.name||"Component"))}return n(D,F)}}var Uh=LA(!0),gx=LA(!1),wd={},hs={current:wd},Xp={current:wd},Yp={current:wd};function Bu(t){if(t===wd)throw Error(tt(174));return t}function P0(t,e){switch(Wr(Yp,e),Wr(Xp,t),Wr(hs,wd),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:u0(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=u0(e,t)}gr(hs),Wr(hs,e)}function Vh(){gr(hs),gr(Xp),gr(Yp)}function CE(t){Bu(Yp.current);var e=Bu(hs.current),n=u0(e,t.type);e!==n&&(Wr(Xp,t),Wr(hs,n))}function yx(t){Xp.current===t&&(gr(hs),gr(Xp))}var Fr={current:0};function Xg(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data===ix||n.data===ox))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.effectTag&64)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}function vx(t,e){return{responder:t,props:e}}var bg=Ia.ReactCurrentDispatcher,ra=Ia.ReactCurrentBatchConfig,Nl=0,oi=null,Ui=null,Vi=null,Yg=!1;function Co(){throw Error(tt(321))}function _x(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ec(t[n],e[n]))return!1;return!0}function xx(t,e,n,r,o,l){if(Nl=l,oi=e,e.memoizedState=null,e.updateQueue=null,e.expirationTime=0,bg.current=t===null||t.memoizedState===null?mO:gO,t=n(r,o),e.expirationTime===Nl){l=0;do{if(e.expirationTime=0,!(25>l))throw Error(tt(301));l+=1,Vi=Ui=null,e.updateQueue=null,bg.current=yO,t=n(r,o)}while(e.expirationTime===Nl)}if(bg.current=Qg,e=Ui!==null&&Ui.next!==null,Nl=0,Vi=Ui=oi=null,Yg=!1,e)throw Error(tt(300));return t}function Mh(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vi===null?oi.memoizedState=Vi=t:Vi=Vi.next=t,Vi}function ef(){if(Ui===null){var t=oi.alternate;t=t!==null?t.memoizedState:null}else t=Ui.next;var e=Vi===null?oi.memoizedState:Vi.next;if(e!==null)Vi=e,Ui=t;else{if(t===null)throw Error(tt(310));Ui=t,t={memoizedState:Ui.memoizedState,baseState:Ui.baseState,baseQueue:Ui.baseQueue,queue:Ui.queue,next:null},Vi===null?oi.memoizedState=Vi=t:Vi=Vi.next=t}return Vi}function Zu(t,e){return typeof e=="function"?e(t):e}function Wm(t){var e=ef(),n=e.queue;if(n===null)throw Error(tt(311));n.lastRenderedReducer=t;var r=Ui,o=r.baseQueue,l=n.pending;if(l!==null){if(o!==null){var a=o.next;o.next=l.next,l.next=a}r.baseQueue=o=l,n.pending=null}if(o!==null){o=o.next,r=r.baseState;var d=a=l=null,g=o;do{var x=g.expirationTime;if(x<Nl){var E={expirationTime:g.expirationTime,suspenseConfig:g.suspenseConfig,action:g.action,eagerReducer:g.eagerReducer,eagerState:g.eagerState,next:null};d===null?(a=d=E,l=r):d=d.next=E,x>oi.expirationTime&&(oi.expirationTime=x,$y(x))}else d!==null&&(d=d.next={expirationTime:1073741823,suspenseConfig:g.suspenseConfig,action:g.action,eagerReducer:g.eagerReducer,eagerState:g.eagerState,next:null}),oC(x,g.suspenseConfig),r=g.eagerReducer===t?g.eagerState:t(r,g.action);g=g.next}while(g!==null&&g!==o);d===null?l=r:d.next=a,ec(r,e.memoizedState)||(as=!0),e.memoizedState=r,e.baseState=l,e.baseQueue=d,n.lastRenderedState=r}return[e.memoizedState,n.dispatch]}function Hm(t){var e=ef(),n=e.queue;if(n===null)throw Error(tt(311));n.lastRenderedReducer=t;var r=n.dispatch,o=n.pending,l=e.memoizedState;if(o!==null){n.pending=null;var a=o=o.next;do l=t(l,a.action),a=a.next;while(a!==o);ec(l,e.memoizedState)||(as=!0),e.memoizedState=l,e.baseQueue===null&&(e.baseState=l),n.lastRenderedState=l}return[l,r]}function r_(t){var e=Mh();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t=e.queue={pending:null,dispatch:null,lastRenderedReducer:Zu,lastRenderedState:t},t=t.dispatch=NA.bind(null,oi,t),[e.memoizedState,t]}function A0(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=oi.updateQueue,e===null?(e={lastEffect:null},oi.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function RA(){return ef().memoizedState}function C0(t,e,n,r){var o=Mh();oi.effectTag|=t,o.memoizedState=A0(1|e,n,void 0,r===void 0?null:r)}function bx(t,e,n,r){var o=ef();r=r===void 0?null:r;var l=void 0;if(Ui!==null){var a=Ui.memoizedState;if(l=a.destroy,r!==null&&_x(r,a.deps)){A0(e,n,l,r);return}}oi.effectTag|=t,o.memoizedState=A0(1|e,n,l,r)}function IE(t,e){return C0(516,4,t,e)}function Kg(t,e){return bx(516,4,t,e)}function OA(t,e){return bx(4,2,t,e)}function zA(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function DA(t,e,n){return n=n!=null?n.concat([t]):null,bx(4,2,zA.bind(null,e,t),n)}function wx(){}function ME(t,e){return Mh().memoizedState=[t,e===void 0?null:e],t}function Jg(t,e){var n=ef();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&_x(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function FA(t,e){var n=ef();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&_x(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Ex(t,e,n){var r=Gy();nu(98>r?98:r,function(){t(!0)}),nu(97<r?97:r,function(){var o=ra.suspense;ra.suspense=e===void 0?null:e;try{t(!1),n()}finally{ra.suspense=o}})}function NA(t,e,n){var r=fs(),o=Rp.suspense;r=Yu(r,t,o),o={expirationTime:r,suspenseConfig:o,action:n,eagerReducer:null,eagerState:null,next:null};var l=e.pending;if(l===null?o.next=o:(o.next=l.next,l.next=o),e.pending=o,l=t.alternate,t===oi||l!==null&&l===oi)Yg=!0,o.expirationTime=Nl,oi.expirationTime=Nl;else{if(t.expirationTime===0&&(l===null||l.expirationTime===0)&&(l=e.lastRenderedReducer,l!==null))try{var a=e.lastRenderedState,d=l(a,n);if(o.eagerReducer=l,o.eagerState=d,ec(d,a))return}catch{}finally{}$l(t,r)}}var Qg={readContext:aa,useCallback:Co,useContext:Co,useEffect:Co,useImperativeHandle:Co,useLayoutEffect:Co,useMemo:Co,useReducer:Co,useRef:Co,useState:Co,useDebugValue:Co,useResponder:Co,useDeferredValue:Co,useTransition:Co},mO={readContext:aa,useCallback:ME,useContext:aa,useEffect:IE,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,C0(4,2,zA.bind(null,e,t),n)},useLayoutEffect:function(t,e){return C0(4,2,t,e)},useMemo:function(t,e){var n=Mh();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Mh();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t=r.queue={pending:null,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},t=t.dispatch=NA.bind(null,oi,t),[r.memoizedState,t]},useRef:function(t){var e=Mh();return t={current:t},e.memoizedState=t},useState:r_,useDebugValue:wx,useResponder:vx,useDeferredValue:function(t,e){var n=r_(t),r=n[0],o=n[1];return IE(function(){var l=ra.suspense;ra.suspense=e===void 0?null:e;try{o(t)}finally{ra.suspense=l}},[t,e]),r},useTransition:function(t){var e=r_(!1),n=e[0];return e=e[1],[ME(Ex.bind(null,e,t),[e,t]),n]}},gO={readContext:aa,useCallback:Jg,useContext:aa,useEffect:Kg,useImperativeHandle:DA,useLayoutEffect:OA,useMemo:FA,useReducer:Wm,useRef:RA,useState:function(){return Wm(Zu)},useDebugValue:wx,useResponder:vx,useDeferredValue:function(t,e){var n=Wm(Zu),r=n[0],o=n[1];return Kg(function(){var l=ra.suspense;ra.suspense=e===void 0?null:e;try{o(t)}finally{ra.suspense=l}},[t,e]),r},useTransition:function(t){var e=Wm(Zu),n=e[0];return e=e[1],[Jg(Ex.bind(null,e,t),[e,t]),n]}},yO={readContext:aa,useCallback:Jg,useContext:aa,useEffect:Kg,useImperativeHandle:DA,useLayoutEffect:OA,useMemo:FA,useReducer:Hm,useRef:RA,useState:function(){return Hm(Zu)},useDebugValue:wx,useResponder:vx,useDeferredValue:function(t,e){var n=Hm(Zu),r=n[0],o=n[1];return Kg(function(){var l=ra.suspense;ra.suspense=e===void 0?null:e;try{o(t)}finally{ra.suspense=l}},[t,e]),r},useTransition:function(t){var e=Hm(Zu),n=e[0];return e=e[1],[Jg(Ex.bind(null,e,t),[e,t]),n]}},$s=null,Bl=null,$u=!1;function BA(t,e){var n=ss(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=e,n.return=t,n.effectTag=8,t.lastEffect!==null?(t.lastEffect.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n}function kE(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,!0):!1;case 13:return!1;default:return!1}}function I0(t){if($u){var e=Bl;if(e){var n=e;if(!kE(t,e)){if(e=Ch(n.nextSibling),!e||!kE(t,e)){t.effectTag=t.effectTag&-1025|2,$u=!1,$s=t;return}BA($s,n)}$s=t,Bl=Ch(e.firstChild)}else t.effectTag=t.effectTag&-1025|2,$u=!1,$s=t}}function LE(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;$s=t}function qm(t){if(t!==$s)return!1;if(!$u)return LE(t),$u=!0,!1;var e=t.type;if(t.tag!==5||e!=="head"&&e!=="body"&&!v0(e,t.memoizedProps))for(e=Bl;e;)BA(t,e),e=Ch(e.nextSibling);if(LE(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(tt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n===oA){if(e===0){Bl=Ch(t.nextSibling);break e}e--}else n!==iA&&n!==ox&&n!==ix||e++}t=t.nextSibling}Bl=null}}else Bl=$s?Ch(t.stateNode.nextSibling):null;return!0}function i_(){Bl=$s=null,$u=!1}var vO=Ia.ReactCurrentOwner,as=!1;function ko(t,e,n,r){e.child=t===null?gx(e,null,n,r):Uh(e,t.child,n,r)}function RE(t,e,n,r,o){n=n.render;var l=e.ref;return Ih(e,o),r=xx(t,e,n,r,l,o),t!==null&&!as?(e.updateQueue=t.updateQueue,e.effectTag&=-517,t.expirationTime<=o&&(t.expirationTime=0),Xs(t,e,o)):(e.effectTag|=1,ko(t,e,r,o),e.child)}function OE(t,e,n,r,o,l){if(t===null){var a=n.type;return typeof a=="function"&&!Cx(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=a,UA(t,e,a,r,o,l)):(t=Tg(n.type,null,r,null,e.mode,l),t.ref=e.ref,t.return=e,e.child=t)}return a=t.child,o<l&&(o=a.memoizedProps,n=n.compare,n=n!==null?n:Zp,n(o,r)&&t.ref===e.ref)?Xs(t,e,l):(e.effectTag|=1,t=nc(a,r),t.ref=e.ref,t.return=e,e.child=t)}function UA(t,e,n,r,o,l){return t!==null&&Zp(t.memoizedProps,r)&&t.ref===e.ref&&(as=!1,o<l)?(e.expirationTime=t.expirationTime,Xs(t,e,l)):M0(t,e,n,r,l)}function VA(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.effectTag|=128)}function M0(t,e,n,r,o){var l=mo(n)?tc:Wi.current;return l=Bh(e,l),Ih(e,o),n=xx(t,e,n,r,l,o),t!==null&&!as?(e.updateQueue=t.updateQueue,e.effectTag&=-517,t.expirationTime<=o&&(t.expirationTime=0),Xs(t,e,o)):(e.effectTag|=1,ko(t,e,n,o),e.child)}function zE(t,e,n,r,o){if(mo(n)){var l=!0;vg(e)}else l=!1;if(Ih(e,o),e.stateNode===null)t!==null&&(t.alternate=null,e.alternate=null,e.effectTag|=2),kA(e,n,r),S0(e,n,r,o),r=!0;else if(t===null){var a=e.stateNode,d=e.memoizedProps;a.props=d;var g=a.context,x=n.contextType;typeof x=="object"&&x!==null?x=aa(x):(x=mo(n)?tc:Wi.current,x=Bh(e,x));var E=n.getDerivedStateFromProps,P=typeof E=="function"||typeof a.getSnapshotBeforeUpdate=="function";P||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(d!==r||g!==x)&&AE(e,a,r,x),Ol=!1;var A=e.memoizedState;a.state=A,$p(e,r,a,o),g=e.memoizedState,d!==r||A!==g||po.current||Ol?(typeof E=="function"&&($g(e,n,E,r),g=e.memoizedState),(d=Ol||PE(e,n,d,r,A,g,x))?(P||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.effectTag|=4)):(typeof a.componentDidMount=="function"&&(e.effectTag|=4),e.memoizedProps=r,e.memoizedState=g),a.props=r,a.state=g,a.context=x,r=d):(typeof a.componentDidMount=="function"&&(e.effectTag|=4),r=!1)}else a=e.stateNode,mx(t,e),d=e.memoizedProps,a.props=e.type===e.elementType?d:Pa(e.type,d),g=a.context,x=n.contextType,typeof x=="object"&&x!==null?x=aa(x):(x=mo(n)?tc:Wi.current,x=Bh(e,x)),E=n.getDerivedStateFromProps,(P=typeof E=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(d!==r||g!==x)&&AE(e,a,r,x),Ol=!1,g=e.memoizedState,a.state=g,$p(e,r,a,o),A=e.memoizedState,d!==r||g!==A||po.current||Ol?(typeof E=="function"&&($g(e,n,E,r),A=e.memoizedState),(E=Ol||PE(e,n,d,r,g,A,x))?(P||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,A,x),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,A,x)),typeof a.componentDidUpdate=="function"&&(e.effectTag|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.effectTag|=256)):(typeof a.componentDidUpdate!="function"||d===t.memoizedProps&&g===t.memoizedState||(e.effectTag|=4),typeof a.getSnapshotBeforeUpdate!="function"||d===t.memoizedProps&&g===t.memoizedState||(e.effectTag|=256),e.memoizedProps=r,e.memoizedState=A),a.props=r,a.state=A,a.context=x,r=E):(typeof a.componentDidUpdate!="function"||d===t.memoizedProps&&g===t.memoizedState||(e.effectTag|=4),typeof a.getSnapshotBeforeUpdate!="function"||d===t.memoizedProps&&g===t.memoizedState||(e.effectTag|=256),r=!1);return k0(t,e,n,r,l,o)}function k0(t,e,n,r,o,l){VA(t,e);var a=(e.effectTag&64)!==0;if(!r&&!a)return o&&xE(e,n,!1),Xs(t,e,l);r=e.stateNode,vO.current=e;var d=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.effectTag|=1,t!==null&&a?(e.child=Uh(e,t.child,null,l),e.child=Uh(e,null,d,l)):ko(t,e,d,l),e.memoizedState=r.state,o&&xE(e,n,!0),e.child}function DE(t){var e=t.stateNode;e.pendingContext?_E(t,e.pendingContext,e.pendingContext!==e.context):e.context&&_E(t,e.context,!1),P0(t,e.containerInfo)}var o_={dehydrated:null,retryTime:0};function FE(t,e,n){var r=e.mode,o=e.pendingProps,l=Fr.current,a=!1,d;if((d=(e.effectTag&64)!==0)||(d=(l&2)!==0&&(t===null||t.memoizedState!==null)),d?(a=!0,e.effectTag&=-65):t!==null&&t.memoizedState===null||o.fallback===void 0||o.unstable_avoidThisFallback===!0||(l|=1),Wr(Fr,l&1),t===null){if(o.fallback!==void 0&&I0(e),a){if(a=o.fallback,o=Ul(null,r,0,null),o.return=e,!(e.mode&2))for(t=e.memoizedState!==null?e.child.child:e.child,o.child=t;t!==null;)t.return=o,t=t.sibling;return n=Ul(a,r,n,null),n.return=e,o.sibling=n,e.memoizedState=o_,e.child=o,n}return r=o.children,e.memoizedState=null,e.child=gx(e,null,r,n)}if(t.memoizedState!==null){if(t=t.child,r=t.sibling,a){if(o=o.fallback,n=nc(t,t.pendingProps),n.return=e,!(e.mode&2)&&(a=e.memoizedState!==null?e.child.child:e.child,a!==t.child))for(n.child=a;a!==null;)a.return=n,a=a.sibling;return r=nc(r,o),r.return=e,n.sibling=r,n.childExpirationTime=0,e.memoizedState=o_,e.child=n,r}return n=Uh(e,t.child,o.children,n),e.memoizedState=null,e.child=n}if(t=t.child,a){if(a=o.fallback,o=Ul(null,r,0,null),o.return=e,o.child=t,t!==null&&(t.return=o),!(e.mode&2))for(t=e.memoizedState!==null?e.child.child:e.child,o.child=t;t!==null;)t.return=o,t=t.sibling;return n=Ul(a,r,n,null),n.return=e,o.sibling=n,n.effectTag|=2,o.childExpirationTime=0,e.memoizedState=o_,e.child=o,n}return e.memoizedState=null,e.child=Uh(e,t,o.children,n)}function NE(t,e){t.expirationTime<e&&(t.expirationTime=e);var n=t.alternate;n!==null&&n.expirationTime<e&&(n.expirationTime=e),IA(t.return,e)}function a_(t,e,n,r,o,l){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailExpiration:0,tailMode:o,lastEffect:l}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailExpiration=0,a.tailMode=o,a.lastEffect=l)}function BE(t,e,n){var r=e.pendingProps,o=r.revealOrder,l=r.tail;if(ko(t,e,r.children,n),r=Fr.current,r&2)r=r&1|2,e.effectTag|=64;else{if(t!==null&&t.effectTag&64)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&NE(t,n);else if(t.tag===19)NE(t,n);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Wr(Fr,r),!(e.mode&2))e.memoizedState=null;else switch(o){case"forwards":for(n=e.child,o=null;n!==null;)t=n.alternate,t!==null&&Xg(t)===null&&(o=n),n=n.sibling;n=o,n===null?(o=e.child,e.child=null):(o=n.sibling,n.sibling=null),a_(e,!1,o,n,l,e.lastEffect);break;case"backwards":for(n=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&Xg(t)===null){e.child=o;break}t=o.sibling,o.sibling=n,n=o,o=t}a_(e,!0,n,null,l,e.lastEffect);break;case"together":a_(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function Xs(t,e,n){t!==null&&(e.dependencies=t.dependencies);var r=e.expirationTime;if(r!==0&&$y(r),e.childExpirationTime<n)return null;if(t!==null&&e.child!==t.child)throw Error(tt(153));if(e.child!==null){for(t=e.child,n=nc(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=nc(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}var jA,L0,GA,WA;jA=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};L0=function(){};GA=function(t,e,n,r,o){var l=t.memoizedProps;if(l!==r){var a=e.stateNode;switch(Bu(hs.current),t=null,n){case"input":l=i0(a,l),r=i0(a,r),t=[];break;case"option":l=s0(a,l),r=s0(a,r),t=[];break;case"select":l=no({},l,{value:void 0}),r=no({},r,{value:void 0}),t=[];break;case"textarea":l=l0(a,l),r=l0(a,r),t=[];break;default:typeof l.onClick!="function"&&typeof r.onClick=="function"&&(a.onclick=Vg)}d0(n,r);var d,g;n=null;for(d in l)if(!r.hasOwnProperty(d)&&l.hasOwnProperty(d)&&l[d]!=null)if(d==="style")for(g in a=l[d],a)a.hasOwnProperty(g)&&(n||(n={}),n[g]="");else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Dh.hasOwnProperty(d)?t||(t=[]):(t=t||[]).push(d,null));for(d in r){var x=r[d];if(a=l!=null?l[d]:void 0,r.hasOwnProperty(d)&&x!==a&&(x!=null||a!=null))if(d==="style")if(a){for(g in a)!a.hasOwnProperty(g)||x&&x.hasOwnProperty(g)||(n||(n={}),n[g]="");for(g in x)x.hasOwnProperty(g)&&a[g]!==x[g]&&(n||(n={}),n[g]=x[g])}else n||(t||(t=[]),t.push(d,n)),n=x;else d==="dangerouslySetInnerHTML"?(x=x?x.__html:void 0,a=a?a.__html:void 0,x!=null&&a!==x&&(t=t||[]).push(d,x)):d==="children"?a===x||typeof x!="string"&&typeof x!="number"||(t=t||[]).push(d,""+x):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Dh.hasOwnProperty(d)?(x!=null&&Gs(o,d),t||a===x||(t=[])):(t=t||[]).push(d,x))}n&&(t=t||[]).push("style",n),o=t,(e.updateQueue=o)&&(e.effectTag|=4)}};WA=function(t,e,n,r){n!==r&&(e.effectTag|=4)};function Zm(t,e){switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function _O(t,e,n){var r=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return mo(e.type)&&Wg(),null;case 3:return Vh(),gr(po),gr(Wi),n=e.stateNode,n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),t!==null&&t.child!==null||!qm(e)||(e.effectTag|=4),L0(e),null;case 5:yx(e),n=Bu(Yp.current);var o=e.type;if(t!==null&&e.stateNode!=null)GA(t,e,o,r,n),t.ref!==e.ref&&(e.effectTag|=128);else{if(!r){if(e.stateNode===null)throw Error(tt(166));return null}if(t=Bu(hs.current),qm(e)){r=e.stateNode,o=e.type;var l=e.memoizedProps;switch(r[Dl]=e,r[jg]=l,o){case"iframe":case"object":case"embed":Ar("load",r);break;case"video":case"audio":for(t=0;t<Ep.length;t++)Ar(Ep[t],r);break;case"source":Ar("error",r);break;case"img":case"image":case"link":Ar("error",r),Ar("load",r);break;case"form":Ar("reset",r),Ar("submit",r);break;case"details":Ar("toggle",r);break;case"input":Yw(r,l),Ar("invalid",r),Gs(n,"onChange");break;case"select":r._wrapperState={wasMultiple:!!l.multiple},Ar("invalid",r),Gs(n,"onChange");break;case"textarea":Jw(r,l),Ar("invalid",r),Gs(n,"onChange")}d0(o,l),t=null;for(var a in l)if(l.hasOwnProperty(a)){var d=l[a];a==="children"?typeof d=="string"?r.textContent!==d&&(t=["children",d]):typeof d=="number"&&r.textContent!==""+d&&(t=["children",""+d]):Dh.hasOwnProperty(a)&&d!=null&&Gs(n,a)}switch(o){case"input":Bm(r),Kw(r,l,!0);break;case"textarea":Bm(r),Qw(r);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(r.onclick=Vg)}n=t,e.updateQueue=n,n!==null&&(e.effectTag|=4)}else{switch(a=n.nodeType===9?n:n.ownerDocument,t===oE&&(t=FP(o)),t===oE?o==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(o,{is:r.is}):(t=a.createElement(o),o==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,o),t[Dl]=e,t[jg]=r,jA(t,e,!1,!1),e.stateNode=t,a=m0(o,r),o){case"iframe":case"object":case"embed":Ar("load",t),d=r;break;case"video":case"audio":for(d=0;d<Ep.length;d++)Ar(Ep[d],t);d=r;break;case"source":Ar("error",t),d=r;break;case"img":case"image":case"link":Ar("error",t),Ar("load",t),d=r;break;case"form":Ar("reset",t),Ar("submit",t),d=r;break;case"details":Ar("toggle",t),d=r;break;case"input":Yw(t,r),d=i0(t,r),Ar("invalid",t),Gs(n,"onChange");break;case"option":d=s0(t,r);break;case"select":t._wrapperState={wasMultiple:!!r.multiple},d=no({},r,{value:void 0}),Ar("invalid",t),Gs(n,"onChange");break;case"textarea":Jw(t,r),d=l0(t,r),Ar("invalid",t),Gs(n,"onChange");break;default:d=r}d0(o,d);var g=d;for(l in g)if(g.hasOwnProperty(l)){var x=g[l];l==="style"?nA(t,x):l==="dangerouslySetInnerHTML"?(x=x?x.__html:void 0,x!=null&&NP(t,x)):l==="children"?typeof x=="string"?(o!=="textarea"||x!=="")&&Gp(t,x):typeof x=="number"&&Gp(t,""+x):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Dh.hasOwnProperty(l)?x!=null&&Gs(n,l):x!=null&&Z1(t,l,x,a))}switch(o){case"input":Bm(t),Kw(t,r,!1);break;case"textarea":Bm(t),Qw(t);break;case"option":r.value!=null&&t.setAttribute("value",""+eu(r.value));break;case"select":t.multiple=!!r.multiple,n=r.value,n!=null?Ah(t,!!r.multiple,n,!1):r.defaultValue!=null&&Ah(t,!!r.multiple,r.defaultValue,!0);break;default:typeof d.onClick=="function"&&(t.onclick=Vg)}aA(o,r)&&(e.effectTag|=4)}e.ref!==null&&(e.effectTag|=128)}return null;case 6:if(t&&e.stateNode!=null)WA(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(tt(166));n=Bu(Yp.current),Bu(hs.current),qm(e)?(n=e.stateNode,r=e.memoizedProps,n[Dl]=e,n.nodeValue!==r&&(e.effectTag|=4)):(n=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),n[Dl]=e,e.stateNode=n)}return null;case 13:return gr(Fr),r=e.memoizedState,e.effectTag&64?(e.expirationTime=n,e):(n=r!==null,r=!1,t===null?e.memoizedProps.fallback!==void 0&&qm(e):(o=t.memoizedState,r=o!==null,n||o===null||(o=t.child.sibling,o!==null&&(l=e.firstEffect,l!==null?(e.firstEffect=o,o.nextEffect=l):(e.firstEffect=e.lastEffect=o,o.nextEffect=null),o.effectTag=8))),n&&!r&&e.mode&2&&(t===null&&e.memoizedProps.unstable_avoidThisFallback!==!0||Fr.current&1?fi===Xu&&(fi=ny):((fi===Xu||fi===ny)&&(fi=Hy),Jp!==0&&No!==null&&(ju(No,go),cC(No,Jp)))),(n||r)&&(e.effectTag|=4),null);case 4:return Vh(),L0(e),null;case 10:return px(e),null;case 17:return mo(e.type)&&Wg(),null;case 19:if(gr(Fr),r=e.memoizedState,r===null)return null;if(o=(e.effectTag&64)!==0,l=r.rendering,l===null){if(o)Zm(r,!1);else if(fi!==Xu||t!==null&&t.effectTag&64)for(l=e.child;l!==null;){if(t=Xg(l),t!==null){for(e.effectTag|=64,Zm(r,!1),o=t.updateQueue,o!==null&&(e.updateQueue=o,e.effectTag|=4),r.lastEffect===null&&(e.firstEffect=null),e.lastEffect=r.lastEffect,r=e.child;r!==null;)o=r,l=n,o.effectTag&=2,o.nextEffect=null,o.firstEffect=null,o.lastEffect=null,t=o.alternate,t===null?(o.childExpirationTime=0,o.expirationTime=l,o.child=null,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null):(o.childExpirationTime=t.childExpirationTime,o.expirationTime=t.expirationTime,o.child=t.child,o.memoizedProps=t.memoizedProps,o.memoizedState=t.memoizedState,o.updateQueue=t.updateQueue,l=t.dependencies,o.dependencies=l===null?null:{expirationTime:l.expirationTime,firstContext:l.firstContext,responders:l.responders}),r=r.sibling;return Wr(Fr,Fr.current&1|2),e.child}l=l.sibling}}else{if(!o)if(t=Xg(l),t!==null){if(e.effectTag|=64,o=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.effectTag|=4),Zm(r,!0),r.tail===null&&r.tailMode==="hidden"&&!l.alternate)return e=e.lastEffect=r.lastEffect,e!==null&&(e.nextEffect=null),null}else 2*na()-r.renderingStartTime>r.tailExpiration&&1<n&&(e.effectTag|=64,o=!0,Zm(r,!1),e.expirationTime=e.childExpirationTime=n-1);r.isBackwards?(l.sibling=e.child,e.child=l):(n=r.last,n!==null?n.sibling=l:e.child=l,r.last=l)}return r.tail!==null?(r.tailExpiration===0&&(r.tailExpiration=na()+500),n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=e.lastEffect,r.renderingStartTime=na(),n.sibling=null,e=Fr.current,Wr(Fr,o?e&1|2:e&1),n):null}throw Error(tt(156,e.tag))}function xO(t){switch(t.tag){case 1:mo(t.type)&&Wg();var e=t.effectTag;return e&4096?(t.effectTag=e&-4097|64,t):null;case 3:if(Vh(),gr(po),gr(Wi),e=t.effectTag,e&64)throw Error(tt(285));return t.effectTag=e&-4097|64,t;case 5:return yx(t),null;case 13:return gr(Fr),e=t.effectTag,e&4096?(t.effectTag=e&-4097|64,t):null;case 19:return gr(Fr),null;case 4:return Vh(),null;case 10:return px(t),null;default:return null}}function Tx(t,e){return{value:t,source:e,stack:Y1(e)}}var bO=typeof WeakSet=="function"?WeakSet:Set;function R0(t,e){var n=e.source,r=e.stack;r===null&&n!==null&&(r=Y1(n)),n!==null&&Ys(n.type),e=e.value,t!==null&&t.tag===1&&Ys(t.type);try{console.error(e)}catch(o){setTimeout(function(){throw o})}}function wO(t,e){try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(n){Ku(t,n)}}function UE(t){var e=t.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(n){Ku(t,n)}else e.current=null}function EO(t,e){switch(e.tag){case 0:case 11:case 15:case 22:return;case 1:if(e.effectTag&256&&t!==null){var n=t.memoizedProps,r=t.memoizedState;t=e.stateNode,e=t.getSnapshotBeforeUpdate(e.elementType===e.type?n:Pa(e.type,n),r),t.__reactInternalSnapshotBeforeUpdate=e}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(tt(163))}function HA(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.destroy;n.destroy=void 0,r!==void 0&&r()}n=n.next}while(n!==e)}}function qA(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function TO(t,e,n){switch(n.tag){case 0:case 11:case 15:case 22:qA(3,n);return;case 1:if(t=n.stateNode,n.effectTag&4)if(e===null)t.componentDidMount();else{var r=n.elementType===n.type?e.memoizedProps:Pa(n.type,e.memoizedProps);t.componentDidUpdate(r,e.memoizedState,t.__reactInternalSnapshotBeforeUpdate)}e=n.updateQueue,e!==null&&SE(n,e,t);return;case 3:if(e=n.updateQueue,e!==null){if(t=null,n.child!==null)switch(n.child.tag){case 5:t=n.child.stateNode;break;case 1:t=n.child.stateNode}SE(n,e,t)}return;case 5:t=n.stateNode,e===null&&n.effectTag&4&&aA(n.type,n.memoizedProps)&&t.focus();return;case 6:return;case 4:return;case 12:return;case 13:n.memoizedState===null&&(n=n.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&JP(n))));return;case 19:case 17:case 20:case 21:return}throw Error(tt(163))}function VE(t,e,n){switch(typeof V0=="function"&&V0(e),e.tag){case 0:case 11:case 14:case 15:case 22:if(t=e.updateQueue,t!==null&&(t=t.lastEffect,t!==null)){var r=t.next;nu(97<n?97:n,function(){var o=r;do{var l=o.destroy;if(l!==void 0){var a=e;try{l()}catch(d){Ku(a,d)}}o=o.next}while(o!==r)})}break;case 1:UE(e),n=e.stateNode,typeof n.componentWillUnmount=="function"&&wO(e,n);break;case 5:UE(e);break;case 4:$A(t,e,n)}}function ZA(t){var e=t.alternate;t.return=null,t.child=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.alternate=null,t.firstEffect=null,t.lastEffect=null,t.pendingProps=null,t.memoizedProps=null,t.stateNode=null,e!==null&&ZA(e)}function jE(t){return t.tag===5||t.tag===3||t.tag===4}function GE(t){e:{for(var e=t.return;e!==null;){if(jE(e)){var n=e;break e}e=e.return}throw Error(tt(160))}switch(e=n.stateNode,n.tag){case 5:var r=!1;break;case 3:e=e.containerInfo,r=!0;break;case 4:e=e.containerInfo,r=!0;break;default:throw Error(tt(161))}n.effectTag&16&&(Gp(e,""),n.effectTag&=-17);e:t:for(n=t;;){for(;n.sibling===null;){if(n.return===null||jE(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.effectTag&2||n.child===null||n.tag===4)continue t;n.child.return=n,n=n.child}if(!(n.effectTag&2)){n=n.stateNode;break e}}r?O0(t,n,e):z0(t,n,e)}function O0(t,e,n){var r=t.tag,o=r===5||r===6;if(o)t=o?t.stateNode:t.stateNode.instance,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Vg));else if(r!==4&&(t=t.child,t!==null))for(O0(t,e,n),t=t.sibling;t!==null;)O0(t,e,n),t=t.sibling}function z0(t,e,n){var r=t.tag,o=r===5||r===6;if(o)t=o?t.stateNode:t.stateNode.instance,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(z0(t,e,n),t=t.sibling;t!==null;)z0(t,e,n),t=t.sibling}function $A(t,e,n){for(var r=e,o=!1,l,a;;){if(!o){o=r.return;e:for(;;){if(o===null)throw Error(tt(160));switch(l=o.stateNode,o.tag){case 5:a=!1;break e;case 3:l=l.containerInfo,a=!0;break e;case 4:l=l.containerInfo,a=!0;break e}o=o.return}o=!0}if(r.tag===5||r.tag===6){e:for(var d=t,g=r,x=n,E=g;;)if(VE(d,E,x),E.child!==null&&E.tag!==4)E.child.return=E,E=E.child;else{if(E===g)break e;for(;E.sibling===null;){if(E.return===null||E.return===g)break e;E=E.return}E.sibling.return=E.return,E=E.sibling}a?(d=l,g=r.stateNode,d.nodeType===8?d.parentNode.removeChild(g):d.removeChild(g)):l.removeChild(r.stateNode)}else if(r.tag===4){if(r.child!==null){l=r.stateNode.containerInfo,a=!0,r.child.return=r,r=r.child;continue}}else if(VE(t,r,n),r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return,r.tag===4&&(o=!1)}r.sibling.return=r.return,r=r.sibling}}function s_(t,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:HA(3,e);return;case 1:return;case 5:var n=e.stateNode;if(n!=null){var r=e.memoizedProps,o=t!==null?t.memoizedProps:r;t=e.type;var l=e.updateQueue;if(e.updateQueue=null,l!==null){for(n[jg]=r,t==="input"&&r.type==="radio"&&r.name!=null&&OP(n,r),m0(t,o),e=m0(t,r),o=0;o<l.length;o+=2){var a=l[o],d=l[o+1];a==="style"?nA(n,d):a==="dangerouslySetInnerHTML"?NP(n,d):a==="children"?Gp(n,d):Z1(n,a,d,e)}switch(t){case"input":o0(n,r);break;case"textarea":zP(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,t=r.value,t!=null?Ah(n,!!r.multiple,t,!1):e!==!!r.multiple&&(r.defaultValue!=null?Ah(n,!!r.multiple,r.defaultValue,!0):Ah(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(e.stateNode===null)throw Error(tt(162));e.stateNode.nodeValue=e.memoizedProps;return;case 3:e=e.stateNode,e.hydrate&&(e.hydrate=!1,JP(e.containerInfo));return;case 12:return;case 13:if(n=e,e.memoizedState===null?r=!1:(r=!0,n=e.child,Ax=na()),n!==null)e:for(t=n;;){if(t.tag===5)l=t.stateNode,r?(l=l.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(l=t.stateNode,o=t.memoizedProps.style,o=o!=null&&o.hasOwnProperty("display")?o.display:null,l.style.display=tA("display",o));else if(t.tag===6)t.stateNode.nodeValue=r?"":t.memoizedProps;else if(t.tag===13&&t.memoizedState!==null&&t.memoizedState.dehydrated===null){l=t.child.sibling,l.return=t,t=l;continue}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break;for(;t.sibling===null;){if(t.return===null||t.return===n)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}WE(e);return;case 19:WE(e);return;case 17:return}throw Error(tt(163))}function WE(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new bO),e.forEach(function(r){var o=OO.bind(null,t,r);n.has(r)||(n.add(r),r.then(o,o))})}}var SO=typeof WeakMap=="function"?WeakMap:Map;function XA(t,e,n){n=Hl(n,null),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){oy||(oy=!0,D0=r),R0(t,e)},n}function YA(t,e,n){n=Hl(n,null),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var o=e.value;n.payload=function(){return R0(t,e),r(o)}}var l=t.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(n.callback=function(){typeof r!="function"&&(Zl===null?Zl=new Set([this]):Zl.add(this),R0(t,e));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}var PO=Math.ceil,ey=Ia.ReactCurrentDispatcher,KA=Ia.ReactCurrentOwner,di=0,Sx=8,Ma=16,ds=32,Xu=0,ty=1,JA=2,ny=3,Hy=4,Px=5,Yt=di,No=null,rn=null,go=0,fi=Xu,qy=null,qs=1073741823,Kp=1073741823,ry=null,Jp=0,iy=!1,Ax=0,QA=500,kt=null,oy=!1,D0=null,Zl=null,ay=!1,Op=null,Sp=90,Uu=null,zp=0,F0=null,wg=0;function fs(){return(Yt&(Ma|ds))!==di?1073741821-(na()/10|0):wg!==0?wg:wg=1073741821-(na()/10|0)}function Yu(t,e,n){if(e=e.mode,!(e&2))return 1073741823;var r=Gy();if(!(e&4))return r===99?1073741823:1073741822;if((Yt&Ma)!==di)return go;if(n!==null)t=xg(t,n.timeoutMs|0||5e3,250);else switch(r){case 99:t=1073741823;break;case 98:t=xg(t,150,100);break;case 97:case 96:t=xg(t,5e3,250);break;case 95:t=2;break;default:throw Error(tt(326))}return No!==null&&t===go&&--t,t}function $l(t,e){if(50<zp)throw zp=0,F0=null,Error(tt(185));if(t=Zy(t,e),t!==null){var n=Gy();e===1073741823?(Yt&Sx)!==di&&(Yt&(Ma|ds))===di?N0(t):(Bo(t),Yt===di&&gs()):Bo(t),(Yt&4)===di||n!==98&&n!==99||(Uu===null?Uu=new Map([[t,e]]):(n=Uu.get(t),(n===void 0||n>e)&&Uu.set(t,e)))}}function Zy(t,e){t.expirationTime<e&&(t.expirationTime=e);var n=t.alternate;n!==null&&n.expirationTime<e&&(n.expirationTime=e);var r=t.return,o=null;if(r===null&&t.tag===3)o=t.stateNode;else for(;r!==null;){if(n=r.alternate,r.childExpirationTime<e&&(r.childExpirationTime=e),n!==null&&n.childExpirationTime<e&&(n.childExpirationTime=e),r.return===null&&r.tag===3){o=r.stateNode;break}r=r.return}return o!==null&&(No===o&&($y(e),fi===Hy&&ju(o,go)),cC(o,e)),o}function Eg(t){var e=t.lastExpiredTime;if(e!==0||(e=t.firstPendingTime,!uC(t,e)))return e;var n=t.lastPingedTime;return t=t.nextKnownPendingLevel,t=n>t?n:t,2>=t&&e!==t?0:t}function Bo(t){if(t.lastExpiredTime!==0)t.callbackExpirationTime=1073741823,t.callbackPriority=99,t.callbackNode=EE(N0.bind(null,t));else{var e=Eg(t),n=t.callbackNode;if(e===0)n!==null&&(t.callbackNode=null,t.callbackExpirationTime=0,t.callbackPriority=90);else{var r=fs();if(e===1073741823?r=99:e===1||e===2?r=95:(r=10*(1073741821-e)-10*(1073741821-r),r=0>=r?99:250>=r?98:5250>=r?97:95),n!==null){var o=t.callbackPriority;if(t.callbackExpirationTime===e&&o>=r)return;n!==SA&&xA(n)}t.callbackExpirationTime=e,t.callbackPriority=r,e=e===1073741823?EE(N0.bind(null,t)):AA(r,eC.bind(null,t),{timeout:10*(1073741821-e)-na()}),t.callbackNode=e}}}function eC(t,e){if(wg=0,e)return e=fs(),j0(t,e),Bo(t),null;var n=Eg(t);if(n!==0){if(e=t.callbackNode,(Yt&(Ma|ds))!==di)throw Error(tt(327));if(tf(),t===No&&n===go||Vu(t,n),rn!==null){var r=Yt;Yt|=Ma;var o=iC();do try{IO();break}catch(d){rC(t,d)}while(1);if(fx(),Yt=r,ey.current=o,fi===ty)throw e=qy,Vu(t,n),ju(t,n),Bo(t),e;if(rn===null)switch(o=t.finishedWork=t.current.alternate,t.finishedExpirationTime=n,r=fi,No=null,r){case Xu:case ty:throw Error(tt(345));case JA:j0(t,2<n?2:n);break;case ny:if(ju(t,n),r=t.lastSuspendedTime,n===r&&(t.nextKnownPendingLevel=B0(o)),qs===1073741823&&(o=Ax+QA-na(),10<o)){if(iy){var l=t.lastPingedTime;if(l===0||l>=n){t.lastPingedTime=n,Vu(t,n);break}}if(l=Eg(t),l!==0&&l!==n)break;if(r!==0&&r!==n){t.lastPingedTime=r;break}t.timeoutHandle=t_(zu.bind(null,t),o);break}zu(t);break;case Hy:if(ju(t,n),r=t.lastSuspendedTime,n===r&&(t.nextKnownPendingLevel=B0(o)),iy&&(o=t.lastPingedTime,o===0||o>=n)){t.lastPingedTime=n,Vu(t,n);break}if(o=Eg(t),o!==0&&o!==n)break;if(r!==0&&r!==n){t.lastPingedTime=r;break}if(Kp!==1073741823?r=10*(1073741821-Kp)-na():qs===1073741823?r=0:(r=10*(1073741821-qs)-5e3,o=na(),n=10*(1073741821-n)-o,r=o-r,0>r&&(r=0),r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*PO(r/1960))-r,n<r&&(r=n)),10<r){t.timeoutHandle=t_(zu.bind(null,t),r);break}zu(t);break;case Px:if(qs!==1073741823&&ry!==null){l=qs;var a=ry;if(r=a.busyMinDurationMs|0,0>=r?r=0:(o=a.busyDelayMs|0,l=na()-(10*(1073741821-l)-(a.timeoutMs|0||5e3)),r=l<=o?0:o+r-l),10<r){ju(t,n),t.timeoutHandle=t_(zu.bind(null,t),r);break}}zu(t);break;default:throw Error(tt(329))}if(Bo(t),t.callbackNode===e)return eC.bind(null,t)}}return null}function N0(t){var e=t.lastExpiredTime;if(e=e!==0?e:1073741823,(Yt&(Ma|ds))!==di)throw Error(tt(327));if(tf(),t===No&&e===go||Vu(t,e),rn!==null){var n=Yt;Yt|=Ma;var r=iC();do try{CO();break}catch(o){rC(t,o)}while(1);if(fx(),Yt=n,ey.current=r,fi===ty)throw n=qy,Vu(t,e),ju(t,e),Bo(t),n;if(rn!==null)throw Error(tt(261));t.finishedWork=t.current.alternate,t.finishedExpirationTime=e,No=null,zu(t),Bo(t)}return null}function AO(){if(Uu!==null){var t=Uu;Uu=null,t.forEach(function(e,n){j0(n,e),Bo(n)}),gs()}}function tC(t,e){var n=Yt;Yt|=1;try{return t(e)}finally{Yt=n,Yt===di&&gs()}}function nC(t,e){var n=Yt;Yt&=-2,Yt|=Sx;try{return t(e)}finally{Yt=n,Yt===di&&gs()}}function Vu(t,e){t.finishedWork=null,t.finishedExpirationTime=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,PR(n)),rn!==null)for(n=rn.return;n!==null;){var r=n;switch(r.tag){case 1:r=r.type.childContextTypes,r!=null&&Wg();break;case 3:Vh(),gr(po),gr(Wi);break;case 5:yx(r);break;case 4:Vh();break;case 13:gr(Fr);break;case 19:gr(Fr);break;case 10:px(r)}n=n.return}No=t,rn=nc(t.current,null),go=e,fi=Xu,qy=null,Kp=qs=1073741823,ry=null,Jp=0,iy=!1}function rC(t,e){do{try{if(fx(),bg.current=Qg,Yg)for(var n=oi.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}if(Nl=0,Vi=Ui=oi=null,Yg=!1,rn===null||rn.return===null)return fi=ty,qy=e,rn=null;e:{var o=t,l=rn.return,a=rn,d=e;if(e=go,a.effectTag|=2048,a.firstEffect=a.lastEffect=null,d!==null&&typeof d=="object"&&typeof d.then=="function"){var g=d;if(!(a.mode&2)){var x=a.alternate;x?(a.updateQueue=x.updateQueue,a.memoizedState=x.memoizedState,a.expirationTime=x.expirationTime):(a.updateQueue=null,a.memoizedState=null)}var E=(Fr.current&1)!==0,P=l;do{var A;if(A=P.tag===13){var R=P.memoizedState;if(R!==null)A=R.dehydrated!==null;else{var j=P.memoizedProps;A=j.fallback===void 0?!1:j.unstable_avoidThisFallback!==!0?!0:!E}}if(A){var X=P.updateQueue;if(X===null){var D=new Set;D.add(g),P.updateQueue=D}else X.add(g);if(!(P.mode&2)){if(P.effectTag|=64,a.effectTag&=-2981,a.tag===1)if(a.alternate===null)a.tag=17;else{var F=Hl(1073741823,null);F.tag=2,ql(a,F)}a.expirationTime=1073741823;break e}d=void 0,a=e;var W=o.pingCache;if(W===null?(W=o.pingCache=new SO,d=new Set,W.set(g,d)):(d=W.get(g),d===void 0&&(d=new Set,W.set(g,d))),!d.has(a)){d.add(a);var J=RO.bind(null,o,g,a);g.then(J,J)}P.effectTag|=4096,P.expirationTime=e;break e}P=P.return}while(P!==null);d=Error((Ys(a.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`+Y1(a))}fi!==Px&&(fi=JA),d=Tx(d,a),P=l;do{switch(P.tag){case 3:g=d,P.effectTag|=4096,P.expirationTime=e;var le=XA(P,g,e);TE(P,le);break e;case 1:g=d;var ue=P.type,ye=P.stateNode;if(!(P.effectTag&64)&&(typeof ue.getDerivedStateFromError=="function"||ye!==null&&typeof ye.componentDidCatch=="function"&&(Zl===null||!Zl.has(ye)))){P.effectTag|=4096,P.expirationTime=e;var Ee=YA(P,g,e);TE(P,Ee);break e}}P=P.return}while(P!==null)}rn=sC(rn)}catch(Pe){e=Pe;continue}break}while(1)}function iC(){var t=ey.current;return ey.current=Qg,t===null?Qg:t}function oC(t,e){t<qs&&2<t&&(qs=t),e!==null&&t<Kp&&2<t&&(Kp=t,ry=e)}function $y(t){t>Jp&&(Jp=t)}function CO(){for(;rn!==null;)rn=aC(rn)}function IO(){for(;rn!==null&&!pO();)rn=aC(rn)}function aC(t){var e=lC(t.alternate,t,go);return t.memoizedProps=t.pendingProps,e===null&&(e=sC(t)),KA.current=null,e}function sC(t){rn=t;do{var e=rn.alternate;if(t=rn.return,rn.effectTag&2048){if(e=xO(rn),e!==null)return e.effectTag&=2047,e;t!==null&&(t.firstEffect=t.lastEffect=null,t.effectTag|=2048)}else{if(e=_O(e,rn,go),go===1||rn.childExpirationTime!==1){for(var n=0,r=rn.child;r!==null;){var o=r.expirationTime,l=r.childExpirationTime;o>n&&(n=o),l>n&&(n=l),r=r.sibling}rn.childExpirationTime=n}if(e!==null)return e;t!==null&&!(t.effectTag&2048)&&(t.firstEffect===null&&(t.firstEffect=rn.firstEffect),rn.lastEffect!==null&&(t.lastEffect!==null&&(t.lastEffect.nextEffect=rn.firstEffect),t.lastEffect=rn.lastEffect),1<rn.effectTag&&(t.lastEffect!==null?t.lastEffect.nextEffect=rn:t.firstEffect=rn,t.lastEffect=rn))}if(e=rn.sibling,e!==null)return e;rn=t}while(rn!==null);return fi===Xu&&(fi=Px),null}function B0(t){var e=t.expirationTime;return t=t.childExpirationTime,e>t?e:t}function zu(t){var e=Gy();return nu(99,MO.bind(null,t,e)),null}function MO(t,e){do tf();while(Op!==null);if((Yt&(Ma|ds))!==di)throw Error(tt(327));var n=t.finishedWork,r=t.finishedExpirationTime;if(n===null)return null;if(t.finishedWork=null,t.finishedExpirationTime=0,n===t.current)throw Error(tt(177));t.callbackNode=null,t.callbackExpirationTime=0,t.callbackPriority=90,t.nextKnownPendingLevel=0;var o=B0(n);if(t.firstPendingTime=o,r<=t.lastSuspendedTime?t.firstSuspendedTime=t.lastSuspendedTime=t.nextKnownPendingLevel=0:r<=t.firstSuspendedTime&&(t.firstSuspendedTime=r-1),r<=t.lastPingedTime&&(t.lastPingedTime=0),r<=t.lastExpiredTime&&(t.lastExpiredTime=0),t===No&&(rn=No=null,go=0),1<n.effectTag?n.lastEffect!==null?(n.lastEffect.nextEffect=n,o=n.firstEffect):o=n:o=n.firstEffect,o!==null){var l=Yt;Yt|=ds,KA.current=null,Qv=dg;var a=lE();if(y0(a)){if("selectionStart"in a)var d={start:a.selectionStart,end:a.selectionEnd};else e:{d=(d=a.ownerDocument)&&d.defaultView||window;var g=d.getSelection&&d.getSelection();if(g&&g.rangeCount!==0){d=g.anchorNode;var x=g.anchorOffset,E=g.focusNode;g=g.focusOffset;try{d.nodeType,E.nodeType}catch{d=null;break e}var P=0,A=-1,R=-1,j=0,X=0,D=a,F=null;t:for(;;){for(var W;D!==d||x!==0&&D.nodeType!==3||(A=P+x),D!==E||g!==0&&D.nodeType!==3||(R=P+g),D.nodeType===3&&(P+=D.nodeValue.length),(W=D.firstChild)!==null;)F=D,D=W;for(;;){if(D===a)break t;if(F===d&&++j===x&&(A=P),F===E&&++X===g&&(R=P),(W=D.nextSibling)!==null)break;D=F,F=D.parentNode}D=W}d=A===-1||R===-1?null:{start:A,end:R}}else d=null}d=d||{start:0,end:0}}else d=null;e_={activeElementDetached:null,focusedElem:a,selectionRange:d},dg=!1,kt=o;do try{kO()}catch(we){if(kt===null)throw Error(tt(330));Ku(kt,we),kt=kt.nextEffect}while(kt!==null);kt=o;do try{for(a=t,d=e;kt!==null;){var J=kt.effectTag;if(J&16&&Gp(kt.stateNode,""),J&128){var le=kt.alternate;if(le!==null){var ue=le.ref;ue!==null&&(typeof ue=="function"?ue(null):ue.current=null)}}switch(J&1038){case 2:GE(kt),kt.effectTag&=-3;break;case 6:GE(kt),kt.effectTag&=-3,s_(kt.alternate,kt);break;case 1024:kt.effectTag&=-1025;break;case 1028:kt.effectTag&=-1025,s_(kt.alternate,kt);break;case 4:s_(kt.alternate,kt);break;case 8:x=kt,$A(a,x,d),ZA(x)}kt=kt.nextEffect}}catch(we){if(kt===null)throw Error(tt(330));Ku(kt,we),kt=kt.nextEffect}while(kt!==null);if(ue=e_,le=lE(),J=ue.focusedElem,d=ue.selectionRange,le!==J&&J&&J.ownerDocument&&rA(J.ownerDocument.documentElement,J)){for(d!==null&&y0(J)&&(le=d.start,ue=d.end,ue===void 0&&(ue=le),"selectionStart"in J?(J.selectionStart=le,J.selectionEnd=Math.min(ue,J.value.length)):(ue=(le=J.ownerDocument||document)&&le.defaultView||window,ue.getSelection&&(ue=ue.getSelection(),x=J.textContent.length,a=Math.min(d.start,x),d=d.end===void 0?a:Math.min(d.end,x),!ue.extend&&a>d&&(x=d,d=a,a=x),x=sE(J,a),E=sE(J,d),x&&E&&(ue.rangeCount!==1||ue.anchorNode!==x.node||ue.anchorOffset!==x.offset||ue.focusNode!==E.node||ue.focusOffset!==E.offset)&&(le=le.createRange(),le.setStart(x.node,x.offset),ue.removeAllRanges(),a>d?(ue.addRange(le),ue.extend(E.node,E.offset)):(le.setEnd(E.node,E.offset),ue.addRange(le)))))),le=[],ue=J;ue=ue.parentNode;)ue.nodeType===1&&le.push({element:ue,left:ue.scrollLeft,top:ue.scrollTop});for(typeof J.focus=="function"&&J.focus(),J=0;J<le.length;J++)ue=le[J],ue.element.scrollLeft=ue.left,ue.element.scrollTop=ue.top}dg=!!Qv,e_=Qv=null,t.current=n,kt=o;do try{for(J=t;kt!==null;){var ye=kt.effectTag;if(ye&36&&TO(J,kt.alternate,kt),ye&128){le=void 0;var Ee=kt.ref;if(Ee!==null){var Pe=kt.stateNode;switch(kt.tag){case 5:le=Pe;break;default:le=Pe}typeof Ee=="function"?Ee(le):Ee.current=le}}kt=kt.nextEffect}}catch(we){if(kt===null)throw Error(tt(330));Ku(kt,we),kt=kt.nextEffect}while(kt!==null);kt=null,dO(),Yt=l}else t.current=n;if(ay)ay=!1,Op=t,Sp=e;else for(kt=o;kt!==null;)e=kt.nextEffect,kt.nextEffect=null,kt=e;if(e=t.firstPendingTime,e===0&&(Zl=null),e===1073741823?t===F0?zp++:(zp=0,F0=t):zp=0,typeof U0=="function"&&U0(n.stateNode,r),Bo(t),oy)throw oy=!1,t=D0,D0=null,t;return(Yt&Sx)!==di||gs(),null}function kO(){for(;kt!==null;){var t=kt.effectTag;t&256&&EO(kt.alternate,kt),!(t&512)||ay||(ay=!0,AA(97,function(){return tf(),null})),kt=kt.nextEffect}}function tf(){if(Sp!==90){var t=97<Sp?97:Sp;return Sp=90,nu(t,LO)}}function LO(){if(Op===null)return!1;var t=Op;if(Op=null,(Yt&(Ma|ds))!==di)throw Error(tt(331));var e=Yt;for(Yt|=ds,t=t.current.firstEffect;t!==null;){try{var n=t;if(n.effectTag&512)switch(n.tag){case 0:case 11:case 15:case 22:HA(5,n),qA(5,n)}}catch(r){if(t===null)throw Error(tt(330));Ku(t,r)}n=t.nextEffect,t.nextEffect=null,t=n}return Yt=e,gs(),!0}function HE(t,e,n){e=Tx(n,e),e=XA(t,e,1073741823),ql(t,e),t=Zy(t,1073741823),t!==null&&Bo(t)}function Ku(t,e){if(t.tag===3)HE(t,t,e);else for(var n=t.return;n!==null;){if(n.tag===3){HE(n,t,e);break}else if(n.tag===1){var r=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Zl===null||!Zl.has(r))){t=Tx(e,t),t=YA(n,t,1073741823),ql(n,t),n=Zy(n,1073741823),n!==null&&Bo(n);break}}n=n.return}}function RO(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),No===t&&go===n?fi===Hy||fi===ny&&qs===1073741823&&na()-Ax<QA?Vu(t,go):iy=!0:uC(t,n)&&(e=t.lastPingedTime,e!==0&&e<n||(t.lastPingedTime=n,Bo(t)))}function OO(t,e){var n=t.stateNode;n!==null&&n.delete(e),e=0,e===0&&(e=fs(),e=Yu(e,t,null)),t=Zy(t,e),t!==null&&Bo(t)}var lC;lC=function(t,e,n){var r=e.expirationTime;if(t!==null){var o=e.pendingProps;if(t.memoizedProps!==o||po.current)as=!0;else{if(r<n){switch(as=!1,e.tag){case 3:DE(e),i_();break;case 5:if(CE(e),e.mode&4&&n!==1&&o.hidden)return e.expirationTime=e.childExpirationTime=1,null;break;case 1:mo(e.type)&&vg(e);break;case 4:P0(e,e.stateNode.containerInfo);break;case 10:r=e.memoizedProps.value,o=e.type._context,Wr(Hg,o._currentValue),o._currentValue=r;break;case 13:if(e.memoizedState!==null)return r=e.child.childExpirationTime,r!==0&&r>=n?FE(t,e,n):(Wr(Fr,Fr.current&1),e=Xs(t,e,n),e!==null?e.sibling:null);Wr(Fr,Fr.current&1);break;case 19:if(r=e.childExpirationTime>=n,t.effectTag&64){if(r)return BE(t,e,n);e.effectTag|=64}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null),Wr(Fr,Fr.current),!r)return null}return Xs(t,e,n)}as=!1}}else as=!1;switch(e.expirationTime=0,e.tag){case 2:if(r=e.type,t!==null&&(t.alternate=null,e.alternate=null,e.effectTag|=2),t=e.pendingProps,o=Bh(e,Wi.current),Ih(e,n),o=xx(null,e,r,t,o,n),e.effectTag|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,mo(r)){var l=!0;vg(e)}else l=!1;e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,dx(e);var a=r.getDerivedStateFromProps;typeof a=="function"&&$g(e,r,a,t),o.updater=Wy,e.stateNode=o,o._reactInternalFiber=e,S0(e,r,t,n),e=k0(null,e,r,!0,l,n)}else e.tag=0,ko(null,e,o,n),e=e.child;return e;case 16:e:{if(o=e.elementType,t!==null&&(t.alternate=null,e.alternate=null,e.effectTag|=2),t=e.pendingProps,uR(o),o._status!==1)throw o._result;switch(o=o._result,e.type=o,l=e.tag=FO(o),t=Pa(o,t),l){case 0:e=M0(null,e,o,t,n);break e;case 1:e=zE(null,e,o,t,n);break e;case 11:e=RE(null,e,o,t,n);break e;case 14:e=OE(null,e,o,Pa(o.type,t),r,n);break e}throw Error(tt(306,o,""))}return e;case 0:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:Pa(r,o),M0(t,e,r,o,n);case 1:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:Pa(r,o),zE(t,e,r,o,n);case 3:if(DE(e),r=e.updateQueue,t===null||r===null)throw Error(tt(282));if(r=e.pendingProps,o=e.memoizedState,o=o!==null?o.element:null,mx(t,e),$p(e,r,null,n),r=e.memoizedState.element,r===o)i_(),e=Xs(t,e,n);else{if((o=e.stateNode.hydrate)&&(Bl=Ch(e.stateNode.containerInfo.firstChild),$s=e,o=$u=!0),o)for(n=gx(e,null,r,n),e.child=n;n;)n.effectTag=n.effectTag&-3|1024,n=n.sibling;else ko(t,e,r,n),i_();e=e.child}return e;case 5:return CE(e),t===null&&I0(e),r=e.type,o=e.pendingProps,l=t!==null?t.memoizedProps:null,a=o.children,v0(r,o)?a=null:l!==null&&v0(r,l)&&(e.effectTag|=16),VA(t,e),e.mode&4&&n!==1&&o.hidden?(e.expirationTime=e.childExpirationTime=1,e=null):(ko(t,e,a,n),e=e.child),e;case 6:return t===null&&I0(e),null;case 13:return FE(t,e,n);case 4:return P0(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Uh(e,null,r,n):ko(t,e,r,n),e.child;case 11:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:Pa(r,o),RE(t,e,r,o,n);case 7:return ko(t,e,e.pendingProps,n),e.child;case 8:return ko(t,e,e.pendingProps.children,n),e.child;case 12:return ko(t,e,e.pendingProps.children,n),e.child;case 10:e:{r=e.type._context,o=e.pendingProps,a=e.memoizedProps,l=o.value;var d=e.type._context;if(Wr(Hg,d._currentValue),d._currentValue=l,a!==null)if(d=a.value,l=ec(d,l)?0:(typeof r._calculateChangedBits=="function"?r._calculateChangedBits(d,l):1073741823)|0,l===0){if(a.children===o.children&&!po.current){e=Xs(t,e,n);break e}}else for(d=e.child,d!==null&&(d.return=e);d!==null;){var g=d.dependencies;if(g!==null){a=d.child;for(var x=g.firstContext;x!==null;){if(x.context===r&&x.observedBits&l){d.tag===1&&(x=Hl(n,null),x.tag=2,ql(d,x)),d.expirationTime<n&&(d.expirationTime=n),x=d.alternate,x!==null&&x.expirationTime<n&&(x.expirationTime=n),IA(d.return,n),g.expirationTime<n&&(g.expirationTime=n);break}x=x.next}}else a=d.tag===10&&d.type===e.type?null:d.child;if(a!==null)a.return=d;else for(a=d;a!==null;){if(a===e){a=null;break}if(d=a.sibling,d!==null){d.return=a.return,a=d;break}a=a.return}d=a}ko(t,e,o.children,n),e=e.child}return e;case 9:return o=e.type,l=e.pendingProps,r=l.children,Ih(e,n),o=aa(o,l.unstable_observedBits),r=r(o),e.effectTag|=1,ko(t,e,r,n),e.child;case 14:return o=e.type,l=Pa(o,e.pendingProps),l=Pa(o.type,l),OE(t,e,o,l,r,n);case 15:return UA(t,e,e.type,e.pendingProps,r,n);case 17:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:Pa(r,o),t!==null&&(t.alternate=null,e.alternate=null,e.effectTag|=2),e.tag=1,mo(r)?(t=!0,vg(e)):t=!1,Ih(e,n),kA(e,r,o),S0(e,r,o,n),k0(null,e,r,!0,t,n);case 19:return BE(t,e,n)}throw Error(tt(156,e.tag))};var U0=null,V0=null;function zO(t){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")return!1;var e=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(e.isDisabled||!e.supportsFiber)return!0;try{var n=e.inject(t);U0=function(r){try{e.onCommitFiberRoot(n,r,void 0,(r.current.effectTag&64)===64)}catch{}},V0=function(r){try{e.onCommitFiberUnmount(n,r)}catch{}}}catch{}return!0}function DO(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function ss(t,e,n,r){return new DO(t,e,n,r)}function Cx(t){return t=t.prototype,!(!t||!t.isReactComponent)}function FO(t){if(typeof t=="function")return Cx(t)?1:0;if(t!=null){if(t=t.$$typeof,t===$1)return 11;if(t===X1)return 14}return 2}function nc(t,e){var n=t.alternate;return n===null?(n=ss(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=t.childExpirationTime,n.expirationTime=t.expirationTime,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{expirationTime:e.expirationTime,firstContext:e.firstContext,responders:e.responders},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Tg(t,e,n,r,o,l){var a=2;if(r=t,typeof t=="function")Cx(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case Fu:return Ul(n.children,o,l,e);case lR:a=8,o|=7;break;case AP:a=8,o|=1;break;case hg:return t=ss(12,n,e,o|8),t.elementType=hg,t.type=hg,t.expirationTime=l,t;case fg:return t=ss(13,n,e,o),t.type=fg,t.elementType=fg,t.expirationTime=l,t;case r0:return t=ss(19,n,e,o),t.elementType=r0,t.expirationTime=l,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case CP:a=10;break e;case IP:a=9;break e;case $1:a=11;break e;case X1:a=14;break e;case MP:a=16,r=null;break e;case kP:a=22;break e}throw Error(tt(130,t==null?t:typeof t,""))}return e=ss(a,n,e,o),e.elementType=t,e.type=r,e.expirationTime=l,e}function Ul(t,e,n,r){return t=ss(7,t,r,e),t.expirationTime=n,t}function l_(t,e,n){return t=ss(6,t,null,e),t.expirationTime=n,t}function u_(t,e,n){return e=ss(4,t.children!==null?t.children:[],t.key,e),e.expirationTime=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function NO(t,e,n){this.tag=e,this.current=null,this.containerInfo=t,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function uC(t,e){var n=t.firstSuspendedTime;return t=t.lastSuspendedTime,n!==0&&n>=e&&t<=e}function ju(t,e){var n=t.firstSuspendedTime,r=t.lastSuspendedTime;n<e&&(t.firstSuspendedTime=e),(r>e||n===0)&&(t.lastSuspendedTime=e),e<=t.lastPingedTime&&(t.lastPingedTime=0),e<=t.lastExpiredTime&&(t.lastExpiredTime=0)}function cC(t,e){e>t.firstPendingTime&&(t.firstPendingTime=e);var n=t.firstSuspendedTime;n!==0&&(e>=n?t.firstSuspendedTime=t.lastSuspendedTime=t.nextKnownPendingLevel=0:e>=t.lastSuspendedTime&&(t.lastSuspendedTime=e+1),e>t.nextKnownPendingLevel&&(t.nextKnownPendingLevel=e))}function j0(t,e){var n=t.lastExpiredTime;(n===0||n>e)&&(t.lastExpiredTime=e)}function sy(t,e,n,r){var o=e.current,l=fs(),a=Rp.suspense;l=Yu(l,o,a);e:if(n){n=n._reactInternalFiber;t:{if(hc(n)!==n||n.tag!==1)throw Error(tt(170));var d=n;do{switch(d.tag){case 3:d=d.stateNode.context;break t;case 1:if(mo(d.type)){d=d.stateNode.__reactInternalMemoizedMergedChildContext;break t}}d=d.return}while(d!==null);throw Error(tt(171))}if(n.tag===1){var g=n.type;if(mo(g)){n=_A(n,g,d);break e}}n=d}else n=tu;return e.context===null?e.context=n:e.pendingContext=n,e=Hl(l,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),ql(o,e),$l(o,l),l}function c_(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function qE(t,e){t=t.memoizedState,t!==null&&t.dehydrated!==null&&t.retryTime<e&&(t.retryTime=e)}function Ix(t,e){qE(t,e),(t=t.alternate)&&qE(t,e)}function Mx(t,e,n){n=n!=null&&n.hydrate===!0;var r=new NO(t,e,n),o=ss(3,null,null,e===2?7:e===1?3:0);r.current=o,o.stateNode=r,dx(o),t[yd]=r.current,n&&e!==0&&mR(t,t.nodeType===9?t:t.ownerDocument),this._internalRoot=r}Mx.prototype.render=function(t){sy(t,this._internalRoot,null,null)};Mx.prototype.unmount=function(){var t=this._internalRoot,e=t.containerInfo;sy(null,t,null,function(){e[yd]=null})};function Ed(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function BO(t,e){if(e||(e=t?t.nodeType===9?t.documentElement:t.firstChild:null,e=!(!e||e.nodeType!==1||!e.hasAttribute("data-reactroot"))),!e)for(var n;n=t.lastChild;)t.removeChild(n);return new Mx(t,0,e?{hydrate:!0}:void 0)}function Xy(t,e,n,r,o){var l=n._reactRootContainer;if(l){var a=l._internalRoot;if(typeof o=="function"){var d=o;o=function(){var x=c_(a);d.call(x)}}sy(e,a,t,o)}else{if(l=n._reactRootContainer=BO(n,r),a=l._internalRoot,typeof o=="function"){var g=o;o=function(){var x=c_(a);g.call(x)}}nC(function(){sy(e,a,t,o)})}return c_(a)}function UO(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:mh,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}YP=function(t){if(t.tag===13){var e=xg(fs(),150,100);$l(t,e),Ix(t,e)}};ex=function(t){t.tag===13&&($l(t,3),Ix(t,3))};KP=function(t){if(t.tag===13){var e=fs();e=Yu(e,t,null),$l(t,e),Ix(t,e)}};n0=function(t,e,n){switch(e){case"input":if(o0(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var o=sx(r);if(!o)throw Error(tt(90));RP(r),o0(r,o)}}}break;case"textarea":zP(t,n);break;case"select":e=n.value,e!=null&&Ah(t,!!n.multiple,e,!1)}};j1=tC;TP=function(t,e,n,r,o){var l=Yt;Yt|=4;try{return nu(98,t.bind(null,e,n,r,o))}finally{Yt=l,Yt===di&&gs()}};G1=function(){(Yt&(1|Ma|ds))===di&&(AO(),tf())};SP=function(t,e){var n=Yt;Yt|=2;try{return t(e)}finally{Yt=n,Yt===di&&gs()}};function hC(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ed(e))throw Error(tt(200));return UO(t,e,null,n)}var VO={Events:[_d,Qu,sx,bP,t0,Nh,function(t){J1(t,CR)},wP,EP,Uy,By,tf,{current:!1}]};(function(t){var e=t.findFiberByHostInstance;return zO(no({},t,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ia.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=HP(n),n===null?null:n.stateNode},findFiberByHostInstance:function(n){return e?e(n):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:vd,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});la.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VO;la.createPortal=hC;la.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternalFiber;if(e===void 0)throw typeof t.render=="function"?Error(tt(188)):Error(tt(268,Object.keys(t)));return t=HP(e),t=t===null?null:t.stateNode,t};la.flushSync=function(t,e){if((Yt&(Ma|ds))!==di)throw Error(tt(187));var n=Yt;Yt|=1;try{return nu(99,t.bind(null,e))}finally{Yt=n,gs()}};la.hydrate=function(t,e,n){if(!Ed(e))throw Error(tt(200));return Xy(null,t,e,!0,n)};la.render=function(t,e,n){if(!Ed(e))throw Error(tt(200));return Xy(null,t,e,!1,n)};la.unmountComponentAtNode=function(t){if(!Ed(t))throw Error(tt(40));return t._reactRootContainer?(nC(function(){Xy(null,null,t,!1,function(){t._reactRootContainer=null,t[yd]=null})}),!0):!1};la.unstable_batchedUpdates=tC;la.unstable_createPortal=function(t,e){return hC(t,e,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};la.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Ed(n))throw Error(tt(200));if(t==null||t._reactInternalFiber===void 0)throw Error(tt(38));return Xy(t,e,n,!1,r)};la.version="16.13.1";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}e(),t.exports=la})(KL);function G0(){return G0=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},G0.apply(this,arguments)}function Gn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ot(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ZE(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Nn(t,e,n){return e&&ZE(t.prototype,e),n&&ZE(t,n),t}function W0(t,e){return W0=Object.setPrototypeOf||function(r,o){return r.__proto__=o,r},W0(t,e)}function Ci(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&W0(t,e)}function Ju(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ju=function(n){return typeof n}:Ju=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ju(t)}function Ii(t,e){return e&&(Ju(e)==="object"||typeof e=="function")?e:ot(t)}function an(t){return an=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},an(t)}function me(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var De={},jO={get exports(){return De},set exports(t){De=t}},GO="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",WO=GO,HO=WO;function fC(){}function pC(){}pC.resetWarningCache=fC;var qO=function(){function t(r,o,l,a,d,g){if(g!==HO){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}t.isRequired=t;function e(){return t}var n={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:pC,resetWarningCache:fC};return n.PropTypes=n,n};jO.exports=qO();function $E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function $m(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$E(Object(n),!0).forEach(function(r){me(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$E(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function XE(t){if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(t=ZO(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(g){throw g},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,o=!0,l=!1,a;return{s:function(){r=t[Symbol.iterator]()},n:function(){var g=r.next();return o=g.done,g},e:function(g){l=!0,a=g},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw a}}}}function ZO(t,e){if(t){if(typeof t=="string")return YE(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return YE(t,e)}}function YE(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var $O=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function KE(t){if(!t)return null;if(typeof t=="string")return t;t.toJS&&(t=t.toJS());var e={},n=XE(t.layers),r;try{for(n.s();!(r=n.n()).done;){var o=r.value;e[o.id]=o}}catch(a){n.e(a)}finally{n.f()}var l=t.layers.map(function(a){var d=e[a.ref],g=null;if("interactive"in a&&(g=$m({},a),delete g.interactive),d){g=g||$m({},a),delete g.ref;var x=XE($O),E;try{for(x.s();!(E=x.n()).done;){var P=E.value;P in d&&(g[P]=d[P])}}catch(A){x.e(A)}finally{x.f()}}return g||a});return $m($m({},t),{},{layers:l})}function H0(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function XO(t){if(Array.isArray(t))return H0(t)}function YO(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function dC(t,e){if(t){if(typeof t=="string")return H0(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return H0(t,e)}}function KO(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xm(t){return XO(t)||YO(t)||dC(t)||KO()}function JO(t){if(Array.isArray(t))return t}function QO(t,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var n=[],r=!0,o=!1,l=void 0;try{for(var a=t[Symbol.iterator](),d;!(r=(d=a.next()).done)&&(n.push(d.value),!(e&&n.length===e));r=!0);}catch(g){o=!0,l=g}finally{try{!r&&a.return!=null&&a.return()}finally{if(o)throw l}}return n}}function e3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Hr(t,e){return JO(t)||QO(t,e)||dC(t,e)||e3()}var Ni=1e-6,jh=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function t3(){var t=new jh(4);return jh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function n3(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Yy(t,e,n){var r=e[0],o=e[1],l=e[2],a=e[3];return t[0]=n[0]*r+n[4]*o+n[8]*l+n[12]*a,t[1]=n[1]*r+n[5]*o+n[9]*l+n[13]*a,t[2]=n[2]*r+n[6]*o+n[10]*l+n[14]*a,t[3]=n[3]*r+n[7]*o+n[11]*l+n[15]*a,t}(function(){var t=t3();return function(e,n,r,o,l,a){var d,g;for(n||(n=4),r||(r=0),o?g=Math.min(o*n+r,e.length):g=e.length,d=r;d<g;d+=n)t[0]=e[d],t[1]=e[d+1],t[2]=e[d+2],t[3]=e[d+3],l(t,t,a),e[d]=t[0],e[d+1]=t[1],e[d+2]=t[2],e[d+3]=t[3];return e}})();function Sg(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function kh(t,e){var n=Yy([],e,t);return n3(n,n,1/n[3]),n}function JE(t,e){var n=t%e;return n<0?e+n:n}function r3(t,e,n){return n*e+(1-n)*t}function q0(t,e){var n=e[0],r=e[1],o=e[2],l=e[3],a=e[4],d=e[5],g=e[6],x=e[7],E=e[8],P=e[9],A=e[10],R=e[11],j=e[12],X=e[13],D=e[14],F=e[15],W=n*d-r*a,J=n*g-o*a,le=n*x-l*a,ue=r*g-o*d,ye=r*x-l*d,Ee=o*x-l*g,Pe=E*X-P*j,we=E*D-A*j,ze=E*F-R*j,Fe=P*D-A*X,Be=P*F-R*X,He=A*F-R*D,We=W*He-J*Be+le*Fe+ue*ze-ye*we+Ee*Pe;return We?(We=1/We,t[0]=(d*He-g*Be+x*Fe)*We,t[1]=(o*Be-r*He-l*Fe)*We,t[2]=(X*Ee-D*ye+F*ue)*We,t[3]=(A*ye-P*Ee-R*ue)*We,t[4]=(g*ze-a*He-x*we)*We,t[5]=(n*He-o*ze+l*we)*We,t[6]=(D*le-j*Ee-F*J)*We,t[7]=(E*Ee-A*le+R*J)*We,t[8]=(a*Be-d*ze+x*Pe)*We,t[9]=(r*ze-n*Be-l*Pe)*We,t[10]=(j*ye-X*le+F*W)*We,t[11]=(P*le-E*ye-R*W)*We,t[12]=(d*we-a*Fe-g*Pe)*We,t[13]=(n*Fe-r*we+o*Pe)*We,t[14]=(X*J-j*ue-D*W)*We,t[15]=(E*ue-P*J+A*W)*We,t):null}function Xl(t,e,n){var r=e[0],o=e[1],l=e[2],a=e[3],d=e[4],g=e[5],x=e[6],E=e[7],P=e[8],A=e[9],R=e[10],j=e[11],X=e[12],D=e[13],F=e[14],W=e[15],J=n[0],le=n[1],ue=n[2],ye=n[3];return t[0]=J*r+le*d+ue*P+ye*X,t[1]=J*o+le*g+ue*A+ye*D,t[2]=J*l+le*x+ue*R+ye*F,t[3]=J*a+le*E+ue*j+ye*W,J=n[4],le=n[5],ue=n[6],ye=n[7],t[4]=J*r+le*d+ue*P+ye*X,t[5]=J*o+le*g+ue*A+ye*D,t[6]=J*l+le*x+ue*R+ye*F,t[7]=J*a+le*E+ue*j+ye*W,J=n[8],le=n[9],ue=n[10],ye=n[11],t[8]=J*r+le*d+ue*P+ye*X,t[9]=J*o+le*g+ue*A+ye*D,t[10]=J*l+le*x+ue*R+ye*F,t[11]=J*a+le*E+ue*j+ye*W,J=n[12],le=n[13],ue=n[14],ye=n[15],t[12]=J*r+le*d+ue*P+ye*X,t[13]=J*o+le*g+ue*A+ye*D,t[14]=J*l+le*x+ue*R+ye*F,t[15]=J*a+le*E+ue*j+ye*W,t}function ly(t,e,n){var r=n[0],o=n[1],l=n[2],a,d,g,x,E,P,A,R,j,X,D,F;return e===t?(t[12]=e[0]*r+e[4]*o+e[8]*l+e[12],t[13]=e[1]*r+e[5]*o+e[9]*l+e[13],t[14]=e[2]*r+e[6]*o+e[10]*l+e[14],t[15]=e[3]*r+e[7]*o+e[11]*l+e[15]):(a=e[0],d=e[1],g=e[2],x=e[3],E=e[4],P=e[5],A=e[6],R=e[7],j=e[8],X=e[9],D=e[10],F=e[11],t[0]=a,t[1]=d,t[2]=g,t[3]=x,t[4]=E,t[5]=P,t[6]=A,t[7]=R,t[8]=j,t[9]=X,t[10]=D,t[11]=F,t[12]=a*r+E*o+j*l+e[12],t[13]=d*r+P*o+X*l+e[13],t[14]=g*r+A*o+D*l+e[14],t[15]=x*r+R*o+F*l+e[15]),t}function kx(t,e,n){var r=n[0],o=n[1],l=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function i3(t,e,n){var r=Math.sin(n),o=Math.cos(n),l=e[4],a=e[5],d=e[6],g=e[7],x=e[8],E=e[9],P=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*o+x*r,t[5]=a*o+E*r,t[6]=d*o+P*r,t[7]=g*o+A*r,t[8]=x*o-l*r,t[9]=E*o-a*r,t[10]=P*o-d*r,t[11]=A*o-g*r,t}function o3(t,e,n){var r=Math.sin(n),o=Math.cos(n),l=e[0],a=e[1],d=e[2],g=e[3],x=e[4],E=e[5],P=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*o+x*r,t[1]=a*o+E*r,t[2]=d*o+P*r,t[3]=g*o+A*r,t[4]=x*o-l*r,t[5]=E*o-a*r,t[6]=P*o-d*r,t[7]=A*o-g*r,t}function a3(t,e,n,r,o){var l=1/Math.tan(e/2),a;return t[0]=l/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0?(a=1/(r-o),t[10]=(o+r)*a,t[14]=2*o*r*a):(t[10]=-1,t[14]=-2*r),t}function QE(t,e){var n=t[0],r=t[1],o=t[2],l=t[3],a=t[4],d=t[5],g=t[6],x=t[7],E=t[8],P=t[9],A=t[10],R=t[11],j=t[12],X=t[13],D=t[14],F=t[15],W=e[0],J=e[1],le=e[2],ue=e[3],ye=e[4],Ee=e[5],Pe=e[6],we=e[7],ze=e[8],Fe=e[9],Be=e[10],He=e[11],We=e[12],_t=e[13],gn=e[14],pn=e[15];return Math.abs(n-W)<=Ni*Math.max(1,Math.abs(n),Math.abs(W))&&Math.abs(r-J)<=Ni*Math.max(1,Math.abs(r),Math.abs(J))&&Math.abs(o-le)<=Ni*Math.max(1,Math.abs(o),Math.abs(le))&&Math.abs(l-ue)<=Ni*Math.max(1,Math.abs(l),Math.abs(ue))&&Math.abs(a-ye)<=Ni*Math.max(1,Math.abs(a),Math.abs(ye))&&Math.abs(d-Ee)<=Ni*Math.max(1,Math.abs(d),Math.abs(Ee))&&Math.abs(g-Pe)<=Ni*Math.max(1,Math.abs(g),Math.abs(Pe))&&Math.abs(x-we)<=Ni*Math.max(1,Math.abs(x),Math.abs(we))&&Math.abs(E-ze)<=Ni*Math.max(1,Math.abs(E),Math.abs(ze))&&Math.abs(P-Fe)<=Ni*Math.max(1,Math.abs(P),Math.abs(Fe))&&Math.abs(A-Be)<=Ni*Math.max(1,Math.abs(A),Math.abs(Be))&&Math.abs(R-He)<=Ni*Math.max(1,Math.abs(R),Math.abs(He))&&Math.abs(j-We)<=Ni*Math.max(1,Math.abs(j),Math.abs(We))&&Math.abs(X-_t)<=Ni*Math.max(1,Math.abs(X),Math.abs(_t))&&Math.abs(D-gn)<=Ni*Math.max(1,Math.abs(D),Math.abs(gn))&&Math.abs(F-pn)<=Ni*Math.max(1,Math.abs(F),Math.abs(pn))}function s3(){var t=new jh(2);return jh!=Float32Array&&(t[0]=0,t[1]=0),t}function rc(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function l3(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function u3(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function c3(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function Lx(t,e){return t[0]=-e[0],t[1]=-e[1],t}function mC(t,e,n,r){var o=e[0],l=e[1];return t[0]=o+r*(n[0]-o),t[1]=l+r*(n[1]-l),t}var h3=l3;(function(){var t=s3();return function(e,n,r,o,l,a){var d,g;for(n||(n=2),r||(r=0),o?g=Math.min(o*n+r,e.length):g=e.length,d=r;d<g;d+=n)t[0]=e[d],t[1]=e[d+1],l(t,t,a),e[d]=t[0],e[d+1]=t[1];return e}})();function f3(){var t=new jh(3);return jh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function p3(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function d3(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}var m3=p3;(function(){var t=f3();return function(e,n,r,o,l,a){var d,g;for(n||(n=3),r||(r=0),o?g=Math.min(o*n+r,e.length):g=e.length,d=r;d<g;d+=n)t[0]=e[d],t[1]=e[d+1],t[2]=e[d+2],l(t,t,a),e[d]=t[0],e[d+1]=t[1],e[d+2]=t[2];return e}})();function Yl(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var Aa=Math.PI,gC=Aa/4,Kl=Aa/180,eT=180/Aa,Qp=512,tT=4003e4,g3=1.5;function Z0(t){return Math.pow(2,t)}function y3(t){return Math.log2(t)}function bh(t){var e=Hr(t,2),n=e[0],r=e[1];Yl(Number.isFinite(n)),Yl(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");var o=n*Kl,l=r*Kl,a=Qp*(o+Aa)/(2*Aa),d=Qp*(Aa+Math.log(Math.tan(gC+l*.5)))/(2*Aa);return[a,d]}function Dp(t){var e=Hr(t,2),n=e[0],r=e[1],o=n/Qp*(2*Aa)-Aa,l=2*(Math.atan(Math.exp(r/Qp*(2*Aa)-Aa))-gC);return[o*eT,l*eT]}function v3(t){var e=t.latitude,n=t.longitude,r=t.highPrecision,o=r===void 0?!1:r;Yl(Number.isFinite(e)&&Number.isFinite(n));var l={},a=Qp,d=Math.cos(e*Kl),g=a/360,x=g/d,E=a/tT/d;if(l.unitsPerMeter=[E,E,E],l.metersPerUnit=[1/E,1/E,1/E],l.unitsPerDegree=[g,x,E],l.degreesPerUnit=[1/g,1/x,1/E],o){var P=Kl*Math.tan(e*Kl)/d,A=g*P/2,R=a/tT*P,j=R/x*E;l.unitsPerDegree2=[0,A,R],l.unitsPerMeter2=[j,0,j]}return l}function _3(t){var e=t.height,n=t.pitch,r=t.bearing,o=t.altitude,l=t.scale,a=t.center,d=a===void 0?null:a,g=Sg();return ly(g,g,[0,0,-o]),i3(g,g,-n*Kl),o3(g,g,r*Kl),l/=e,kx(g,g,[l,l,l]),d&&ly(g,g,d3([],d)),g}function x3(t){var e=t.width,n=t.height,r=t.altitude,o=r===void 0?g3:r,l=t.pitch,a=l===void 0?0:l,d=t.nearZMultiplier,g=d===void 0?1:d,x=t.farZMultiplier,E=x===void 0?1:x,P=a*Kl,A=Math.atan(.5/o),R=Math.sin(A)*o/Math.sin(Math.min(Math.max(Math.PI/2-P-A,.01),Math.PI-.01)),j=Math.sin(P)*R+o;return{fov:2*A,aspect:e/n,focalDistance:o,near:g,far:j*E}}function b3(t){var e=t.width,n=t.height,r=t.pitch,o=t.altitude,l=t.nearZMultiplier,a=t.farZMultiplier,d=x3({width:e,height:n,altitude:o,pitch:r,nearZMultiplier:l,farZMultiplier:a}),g=d.fov,x=d.aspect,E=d.near,P=d.far,A=a3([],g,x,E,P);return A}function w3(t,e){var n=Hr(t,3),r=n[0],o=n[1],l=n[2],a=l===void 0?0:l;return Yl(Number.isFinite(r)&&Number.isFinite(o)&&Number.isFinite(a)),kh(e,[r,o,a,1])}function nT(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=Hr(t,3),o=r[0],l=r[1],a=r[2];if(Yl(Number.isFinite(o)&&Number.isFinite(l),"invalid pixel coordinate"),Number.isFinite(a)){var d=kh(e,[o,l,a,1]);return d}var g=kh(e,[o,l,0,1]),x=kh(e,[o,l,1,1]),E=g[2],P=x[2],A=E===P?0:((n||0)-E)/(P-E);return mC([],g,x,A)}function E3(t){var e=t.width,n=t.height,r=t.bounds,o=t.minExtent,l=o===void 0?0:o,a=t.maxZoom,d=a===void 0?24:a,g=t.padding,x=g===void 0?0:g,E=t.offset,P=E===void 0?[0,0]:E,A=Hr(r,2),R=Hr(A[0],2),j=R[0],X=R[1],D=Hr(A[1],2),F=D[0],W=D[1];if(Number.isFinite(x)){var J=x;x={top:J,bottom:J,left:J,right:J}}else Yl(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var le=new ia({width:e,height:n,longitude:0,latitude:0,zoom:0}),ue=le.project([j,W]),ye=le.project([F,X]),Ee=[Math.max(Math.abs(ye[0]-ue[0]),l),Math.max(Math.abs(ye[1]-ue[1]),l)],Pe=[e-x.left-x.right-Math.abs(P[0])*2,n-x.top-x.bottom-Math.abs(P[1])*2];Yl(Pe[0]>0&&Pe[1]>0);var we=Pe[0]/Ee[0],ze=Pe[1]/Ee[1],Fe=(x.right-x.left)/2/we,Be=(x.bottom-x.top)/2/ze,He=[(ye[0]+ue[0])/2+Fe,(ye[1]+ue[1])/2+Be],We=le.unproject(He),_t=Math.min(d,le.zoom+Math.log2(Math.abs(Math.min(we,ze))));return Yl(Number.isFinite(_t)),{longitude:We[0],latitude:We[1],zoom:_t}}var T3=Math.PI/180;function S3(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=t.width,r=t.height,o=t.unproject,l={targetZ:e},a=o([0,r],l),d=o([n,r],l),g,x,E=Math.atan(.5/t.altitude),P=(90-t.pitch)*T3;return E>P-.01?(g=rT(t,0,e),x=rT(t,n,e)):(g=o([0,0],l),x=o([n,0],l)),[a,d,x,g]}function rT(t,e,n){var r=t.pixelUnprojectionMatrix,o=kh(r,[e,0,1,1]),l=kh(r,[e,t.height,1,1]),a=n*t.distanceScales.unitsPerMeter[2],d=(a-o[2])/(l[2]-o[2]),g=mC([],o,l,d),x=Dp(g);return x[2]=n,x}var ia=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{width:1,height:1},n=e.width,r=e.height,o=e.latitude,l=o===void 0?0:o,a=e.longitude,d=a===void 0?0:a,g=e.zoom,x=g===void 0?0:g,E=e.pitch,P=E===void 0?0:E,A=e.bearing,R=A===void 0?0:A,j=e.altitude,X=j===void 0?1.5:j,D=e.nearZMultiplier,F=D===void 0?.02:D,W=e.farZMultiplier,J=W===void 0?1.01:W;Gn(this,t),n=n||1,r=r||1;var le=Z0(x);X=Math.max(.75,X);var ue=bh([d,l]);ue[2]=0,this.projectionMatrix=b3({width:n,height:r,pitch:P,altitude:X,nearZMultiplier:F,farZMultiplier:J}),this.viewMatrix=_3({height:r,scale:le,center:ue,pitch:P,bearing:R,altitude:X}),this.width=n,this.height=r,this.scale=le,this.latitude=l,this.longitude=d,this.zoom=x,this.pitch=P,this.bearing=R,this.altitude=X,this.center=ue,this.distanceScales=v3(this),this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this)}return Nn(t,[{key:"_initMatrices",value:function(){var n=this.width,r=this.height,o=this.projectionMatrix,l=this.viewMatrix,a=Sg();Xl(a,a,o),Xl(a,a,l),this.viewProjectionMatrix=a;var d=Sg();kx(d,d,[n/2,-r/2,1]),ly(d,d,[1,-1,0]),Xl(d,d,a);var g=q0(Sg(),d);if(!g)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=g}},{key:"equals",value:function(n){return n instanceof t?n.width===this.width&&n.height===this.height&&QE(n.projectionMatrix,this.projectionMatrix)&&QE(n.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.topLeft,l=o===void 0?!0:o,a=this.projectPosition(n),d=w3(a,this.pixelProjectionMatrix),g=Hr(d,2),x=g[0],E=g[1],P=l?E:this.height-E;return n.length===2?[x,P]:[x,P,d[2]]}},{key:"unproject",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.topLeft,l=o===void 0?!0:o,a=r.targetZ,d=a===void 0?void 0:a,g=Hr(n,3),x=g[0],E=g[1],P=g[2],A=l?E:this.height-E,R=d&&d*this.distanceScales.unitsPerMeter[2],j=nT([x,A,P],this.pixelUnprojectionMatrix,R),X=this.unprojectPosition(j),D=Hr(X,3),F=D[0],W=D[1],J=D[2];return Number.isFinite(P)?[F,W,J]:Number.isFinite(d)?[F,W,d]:[F,W]}},{key:"projectPosition",value:function(n){var r=bh(n),o=Hr(r,2),l=o[0],a=o[1],d=(n[2]||0)*this.distanceScales.unitsPerMeter[2];return[l,a,d]}},{key:"unprojectPosition",value:function(n){var r=Dp(n),o=Hr(r,2),l=o[0],a=o[1],d=(n[2]||0)*this.distanceScales.metersPerUnit[2];return[l,a,d]}},{key:"projectFlat",value:function(n){return bh(n)}},{key:"unprojectFlat",value:function(n){return Dp(n)}},{key:"getMapCenterByLngLatPosition",value:function(n){var r=n.lngLat,o=n.pos,l=nT(o,this.pixelUnprojectionMatrix),a=bh(r),d=rc([],a,Lx([],l)),g=rc([],this.center,d);return Dp(g)}},{key:"getLocationAtPoint",value:function(n){var r=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:r,pos:o})}},{key:"fitBounds",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,l=this.height,a=E3(Object.assign({width:o,height:l,bounds:n},r)),d=a.longitude,g=a.latitude,x=a.zoom;return new t({width:o,height:l,longitude:d,latitude:g,zoom:x})}},{key:"getBounds",value:function(n){var r=this.getBoundingRegion(n),o=Math.min.apply(Math,Xm(r.map(function(g){return g[0]}))),l=Math.max.apply(Math,Xm(r.map(function(g){return g[0]}))),a=Math.min.apply(Math,Xm(r.map(function(g){return g[1]}))),d=Math.max.apply(Math,Xm(r.map(function(g){return g[1]})));return[[o,a],[l,d]]}},{key:"getBoundingRegion",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return S3(this,n.z||0)}}]),t}(),iT=85.05113,oT=-85.05113;function P3(t){var e=t.width,n=t.height,r=t.longitude,o=t.latitude,l=t.zoom,a=t.pitch,d=a===void 0?0:a,g=t.bearing,x=g===void 0?0:g;(r<-180||r>180)&&(r=JE(r+180,360)-180),(x<-180||x>180)&&(x=JE(x+180,360)-180);var E=new ia({width:e,height:n,longitude:r,latitude:o,zoom:l}),P=E.project([r,iT])[1],A=E.project([r,oT])[1],R=0;return A-P<n&&(l+=Math.log2(n/(A-P)),E=new ia({width:e,height:n,longitude:r,latitude:o,zoom:l}),P=E.project([r,iT])[1],A=E.project([r,oT])[1]),P>0?R=P:A<n&&(R=A-n),R&&(o=E.unproject([e/2,n/2+R])[1]),{width:e,height:n,longitude:r,latitude:o,zoom:l,pitch:d,bearing:x}}var yC=.01,A3=["longitude","latitude","zoom"],vC={curve:1.414,speed:1.2};function C3(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},o={},l=_C(t,e,r),a=l.startZoom,d=l.startCenterXY,g=l.uDelta,x=l.w0,E=l.u1,P=l.S,A=l.rho,R=l.rho2,j=l.r0;if(E<yC){var X=!0,D=!1,F=void 0;try{for(var W=A3[Symbol.iterator](),J;!(X=(J=W.next()).done);X=!0){var le=J.value,ue=t[le],ye=e[le];o[le]=r3(ue,ye,n)}}catch(We){D=!0,F=We}finally{try{!X&&W.return!=null&&W.return()}finally{if(D)throw F}}return o}var Ee=n*P,Pe=Math.cosh(j)/Math.cosh(j+A*Ee),we=x*((Math.cosh(j)*Math.tanh(j+A*Ee)-Math.sinh(j))/R)/E,ze=1/Pe,Fe=a+y3(ze),Be=u3([],g,we);rc(Be,Be,d);var He=Dp(Be);return o.longitude=He[0],o.latitude=He[1],o.zoom=Fe,o}function I3(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n=Object.assign({},vC,n);var r=n,o=r.screenSpeed,l=r.speed,a=r.maxDuration,d=_C(t,e,n),g=d.S,x=d.rho,E=1e3*g,P;return Number.isFinite(o)?P=E/(o/x):P=E/l,Number.isFinite(a)&&P>a?0:P}function _C(t,e,n){n=Object.assign({},vC,n);var r=n.curve,o=t.zoom,l=[t.longitude,t.latitude],a=Z0(o),d=e.zoom,g=[e.longitude,e.latitude],x=Z0(d-o),E=bh(l),P=bh(g),A=h3([],P,E),R=Math.max(t.width,t.height),j=R/x,X=c3(A)*a,D=Math.max(X,yC),F=r*r,W=(j*j-R*R+F*F*D*D)/(2*R*F*D),J=(j*j-R*R-F*F*D*D)/(2*j*F*D),le=Math.log(Math.sqrt(W*W+1)-W),ue=Math.log(Math.sqrt(J*J+1)-J),ye=(ue-le)/r;return{startZoom:o,startCenterXY:E,uDelta:A,w0:R,u1:X,S:ye,rho:r,rho2:F,r0:le,r1:ue}}function M3(t){var e;typeof window<"u"?e=window:typeof self<"u"?e=self:e=global;var n=typeof document<"u"&&document.attachEvent;if(!n){var r=function(){var ye=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||function(Ee){return e.setTimeout(Ee,20)};return function(Ee){return ye(Ee)}}(),o=function(){var ye=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||e.clearTimeout;return function(Ee){return ye(Ee)}}(),l=function(Ee){var Pe=Ee.__resizeTriggers__,we=Pe.firstElementChild,ze=Pe.lastElementChild,Fe=we.firstElementChild;ze.scrollLeft=ze.scrollWidth,ze.scrollTop=ze.scrollHeight,Fe.style.width=we.offsetWidth+1+"px",Fe.style.height=we.offsetHeight+1+"px",we.scrollLeft=we.scrollWidth,we.scrollTop=we.scrollHeight},a=function(Ee){return Ee.offsetWidth!=Ee.__resizeLast__.width||Ee.offsetHeight!=Ee.__resizeLast__.height},d=function(Ee){if(!(Ee.target.className.indexOf("contract-trigger")<0&&Ee.target.className.indexOf("expand-trigger")<0)){var Pe=this;l(this),this.__resizeRAF__&&o(this.__resizeRAF__),this.__resizeRAF__=r(function(){a(Pe)&&(Pe.__resizeLast__.width=Pe.offsetWidth,Pe.__resizeLast__.height=Pe.offsetHeight,Pe.__resizeListeners__.forEach(function(we){we.call(Pe,Ee)}))})}},g=!1,x="",E="animationstart",P="Webkit Moz O ms".split(" "),A="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),R="";{var j=document.createElement("fakeelement");if(j.style.animationName!==void 0&&(g=!0),g===!1){for(var X=0;X<P.length;X++)if(j.style[P[X]+"AnimationName"]!==void 0){R=P[X],x="-"+R.toLowerCase()+"-",E=A[X],g=!0;break}}}var D="resizeanim",F="@"+x+"keyframes "+D+" { from { opacity: 0; } to { opacity: 0; } } ",W=x+"animation: 1ms "+D+"; "}var J=function(Ee){if(!Ee.getElementById("detectElementResize")){var Pe=(F||"")+".resize-triggers { "+(W||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',we=Ee.head||Ee.getElementsByTagName("head")[0],ze=Ee.createElement("style");ze.id="detectElementResize",ze.type="text/css",t!=null&&ze.setAttribute("nonce",t),ze.styleSheet?ze.styleSheet.cssText=Pe:ze.appendChild(Ee.createTextNode(Pe)),we.appendChild(ze)}},le=function(Ee,Pe){if(n)Ee.attachEvent("onresize",Pe);else{if(!Ee.__resizeTriggers__){var we=Ee.ownerDocument,ze=e.getComputedStyle(Ee);ze&&ze.position=="static"&&(Ee.style.position="relative"),J(we),Ee.__resizeLast__={},Ee.__resizeListeners__=[],(Ee.__resizeTriggers__=we.createElement("div")).className="resize-triggers",Ee.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',Ee.appendChild(Ee.__resizeTriggers__),l(Ee),Ee.addEventListener("scroll",d,!0),E&&(Ee.__resizeTriggers__.__animationListener__=function(Be){Be.animationName==D&&l(Ee)},Ee.__resizeTriggers__.addEventListener(E,Ee.__resizeTriggers__.__animationListener__))}Ee.__resizeListeners__.push(Pe)}},ue=function(Ee,Pe){if(n)Ee.detachEvent("onresize",Pe);else if(Ee.__resizeListeners__.splice(Ee.__resizeListeners__.indexOf(Pe),1),!Ee.__resizeListeners__.length){Ee.removeEventListener("scroll",d,!0),Ee.__resizeTriggers__.__animationListener__&&(Ee.__resizeTriggers__.removeEventListener(E,Ee.__resizeTriggers__.__animationListener__),Ee.__resizeTriggers__.__animationListener__=null);try{Ee.__resizeTriggers__=!Ee.removeChild(Ee.__resizeTriggers__)}catch{}}};return{addResizeListener:le,removeResizeListener:ue}}var k3=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},L3=function(){function t(e,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),R3=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},O3=function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},aT=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t},xC=function(t){O3(e,t);function e(){var n,r,o,l;k3(this,e);for(var a=arguments.length,d=Array(a),g=0;g<a;g++)d[g]=arguments[g];return l=(r=(o=aT(this,(n=e.__proto__||Object.getPrototypeOf(e)).call.apply(n,[this].concat(d))),o),o.state={height:o.props.defaultHeight||0,width:o.props.defaultWidth||0},o._onResize=function(){var x=o.props,E=x.disableHeight,P=x.disableWidth,A=x.onResize;if(o._parentNode){var R=o._parentNode.offsetHeight||0,j=o._parentNode.offsetWidth||0,X=window.getComputedStyle(o._parentNode)||{},D=parseInt(X.paddingLeft,10)||0,F=parseInt(X.paddingRight,10)||0,W=parseInt(X.paddingTop,10)||0,J=parseInt(X.paddingBottom,10)||0,le=R-W-J,ue=j-D-F;(!E&&o.state.height!==le||!P&&o.state.width!==ue)&&(o.setState({height:R-W-J,width:j-D-F}),A({height:R,width:j}))}},o._setRef=function(x){o._autoSizer=x},r),aT(o,l)}return L3(e,[{key:"componentDidMount",value:function(){var r=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._detectElementResize=M3(r),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var r=this.props,o=r.children,l=r.className,a=r.disableHeight,d=r.disableWidth,g=r.style,x=this.state,E=x.height,P=x.width,A={overflow:"visible"},R={},j=!1;return a||(E===0&&(j=!0),A.height=0,R.height=E),d||(P===0&&(j=!0),A.width=0,R.width=P),st.createElement("div",{className:l,ref:this._setRef,style:R3({},A,g)},!j&&o(R))}}]),e}(st.PureComponent);xC.defaultProps={onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}};var sT=typeof window<"u"?window:global,zl=typeof document<"u"?document:{};function z3(){}function D3(t){t&&console.error(t.error)}var bC={container:De.object,gl:De.object,mapboxApiAccessToken:De.string,mapboxApiUrl:De.string,attributionControl:De.bool,preserveDrawingBuffer:De.bool,reuseMaps:De.bool,transformRequest:De.func,mapOptions:De.object,mapStyle:De.oneOfType([De.string,De.object]),visible:De.bool,asyncRender:De.bool,onLoad:De.func,onError:De.func,width:De.number,height:De.number,viewState:De.object,longitude:De.number,latitude:De.number,zoom:De.number,bearing:De.number,pitch:De.number,altitude:De.number},Pg={container:zl.body,mapboxApiAccessToken:F3(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",visible:!0,asyncRender:!1,onLoad:z3,onError:D3,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function F3(){var t=null;if(typeof window<"u"&&window.location){var e=window.location.search.match(/access_token=([^&\/]*)/);t=e&&e[1]}return!t&&typeof process<"u"&&(t=t||{}.MapboxAccessToken||{}.REACT_APP_MAPBOX_ACCESS_TOKEN),t||"no-token"}function lT(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";t.debug&&De.checkPropTypes(bC,t,"prop",e)}var fc=function(){function t(e){var n=this;if(Gn(this,t),me(this,"mapboxgl",void 0),me(this,"props",Pg),me(this,"_map",null),me(this,"width",0),me(this,"height",0),me(this,"_fireLoadEvent",function(){n.props.onLoad({type:"load",target:n._map})}),!e.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=e.mapboxgl,t.initialized||(t.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(e)}return Nn(t,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(n){return this._update(this.props,n),this}},{key:"resize",value:function(){return this._map.resize(),this}},{key:"redraw",value:function(){var n=this._map;n.style&&(n._frame&&(n._frame.cancel(),n._frame=null),n._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(n){this._map=t.savedMap;var r=this._map.getContainer(),o=n.container;for(o.classList.add("mapboxgl-map");r.childNodes.length>0;)o.appendChild(r.childNodes[0]);this._map._container=o,t.savedMap=null,n.mapStyle&&this._map.setStyle(n.mapStyle,{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(n){if(n.reuseMaps&&t.savedMap)this._reuse(n);else{if(n.gl){var r=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=r,n.gl}}var o={container:n.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:n.mapStyle,interactive:!1,trackResize:!1,attributionControl:n.attributionControl,preserveDrawingBuffer:n.preserveDrawingBuffer};n.transformRequest&&(o.transformRequest=n.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},o,n.mapOptions)),this._map.once("load",n.onLoad),this._map.on("error",n.onError)}return this}},{key:"_destroy",value:function(){this._map&&(t.savedMap?this._map.remove():(t.savedMap=this._map,this._map.off("load",this.props.onLoad),this._map.off("error",this.props.onError),this._map.off("styledata",this._fireLoadEvent)),this._map=null)}},{key:"_initialize",value:function(n){var r=this;n=Object.assign({},Pg,n),lT(n,"Mapbox"),this.mapboxgl.accessToken=n.mapboxApiAccessToken||Pg.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=n.mapboxApiUrl,this._create(n);var o=n,l=o.container;Object.defineProperty(l,"offsetWidth",{get:function(){return r.width}}),Object.defineProperty(l,"clientWidth",{get:function(){return r.width}}),Object.defineProperty(l,"offsetHeight",{get:function(){return r.height}}),Object.defineProperty(l,"clientHeight",{get:function(){return r.height}});var a=this._map.getCanvas();a&&(a.style.outline="none"),this._updateMapViewport({},n),this._updateMapSize({},n),this.props=n}},{key:"_update",value:function(n,r){if(this._map){r=Object.assign({},this.props,r),lT(r,"Mapbox");var o=this._updateMapViewport(n,r),l=this._updateMapSize(n,r);!r.asyncRender&&(o||l)&&this.redraw(),this.props=r}}},{key:"_updateMapSize",value:function(n,r){var o=n.width!==r.width||n.height!==r.height;return o&&(this.width=r.width,this.height=r.height,this.resize()),o}},{key:"_updateMapViewport",value:function(n,r){var o=this._getViewState(n),l=this._getViewState(r),a=l.latitude!==o.latitude||l.longitude!==o.longitude||l.zoom!==o.zoom||l.pitch!==o.pitch||l.bearing!==o.bearing||l.altitude!==o.altitude;return a&&(this._map.jumpTo(this._viewStateToMapboxProps(l)),l.altitude!==o.altitude&&(this._map.transform.altitude=l.altitude)),a}},{key:"_getViewState",value:function(n){var r=n.viewState||n,o=r.longitude,l=r.latitude,a=r.zoom,d=r.pitch,g=d===void 0?0:d,x=r.bearing,E=x===void 0?0:x,P=r.altitude,A=P===void 0?1.5:P;return{longitude:o,latitude:l,zoom:a,pitch:g,bearing:E,altitude:A}}},{key:"_checkStyleSheet",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof zl>"u"))try{var r=zl.createElement("div");r.className="mapboxgl-map",r.style.display="none",zl.body.append(r);var o=window.getComputedStyle(r).position!=="static";if(!o){var l=zl.createElement("link");l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(n,"/mapbox-gl.css")),zl.head.append(l)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(n){return{center:[n.longitude,n.latitude],zoom:n.zoom,bearing:n.bearing,pitch:n.pitch}}}]),t}();me(fc,"initialized",!1);me(fc,"propTypes",bC);me(fc,"defaultProps",Pg);me(fc,"savedMap",null);var $0={},N3={get exports(){return $0},set exports(t){$0=t}};(function(t,e){(function(n,r){t.exports=r()})(IL,function(){var n,r,o;function l(a,d){if(!n)n=d;else if(!r)r=d;else{var g="var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk);",x={};n(x),o=d(x),typeof window<"u"&&(o.workerUrl=window.URL.createObjectURL(new Blob([g],{type:"text/javascript"})))}}return l(["exports"],function(a){function d(i,s){return i(s={exports:{}},s.exports),s.exports}var g=x;function x(i,s,u,p){this.cx=3*i,this.bx=3*(u-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(p-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=p,this.p2x=u,this.p2y=p}x.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},x.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},x.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},x.prototype.solveCurveX=function(i,s){var u,p,y,v,b;for(s===void 0&&(s=1e-6),y=i,b=0;b<8;b++){if(v=this.sampleCurveX(y)-i,Math.abs(v)<s)return y;var T=this.sampleCurveDerivativeX(y);if(Math.abs(T)<1e-6)break;y-=v/T}if((y=i)<(u=0))return u;if(y>(p=1))return p;for(;u<p;){if(v=this.sampleCurveX(y),Math.abs(v-i)<s)return y;i>v?u=y:p=y,y=.5*(p-u)+u}return y},x.prototype.solve=function(i,s){return this.sampleCurveY(this.solveCurveX(i,s))};var E=P;function P(i,s){this.x=i,this.y=s}P.prototype={clone:function(){return new P(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,s){return this.clone()._rotateAround(i,s)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var s=i.x-this.x,u=i.y-this.y;return s*s+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,s){return Math.atan2(this.x*s-this.y*i,this.x*i+this.y*s)},_matMult:function(i){var s=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=s,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var s=Math.cos(i),u=Math.sin(i),p=u*this.x+s*this.y;return this.x=s*this.x-u*this.y,this.y=p,this},_rotateAround:function(i,s){var u=Math.cos(i),p=Math.sin(i),y=s.y+p*(this.x-s.x)+u*(this.y-s.y);return this.x=s.x+u*(this.x-s.x)-p*(this.y-s.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},P.convert=function(i){return i instanceof P?i:Array.isArray(i)?new P(i[0],i[1]):i};var A=typeof self<"u"?self:{};function R(i,s,u,p){var y=new g(i,s,u,p);return function(v){return y.solve(v)}}var j=R(.25,.1,.25,1);function X(i,s,u){return Math.min(u,Math.max(s,i))}function D(i,s,u){var p=u-s,y=((i-s)%p+p)%p+s;return y===s?u:y}function F(i){for(var s=[],u=arguments.length-1;u-- >0;)s[u]=arguments[u+1];for(var p=0,y=s;p<y.length;p+=1){var v=y[p];for(var b in v)i[b]=v[b]}return i}var W=1;function J(){return W++}function le(){return function i(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function ue(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function ye(i,s){i.forEach(function(u){s[u]&&(s[u]=s[u].bind(s))})}function Ee(i,s){return i.indexOf(s,i.length-s.length)!==-1}function Pe(i,s,u){var p={};for(var y in i)p[y]=s.call(u||this,i[y],y,i);return p}function we(i,s,u){var p={};for(var y in i)s.call(u||this,i[y],y,i)&&(p[y]=i[y]);return p}function ze(i){return Array.isArray(i)?i.map(ze):typeof i=="object"&&i?Pe(i,ze):i}var Fe={};function Be(i){Fe[i]||(typeof console<"u"&&console.warn(i),Fe[i]=!0)}function He(i,s,u){return(u.y-i.y)*(s.x-i.x)>(s.y-i.y)*(u.x-i.x)}function We(i){for(var s=0,u=0,p=i.length,y=p-1,v=void 0,b=void 0;u<p;y=u++)s+=((b=i[y]).x-(v=i[u]).x)*(v.y+b.y);return s}function _t(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function gn(i){var s={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,y,v,b){var T=v||b;return s[y]=!T||T.toLowerCase(),""}),s["max-age"]){var u=parseInt(s["max-age"],10);isNaN(u)?delete s["max-age"]:s["max-age"]=u}return s}var pn=null;function $n(i){if(pn==null){var s=i.navigator?i.navigator.userAgent:null;pn=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return pn}function Tn(i){try{var s=A[i];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch{return!1}}var lr,Jt,dn,An,et=A.performance&&A.performance.now?A.performance.now.bind(A.performance):Date.now.bind(Date),yt=A.requestAnimationFrame||A.mozRequestAnimationFrame||A.webkitRequestAnimationFrame||A.msRequestAnimationFrame,Qt=A.cancelAnimationFrame||A.mozCancelAnimationFrame||A.webkitCancelAnimationFrame||A.msCancelAnimationFrame,Pt={now:et,frame:function(i){var s=yt(i);return{cancel:function(){return Qt(s)}}},getImageData:function(i,s){s===void 0&&(s=0);var u=A.document.createElement("canvas"),p=u.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return u.width=i.width,u.height=i.height,p.drawImage(i,0,0,i.width,i.height),p.getImageData(-s,-s,i.width+2*s,i.height+2*s)},resolveURL:function(i){return lr||(lr=A.document.createElement("a")),lr.href=i,lr.href},hardwareConcurrency:A.navigator&&A.navigator.hardwareConcurrency||4,get devicePixelRatio(){return A.devicePixelRatio},get prefersReducedMotion(){return!!A.matchMedia&&(Jt==null&&(Jt=A.matchMedia("(prefers-reduced-motion: reduce)")),Jt.matches)}},Nt={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},qt={supported:!1,testSupport:function(i){!yn&&An&&(ai?Kn(i):dn=i)}},yn=!1,ai=!1;function Kn(i){var s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,An),i.isContextLost())return;qt.supported=!0}catch{}i.deleteTexture(s),yn=!0}A.document&&((An=A.document.createElement("img")).onload=function(){dn&&Kn(dn),dn=null,ai=!0},An.onerror=function(){yn=!0,dn=null},An.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Wt="01",Jn=function(i,s){this._transformRequestFn=i,this._customAccessToken=s,this._createSkuToken()};function Zr(i){return i.indexOf("mapbox:")===0}Jn.prototype._createSkuToken=function(){var i=function(){for(var s="",u=0;u<10;u++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Wt,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt},Jn.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Jn.prototype.transformRequest=function(i,s){return this._transformRequestFn&&this._transformRequestFn(i,s)||{url:i}},Jn.prototype.normalizeStyleURL=function(i,s){if(!Zr(i))return i;var u=yi(i);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||s)},Jn.prototype.normalizeGlyphsURL=function(i,s){if(!Zr(i))return i;var u=yi(i);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||s)},Jn.prototype.normalizeSourceURL=function(i,s){if(!Zr(i))return i;var u=yi(i);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||s)},Jn.prototype.normalizeSpriteURL=function(i,s,u,p){var y=yi(i);return Zr(i)?(y.path="/styles/v1"+y.path+"/sprite"+s+u,this._makeAPIURL(y,this._customAccessToken||p)):(y.path+=""+s+u,Hi(y))},Jn.prototype.normalizeTileURL=function(i,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Zr(i))return i;var u=yi(i);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Pt.devicePixelRatio>=2||s===512?"@2x":"")+(qt.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var p=this._customAccessToken||function(y){for(var v=0,b=y;v<b.length;v+=1){var T=b[v].match(/^access_token=(.*)$/);if(T)return T[1]}return null}(u.params)||Nt.ACCESS_TOKEN;return Nt.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,p)},Jn.prototype.canonicalizeTileURL=function(i,s){var u=yi(i);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return i;var p="mapbox://tiles/";p+=u.path.replace("/v4/","");var y=u.params;return s&&(y=y.filter(function(v){return!v.match(/^access_token=/)})),y.length&&(p+="?"+y.join("&")),p},Jn.prototype.canonicalizeTileset=function(i,s){for(var u=!!s&&Zr(s),p=[],y=0,v=i.tiles||[];y<v.length;y+=1){var b=v[y];gi(b)?p.push(this.canonicalizeTileURL(b,u)):p.push(b)}return p},Jn.prototype._makeAPIURL=function(i,s){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=yi(Nt.API_URL);if(i.protocol=p.protocol,i.authority=p.authority,p.path!=="/"&&(i.path=""+p.path+i.path),!Nt.REQUIRE_ACCESS_TOKEN)return Hi(i);if(!(s=s||Nt.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return i.params=i.params.filter(function(y){return y.indexOf("access_token")===-1}),i.params.push("access_token="+s),Hi(i)};var mi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function gi(i){return mi.test(i)}var Go=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yi(i){var s=i.match(Go);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function Hi(i){var s=i.params.length?"?"+i.params.join("&"):"";return i.protocol+"://"+i.authority+i.path+s}function $r(i){if(!i)return null;var s=i.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(A.atob(s[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var Mi=function(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Mi.prototype.getStorageKey=function(i){var s,u=$r(Nt.ACCESS_TOKEN);return s=u&&u.u?A.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(p,y){return String.fromCharCode(Number("0x"+y))})):Nt.ACCESS_TOKEN||"",i?"mapbox.eventData."+i+":"+s:"mapbox.eventData:"+s},Mi.prototype.fetchEventData=function(){var i=Tn("localStorage"),s=this.getStorageKey(),u=this.getStorageKey("uuid");if(i)try{var p=A.localStorage.getItem(s);p&&(this.eventData=JSON.parse(p));var y=A.localStorage.getItem(u);y&&(this.anonId=y)}catch{Be("Unable to read from LocalStorage")}},Mi.prototype.saveEventData=function(){var i=Tn("localStorage"),s=this.getStorageKey(),u=this.getStorageKey("uuid");if(i)try{A.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&A.localStorage.setItem(s,JSON.stringify(this.eventData))}catch{Be("Unable to write to LocalStorage")}},Mi.prototype.processRequests=function(i){},Mi.prototype.postEvent=function(i,s,u,p){var y=this;if(Nt.EVENTS_URL){var v=yi(Nt.EVENTS_URL);v.params.push("access_token="+(p||Nt.ACCESS_TOKEN||""));var b={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.11.0",skuId:Wt,userId:this.anonId},T=s?F(b,s):b,I={url:Hi(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};this.pendingRequest=ou(I,function(M){y.pendingRequest=null,u(M),y.saveEventData(),y.processRequests(p)})}},Mi.prototype.queueRequest=function(i,s){this.queue.push(i),this.processRequests(s)};var vi,ua,il=function(i){function s(){i.call(this,"map.load"),this.success={},this.skuToken=""}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(u,p,y,v){this.skuToken=y,(Nt.EVENTS_URL&&v||Nt.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(b){return Zr(b)||gi(b)}))&&this.queueRequest({id:p,timestamp:Date.now()},v)},s.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),v=y.id,b=y.timestamp;v&&this.success[v]||(this.anonId||this.fetchEventData(),ue(this.anonId)||(this.anonId=le()),this.postEvent(b,{skuToken:this.skuToken},function(T){T||v&&(p.success[v]=!0)},u))}},s}(Mi),ki=new(function(i){function s(u){i.call(this,"appUserTurnstile"),this._customAccessToken=u}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(u,p){Nt.EVENTS_URL&&Nt.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Zr(y)||gi(y)})&&this.queueRequest(Date.now(),p)},s.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=$r(Nt.ACCESS_TOKEN),v=y?y.u:Nt.ACCESS_TOKEN,b=v!==this.eventData.tokenU;ue(this.anonId)||(this.anonId=le(),b=!0);var T=this.queue.shift();if(this.eventData.lastSuccess){var I=new Date(this.eventData.lastSuccess),M=new Date(T),L=(T-this.eventData.lastSuccess)/864e5;b=b||L>=1||L<-1||I.getDate()!==M.getDate()}else b=!0;if(!b)return this.processRequests();this.postEvent(T,{"enabled.telemetry":!1},function(z){z||(p.eventData.lastSuccess=T,p.eventData.tokenU=v)},u)}},s}(Mi)),ol=ki.postTurnstileEvent.bind(ki),La=new il,ys=La.postMapLoadEvent.bind(La),ca=500,vo=50;function Wo(){A.caches&&!vi&&(vi=A.caches.open("mapbox-tiles"))}function al(i){var s=i.indexOf("?");return s<0?i:i.slice(0,s)}var Ra,Oa=1/0;function vs(){return Ra==null&&(Ra=A.OffscreenCanvas&&new A.OffscreenCanvas(1,1).getContext("2d")&&typeof A.createImageBitmap=="function"),Ra}var _s={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(_s);var ha=function(i){function s(u,p,y){p===401&&gi(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),i.call(this,u),this.status=p,this.url=y,this.name=this.constructor.name,this.message=u}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),xs=_t()?function(){return self.worker&&self.worker.referrer}:function(){return(A.location.protocol==="blob:"?A.parent:A).location.href},Ho,qi,_o=function(i,s){if(!(/^file:/.test(u=i.url)||/^file:/.test(xs())&&!/^\w+:/.test(u))){if(A.fetch&&A.Request&&A.AbortController&&A.Request.prototype.hasOwnProperty("signal"))return function(p,y){var v,b=new A.AbortController,T=new A.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:xs(),signal:b.signal}),I=!1,M=!1,L=(v=T.url).indexOf("sku=")>0&&gi(v);p.type==="json"&&T.headers.set("Accept","application/json");var z=function(H,ee,te){if(!M){if(H&&H.message!=="SecurityError"&&Be(H),ee&&te)return U(ee);var pe=Date.now();A.fetch(T).then(function(ce){if(ce.ok){var be=L?ce.clone():null;return U(ce,be,pe)}return y(new ha(ce.statusText,ce.status,p.url))}).catch(function(ce){ce.code!==20&&y(new Error(ce.message))})}},U=function(H,ee,te){(p.type==="arrayBuffer"?H.arrayBuffer():p.type==="json"?H.json():H.text()).then(function(pe){M||(ee&&te&&function(ce,be,Se){if(Wo(),vi){var Ie={status:be.status,statusText:be.statusText,headers:new A.Headers};be.headers.forEach(function(Ne,$e){return Ie.headers.set($e,Ne)});var Me=gn(be.headers.get("Cache-Control")||"");Me["no-store"]||(Me["max-age"]&&Ie.headers.set("Expires",new Date(Se+1e3*Me["max-age"]).toUTCString()),new Date(Ie.headers.get("Expires")).getTime()-Se<42e4||function(Ne,$e){if(ua===void 0)try{new Response(new ReadableStream),ua=!0}catch{ua=!1}ua?$e(Ne.body):Ne.blob().then($e)}(be,function(Ne){var $e=new A.Response(Ne,Ie);Wo(),vi&&vi.then(function(Qe){return Qe.put(al(ce.url),$e)}).catch(function(Qe){return Be(Qe.message)})}))}}(T,ee,te),I=!0,y(null,pe,H.headers.get("Cache-Control"),H.headers.get("Expires")))}).catch(function(pe){M||y(new Error(pe.message))})};return L?function(H,ee){if(Wo(),!vi)return ee(null);var te=al(H.url);vi.then(function(pe){pe.match(te).then(function(ce){var be=function(Se){if(!Se)return!1;var Ie=new Date(Se.headers.get("Expires")||0),Me=gn(Se.headers.get("Cache-Control")||"");return Ie>Date.now()&&!Me["no-cache"]}(ce);pe.delete(te),be&&pe.put(te,ce.clone()),ee(null,ce,be)}).catch(ee)}).catch(ee)}(T,z):z(null,null),{cancel:function(){M=!0,I||b.abort()}}}(i,s);if(_t()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,s,void 0,!0)}var u;return function(p,y){var v=new A.XMLHttpRequest;for(var b in v.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(v.responseType="arraybuffer"),p.headers)v.setRequestHeader(b,p.headers[b]);return p.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=p.credentials==="include",v.onerror=function(){y(new Error(v.statusText))},v.onload=function(){if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){var T=v.response;if(p.type==="json")try{T=JSON.parse(v.response)}catch(I){return y(I)}y(null,T,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else y(new ha(v.statusText,v.status,p.url))},v.send(p.body),{cancel:function(){return v.abort()}}}(i,s)},fa=function(i,s){return _o(F(i,{type:"arrayBuffer"}),s)},ou=function(i,s){return _o(F(i,{method:"POST"}),s)};Ho=[],qi=0;var Wn=function(i,s){if(qt.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),qi>=Nt.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:i,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ho.push(u),u}qi++;var p=!1,y=function(){if(!p)for(p=!0,qi--;Ho.length&&qi<Nt.MAX_PARALLEL_IMAGE_REQUESTS;){var b=Ho.shift();b.cancelled||(b.cancel=Wn(b.requestParameters,b.callback).cancel)}},v=fa(i,function(b,T,I,M){y(),b?s(b):T&&(vs()?function(L,z){var U=new A.Blob([new Uint8Array(L)],{type:"image/png"});A.createImageBitmap(U).then(function(H){z(null,H)}).catch(function(H){z(new Error("Could not load image because of "+H.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(T,s):function(L,z,U,H){var ee=new A.Image,te=A.URL;ee.onload=function(){z(null,ee),te.revokeObjectURL(ee.src)},ee.onerror=function(){return z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var pe=new A.Blob([new Uint8Array(L)],{type:"image/png"});ee.cacheControl=U,ee.expires=H,ee.src=L.byteLength?te.createObjectURL(pe):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}(T,s,I,M))});return{cancel:function(){v.cancel(),y()}}};function O(i,s,u){u[i]&&u[i].indexOf(s)!==-1||(u[i]=u[i]||[],u[i].push(s))}function B(i,s,u){if(u&&u[i]){var p=u[i].indexOf(s);p!==-1&&u[i].splice(p,1)}}var G=function(i,s){s===void 0&&(s={}),F(this,s),this.type=i},Y=function(i){function s(u,p){p===void 0&&(p={}),i.call(this,"error",F({error:u},p))}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(G),ne=function(){};ne.prototype.on=function(i,s){return this._listeners=this._listeners||{},O(i,s,this._listeners),this},ne.prototype.off=function(i,s){return B(i,s,this._listeners),B(i,s,this._oneTimeListeners),this},ne.prototype.once=function(i,s){return this._oneTimeListeners=this._oneTimeListeners||{},O(i,s,this._oneTimeListeners),this},ne.prototype.fire=function(i,s){typeof i=="string"&&(i=new G(i,s||{}));var u=i.type;if(this.listens(u)){i.target=this;for(var p=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];p<y.length;p+=1)y[p].call(this,i);for(var v=0,b=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];v<b.length;v+=1){var T=b[v];B(u,T,this._oneTimeListeners),T.call(this,i)}var I=this._eventedParent;I&&(F(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),I.fire(i))}else i instanceof Y&&console.error(i.error);return this},ne.prototype.listens=function(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)},ne.prototype.setEventedParent=function(i,s){return this._eventedParent=i,this._eventedParentData=s,this};var Z={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},"index-of":{group:"Lookup"},slice:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},distance:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},within:{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},re=function(i,s,u,p){this.message=(i?i+": ":"")+u,p&&(this.identifier=p),s!=null&&s.__line__&&(this.line=s.__line__)};function ge(i){var s=i.value;return s?[new re(i.key,s,"constants have been deprecated as of v8")]:[]}function xe(i){for(var s=[],u=arguments.length-1;u-- >0;)s[u]=arguments[u+1];for(var p=0,y=s;p<y.length;p+=1){var v=y[p];for(var b in v)i[b]=v[b]}return i}function _e(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ue(i){if(Array.isArray(i))return i.map(Ue);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){var s={};for(var u in i)s[u]=Ue(i[u]);return s}return _e(i)}var Ge=function(i){function s(u,p){i.call(this,p),this.message=p,this.key=u}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Error),Oe=function(i,s){s===void 0&&(s=[]),this.parent=i,this.bindings={};for(var u=0,p=s;u<p.length;u+=1){var y=p[u];this.bindings[y[0]]=y[1]}};Oe.prototype.concat=function(i){return new Oe(this,i)},Oe.prototype.get=function(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(i+" not found in scope.")},Oe.prototype.has=function(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)};var qe={kind:"null"},ke={kind:"number"},Xe={kind:"string"},Ye={kind:"boolean"},Tt={kind:"color"},xt={kind:"object"},Ve={kind:"value"},zt={kind:"collator"},Rt={kind:"formatted"},Zt={kind:"resolvedImage"};function en(i,s){return{kind:"array",itemType:i,N:s}}function bt(i){if(i.kind==="array"){var s=bt(i.itemType);return typeof i.N=="number"?"array<"+s+", "+i.N+">":i.itemType.kind==="value"?"array":"array<"+s+">"}return i.kind}var mn=[qe,ke,Xe,Ye,Tt,Rt,xt,en(Ve),Zt];function sn(i,s){if(s.kind==="error")return null;if(i.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!sn(i.itemType,s.itemType))&&(typeof i.N!="number"||i.N===s.N))return null}else{if(i.kind===s.kind)return null;if(i.kind==="value"){for(var u=0,p=mn;u<p.length;u+=1)if(!sn(p[u],s))return null}}return"Expected "+bt(i)+" but found "+bt(s)+" instead."}function kn(i,s){return s.some(function(u){return u.kind===i.kind})}function $t(i,s){return s.some(function(u){return u==="null"?i===null:u==="array"?Array.isArray(i):u==="object"?i&&!Array.isArray(i)&&typeof i=="object":u===typeof i})}var xn=d(function(i,s){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(T){return(T=Math.round(T))<0?0:T>255?255:T}function y(T){return p(T[T.length-1]==="%"?parseFloat(T)/100*255:parseInt(T))}function v(T){return(I=T[T.length-1]==="%"?parseFloat(T)/100:parseFloat(T))<0?0:I>1?1:I;var I}function b(T,I,M){return M<0?M+=1:M>1&&(M-=1),6*M<1?T+(I-T)*M*6:2*M<1?I:3*M<2?T+(I-T)*(2/3-M)*6:T}try{s.parseCSSColor=function(T){var I,M=T.replace(/ /g,"").toLowerCase();if(M in u)return u[M].slice();if(M[0]==="#")return M.length===4?(I=parseInt(M.substr(1),16))>=0&&I<=4095?[(3840&I)>>4|(3840&I)>>8,240&I|(240&I)>>4,15&I|(15&I)<<4,1]:null:M.length===7&&(I=parseInt(M.substr(1),16))>=0&&I<=16777215?[(16711680&I)>>16,(65280&I)>>8,255&I,1]:null;var L=M.indexOf("("),z=M.indexOf(")");if(L!==-1&&z+1===M.length){var U=M.substr(0,L),H=M.substr(L+1,z-(L+1)).split(","),ee=1;switch(U){case"rgba":if(H.length!==4)return null;ee=v(H.pop());case"rgb":return H.length!==3?null:[y(H[0]),y(H[1]),y(H[2]),ee];case"hsla":if(H.length!==4)return null;ee=v(H.pop());case"hsl":if(H.length!==3)return null;var te=(parseFloat(H[0])%360+360)%360/360,pe=v(H[1]),ce=v(H[2]),be=ce<=.5?ce*(pe+1):ce+pe-ce*pe,Se=2*ce-be;return[p(255*b(Se,be,te+1/3)),p(255*b(Se,be,te)),p(255*b(Se,be,te-1/3)),ee];default:return null}}return null}}catch{}}).parseCSSColor,At=function(i,s,u,p){p===void 0&&(p=1),this.r=i,this.g=s,this.b=u,this.a=p};At.parse=function(i){if(i){if(i instanceof At)return i;if(typeof i=="string"){var s=xn(i);if(s)return new At(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},At.prototype.toString=function(){var i=this.toArray(),s=i[1],u=i[2],p=i[3];return"rgba("+Math.round(i[0])+","+Math.round(s)+","+Math.round(u)+","+p+")"},At.prototype.toArray=function(){var i=this.a;return i===0?[0,0,0,0]:[255*this.r/i,255*this.g/i,255*this.b/i,i]},At.black=new At(0,0,0,1),At.white=new At(1,1,1,1),At.transparent=new At(0,0,0,0),At.red=new At(1,0,0,1);var Vt=function(i,s,u){this.sensitivity=i?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Vt.prototype.compare=function(i,s){return this.collator.compare(i,s)},Vt.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Qr=function(i,s,u,p,y){this.text=i,this.image=s,this.scale=u,this.fontStack=p,this.textColor=y},bn=function(i){this.sections=i};bn.fromString=function(i){return new bn([new Qr(i,null,null,null,null)])},bn.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(i){return i.text.length!==0||i.image&&i.image.name.length!==0})},bn.factory=function(i){return i instanceof bn?i:bn.fromString(i)},bn.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(i){return i.text}).join("")},bn.prototype.serialize=function(){for(var i=["format"],s=0,u=this.sections;s<u.length;s+=1){var p=u[s];if(p.image)i.push(["image",p.image.name]);else{i.push(p.text);var y={};p.fontStack&&(y["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(y["font-scale"]=p.scale),p.textColor&&(y["text-color"]=["rgba"].concat(p.textColor.toArray())),i.push(y)}}return i};var Nr=function(i){this.name=i.name,this.available=i.available};function za(i,s,u,p){return typeof i=="number"&&i>=0&&i<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[i,s,u,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[i,s,u,p]:[i,s,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ei(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof At||i instanceof Vt||i instanceof bn||i instanceof Nr)return!0;if(Array.isArray(i)){for(var s=0,u=i;s<u.length;s+=1)if(!ei(u[s]))return!1;return!0}if(typeof i=="object"){for(var p in i)if(!ei(i[p]))return!1;return!0}return!1}function Hn(i){if(i===null)return qe;if(typeof i=="string")return Xe;if(typeof i=="boolean")return Ye;if(typeof i=="number")return ke;if(i instanceof At)return Tt;if(i instanceof Vt)return zt;if(i instanceof bn)return Rt;if(i instanceof Nr)return Zt;if(Array.isArray(i)){for(var s,u=i.length,p=0,y=i;p<y.length;p+=1){var v=Hn(y[p]);if(s){if(s===v)continue;s=Ve;break}s=v}return en(s||Ve,u)}return xt}function qo(i){var s=typeof i;return i===null?"":s==="string"||s==="number"||s==="boolean"?String(i):i instanceof At||i instanceof bn||i instanceof Nr?i.toString():JSON.stringify(i)}Nr.prototype.toString=function(){return this.name},Nr.fromString=function(i){return i?new Nr({name:i,available:!1}):null},Nr.prototype.serialize=function(){return["image",this.name]};var Xr=function(i,s){this.type=i,this.value=s};Xr.parse=function(i,s){if(i.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(i.length-1)+" instead.");if(!ei(i[1]))return s.error("invalid value");var u=i[1],p=Hn(u),y=s.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new Xr(p,u)},Xr.prototype.evaluate=function(){return this.value},Xr.prototype.eachChild=function(){},Xr.prototype.outputDefined=function(){return!0},Xr.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof At?["rgba"].concat(this.value.toArray()):this.value instanceof bn?this.value.serialize():this.value};var ur=function(i){this.name="ExpressionEvaluationError",this.message=i};ur.prototype.toJSON=function(){return this.message};var io={string:Xe,number:ke,boolean:Ye,object:xt},yr=function(i,s){this.type=i,this.args=s};yr.parse=function(i,s){if(i.length<2)return s.error("Expected at least one argument.");var u,p=1,y=i[0];if(y==="array"){var v,b;if(i.length>2){var T=i[1];if(typeof T!="string"||!(T in io)||T==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=io[T],p++}else v=Ve;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return s.error('The length argument to "array" must be a positive integer literal',2);b=i[2],p++}u=en(v,b)}else u=io[y];for(var I=[];p<i.length;p++){var M=s.parse(i[p],p,Ve);if(!M)return null;I.push(M)}return new yr(u,I)},yr.prototype.evaluate=function(i){for(var s=0;s<this.args.length;s++){var u=this.args[s].evaluate(i);if(!sn(this.type,Hn(u)))return u;if(s===this.args.length-1)throw new ur("Expected value to be of type "+bt(this.type)+", but found "+bt(Hn(u))+" instead.")}return null},yr.prototype.eachChild=function(i){this.args.forEach(i)},yr.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},yr.prototype.serialize=function(){var i=this.type,s=[i.kind];if(i.kind==="array"){var u=i.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){s.push(u.kind);var p=i.N;(typeof p=="number"||this.args.length>1)&&s.push(p)}}return s.concat(this.args.map(function(y){return y.serialize()}))};var Ln=function(i){this.type=Rt,this.sections=i};Ln.parse=function(i,s){if(i.length<2)return s.error("Expected at least one argument.");var u=i[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");for(var p=[],y=!1,v=1;v<=i.length-1;++v){var b=i[v];if(y&&typeof b=="object"&&!Array.isArray(b)){y=!1;var T=null;if(b["font-scale"]&&!(T=s.parse(b["font-scale"],1,ke)))return null;var I=null;if(b["text-font"]&&!(I=s.parse(b["text-font"],1,en(Xe))))return null;var M=null;if(b["text-color"]&&!(M=s.parse(b["text-color"],1,Tt)))return null;var L=p[p.length-1];L.scale=T,L.font=I,L.textColor=M}else{var z=s.parse(i[v],1,Ve);if(!z)return null;var U=z.type.kind;if(U!=="string"&&U!=="value"&&U!=="null"&&U!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:z,scale:null,font:null,textColor:null})}}return new Ln(p)},Ln.prototype.evaluate=function(i){return new bn(this.sections.map(function(s){var u=s.content.evaluate(i);return Hn(u)===Zt?new Qr("",u,null,null,null):new Qr(qo(u),null,s.scale?s.scale.evaluate(i):null,s.font?s.font.evaluate(i).join(","):null,s.textColor?s.textColor.evaluate(i):null)}))},Ln.prototype.eachChild=function(i){for(var s=0,u=this.sections;s<u.length;s+=1){var p=u[s];i(p.content),p.scale&&i(p.scale),p.font&&i(p.font),p.textColor&&i(p.textColor)}},Ln.prototype.outputDefined=function(){return!1},Ln.prototype.serialize=function(){for(var i=["format"],s=0,u=this.sections;s<u.length;s+=1){var p=u[s];i.push(p.content.serialize());var y={};p.scale&&(y["font-scale"]=p.scale.serialize()),p.font&&(y["text-font"]=p.font.serialize()),p.textColor&&(y["text-color"]=p.textColor.serialize()),i.push(y)}return i};var cr=function(i){this.type=Zt,this.input=i};cr.parse=function(i,s){if(i.length!==2)return s.error("Expected two arguments.");var u=s.parse(i[1],1,Xe);return u?new cr(u):s.error("No image name provided.")},cr.prototype.evaluate=function(i){var s=this.input.evaluate(i),u=Nr.fromString(s);return u&&i.availableImages&&(u.available=i.availableImages.indexOf(s)>-1),u},cr.prototype.eachChild=function(i){i(this.input)},cr.prototype.outputDefined=function(){return!1},cr.prototype.serialize=function(){return["image",this.input.serialize()]};var sl={"to-boolean":Ye,"to-color":Tt,"to-number":ke,"to-string":Xe},vr=function(i,s){this.type=i,this.args=s};vr.parse=function(i,s){if(i.length<2)return s.error("Expected at least one argument.");var u=i[0];if((u==="to-boolean"||u==="to-string")&&i.length!==2)return s.error("Expected one argument.");for(var p=sl[u],y=[],v=1;v<i.length;v++){var b=s.parse(i[v],v,Ve);if(!b)return null;y.push(b)}return new vr(p,y)},vr.prototype.evaluate=function(i){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(i));if(this.type.kind==="color"){for(var s,u,p=0,y=this.args;p<y.length;p+=1){if(u=null,(s=y[p].evaluate(i))instanceof At)return s;if(typeof s=="string"){var v=i.parseColor(s);if(v)return v}else if(Array.isArray(s)&&!(u=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":za(s[0],s[1],s[2],s[3])))return new At(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new ur(u||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var b=null,T=0,I=this.args;T<I.length;T+=1){if((b=I[T].evaluate(i))===null)return 0;var M=Number(b);if(!isNaN(M))return M}throw new ur("Could not convert "+JSON.stringify(b)+" to number.")}return this.type.kind==="formatted"?bn.fromString(qo(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?Nr.fromString(qo(this.args[0].evaluate(i))):qo(this.args[0].evaluate(i))},vr.prototype.eachChild=function(i){this.args.forEach(i)},vr.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},vr.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ln([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new cr(this.args[0]).serialize();var i=["to-"+this.type.kind];return this.eachChild(function(s){i.push(s.serialize())}),i};var au=["Unknown","Point","LineString","Polygon"],Zo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Zo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Zo.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?au[this.feature.type]:this.feature.type:null},Zo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Zo.prototype.canonicalID=function(){return this.canonical},Zo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Zo.prototype.parseColor=function(i){var s=this._parseColorCache[i];return s||(s=this._parseColorCache[i]=At.parse(i)),s};var Br=function(i,s,u,p){this.name=i,this.type=s,this._evaluate=u,this.args=p};Br.prototype.evaluate=function(i){return this._evaluate(i,this.args)},Br.prototype.eachChild=function(i){this.args.forEach(i)},Br.prototype.outputDefined=function(){return!1},Br.prototype.serialize=function(){return[this.name].concat(this.args.map(function(i){return i.serialize()}))},Br.parse=function(i,s){var u,p=i[0],y=Br.definitions[p];if(!y)return s.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var v=Array.isArray(y)?y[0]:y.type,b=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,T=b.filter(function(vt){var it=vt[0];return!Array.isArray(it)||it.length===i.length-1}),I=null,M=0,L=T;M<L.length;M+=1){var z=L[M],U=z[0],H=z[1];I=new wo(s.registry,s.path,null,s.scope);for(var ee=[],te=!1,pe=1;pe<i.length;pe++){var ce=i[pe],be=Array.isArray(U)?U[pe-1]:U.type,Se=I.parse(ce,1+ee.length,be);if(!Se){te=!0;break}ee.push(Se)}if(!te)if(Array.isArray(U)&&U.length!==ee.length)I.error("Expected "+U.length+" arguments, but found "+ee.length+" instead.");else{for(var Ie=0;Ie<ee.length;Ie++){var Me=Array.isArray(U)?U[Ie]:U.type,Ne=ee[Ie];I.concat(Ie+1).checkSubtype(Me,Ne.type)}if(I.errors.length===0)return new Br(p,v,H,ee)}}if(T.length===1)(u=s.errors).push.apply(u,I.errors);else{for(var $e=(T.length?T:b).map(function(vt){var it;return it=vt[0],Array.isArray(it)?"("+it.map(bt).join(", ")+")":"("+bt(it.type)+"...)"}).join(" | "),Qe=[],pt=1;pt<i.length;pt++){var at=s.parse(i[pt],1+Qe.length);if(!at)return null;Qe.push(bt(at.type))}s.error("Expected arguments of type "+$e+", but found ("+Qe.join(", ")+") instead.")}return null},Br.register=function(i,s){for(var u in Br.definitions=s,s)i[u]=Br};var q=function(i,s,u){this.type=zt,this.locale=u,this.caseSensitive=i,this.diacriticSensitive=s};function Q(i,s){i[0]=Math.min(i[0],s[0]),i[1]=Math.min(i[1],s[1]),i[2]=Math.max(i[2],s[0]),i[3]=Math.max(i[3],s[1])}function de(i,s){return!(i[0]<=s[0]||i[2]>=s[2]||i[1]<=s[1]||i[3]>=s[3])}function Ce(i,s){var u=(180+i[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,y=Math.pow(2,s.z);return[Math.round(u*y*8192),Math.round(p*y*8192)]}function Ke(i,s,u){return s[1]>i[1]!=u[1]>i[1]&&i[0]<(u[0]-s[0])*(i[1]-s[1])/(u[1]-s[1])+s[0]}function ct(i,s){for(var u,p,y,v,b,T,I,M=!1,L=0,z=s.length;L<z;L++)for(var U=s[L],H=0,ee=U.length;H<ee-1;H++){if((v=(u=i)[0]-(p=U[H])[0])*(I=u[1]-(y=U[H+1])[1])-(T=u[0]-y[0])*(b=u[1]-p[1])==0&&v*T<=0&&b*I<=0)return!1;Ke(i,U[H],U[H+1])&&(M=!M)}return M}function tn(i,s){for(var u=0;u<s.length;u++)if(ct(i,s[u]))return!0;return!1}function _r(i,s,u,p){var y=p[0]-u[0],v=p[1]-u[1],b=(i[0]-u[0])*v-y*(i[1]-u[1]),T=(s[0]-u[0])*v-y*(s[1]-u[1]);return b>0&&T<0||b<0&&T>0}function Ur(i,s,u){for(var p=0,y=u;p<y.length;p+=1)for(var v=y[p],b=0;b<v.length-1;++b)if((z=[(L=v[b+1])[0]-(M=v[b])[0],L[1]-M[1]])[0]*(U=[(I=s)[0]-(T=i)[0],I[1]-T[1]])[1]-z[1]*U[0]!=0&&_r(T,I,M,L)&&_r(M,L,T,I))return!0;var T,I,M,L,z,U;return!1}function Yr(i,s){for(var u=0;u<i.length;++u)if(!ct(i[u],s))return!1;for(var p=0;p<i.length-1;++p)if(Ur(i[p],i[p+1],s))return!1;return!0}function oo(i,s){for(var u=0;u<s.length;u++)if(Yr(i,s[u]))return!0;return!1}function af(i,s,u){for(var p=[],y=0;y<i.length;y++){for(var v=[],b=0;b<i[y].length;b++){var T=Ce(i[y][b],u);Q(s,T),v.push(T)}p.push(v)}return p}function sf(i,s,u){for(var p=[],y=0;y<i.length;y++){var v=af(i[y],s,u);p.push(v)}return p}function su(i,s,u,p){if(i[0]<u[0]||i[0]>u[2]){var y=.5*p,v=i[0]-u[0]>y?-p:u[0]-i[0]>y?p:0;v===0&&(v=i[0]-u[2]>y?-p:u[2]-i[0]>y?p:0),i[0]+=v}Q(s,i)}function lf(i,s,u,p){for(var y=8192*Math.pow(2,p.z),v=[8192*p.x,8192*p.y],b=[],T=0,I=i;T<I.length;T+=1)for(var M=0,L=I[T];M<L.length;M+=1){var z=L[M],U=[z.x+v[0],z.y+v[1]];su(U,s,u,y),b.push(U)}return b}function lu(i,s,u,p){for(var y,v=8192*Math.pow(2,p.z),b=[8192*p.x,8192*p.y],T=[],I=0,M=i;I<M.length;I+=1){for(var L=[],z=0,U=M[I];z<U.length;z+=1){var H=U[z],ee=[H.x+b[0],H.y+b[1]];Q(s,ee),L.push(ee)}T.push(L)}if(s[2]-s[0]<=v/2){(y=s)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var te=0,pe=T;te<pe.length;te+=1)for(var ce=0,be=pe[te];ce<be.length;ce+=1)su(be[ce],s,u,v)}return T}q.parse=function(i,s){if(i.length!==2)return s.error("Expected one argument.");var u=i[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");var p=s.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Ye);if(!p)return null;var y=s.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Ye);if(!y)return null;var v=null;return u.locale&&!(v=s.parse(u.locale,1,Xe))?null:new q(p,y,v)},q.prototype.evaluate=function(i){return new Vt(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)},q.prototype.eachChild=function(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)},q.prototype.outputDefined=function(){return!1},q.prototype.serialize=function(){var i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]};var xo=function(i,s){this.type=Ye,this.geojson=i,this.geometries=s};function ll(i){if(i instanceof Br&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof xo)return!1;var s=!0;return i.eachChild(function(u){s&&!ll(u)&&(s=!1)}),s}function ul(i){if(i instanceof Br&&i.name==="feature-state")return!1;var s=!0;return i.eachChild(function(u){s&&!ul(u)&&(s=!1)}),s}function Da(i,s){if(i instanceof Br&&s.indexOf(i.name)>=0)return!1;var u=!0;return i.eachChild(function(p){u&&!Da(p,s)&&(u=!1)}),u}xo.parse=function(i,s){if(i.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(i.length-1)+" instead.");if(ei(i[1])){var u=i[1];if(u.type==="FeatureCollection")for(var p=0;p<u.features.length;++p){var y=u.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new xo(u,u.features[p].geometry)}else if(u.type==="Feature"){var v=u.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new xo(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new xo(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},xo.prototype.evaluate=function(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(s,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(u.type==="Polygon"){var b=af(u.coordinates,y,v),T=lf(s.geometry(),p,y,v);if(!de(p,y))return!1;for(var I=0,M=T;I<M.length;I+=1)if(!ct(M[I],b))return!1}if(u.type==="MultiPolygon"){var L=sf(u.coordinates,y,v),z=lf(s.geometry(),p,y,v);if(!de(p,y))return!1;for(var U=0,H=z;U<H.length;U+=1)if(!tn(H[U],L))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(s,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(u.type==="Polygon"){var b=af(u.coordinates,y,v),T=lu(s.geometry(),p,y,v);if(!de(p,y))return!1;for(var I=0,M=T;I<M.length;I+=1)if(!Yr(M[I],b))return!1}if(u.type==="MultiPolygon"){var L=sf(u.coordinates,y,v),z=lu(s.geometry(),p,y,v);if(!de(p,y))return!1;for(var U=0,H=z;U<H.length;U+=1)if(!oo(H[U],L))return!1}return!0}(i,this.geometries)}return!1},xo.prototype.eachChild=function(){},xo.prototype.outputDefined=function(){return!0},xo.prototype.serialize=function(){return["within",this.geojson]};var bo=function(i,s){this.type=s.type,this.name=i,this.boundExpression=s};bo.parse=function(i,s){if(i.length!==2||typeof i[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var u=i[1];return s.scope.has(u)?new bo(u,s.scope.get(u)):s.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},bo.prototype.evaluate=function(i){return this.boundExpression.evaluate(i)},bo.prototype.eachChild=function(){},bo.prototype.outputDefined=function(){return!1},bo.prototype.serialize=function(){return["var",this.name]};var wo=function(i,s,u,p,y){s===void 0&&(s=[]),p===void 0&&(p=new Oe),y===void 0&&(y=[]),this.registry=i,this.path=s,this.key=s.map(function(v){return"["+v+"]"}).join(""),this.scope=p,this.errors=y,this.expectedType=u};function gc(i,s){for(var u,p=i.length-1,y=0,v=p,b=0;y<=v;)if((u=i[b=Math.floor((y+v)/2)])<=s){if(b===p||s<i[b+1])return b;y=b+1}else{if(!(u>s))throw new ur("Input is not a number.");v=b-1}return 0}wo.prototype.parse=function(i,s,u,p,y){return y===void 0&&(y={}),s?this.concat(s,u,p)._parse(i,y):this._parse(i,y)},wo.prototype._parse=function(i,s){function u(M,L,z){return z==="assert"?new yr(L,[M]):z==="coerce"?new vr(L,[M]):M}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=i[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[p];if(y){var v=y.parse(i,this);if(!v)return null;if(this.expectedType){var b=this.expectedType,T=v.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(b,T))return null}else v=u(v,b,s.typeAnnotation||"coerce");else v=u(v,b,s.typeAnnotation||"assert")}if(!(v instanceof Xr)&&v.type.kind!=="resolvedImage"&&function M(L){if(L instanceof bo)return M(L.boundExpression);if(L instanceof Br&&L.name==="error"||L instanceof q||L instanceof xo)return!1;var z=L instanceof vr||L instanceof yr,U=!0;return L.eachChild(function(H){U=z?U&&M(H):U&&H instanceof Xr}),!!U&&ll(L)&&Da(L,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(v)){var I=new Zo;try{v=new Xr(v.type,v.evaluate(I))}catch(M){return this.error(M.message),null}}return v}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof i+" instead.")},wo.prototype.concat=function(i,s,u){var p=typeof i=="number"?this.path.concat(i):this.path,y=u?this.scope.concat(u):this.scope;return new wo(this.registry,p,s||null,y,this.errors)},wo.prototype.error=function(i){for(var s=[],u=arguments.length-1;u-- >0;)s[u]=arguments[u+1];var p=""+this.key+s.map(function(y){return"["+y+"]"}).join("");this.errors.push(new Ge(p,i))},wo.prototype.checkSubtype=function(i,s){var u=sn(i,s);return u&&this.error(u),u};var Fa=function(i,s,u){this.type=i,this.input=s,this.labels=[],this.outputs=[];for(var p=0,y=u;p<y.length;p+=1){var v=y[p],b=v[1];this.labels.push(v[0]),this.outputs.push(b)}};function Cr(i,s,u){return i*(1-u)+s*u}Fa.parse=function(i,s){if(i.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");var u=s.parse(i[1],1,ke);if(!u)return null;var p=[],y=null;s.expectedType&&s.expectedType.kind!=="value"&&(y=s.expectedType);for(var v=1;v<i.length;v+=2){var b=v===1?-1/0:i[v],T=i[v+1],I=v,M=v+1;if(typeof b!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=b)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);var L=s.parse(T,M,y);if(!L)return null;y=y||L.type,p.push([b,L])}return new Fa(y,u,p)},Fa.prototype.evaluate=function(i){var s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(i);var p=this.input.evaluate(i);if(p<=s[0])return u[0].evaluate(i);var y=s.length;return p>=s[y-1]?u[y-1].evaluate(i):u[gc(s,p)].evaluate(i)},Fa.prototype.eachChild=function(i){i(this.input);for(var s=0,u=this.outputs;s<u.length;s+=1)i(u[s])},Fa.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})},Fa.prototype.serialize=function(){for(var i=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&i.push(this.labels[s]),i.push(this.outputs[s].serialize());return i};var pa=Object.freeze({__proto__:null,number:Cr,color:function(i,s,u){return new At(Cr(i.r,s.r,u),Cr(i.g,s.g,u),Cr(i.b,s.b,u),Cr(i.a,s.a,u))},array:function(i,s,u){return i.map(function(p,y){return Cr(p,s[y],u)})}}),yc=6/29*3*(6/29),uf=Math.PI/180,uv=180/Math.PI;function cf(i){return i>.008856451679035631?Math.pow(i,1/3):i/yc+4/29}function hf(i){return i>6/29?i*i*i:yc*(i-4/29)}function ff(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function pf(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Od(i){var s=pf(i.r),u=pf(i.g),p=pf(i.b),y=cf((.4124564*s+.3575761*u+.1804375*p)/.95047),v=cf((.2126729*s+.7151522*u+.072175*p)/1);return{l:116*v-16,a:500*(y-v),b:200*(v-cf((.0193339*s+.119192*u+.9503041*p)/1.08883)),alpha:i.a}}function zd(i){var s=(i.l+16)/116,u=isNaN(i.a)?s:s+i.a/500,p=isNaN(i.b)?s:s-i.b/200;return s=1*hf(s),u=.95047*hf(u),p=1.08883*hf(p),new At(ff(3.2404542*u-1.5371385*s-.4985314*p),ff(-.969266*u+1.8760108*s+.041556*p),ff(.0556434*u-.2040259*s+1.0572252*p),i.alpha)}function cv(i,s,u){var p=s-i;return i+u*(p>180||p<-180?p-360*Math.round(p/360):p)}var uu={forward:Od,reverse:zd,interpolate:function(i,s,u){return{l:Cr(i.l,s.l,u),a:Cr(i.a,s.a,u),b:Cr(i.b,s.b,u),alpha:Cr(i.alpha,s.alpha,u)}}},cu={forward:function(i){var s=Od(i),u=s.l,p=s.a,y=s.b,v=Math.atan2(y,p)*uv;return{h:v<0?v+360:v,c:Math.sqrt(p*p+y*y),l:u,alpha:i.a}},reverse:function(i){var s=i.h*uf,u=i.c;return zd({l:i.l,a:Math.cos(s)*u,b:Math.sin(s)*u,alpha:i.alpha})},interpolate:function(i,s,u){return{h:cv(i.h,s.h,u),c:Cr(i.c,s.c,u),l:Cr(i.l,s.l,u),alpha:Cr(i.alpha,s.alpha,u)}}},Dd=Object.freeze({__proto__:null,lab:uu,hcl:cu}),Kr=function(i,s,u,p,y){this.type=i,this.operator=s,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(var v=0,b=y;v<b.length;v+=1){var T=b[v],I=T[1];this.labels.push(T[0]),this.outputs.push(I)}};function df(i,s,u,p){var y=p-u,v=i-u;return y===0?0:s===1?v/y:(Math.pow(s,v)-1)/(Math.pow(s,y)-1)}Kr.interpolationFactor=function(i,s,u,p){var y=0;if(i.name==="exponential")y=df(s,i.base,u,p);else if(i.name==="linear")y=df(s,1,u,p);else if(i.name==="cubic-bezier"){var v=i.controlPoints;y=new g(v[0],v[1],v[2],v[3]).solve(df(s,1,u,p))}return y},Kr.parse=function(i,s){var u=i[0],p=i[1],y=i[2],v=i.slice(3);if(!Array.isArray(p)||p.length===0)return s.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var b=p[1];if(typeof b!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:b}}else{if(p[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(p[0]),1,0);var T=p.slice(1);if(T.length!==4||T.some(function(pe){return typeof pe!="number"||pe<0||pe>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:T}}if(i.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(y=s.parse(y,2,ke)))return null;var I=[],M=null;u==="interpolate-hcl"||u==="interpolate-lab"?M=Tt:s.expectedType&&s.expectedType.kind!=="value"&&(M=s.expectedType);for(var L=0;L<v.length;L+=2){var z=v[L],U=v[L+1],H=L+3,ee=L+4;if(typeof z!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(I.length&&I[I.length-1][0]>=z)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);var te=s.parse(U,ee,M);if(!te)return null;M=M||te.type,I.push([z,te])}return M.kind==="number"||M.kind==="color"||M.kind==="array"&&M.itemType.kind==="number"&&typeof M.N=="number"?new Kr(M,u,p,y,I):s.error("Type "+bt(M)+" is not interpolatable.")},Kr.prototype.evaluate=function(i){var s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(i);var p=this.input.evaluate(i);if(p<=s[0])return u[0].evaluate(i);var y=s.length;if(p>=s[y-1])return u[y-1].evaluate(i);var v=gc(s,p),b=Kr.interpolationFactor(this.interpolation,p,s[v],s[v+1]),T=u[v].evaluate(i),I=u[v+1].evaluate(i);return this.operator==="interpolate"?pa[this.type.kind.toLowerCase()](T,I,b):this.operator==="interpolate-hcl"?cu.reverse(cu.interpolate(cu.forward(T),cu.forward(I),b)):uu.reverse(uu.interpolate(uu.forward(T),uu.forward(I),b))},Kr.prototype.eachChild=function(i){i(this.input);for(var s=0,u=this.outputs;s<u.length;s+=1)i(u[s])},Kr.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})},Kr.prototype.serialize=function(){var i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,i,this.input.serialize()],u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s};var Na=function(i,s){this.type=i,this.args=s};Na.parse=function(i,s){if(i.length<2)return s.error("Expectected at least one argument.");var u=null,p=s.expectedType;p&&p.kind!=="value"&&(u=p);for(var y=[],v=0,b=i.slice(1);v<b.length;v+=1){var T=s.parse(b[v],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,y.push(T)}var I=p&&y.some(function(M){return sn(p,M.type)});return new Na(I?Ve:u,y)},Na.prototype.evaluate=function(i){for(var s,u=null,p=0,y=0,v=this.args;y<v.length&&(p++,(u=v[y].evaluate(i))&&u instanceof Nr&&!u.available&&(s||(s=u.name),u=null,p===this.args.length&&(u=s)),u===null);y+=1);return u},Na.prototype.eachChild=function(i){this.args.forEach(i)},Na.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},Na.prototype.serialize=function(){var i=["coalesce"];return this.eachChild(function(s){i.push(s.serialize())}),i};var Ba=function(i,s){this.type=s.type,this.bindings=[].concat(i),this.result=s};Ba.prototype.evaluate=function(i){return this.result.evaluate(i)},Ba.prototype.eachChild=function(i){for(var s=0,u=this.bindings;s<u.length;s+=1)i(u[s][1]);i(this.result)},Ba.parse=function(i,s){if(i.length<4)return s.error("Expected at least 3 arguments, but found "+(i.length-1)+" instead.");for(var u=[],p=1;p<i.length-1;p+=2){var y=i[p];if(typeof y!="string")return s.error("Expected string, but found "+typeof y+" instead.",p);if(/[^a-zA-Z0-9_]/.test(y))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);var v=s.parse(i[p+1],p+1);if(!v)return null;u.push([y,v])}var b=s.parse(i[i.length-1],i.length-1,s.expectedType,u);return b?new Ba(u,b):null},Ba.prototype.outputDefined=function(){return this.result.outputDefined()},Ba.prototype.serialize=function(){for(var i=["let"],s=0,u=this.bindings;s<u.length;s+=1){var p=u[s];i.push(p[0],p[1].serialize())}return i.push(this.result.serialize()),i};var bs=function(i,s,u){this.type=i,this.index=s,this.input=u};bs.parse=function(i,s){if(i.length!==3)return s.error("Expected 2 arguments, but found "+(i.length-1)+" instead.");var u=s.parse(i[1],1,ke),p=s.parse(i[2],2,en(s.expectedType||Ve));return u&&p?new bs(p.type.itemType,u,p):null},bs.prototype.evaluate=function(i){var s=this.index.evaluate(i),u=this.input.evaluate(i);if(s<0)throw new ur("Array index out of bounds: "+s+" < 0.");if(s>=u.length)throw new ur("Array index out of bounds: "+s+" > "+(u.length-1)+".");if(s!==Math.floor(s))throw new ur("Array index must be an integer, but found "+s+" instead.");return u[s]},bs.prototype.eachChild=function(i){i(this.index),i(this.input)},bs.prototype.outputDefined=function(){return!1},bs.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ws=function(i,s){this.type=Ye,this.needle=i,this.haystack=s};ws.parse=function(i,s){if(i.length!==3)return s.error("Expected 2 arguments, but found "+(i.length-1)+" instead.");var u=s.parse(i[1],1,Ve),p=s.parse(i[2],2,Ve);return u&&p?kn(u.type,[Ye,Xe,ke,qe,Ve])?new ws(u,p):s.error("Expected first argument to be of type boolean, string, number or null, but found "+bt(u.type)+" instead"):null},ws.prototype.evaluate=function(i){var s=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!u)return!1;if(!$t(s,["boolean","string","number","null"]))throw new ur("Expected first argument to be of type boolean, string, number or null, but found "+bt(Hn(s))+" instead.");if(!$t(u,["string","array"]))throw new ur("Expected second argument to be of type array or string, but found "+bt(Hn(u))+" instead.");return u.indexOf(s)>=0},ws.prototype.eachChild=function(i){i(this.needle),i(this.haystack)},ws.prototype.outputDefined=function(){return!0},ws.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Ua=function(i,s,u){this.type=ke,this.needle=i,this.haystack=s,this.fromIndex=u};Ua.parse=function(i,s){if(i.length<=2||i.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(i.length-1)+" instead.");var u=s.parse(i[1],1,Ve),p=s.parse(i[2],2,Ve);if(!u||!p)return null;if(!kn(u.type,[Ye,Xe,ke,qe,Ve]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+bt(u.type)+" instead");if(i.length===4){var y=s.parse(i[3],3,ke);return y?new Ua(u,p,y):null}return new Ua(u,p)},Ua.prototype.evaluate=function(i){var s=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!$t(s,["boolean","string","number","null"]))throw new ur("Expected first argument to be of type boolean, string, number or null, but found "+bt(Hn(s))+" instead.");if(!$t(u,["string","array"]))throw new ur("Expected second argument to be of type array or string, but found "+bt(Hn(u))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(i);return u.indexOf(s,p)}return u.indexOf(s)},Ua.prototype.eachChild=function(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)},Ua.prototype.outputDefined=function(){return!1},Ua.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Es=function(i,s,u,p,y,v){this.inputType=i,this.type=s,this.input=u,this.cases=p,this.outputs=y,this.otherwise=v};Es.parse=function(i,s){if(i.length<5)return s.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if(i.length%2!=1)return s.error("Expected an even number of arguments.");var u,p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);for(var y={},v=[],b=2;b<i.length-1;b+=2){var T=i[b],I=i[b+1];Array.isArray(T)||(T=[T]);var M=s.concat(b);if(T.length===0)return M.error("Expected at least one branch label.");for(var L=0,z=T;L<z.length;L+=1){var U=z[L];if(typeof U!="number"&&typeof U!="string")return M.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return M.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof U=="number"&&Math.floor(U)!==U)return M.error("Numeric branch labels must be integer values.");if(u){if(M.checkSubtype(u,Hn(U)))return null}else u=Hn(U);if(y[String(U)]!==void 0)return M.error("Branch labels must be unique.");y[String(U)]=v.length}var H=s.parse(I,b,p);if(!H)return null;p=p||H.type,v.push(H)}var ee=s.parse(i[1],1,Ve);if(!ee)return null;var te=s.parse(i[i.length-1],i.length-1,p);return te?ee.type.kind!=="value"&&s.concat(1).checkSubtype(u,ee.type)?null:new Es(u,p,ee,y,v,te):null},Es.prototype.evaluate=function(i){var s=this.input.evaluate(i);return(Hn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(i)},Es.prototype.eachChild=function(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)},Es.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})&&this.otherwise.outputDefined()},Es.prototype.serialize=function(){for(var i=this,s=["match",this.input.serialize()],u=[],p={},y=0,v=Object.keys(this.cases).sort();y<v.length;y+=1){var b=v[y];(z=p[this.cases[b]])===void 0?(p[this.cases[b]]=u.length,u.push([this.cases[b],[b]])):u[z][1].push(b)}for(var T=function(H){return i.inputType.kind==="number"?Number(H):H},I=0,M=u;I<M.length;I+=1){var L=M[I],z=L[0],U=L[1];s.push(U.length===1?T(U[0]):U.map(T)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var Ts=function(i,s,u){this.type=i,this.branches=s,this.otherwise=u};Ts.parse=function(i,s){if(i.length<4)return s.error("Expected at least 3 arguments, but found only "+(i.length-1)+".");if(i.length%2!=0)return s.error("Expected an odd number of arguments.");var u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);for(var p=[],y=1;y<i.length-1;y+=2){var v=s.parse(i[y],y,Ye);if(!v)return null;var b=s.parse(i[y+1],y+1,u);if(!b)return null;p.push([v,b]),u=u||b.type}var T=s.parse(i[i.length-1],i.length-1,u);return T?new Ts(u,p,T):null},Ts.prototype.evaluate=function(i){for(var s=0,u=this.branches;s<u.length;s+=1){var p=u[s],y=p[1];if(p[0].evaluate(i))return y.evaluate(i)}return this.otherwise.evaluate(i)},Ts.prototype.eachChild=function(i){for(var s=0,u=this.branches;s<u.length;s+=1){var p=u[s],y=p[1];i(p[0]),i(y)}i(this.otherwise)},Ts.prototype.outputDefined=function(){return this.branches.every(function(i){return i[1].outputDefined()})&&this.otherwise.outputDefined()},Ts.prototype.serialize=function(){var i=["case"];return this.eachChild(function(s){i.push(s.serialize())}),i};var Va=function(i,s,u,p){this.type=i,this.input=s,this.beginIndex=u,this.endIndex=p};function Fd(i,s){return i==="=="||i==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Nd(i,s,u,p){return p.compare(s,u)===0}function cl(i,s,u){var p=i!=="=="&&i!=="!=";return function(){function y(v,b,T){this.type=Ye,this.lhs=v,this.rhs=b,this.collator=T,this.hasUntypedArgument=v.type.kind==="value"||b.type.kind==="value"}return y.parse=function(v,b){if(v.length!==3&&v.length!==4)return b.error("Expected two or three arguments.");var T=v[0],I=b.parse(v[1],1,Ve);if(!I)return null;if(!Fd(T,I.type))return b.concat(1).error('"'+T+`" comparisons are not supported for type '`+bt(I.type)+"'.");var M=b.parse(v[2],2,Ve);if(!M)return null;if(!Fd(T,M.type))return b.concat(2).error('"'+T+`" comparisons are not supported for type '`+bt(M.type)+"'.");if(I.type.kind!==M.type.kind&&I.type.kind!=="value"&&M.type.kind!=="value")return b.error("Cannot compare types '"+bt(I.type)+"' and '"+bt(M.type)+"'.");p&&(I.type.kind==="value"&&M.type.kind!=="value"?I=new yr(M.type,[I]):I.type.kind!=="value"&&M.type.kind==="value"&&(M=new yr(I.type,[M])));var L=null;if(v.length===4){if(I.type.kind!=="string"&&M.type.kind!=="string"&&I.type.kind!=="value"&&M.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(!(L=b.parse(v[3],3,zt)))return null}return new y(I,M,L)},y.prototype.evaluate=function(v){var b=this.lhs.evaluate(v),T=this.rhs.evaluate(v);if(p&&this.hasUntypedArgument){var I=Hn(b),M=Hn(T);if(I.kind!==M.kind||I.kind!=="string"&&I.kind!=="number")throw new ur('Expected arguments for "'+i+'" to be (string, string) or (number, number), but found ('+I.kind+", "+M.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var L=Hn(b),z=Hn(T);if(L.kind!=="string"||z.kind!=="string")return s(v,b,T)}return this.collator?u(v,b,T,this.collator.evaluate(v)):s(v,b,T)},y.prototype.eachChild=function(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var v=[i];return this.eachChild(function(b){v.push(b.serialize())}),v},y}()}Va.parse=function(i,s){if(i.length<=2||i.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(i.length-1)+" instead.");var u=s.parse(i[1],1,Ve),p=s.parse(i[2],2,ke);if(!u||!p)return null;if(!kn(u.type,[en(Ve),Xe,Ve]))return s.error("Expected first argument to be of type array or string, but found "+bt(u.type)+" instead");if(i.length===4){var y=s.parse(i[3],3,ke);return y?new Va(u.type,u,p,y):null}return new Va(u.type,u,p)},Va.prototype.evaluate=function(i){var s=this.input.evaluate(i),u=this.beginIndex.evaluate(i);if(!$t(s,["string","array"]))throw new ur("Expected first argument to be of type array or string, but found "+bt(Hn(s))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(i);return s.slice(u,p)}return s.slice(u)},Va.prototype.eachChild=function(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)},Va.prototype.outputDefined=function(){return!1},Va.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var hv=cl("==",function(i,s,u){return s===u},Nd),qn=cl("!=",function(i,s,u){return s!==u},function(i,s,u,p){return!Nd(0,s,u,p)}),fv=cl("<",function(i,s,u){return s<u},function(i,s,u,p){return p.compare(s,u)<0}),vc=cl(">",function(i,s,u){return s>u},function(i,s,u,p){return p.compare(s,u)>0}),Bd=cl("<=",function(i,s,u){return s<=u},function(i,s,u,p){return p.compare(s,u)<=0}),Ud=cl(">=",function(i,s,u){return s>=u},function(i,s,u,p){return p.compare(s,u)>=0}),ja=function(i,s,u,p,y){this.type=Xe,this.number=i,this.locale=s,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=y};ja.parse=function(i,s){if(i.length!==3)return s.error("Expected two arguments.");var u=s.parse(i[1],1,ke);if(!u)return null;var p=i[2];if(typeof p!="object"||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");var y=null;if(p.locale&&!(y=s.parse(p.locale,1,Xe)))return null;var v=null;if(p.currency&&!(v=s.parse(p.currency,1,Xe)))return null;var b=null;if(p["min-fraction-digits"]&&!(b=s.parse(p["min-fraction-digits"],1,ke)))return null;var T=null;return p["max-fraction-digits"]&&!(T=s.parse(p["max-fraction-digits"],1,ke))?null:new ja(u,y,v,b,T)},ja.prototype.evaluate=function(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))},ja.prototype.eachChild=function(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)},ja.prototype.outputDefined=function(){return!1},ja.prototype.serialize=function(){var i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]};var Ga=function(i){this.type=ke,this.input=i};Ga.parse=function(i,s){if(i.length!==2)return s.error("Expected 1 argument, but found "+(i.length-1)+" instead.");var u=s.parse(i[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+bt(u.type)+" instead."):new Ga(u):null},Ga.prototype.evaluate=function(i){var s=this.input.evaluate(i);if(typeof s=="string"||Array.isArray(s))return s.length;throw new ur("Expected value to be of type string or array, but found "+bt(Hn(s))+" instead.")},Ga.prototype.eachChild=function(i){i(this.input)},Ga.prototype.outputDefined=function(){return!1},Ga.prototype.serialize=function(){var i=["length"];return this.eachChild(function(s){i.push(s.serialize())}),i};var hl={"==":hv,"!=":qn,">":vc,"<":fv,">=":Ud,"<=":Bd,array:yr,at:bs,boolean:yr,case:Ts,coalesce:Na,collator:q,format:Ln,image:cr,in:ws,"index-of":Ua,interpolate:Kr,"interpolate-hcl":Kr,"interpolate-lab":Kr,length:Ga,let:Ba,literal:Xr,match:Es,number:yr,"number-format":ja,object:yr,slice:Va,step:Fa,string:yr,"to-boolean":vr,"to-color":vr,"to-number":vr,"to-string":vr,var:bo,within:xo};function mf(i,s){var u=s[0],p=s[1],y=s[2],v=s[3];u=u.evaluate(i),p=p.evaluate(i),y=y.evaluate(i);var b=v?v.evaluate(i):1,T=za(u,p,y,b);if(T)throw new ur(T);return new At(u/255*b,p/255*b,y/255*b,b)}function gf(i,s){return i in s}function yf(i,s){var u=s[i];return u===void 0?null:u}function Ss(i){return{type:i}}function Vd(i){return{result:"success",value:i}}function fl(i){return{result:"error",value:i}}function pl(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function vf(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function _c(i){return!!i.expression&&i.expression.interpolated}function Cn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function dl(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function pv(i){return i}function hu(i,s,u){return i!==void 0?i:s!==void 0?s:u!==void 0?u:void 0}function dv(i,s,u,p,y){return hu(typeof u===y?p[u]:void 0,i.default,s.default)}function jd(i,s,u){if(Cn(u)!=="number")return hu(i.default,s.default);var p=i.stops.length;if(p===1||u<=i.stops[0][0])return i.stops[0][1];if(u>=i.stops[p-1][0])return i.stops[p-1][1];var y=gc(i.stops.map(function(v){return v[0]}),u);return i.stops[y][1]}function _f(i,s,u){var p=i.base!==void 0?i.base:1;if(Cn(u)!=="number")return hu(i.default,s.default);var y=i.stops.length;if(y===1||u<=i.stops[0][0])return i.stops[0][1];if(u>=i.stops[y-1][0])return i.stops[y-1][1];var v=gc(i.stops.map(function(z){return z[0]}),u),b=function(z,U,H,ee){var te=ee-H,pe=z-H;return te===0?0:U===1?pe/te:(Math.pow(U,pe)-1)/(Math.pow(U,te)-1)}(u,p,i.stops[v][0],i.stops[v+1][0]),T=i.stops[v][1],I=i.stops[v+1][1],M=pa[s.type]||pv;if(i.colorSpace&&i.colorSpace!=="rgb"){var L=Dd[i.colorSpace];M=function(z,U){return L.reverse(L.interpolate(L.forward(z),L.forward(U),b))}}return typeof T.evaluate=="function"?{evaluate:function(){for(var z=[],U=arguments.length;U--;)z[U]=arguments[U];var H=T.evaluate.apply(void 0,z),ee=I.evaluate.apply(void 0,z);if(H!==void 0&&ee!==void 0)return M(H,ee,b)}}:M(T,I,b)}function mv(i,s,u){return s.type==="color"?u=At.parse(u):s.type==="formatted"?u=bn.fromString(u.toString()):s.type==="resolvedImage"?u=Nr.fromString(u.toString()):Cn(u)===s.type||s.type==="enum"&&s.values[u]||(u=void 0),hu(u,i.default,s.default)}Br.register(hl,{error:[{kind:"error"},[Xe],function(i,s){throw new ur(s[0].evaluate(i))}],typeof:[Xe,[Ve],function(i,s){return bt(Hn(s[0].evaluate(i)))}],"to-rgba":[en(ke,4),[Tt],function(i,s){return s[0].evaluate(i).toArray()}],rgb:[Tt,[ke,ke,ke],mf],rgba:[Tt,[ke,ke,ke,ke],mf],has:{type:Ye,overloads:[[[Xe],function(i,s){return gf(s[0].evaluate(i),i.properties())}],[[Xe,xt],function(i,s){var u=s[1];return gf(s[0].evaluate(i),u.evaluate(i))}]]},get:{type:Ve,overloads:[[[Xe],function(i,s){return yf(s[0].evaluate(i),i.properties())}],[[Xe,xt],function(i,s){var u=s[1];return yf(s[0].evaluate(i),u.evaluate(i))}]]},"feature-state":[Ve,[Xe],function(i,s){return yf(s[0].evaluate(i),i.featureState||{})}],properties:[xt,[],function(i){return i.properties()}],"geometry-type":[Xe,[],function(i){return i.geometryType()}],id:[Ve,[],function(i){return i.id()}],zoom:[ke,[],function(i){return i.globals.zoom}],"heatmap-density":[ke,[],function(i){return i.globals.heatmapDensity||0}],"line-progress":[ke,[],function(i){return i.globals.lineProgress||0}],accumulated:[Ve,[],function(i){return i.globals.accumulated===void 0?null:i.globals.accumulated}],"+":[ke,Ss(ke),function(i,s){for(var u=0,p=0,y=s;p<y.length;p+=1)u+=y[p].evaluate(i);return u}],"*":[ke,Ss(ke),function(i,s){for(var u=1,p=0,y=s;p<y.length;p+=1)u*=y[p].evaluate(i);return u}],"-":{type:ke,overloads:[[[ke,ke],function(i,s){var u=s[1];return s[0].evaluate(i)-u.evaluate(i)}],[[ke],function(i,s){return-s[0].evaluate(i)}]]},"/":[ke,[ke,ke],function(i,s){var u=s[1];return s[0].evaluate(i)/u.evaluate(i)}],"%":[ke,[ke,ke],function(i,s){var u=s[1];return s[0].evaluate(i)%u.evaluate(i)}],ln2:[ke,[],function(){return Math.LN2}],pi:[ke,[],function(){return Math.PI}],e:[ke,[],function(){return Math.E}],"^":[ke,[ke,ke],function(i,s){var u=s[1];return Math.pow(s[0].evaluate(i),u.evaluate(i))}],sqrt:[ke,[ke],function(i,s){return Math.sqrt(s[0].evaluate(i))}],log10:[ke,[ke],function(i,s){return Math.log(s[0].evaluate(i))/Math.LN10}],ln:[ke,[ke],function(i,s){return Math.log(s[0].evaluate(i))}],log2:[ke,[ke],function(i,s){return Math.log(s[0].evaluate(i))/Math.LN2}],sin:[ke,[ke],function(i,s){return Math.sin(s[0].evaluate(i))}],cos:[ke,[ke],function(i,s){return Math.cos(s[0].evaluate(i))}],tan:[ke,[ke],function(i,s){return Math.tan(s[0].evaluate(i))}],asin:[ke,[ke],function(i,s){return Math.asin(s[0].evaluate(i))}],acos:[ke,[ke],function(i,s){return Math.acos(s[0].evaluate(i))}],atan:[ke,[ke],function(i,s){return Math.atan(s[0].evaluate(i))}],min:[ke,Ss(ke),function(i,s){return Math.min.apply(Math,s.map(function(u){return u.evaluate(i)}))}],max:[ke,Ss(ke),function(i,s){return Math.max.apply(Math,s.map(function(u){return u.evaluate(i)}))}],abs:[ke,[ke],function(i,s){return Math.abs(s[0].evaluate(i))}],round:[ke,[ke],function(i,s){var u=s[0].evaluate(i);return u<0?-Math.round(-u):Math.round(u)}],floor:[ke,[ke],function(i,s){return Math.floor(s[0].evaluate(i))}],ceil:[ke,[ke],function(i,s){return Math.ceil(s[0].evaluate(i))}],"filter-==":[Ye,[Xe,Ve],function(i,s){var u=s[0],p=s[1];return i.properties()[u.value]===p.value}],"filter-id-==":[Ye,[Ve],function(i,s){var u=s[0];return i.id()===u.value}],"filter-type-==":[Ye,[Xe],function(i,s){var u=s[0];return i.geometryType()===u.value}],"filter-<":[Ye,[Xe,Ve],function(i,s){var u=s[0],p=s[1],y=i.properties()[u.value],v=p.value;return typeof y==typeof v&&y<v}],"filter-id-<":[Ye,[Ve],function(i,s){var u=s[0],p=i.id(),y=u.value;return typeof p==typeof y&&p<y}],"filter->":[Ye,[Xe,Ve],function(i,s){var u=s[0],p=s[1],y=i.properties()[u.value],v=p.value;return typeof y==typeof v&&y>v}],"filter-id->":[Ye,[Ve],function(i,s){var u=s[0],p=i.id(),y=u.value;return typeof p==typeof y&&p>y}],"filter-<=":[Ye,[Xe,Ve],function(i,s){var u=s[0],p=s[1],y=i.properties()[u.value],v=p.value;return typeof y==typeof v&&y<=v}],"filter-id-<=":[Ye,[Ve],function(i,s){var u=s[0],p=i.id(),y=u.value;return typeof p==typeof y&&p<=y}],"filter->=":[Ye,[Xe,Ve],function(i,s){var u=s[0],p=s[1],y=i.properties()[u.value],v=p.value;return typeof y==typeof v&&y>=v}],"filter-id->=":[Ye,[Ve],function(i,s){var u=s[0],p=i.id(),y=u.value;return typeof p==typeof y&&p>=y}],"filter-has":[Ye,[Ve],function(i,s){return s[0].value in i.properties()}],"filter-has-id":[Ye,[],function(i){return i.id()!==null&&i.id()!==void 0}],"filter-type-in":[Ye,[en(Xe)],function(i,s){return s[0].value.indexOf(i.geometryType())>=0}],"filter-id-in":[Ye,[en(Ve)],function(i,s){return s[0].value.indexOf(i.id())>=0}],"filter-in-small":[Ye,[Xe,en(Ve)],function(i,s){var u=s[0];return s[1].value.indexOf(i.properties()[u.value])>=0}],"filter-in-large":[Ye,[Xe,en(Ve)],function(i,s){var u=s[0],p=s[1];return function(y,v,b,T){for(;b<=T;){var I=b+T>>1;if(v[I]===y)return!0;v[I]>y?T=I-1:b=I+1}return!1}(i.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:Ye,overloads:[[[Ye,Ye],function(i,s){var u=s[1];return s[0].evaluate(i)&&u.evaluate(i)}],[Ss(Ye),function(i,s){for(var u=0,p=s;u<p.length;u+=1)if(!p[u].evaluate(i))return!1;return!0}]]},any:{type:Ye,overloads:[[[Ye,Ye],function(i,s){var u=s[1];return s[0].evaluate(i)||u.evaluate(i)}],[Ss(Ye),function(i,s){for(var u=0,p=s;u<p.length;u+=1)if(p[u].evaluate(i))return!0;return!1}]]},"!":[Ye,[Ye],function(i,s){return!s[0].evaluate(i)}],"is-supported-script":[Ye,[Xe],function(i,s){var u=i.globals&&i.globals.isSupportedScript;return!u||u(s[0].evaluate(i))}],upcase:[Xe,[Xe],function(i,s){return s[0].evaluate(i).toUpperCase()}],downcase:[Xe,[Xe],function(i,s){return s[0].evaluate(i).toLowerCase()}],concat:[Xe,Ss(Ve),function(i,s){return s.map(function(u){return qo(u.evaluate(i))}).join("")}],"resolved-locale":[Xe,[zt],function(i,s){return s[0].evaluate(i).resolvedLocale()}]});var fu=function(i,s){this.expression=i,this._warningHistory={},this._evaluator=new Zo,this._defaultValue=s?function(u){return u.type==="color"&&dl(u.default)?new At(0,0,0,0):u.type==="color"?At.parse(u.default)||null:u.default===void 0?null:u.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function Ps(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in hl}function pu(i,s){var u=new wo(hl,[],s?function(y){var v={color:Tt,string:Xe,number:ke,enum:Xe,boolean:Ye,formatted:Rt,resolvedImage:Zt};return y.type==="array"?en(v[y.value]||Ve,y.length):v[y.type]}(s):void 0),p=u.parse(i,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Vd(new fu(p,s)):fl(u.errors)}fu.prototype.evaluateWithoutErrorHandling=function(i,s,u,p,y,v){return this._evaluator.globals=i,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)},fu.prototype.evaluate=function(i,s,u,p,y,v){this._evaluator.globals=i,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v||null;try{var b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new ur("Expected value to be one of "+Object.keys(this._enumValues).map(function(T){return JSON.stringify(T)}).join(", ")+", but found "+JSON.stringify(b)+" instead.");return b}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}};var ml=function(i,s){this.kind=i,this._styleExpression=s,this.isStateDependent=i!=="constant"&&!ul(s.expression)};ml.prototype.evaluateWithoutErrorHandling=function(i,s,u,p,y,v){return this._styleExpression.evaluateWithoutErrorHandling(i,s,u,p,y,v)},ml.prototype.evaluate=function(i,s,u,p,y,v){return this._styleExpression.evaluate(i,s,u,p,y,v)};var gl=function(i,s,u,p){this.kind=i,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=i!=="camera"&&!ul(s.expression),this.interpolationType=p};function Gd(i,s){if((i=pu(i,s)).result==="error")return i;var u=i.value.expression,p=ll(u);if(!p&&!pl(s))return fl([new Ge("","data expressions not supported")]);var y=Da(u,["zoom"]);if(!y&&!vf(s))return fl([new Ge("","zoom expressions not supported")]);var v=function b(T){var I=null;if(T instanceof Ba)I=b(T.result);else if(T instanceof Na)for(var M=0,L=T.args;M<L.length&&!(I=b(L[M]));M+=1);else(T instanceof Fa||T instanceof Kr)&&T.input instanceof Br&&T.input.name==="zoom"&&(I=T);return I instanceof Ge||T.eachChild(function(z){var U=b(z);U instanceof Ge?I=U:!I&&U?I=new Ge("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):I&&U&&I!==U&&(I=new Ge("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),I}(u);return v||y?v instanceof Ge?fl([v]):v instanceof Kr&&!_c(s)?fl([new Ge("",'"interpolate" expressions cannot be used with this property')]):Vd(v?new gl(p?"camera":"composite",i.value,v.labels,v instanceof Kr?v.interpolation:void 0):new ml(p?"constant":"source",i.value)):fl([new Ge("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}gl.prototype.evaluateWithoutErrorHandling=function(i,s,u,p,y,v){return this._styleExpression.evaluateWithoutErrorHandling(i,s,u,p,y,v)},gl.prototype.evaluate=function(i,s,u,p,y,v){return this._styleExpression.evaluate(i,s,u,p,y,v)},gl.prototype.interpolationFactor=function(i,s,u){return this.interpolationType?Kr.interpolationFactor(this.interpolationType,i,s,u):0};var du=function(i,s){this._parameters=i,this._specification=s,xe(this,function u(p,y){var v,b,T,I=y.type==="color",M=p.stops&&typeof p.stops[0][0]=="object",L=M||!(M||p.property!==void 0),z=p.type||(_c(y)?"exponential":"interval");if(I&&((p=xe({},p)).stops&&(p.stops=p.stops.map(function(at){return[at[0],At.parse(at[1])]})),p.default=At.parse(p.default?p.default:y.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!Dd[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(z==="exponential")v=_f;else if(z==="interval")v=jd;else if(z==="categorical"){v=dv,b=Object.create(null);for(var U=0,H=p.stops;U<H.length;U+=1){var ee=H[U];b[ee[0]]=ee[1]}T=typeof p.stops[0][0]}else{if(z!=="identity")throw new Error('Unknown function type "'+z+'"');v=mv}if(M){for(var te={},pe=[],ce=0;ce<p.stops.length;ce++){var be=p.stops[ce],Se=be[0].zoom;te[Se]===void 0&&(te[Se]={zoom:Se,type:p.type,property:p.property,default:p.default,stops:[]},pe.push(Se)),te[Se].stops.push([be[0].value,be[1]])}for(var Ie=[],Me=0,Ne=pe;Me<Ne.length;Me+=1){var $e=Ne[Me];Ie.push([te[$e].zoom,u(te[$e],y)])}var Qe={name:"linear"};return{kind:"composite",interpolationType:Qe,interpolationFactor:Kr.interpolationFactor.bind(void 0,Qe),zoomStops:Ie.map(function(at){return at[0]}),evaluate:function(at,vt){var it=at.zoom;return _f({stops:Ie,base:p.base},y,it).evaluate(it,vt)}}}if(L){var pt=z==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:pt,interpolationFactor:Kr.interpolationFactor.bind(void 0,pt),zoomStops:p.stops.map(function(at){return at[0]}),evaluate:function(at){return v(p,y,at.zoom,b,T)}}}return{kind:"source",evaluate:function(at,vt){var it=vt&&vt.properties?vt.properties[p.property]:void 0;return it===void 0?hu(p.default,y.default):v(p,y,it,b,T)}}}(this._parameters,this._specification))};function Eo(i){var s=i.key,u=i.value,p=i.valueSpec||{},y=i.objectElementValidators||{},v=i.style,b=i.styleSpec,T=[],I=Cn(u);if(I!=="object")return[new re(s,u,"object expected, "+I+" found")];for(var M in u){var L=M.split(".")[0],z=p[L]||p["*"],U=void 0;if(y[L])U=y[L];else if(p[L])U=si;else if(y["*"])U=y["*"];else{if(!p["*"]){T.push(new re(s,u[M],'unknown property "'+M+'"'));continue}U=si}T=T.concat(U({key:(s&&s+".")+M,value:u[M],valueSpec:z,style:v,styleSpec:b,object:u,objectKey:M},u))}for(var H in p)y[H]||p[H].required&&p[H].default===void 0&&u[H]===void 0&&T.push(new re(s,u,'missing required property "'+H+'"'));return T}function xf(i){var s=i.value,u=i.valueSpec,p=i.style,y=i.styleSpec,v=i.key,b=i.arrayElementValidator||si;if(Cn(s)!=="array")return[new re(v,s,"array expected, "+Cn(s)+" found")];if(u.length&&s.length!==u.length)return[new re(v,s,"array length "+u.length+" expected, length "+s.length+" found")];if(u["min-length"]&&s.length<u["min-length"])return[new re(v,s,"array length at least "+u["min-length"]+" expected, length "+s.length+" found")];var T={type:u.value,values:u.values};y.$version<7&&(T.function=u.function),Cn(u.value)==="object"&&(T=u.value);for(var I=[],M=0;M<s.length;M++)I=I.concat(b({array:s,arrayIndex:M,value:s[M],valueSpec:T,style:p,styleSpec:y,key:v+"["+M+"]"}));return I}function Wd(i){var s=i.key,u=i.value,p=i.valueSpec,y=Cn(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new re(s,u,"number expected, "+y+" found")]:"minimum"in p&&u<p.minimum?[new re(s,u,u+" is less than the minimum value "+p.minimum)]:"maximum"in p&&u>p.maximum?[new re(s,u,u+" is greater than the maximum value "+p.maximum)]:[]}function Hd(i){var s,u,p,y=i.valueSpec,v=_e(i.value.type),b={},T=v!=="categorical"&&i.value.property===void 0,I=!T,M=Cn(i.value.stops)==="array"&&Cn(i.value.stops[0])==="array"&&Cn(i.value.stops[0][0])==="object",L=Eo({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(H){if(v==="identity")return[new re(H.key,H.value,'identity function may not have a "stops" property')];var ee=[],te=H.value;return ee=ee.concat(xf({key:H.key,value:te,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:z})),Cn(te)==="array"&&te.length===0&&ee.push(new re(H.key,te,"array must have at least one stop")),ee},default:function(H){return si({key:H.key,value:H.value,valueSpec:y,style:H.style,styleSpec:H.styleSpec})}}});return v==="identity"&&T&&L.push(new re(i.key,i.value,'missing required property "property"')),v==="identity"||i.value.stops||L.push(new re(i.key,i.value,'missing required property "stops"')),v==="exponential"&&i.valueSpec.expression&&!_c(i.valueSpec)&&L.push(new re(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(I&&!pl(i.valueSpec)?L.push(new re(i.key,i.value,"property functions not supported")):T&&!vf(i.valueSpec)&&L.push(new re(i.key,i.value,"zoom functions not supported"))),v!=="categorical"&&!M||i.value.property!==void 0||L.push(new re(i.key,i.value,'"property" property is required')),L;function z(H){var ee=[],te=H.value,pe=H.key;if(Cn(te)!=="array")return[new re(pe,te,"array expected, "+Cn(te)+" found")];if(te.length!==2)return[new re(pe,te,"array length 2 expected, length "+te.length+" found")];if(M){if(Cn(te[0])!=="object")return[new re(pe,te,"object expected, "+Cn(te[0])+" found")];if(te[0].zoom===void 0)return[new re(pe,te,"object stop key must have zoom")];if(te[0].value===void 0)return[new re(pe,te,"object stop key must have value")];if(p&&p>_e(te[0].zoom))return[new re(pe,te[0].zoom,"stop zoom values must appear in ascending order")];_e(te[0].zoom)!==p&&(p=_e(te[0].zoom),u=void 0,b={}),ee=ee.concat(Eo({key:pe+"[0]",value:te[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:Wd,value:U}}))}else ee=ee.concat(U({key:pe+"[0]",value:te[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},te));return Ps(Ue(te[1]))?ee.concat([new re(pe+"[1]",te[1],"expressions are not allowed in function stops.")]):ee.concat(si({key:pe+"[1]",value:te[1],valueSpec:y,style:H.style,styleSpec:H.styleSpec}))}function U(H,ee){var te=Cn(H.value),pe=_e(H.value),ce=H.value!==null?H.value:ee;if(s){if(te!==s)return[new re(H.key,ce,te+" stop domain type must match previous stop domain type "+s)]}else s=te;if(te!=="number"&&te!=="string"&&te!=="boolean")return[new re(H.key,ce,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&v!=="categorical"){var be="number expected, "+te+" found";return pl(y)&&v===void 0&&(be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new re(H.key,ce,be)]}return v!=="categorical"||te!=="number"||isFinite(pe)&&Math.floor(pe)===pe?v!=="categorical"&&te==="number"&&u!==void 0&&pe<u?[new re(H.key,ce,"stop domain values must appear in ascending order")]:(u=pe,v==="categorical"&&pe in b?[new re(H.key,ce,"stop domain values must be unique")]:(b[pe]=!0,[])):[new re(H.key,ce,"integer expected, found "+pe)]}}function yl(i){var s=(i.expressionContext==="property"?Gd:pu)(Ue(i.value),i.valueSpec);if(s.result==="error")return s.value.map(function(p){return new re(""+i.key+p.key,i.value,p.message)});var u=s.value.expression||s.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!u.outputDefined())return[new re(i.key,i.value,'Invalid data expression for "'+i.propertyKey+'". Output values must be contained as literals within the expression.')];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!ul(u))return[new re(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!ul(u))return[new re(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Da(u,["zoom","feature-state"]))return[new re(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ll(u))return[new re(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xc(i){var s=i.key,u=i.value,p=i.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(_e(u))===-1&&y.push(new re(s,u,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(p.values).indexOf(_e(u))===-1&&y.push(new re(s,u,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function bc(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(var s=0,u=i.slice(1);s<u.length;s+=1){var p=u[s];if(!bc(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}du.deserialize=function(i){return new du(i._parameters,i._specification)},du.serialize=function(i){return{_parameters:i._parameters,_specification:i._specification}};var qd={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function mu(i){if(i==null)return{filter:function(){return!0},needGeometry:!1};bc(i)||(i=wc(i));var s=pu(i,qd);if(s.result==="error")throw new Error(s.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,p,y){return s.value.evaluate(u,p,{},y)},needGeometry:function u(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var y=1;y<p.length;y++)if(u(p[y]))return!0;return!1}(i)}}function bf(i,s){return i<s?-1:i>s?1:0}function wc(i){if(!i)return!0;var s,u=i[0];return i.length<=1?u!=="any":u==="=="?wf(i[1],i[2],"=="):u==="!="?Ec(wf(i[1],i[2],"==")):u==="<"||u===">"||u==="<="||u===">="?wf(i[1],i[2],u):u==="any"?(s=i.slice(1),["any"].concat(s.map(wc))):u==="all"?["all"].concat(i.slice(1).map(wc)):u==="none"?["all"].concat(i.slice(1).map(wc).map(Ec)):u==="in"?Zd(i[1],i.slice(2)):u==="!in"?Ec(Zd(i[1],i.slice(2))):u==="has"?$d(i[1]):u==="!has"?Ec($d(i[1])):u!=="within"||i}function wf(i,s,u){switch(i){case"$type":return["filter-type-"+u,s];case"$id":return["filter-id-"+u,s];default:return["filter-"+u,i,s]}}function Zd(i,s){if(s.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(u){return typeof u!=typeof s[0]})?["filter-in-large",i,["literal",s.sort(bf)]]:["filter-in-small",i,["literal",s]]}}function $d(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ec(i){return["!",i]}function Ef(i){return bc(Ue(i.value))?yl(xe({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(u){var p=u.value,y=u.key;if(Cn(p)!=="array")return[new re(y,p,"array expected, "+Cn(p)+" found")];var v,b=u.styleSpec,T=[];if(p.length<1)return[new re(y,p,"filter array must have at least 1 element")];switch(T=T.concat(xc({key:y+"[0]",value:p[0],valueSpec:b.filter_operator,style:u.style,styleSpec:u.styleSpec})),_e(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&_e(p[1])==="$type"&&T.push(new re(y,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&T.push(new re(y,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(v=Cn(p[1]))!=="string"&&T.push(new re(y+"[1]",p[1],"string expected, "+v+" found"));for(var I=2;I<p.length;I++)v=Cn(p[I]),_e(p[1])==="$type"?T=T.concat(xc({key:y+"["+I+"]",value:p[I],valueSpec:b.geometry_type,style:u.style,styleSpec:u.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&T.push(new re(y+"["+I+"]",p[I],"string, number, or boolean expected, "+v+" found"));break;case"any":case"all":case"none":for(var M=1;M<p.length;M++)T=T.concat(s({key:y+"["+M+"]",value:p[M],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":v=Cn(p[1]),p.length!==2?T.push(new re(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):v!=="string"&&T.push(new re(y+"[1]",p[1],"string expected, "+v+" found"));break;case"within":v=Cn(p[1]),p.length!==2?T.push(new re(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):v!=="object"&&T.push(new re(y+"[1]",p[1],"object expected, "+v+" found"))}return T}(i)}function Xd(i,s){var u=i.key,p=i.style,y=i.styleSpec,v=i.value,b=i.objectKey,T=y[s+"_"+i.layerType];if(!T)return[];var I=b.match(/^(.*)-transition$/);if(s==="paint"&&I&&T[I[1]]&&T[I[1]].transition)return si({key:u,value:v,valueSpec:y.transition,style:p,styleSpec:y});var M,L=i.valueSpec||T[b];if(!L)return[new re(u,v,'unknown property "'+b+'"')];if(Cn(v)==="string"&&pl(L)&&!L.tokens&&(M=/^{([^}]+)}$/.exec(v)))return[new re(u,v,'"'+b+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(M[1])+" }`.")];var z=[];return i.layerType==="symbol"&&(b==="text-field"&&p&&!p.glyphs&&z.push(new re(u,v,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&dl(Ue(v))&&_e(v.type)==="identity"&&z.push(new re(u,v,'"text-font" does not support identity functions'))),z.concat(si({key:i.key,value:v,valueSpec:L,style:p,styleSpec:y,expressionContext:"property",propertyType:s,propertyKey:b}))}function Yd(i){return Xd(i,"paint")}function Tf(i){return Xd(i,"layout")}function Sf(i){var s=[],u=i.value,p=i.key,y=i.style,v=i.styleSpec;u.type||u.ref||s.push(new re(p,u,'either "type" or "ref" is required'));var b,T=_e(u.type),I=_e(u.ref);if(u.id)for(var M=_e(u.id),L=0;L<i.arrayIndex;L++){var z=y.layers[L];_e(z.id)===M&&s.push(new re(p,u.id,'duplicate layer id "'+u.id+'", previously used at line '+z.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(ee){ee in u&&s.push(new re(p,u[ee],'"'+ee+'" is prohibited for ref layers'))}),y.layers.forEach(function(ee){_e(ee.id)===I&&(b=ee)}),b?b.ref?s.push(new re(p,u.ref,"ref cannot reference another ref layer")):T=_e(b.type):s.push(new re(p,u.ref,'ref layer "'+I+'" not found'));else if(T!=="background")if(u.source){var U=y.sources&&y.sources[u.source],H=U&&_e(U.type);U?H==="vector"&&T==="raster"?s.push(new re(p,u.source,'layer "'+u.id+'" requires a raster source')):H==="raster"&&T!=="raster"?s.push(new re(p,u.source,'layer "'+u.id+'" requires a vector source')):H!=="vector"||u["source-layer"]?H==="raster-dem"&&T!=="hillshade"?s.push(new re(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!u.paint||!u.paint["line-gradient"]||H==="geojson"&&U.lineMetrics||s.push(new re(p,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new re(p,u,'layer "'+u.id+'" must specify a "source-layer"')):s.push(new re(p,u.source,'source "'+u.source+'" not found'))}else s.push(new re(p,u,'missing required property "source"'));return s=s.concat(Eo({key:p,value:u,valueSpec:v.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return si({key:p+".type",value:u.type,valueSpec:v.layer.type,style:i.style,styleSpec:i.styleSpec,object:u,objectKey:"type"})},filter:Ef,layout:function(ee){return Eo({layer:u,key:ee.key,value:ee.value,style:ee.style,styleSpec:ee.styleSpec,objectElementValidators:{"*":function(te){return Tf(xe({layerType:T},te))}}})},paint:function(ee){return Eo({layer:u,key:ee.key,value:ee.value,style:ee.style,styleSpec:ee.styleSpec,objectElementValidators:{"*":function(te){return Yd(xe({layerType:T},te))}}})}}}))}function da(i){var s=i.value,u=i.key,p=Cn(s);return p!=="string"?[new re(u,s,"string expected, "+p+" found")]:[]}var Kd={promoteId:function(i){var s=i.key,u=i.value;if(Cn(u)==="string")return da({key:s,value:u});var p=[];for(var y in u)p.push.apply(p,da({key:s+"."+y,value:u[y]}));return p}};function Pf(i){var s=i.value,u=i.key,p=i.styleSpec,y=i.style;if(!s.type)return[new re(u,s,'"type" is required')];var v,b=_e(s.type);switch(b){case"vector":case"raster":case"raster-dem":return Eo({key:u,value:s,valueSpec:p["source_"+b.replace("-","_")],style:i.style,styleSpec:p,objectElementValidators:Kd});case"geojson":if(v=Eo({key:u,value:s,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:Kd}),s.cluster)for(var T in s.clusterProperties){var I=s.clusterProperties[T],M=I[0],L=typeof M=="string"?[M,["accumulated"],["get",T]]:M;v.push.apply(v,yl({key:u+"."+T+".map",value:I[1],expressionContext:"cluster-map"})),v.push.apply(v,yl({key:u+"."+T+".reduce",value:L,expressionContext:"cluster-reduce"}))}return v;case"video":return Eo({key:u,value:s,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return Eo({key:u,value:s,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new re(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xc({key:u+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:p})}}function Bn(i){var s=i.value,u=i.styleSpec,p=u.light,y=i.style,v=[],b=Cn(s);if(s===void 0)return v;if(b!=="object")return v.concat([new re("light",s,"object expected, "+b+" found")]);for(var T in s){var I=T.match(/^(.*)-transition$/);v=v.concat(I&&p[I[1]]&&p[I[1]].transition?si({key:T,value:s[T],valueSpec:u.transition,style:y,styleSpec:u}):p[T]?si({key:T,value:s[T],valueSpec:p[T],style:y,styleSpec:u}):[new re(T,s[T],'unknown property "'+T+'"')])}return v}var Tc={"*":function(){return[]},array:xf,boolean:function(i){var s=i.value,u=i.key,p=Cn(s);return p!=="boolean"?[new re(u,s,"boolean expected, "+p+" found")]:[]},number:Wd,color:function(i){var s=i.key,u=i.value,p=Cn(u);return p!=="string"?[new re(s,u,"color expected, "+p+" found")]:xn(u)===null?[new re(s,u,'color expected, "'+u+'" found')]:[]},constants:ge,enum:xc,filter:Ef,function:Hd,layer:Sf,object:Eo,source:Pf,light:Bn,string:da,formatted:function(i){return da(i).length===0?[]:yl(i)},resolvedImage:function(i){return da(i).length===0?[]:yl(i)}};function si(i){var s=i.value,u=i.valueSpec,p=i.styleSpec;return u.expression&&dl(_e(s))?Hd(i):u.expression&&Ps(Ue(s))?yl(i):u.type&&Tc[u.type]?Tc[u.type](i):Eo(xe({},i,{valueSpec:u.type?p[u.type]:u}))}function As(i){var s=i.value,u=i.key,p=da(i);return p.length||(s.indexOf("{fontstack}")===-1&&p.push(new re(u,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&p.push(new re(u,s,'"glyphs" url must include a "{range}" token'))),p}function ln(i,s){s===void 0&&(s=Z);var u=[];return u=u.concat(si({key:"",value:i,valueSpec:s.$root,styleSpec:s,style:i,objectElementValidators:{glyphs:As,"*":function(){return[]}}})),i.constants&&(u=u.concat(ge({key:"constants",value:i.constants,style:i,styleSpec:s}))),Sn(u)}function Sn(i){return[].concat(i).sort(function(s,u){return s.line-u.line})}function ao(i){return function(){for(var s=[],u=arguments.length;u--;)s[u]=arguments[u];return Sn(i.apply(this,s))}}ln.source=ao(Pf),ln.light=ao(Bn),ln.layer=ao(Sf),ln.filter=ao(Ef),ln.paintProperty=ao(Yd),ln.layoutProperty=ao(Tf);var Wa=ln,gv=Wa.light,yv=Wa.paintProperty,vv=Wa.layoutProperty;function Jd(i,s){var u=!1;if(s&&s.length)for(var p=0,y=s;p<y.length;p+=1)i.fire(new Y(new Error(y[p].message))),u=!0;return u}var $o=Zi;function Zi(i,s,u){var p=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var y=new Int32Array(this.arrayBuffer);i=y[0],this.d=(s=y[1])+2*(u=y[2]);for(var v=0;v<this.d*this.d;v++){var b=y[3+v],T=y[3+v+1];p.push(b===T?null:y.subarray(b,T))}var I=y[3+p.length+1];this.keys=y.subarray(y[3+p.length],I),this.bboxes=y.subarray(I),this.insert=this._insertReadonly}else{this.d=s+2*u;for(var M=0;M<this.d*this.d;M++)p.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=u,this.scale=s/i,this.uid=0;var L=u/s*i;this.min=-L,this.max=i+L}Zi.prototype.insert=function(i,s,u,p,y){this._forEachCell(s,u,p,y,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)},Zi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Zi.prototype._insertCell=function(i,s,u,p,y,v){this.cells[y].push(v)},Zi.prototype.query=function(i,s,u,p,y){var v=this.min,b=this.max;if(i<=v&&s<=v&&b<=u&&b<=p&&!y)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(i,s,u,p,this._queryCell,T,{},y),T},Zi.prototype._queryCell=function(i,s,u,p,y,v,b,T){var I=this.cells[y];if(I!==null)for(var M=this.keys,L=this.bboxes,z=0;z<I.length;z++){var U=I[z];if(b[U]===void 0){var H=4*U;(T?T(L[H+0],L[H+1],L[H+2],L[H+3]):i<=L[H+2]&&s<=L[H+3]&&u>=L[H+0]&&p>=L[H+1])?(b[U]=!0,v.push(M[U])):b[U]=!1}}},Zi.prototype._forEachCell=function(i,s,u,p,y,v,b,T){for(var I=this._convertToCellCoord(i),M=this._convertToCellCoord(s),L=this._convertToCellCoord(u),z=this._convertToCellCoord(p),U=I;U<=L;U++)for(var H=M;H<=z;H++){var ee=this.d*H+U;if((!T||T(this._convertFromCellCoord(U),this._convertFromCellCoord(H),this._convertFromCellCoord(U+1),this._convertFromCellCoord(H+1)))&&y.call(this,i,s,u,p,ee,v,b,T))return}},Zi.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Zi.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Zi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=3+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var y=new Int32Array(s+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var v=s,b=0;b<i.length;b++){var T=i[b];y[3+b]=v,y.set(T,v),v+=T.length}return y[3+i.length]=v,y.set(this.keys,v),y[3+i.length+1]=v+=this.keys.length,y.set(this.bboxes,v),v+=this.bboxes.length,y.buffer};var gu=A.ImageData,$i=A.ImageBitmap,Ha={};function ht(i,s,u){u===void 0&&(u={}),Object.defineProperty(s,"_classRegistryKey",{value:i,writeable:!1}),Ha[i]={klass:s,omit:u.omit||[],shallow:u.shallow||[]}}for(var Ir in ht("Object",Object),$o.serialize=function(i,s){var u=i.toArrayBuffer();return s&&s.push(u),{buffer:u}},$o.deserialize=function(i){return new $o(i.buffer)},ht("Grid",$o),ht("Color",At),ht("Error",Error),ht("ResolvedImage",Nr),ht("StylePropertyFunction",du),ht("StyleExpression",fu,{omit:["_evaluator"]}),ht("ZoomDependentExpression",gl),ht("ZoomConstantExpression",ml),ht("CompoundExpression",Br,{omit:["_evaluate"]}),hl)hl[Ir]._classRegistryKey||ht("Expression_"+Ir,hl[Ir]);function To(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function so(i){return $i&&i instanceof $i}function Cs(i,s){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(To(i)||so(i))return s&&s.push(i),i;if(ArrayBuffer.isView(i)){var u=i;return s&&s.push(u.buffer),u}if(i instanceof gu)return s&&s.push(i.data.buffer),i;if(Array.isArray(i)){for(var p=[],y=0,v=i;y<v.length;y+=1)p.push(Cs(v[y],s));return p}if(typeof i=="object"){var b=i.constructor,T=b._classRegistryKey;if(!T)throw new Error("can't serialize object of unregistered class");var I=b.serialize?b.serialize(i,s):{};if(!b.serialize){for(var M in i)if(i.hasOwnProperty(M)&&!(Ha[T].omit.indexOf(M)>=0)){var L=i[M];I[M]=Ha[T].shallow.indexOf(M)>=0?L:Cs(L,s)}i instanceof Error&&(I.message=i.message)}if(I.$name)throw new Error("$name property is reserved for worker serialization logic.");return T!=="Object"&&(I.$name=T),I}throw new Error("can't serialize object of type "+typeof i)}function ma(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||To(i)||so(i)||ArrayBuffer.isView(i)||i instanceof gu)return i;if(Array.isArray(i))return i.map(ma);if(typeof i=="object"){var s=i.$name||"Object",u=Ha[s].klass;if(!u)throw new Error("can't deserialize unregistered class "+s);if(u.deserialize)return u.deserialize(i);for(var p=Object.create(u.prototype),y=0,v=Object.keys(i);y<v.length;y+=1){var b=v[y];if(b!=="$name"){var T=i[b];p[b]=Ha[s].shallow.indexOf(b)>=0?T:ma(T)}}return p}throw new Error("can't deserialize object of type "+typeof i)}var ga=function(){this.first=!0};ga.prototype.update=function(i,s){var u=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=s),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=u,!0))};var nt={"Latin-1 Supplement":function(i){return i>=128&&i<=255},Arabic:function(i){return i>=1536&&i<=1791},"Arabic Supplement":function(i){return i>=1872&&i<=1919},"Arabic Extended-A":function(i){return i>=2208&&i<=2303},"Hangul Jamo":function(i){return i>=4352&&i<=4607},"Unified Canadian Aboriginal Syllabics":function(i){return i>=5120&&i<=5759},Khmer:function(i){return i>=6016&&i<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(i){return i>=6320&&i<=6399},"General Punctuation":function(i){return i>=8192&&i<=8303},"Letterlike Symbols":function(i){return i>=8448&&i<=8527},"Number Forms":function(i){return i>=8528&&i<=8591},"Miscellaneous Technical":function(i){return i>=8960&&i<=9215},"Control Pictures":function(i){return i>=9216&&i<=9279},"Optical Character Recognition":function(i){return i>=9280&&i<=9311},"Enclosed Alphanumerics":function(i){return i>=9312&&i<=9471},"Geometric Shapes":function(i){return i>=9632&&i<=9727},"Miscellaneous Symbols":function(i){return i>=9728&&i<=9983},"Miscellaneous Symbols and Arrows":function(i){return i>=11008&&i<=11263},"CJK Radicals Supplement":function(i){return i>=11904&&i<=12031},"Kangxi Radicals":function(i){return i>=12032&&i<=12255},"Ideographic Description Characters":function(i){return i>=12272&&i<=12287},"CJK Symbols and Punctuation":function(i){return i>=12288&&i<=12351},Hiragana:function(i){return i>=12352&&i<=12447},Katakana:function(i){return i>=12448&&i<=12543},Bopomofo:function(i){return i>=12544&&i<=12591},"Hangul Compatibility Jamo":function(i){return i>=12592&&i<=12687},Kanbun:function(i){return i>=12688&&i<=12703},"Bopomofo Extended":function(i){return i>=12704&&i<=12735},"CJK Strokes":function(i){return i>=12736&&i<=12783},"Katakana Phonetic Extensions":function(i){return i>=12784&&i<=12799},"Enclosed CJK Letters and Months":function(i){return i>=12800&&i<=13055},"CJK Compatibility":function(i){return i>=13056&&i<=13311},"CJK Unified Ideographs Extension A":function(i){return i>=13312&&i<=19903},"Yijing Hexagram Symbols":function(i){return i>=19904&&i<=19967},"CJK Unified Ideographs":function(i){return i>=19968&&i<=40959},"Yi Syllables":function(i){return i>=40960&&i<=42127},"Yi Radicals":function(i){return i>=42128&&i<=42191},"Hangul Jamo Extended-A":function(i){return i>=43360&&i<=43391},"Hangul Syllables":function(i){return i>=44032&&i<=55215},"Hangul Jamo Extended-B":function(i){return i>=55216&&i<=55295},"Private Use Area":function(i){return i>=57344&&i<=63743},"CJK Compatibility Ideographs":function(i){return i>=63744&&i<=64255},"Arabic Presentation Forms-A":function(i){return i>=64336&&i<=65023},"Vertical Forms":function(i){return i>=65040&&i<=65055},"CJK Compatibility Forms":function(i){return i>=65072&&i<=65103},"Small Form Variants":function(i){return i>=65104&&i<=65135},"Arabic Presentation Forms-B":function(i){return i>=65136&&i<=65279},"Halfwidth and Fullwidth Forms":function(i){return i>=65280&&i<=65519}};function Af(i){for(var s=0,u=i;s<u.length;s+=1)if(_i(u[s].charCodeAt(0)))return!0;return!1}function _i(i){return!(i!==746&&i!==747&&(i<4352||!(nt["Bopomofo Extended"](i)||nt.Bopomofo(i)||nt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||nt["CJK Compatibility Ideographs"](i)||nt["CJK Compatibility"](i)||nt["CJK Radicals Supplement"](i)||nt["CJK Strokes"](i)||!(!nt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||nt["CJK Unified Ideographs Extension A"](i)||nt["CJK Unified Ideographs"](i)||nt["Enclosed CJK Letters and Months"](i)||nt["Hangul Compatibility Jamo"](i)||nt["Hangul Jamo Extended-A"](i)||nt["Hangul Jamo Extended-B"](i)||nt["Hangul Jamo"](i)||nt["Hangul Syllables"](i)||nt.Hiragana(i)||nt["Ideographic Description Characters"](i)||nt.Kanbun(i)||nt["Kangxi Radicals"](i)||nt["Katakana Phonetic Extensions"](i)||nt.Katakana(i)&&i!==12540||!(!nt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!nt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||nt["Unified Canadian Aboriginal Syllabics"](i)||nt["Unified Canadian Aboriginal Syllabics Extended"](i)||nt["Vertical Forms"](i)||nt["Yijing Hexagram Symbols"](i)||nt["Yi Syllables"](i)||nt["Yi Radicals"](i))))}function Qd(i){return!(_i(i)||function(s){return!!(nt["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||nt["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||nt["Letterlike Symbols"](s)||nt["Number Forms"](s)||nt["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||nt["Control Pictures"](s)&&s!==9251||nt["Optical Character Recognition"](s)||nt["Enclosed Alphanumerics"](s)||nt["Geometric Shapes"](s)||nt["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||nt["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||nt["CJK Symbols and Punctuation"](s)||nt.Katakana(s)||nt["Private Use Area"](s)||nt["CJK Compatibility Forms"](s)||nt["Small Form Variants"](s)||nt["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(i))}function Cf(i){return i>=1424&&i<=2303||nt["Arabic Presentation Forms-A"](i)||nt["Arabic Presentation Forms-B"](i)}function em(i,s){return!(!s&&Cf(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||nt.Khmer(i))}function So(i){for(var s=0,u=i;s<u.length;s+=1)if(Cf(u[s].charCodeAt(0)))return!0;return!1}var li=null,ti="unavailable",ya=null,tm=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(ti="error"),li&&li(i)};function Sc(){If.fire(new G("pluginStateChange",{pluginStatus:ti,pluginURL:ya}))}var If=new ne,yu=function(){return ti},nm=function(){if(ti!=="deferred"||!ya)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ti="loading",Sc(),ya&&fa({url:ya},function(i){i?tm(i):(ti="loaded",Sc())})},Xi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ti==="loaded"||Xi.applyArabicShaping!=null},isLoading:function(){return ti==="loading"},setState:function(i){ti=i.pluginStatus,ya=i.pluginURL},isParsed:function(){return Xi.applyArabicShaping!=null&&Xi.processBidirectionalText!=null&&Xi.processStyledBidirectionalText!=null},getPluginURL:function(){return ya}},hn=function(i,s){this.zoom=i,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ga,this.transition={})};hn.prototype.isSupportedScript=function(i){return function(s,u){for(var p=0,y=s;p<y.length;p+=1)if(!em(y[p].charCodeAt(0),u))return!1;return!0}(i,Xi.isLoaded())},hn.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},hn.prototype.getCrossfadeParameters=function(){var i=this.zoom,s=i-Math.floor(i),u=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*s}};var vl=function(i,s){this.property=i,this.value=s,this.expression=function(u,p){if(dl(u))return new du(u,p);if(Ps(u)){var y=Gd(u,p);if(y.result==="error")throw new Error(y.value.map(function(b){return b.key+": "+b.message}).join(", "));return y.value}var v=u;return typeof u=="string"&&p.type==="color"&&(v=At.parse(u)),{kind:"constant",evaluate:function(){return v}}}(s===void 0?i.specification.default:s,i.specification)};vl.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},vl.prototype.possiblyEvaluate=function(i,s,u){return this.property.possiblyEvaluate(this,i,s,u)};var Vr=function(i){this.property=i,this.value=new vl(i,void 0)};Vr.prototype.transitioned=function(i,s){return new va(this.property,this.value,s,F({},i.transition,this.transition),i.now)},Vr.prototype.untransitioned=function(){return new va(this.property,this.value,null,{},0)};var Yi=function(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)};Yi.prototype.getValue=function(i){return ze(this._values[i].value.value)},Yi.prototype.setValue=function(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new Vr(this._values[i].property)),this._values[i].value=new vl(this._values[i].property,s===null?void 0:ze(s))},Yi.prototype.getTransition=function(i){return ze(this._values[i].transition)},Yi.prototype.setTransition=function(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new Vr(this._values[i].property)),this._values[i].transition=ze(s)||void 0},Yi.prototype.serialize=function(){for(var i={},s=0,u=Object.keys(this._values);s<u.length;s+=1){var p=u[s],y=this.getValue(p);y!==void 0&&(i[p]=y);var v=this.getTransition(p);v!==void 0&&(i[p+"-transition"]=v)}return i},Yi.prototype.transitioned=function(i,s){for(var u=new Ki(this._properties),p=0,y=Object.keys(this._values);p<y.length;p+=1){var v=y[p];u._values[v]=this._values[v].transitioned(i,s._values[v])}return u},Yi.prototype.untransitioned=function(){for(var i=new Ki(this._properties),s=0,u=Object.keys(this._values);s<u.length;s+=1){var p=u[s];i._values[p]=this._values[p].untransitioned()}return i};var va=function(i,s,u,p,y){this.property=i,this.value=s,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,i.specification.transition&&(p.delay||p.duration)&&(this.prior=u)};va.prototype.possiblyEvaluate=function(i,s,u){var p=i.now||0,y=this.value.possiblyEvaluate(i,s,u),v=this.prior;if(v){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return v.possiblyEvaluate(i,s,u);var b=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(i,s,u),y,function(T){if(T<=0)return 0;if(T>=1)return 1;var I=T*T,M=I*T;return 4*(T<.5?M:3*(T-I)+M-.75)}(b))}return y};var Ki=function(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)};Ki.prototype.possiblyEvaluate=function(i,s,u){for(var p=new Po(this._properties),y=0,v=Object.keys(this._values);y<v.length;y+=1){var b=v[y];p._values[b]=this._values[b].possiblyEvaluate(i,s,u)}return p},Ki.prototype.hasTransition=function(){for(var i=0,s=Object.keys(this._values);i<s.length;i+=1)if(this._values[s[i]].prior)return!0;return!1};var _a=function(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)};_a.prototype.getValue=function(i){return ze(this._values[i].value)},_a.prototype.setValue=function(i,s){this._values[i]=new vl(this._values[i].property,s===null?void 0:ze(s))},_a.prototype.serialize=function(){for(var i={},s=0,u=Object.keys(this._values);s<u.length;s+=1){var p=u[s],y=this.getValue(p);y!==void 0&&(i[p]=y)}return i},_a.prototype.possiblyEvaluate=function(i,s,u){for(var p=new Po(this._properties),y=0,v=Object.keys(this._values);y<v.length;y+=1){var b=v[y];p._values[b]=this._values[b].possiblyEvaluate(i,s,u)}return p};var ni=function(i,s,u){this.property=i,this.value=s,this.parameters=u};ni.prototype.isConstant=function(){return this.value.kind==="constant"},ni.prototype.constantOr=function(i){return this.value.kind==="constant"?this.value.value:i},ni.prototype.evaluate=function(i,s,u,p){return this.property.evaluate(this.value,this.parameters,i,s,u,p)};var Po=function(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)};Po.prototype.get=function(i){return this._values[i]};var gt=function(i){this.specification=i};gt.prototype.possiblyEvaluate=function(i,s){return i.expression.evaluate(s)},gt.prototype.interpolate=function(i,s,u){var p=pa[this.specification.type];return p?p(i,s,u):i};var Ct=function(i,s){this.specification=i,this.overrides=s};Ct.prototype.possiblyEvaluate=function(i,s,u,p){return new ni(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(s,null,{},u,p)}:i.expression,s)},Ct.prototype.interpolate=function(i,s,u){if(i.value.kind!=="constant"||s.value.kind!=="constant")return i;if(i.value.value===void 0||s.value.value===void 0)return new ni(this,{kind:"constant",value:void 0},i.parameters);var p=pa[this.specification.type];return p?new ni(this,{kind:"constant",value:p(i.value.value,s.value.value,u)},i.parameters):i},Ct.prototype.evaluate=function(i,s,u,p,y,v){return i.kind==="constant"?i.value:i.evaluate(s,u,p,y,v)};var _l=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(u,p,y,v){if(u.value===void 0)return new ni(this,{kind:"constant",value:void 0},p);if(u.expression.kind==="constant"){var b=u.expression.evaluate(p,null,{},y,v),T=u.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,I=this._calculate(T,T,T,p);return new ni(this,{kind:"constant",value:I},p)}if(u.expression.kind==="camera"){var M=this._calculate(u.expression.evaluate({zoom:p.zoom-1}),u.expression.evaluate({zoom:p.zoom}),u.expression.evaluate({zoom:p.zoom+1}),p);return new ni(this,{kind:"constant",value:M},p)}return new ni(this,u.expression,p)},s.prototype.evaluate=function(u,p,y,v,b,T){if(u.kind==="source"){var I=u.evaluate(p,y,v,b,T);return this._calculate(I,I,I,p)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(p.zoom)-1},y,v),u.evaluate({zoom:Math.floor(p.zoom)},y,v),u.evaluate({zoom:Math.floor(p.zoom)+1},y,v),p):u.value},s.prototype._calculate=function(u,p,y,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:u,to:p}:{from:y,to:p}},s.prototype.interpolate=function(u){return u},s}(Ct),Qn=function(i){this.specification=i};Qn.prototype.possiblyEvaluate=function(i,s,u,p){if(i.value!==void 0){if(i.expression.kind==="constant"){var y=i.expression.evaluate(s,null,{},u,p);return this._calculate(y,y,y,s)}return this._calculate(i.expression.evaluate(new hn(Math.floor(s.zoom-1),s)),i.expression.evaluate(new hn(Math.floor(s.zoom),s)),i.expression.evaluate(new hn(Math.floor(s.zoom+1),s)),s)}},Qn.prototype._calculate=function(i,s,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:i,to:s}:{from:u,to:s}},Qn.prototype.interpolate=function(i){return i};var vu=function(i){this.specification=i};vu.prototype.possiblyEvaluate=function(i,s,u,p){return!!i.expression.evaluate(s,null,{},u,p)},vu.prototype.interpolate=function(){return!1};var hr=function(i){for(var s in this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],i){var u=i[s];u.specification.overridable&&this.overridableProperties.push(s);var p=this.defaultPropertyValues[s]=new vl(u,void 0),y=this.defaultTransitionablePropertyValues[s]=new Vr(u);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate({})}};ht("DataDrivenProperty",Ct),ht("DataConstantProperty",gt),ht("CrossFadedDataDrivenProperty",_l),ht("CrossFadedProperty",Qn),ht("ColorRampProperty",vu);var ui=function(i){function s(u,p){if(i.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),p.layout&&(this._unevaluatedLayout=new _a(p.layout)),p.paint)){for(var y in this._transitionablePaint=new Yi(p.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var v in u.layout)this.setLayoutProperty(v,u.layout[v],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Po(p.paint)}}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},s.prototype.setLayoutProperty=function(u,p,y){y===void 0&&(y={}),p!=null&&this._validate(vv,"layers."+this.id+".layout."+u,u,p,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,p):this.visibility=p)},s.prototype.getPaintProperty=function(u){return Ee(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-11)):this._transitionablePaint.getValue(u)},s.prototype.setPaintProperty=function(u,p,y){if(y===void 0&&(y={}),p!=null&&this._validate(yv,"layers."+this.id+".paint."+u,u,p,y))return!1;if(Ee(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-11),p||void 0),!1;var v=this._transitionablePaint._values[u],b=v.property.specification["property-type"]==="cross-faded-data-driven",T=v.value.isDataDriven(),I=v.value;this._transitionablePaint.setValue(u,p),this._handleSpecialPaintPropertyUpdate(u);var M=this._transitionablePaint._values[u].value;return M.isDataDriven()||T||b||this._handleOverridablePaintPropertyUpdate(u,I,M)},s.prototype._handleSpecialPaintPropertyUpdate=function(u){},s.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!1},s.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(u,p){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,p)},s.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),we(u,function(p,y){return!(p===void 0||y==="layout"&&!Object.keys(p).length||y==="paint"&&!Object.keys(p).length)})},s.prototype._validate=function(u,p,y,v,b){return b===void 0&&(b={}),(!b||b.validate!==!1)&&Jd(this,u.call(Wa,{key:p,layerType:this.type,objectKey:y,value:v,styleSpec:Z,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var u in this.paint._values){var p=this.paint.get(u);if(p instanceof ni&&pl(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},s}(ne),_u={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Pc=function(i,s){this._structArray=i,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},wn=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Jr(i,s){s===void 0&&(s=1);var u=0,p=0;return{members:i.map(function(y){var v=_u[y.type].BYTES_PER_ELEMENT,b=u=Is(u,Math.max(s,v)),T=y.components||1;return p=Math.max(p,v),u+=v*T,{name:y.name,type:y.type,components:T,offset:b}}),size:Is(u,Math.max(p,s)),alignment:s}}function Is(i,s){return Math.ceil(i/s)*s}wn.serialize=function(i,s){return i._trim(),s&&(i.isTransferred=!0,s.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}},wn.deserialize=function(i){var s=Object.create(this.prototype);return s.arrayBuffer=i.arrayBuffer,s.length=i.length,s.capacity=i.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},wn.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},wn.prototype.clear=function(){this.length=0},wn.prototype.resize=function(i){this.reserve(i),this.length=i},wn.prototype.reserve=function(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},wn.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var xu=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},s.prototype.emplace=function(u,p,y){var v=2*u;return this.int16[v+0]=p,this.int16[v+1]=y,u},s}(wn);xu.prototype.bytesPerElement=4,ht("StructArrayLayout2i4",xu);var Mf=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y,v){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y,v)},s.prototype.emplace=function(u,p,y,v,b){var T=4*u;return this.int16[T+0]=p,this.int16[T+1]=y,this.int16[T+2]=v,this.int16[T+3]=b,u},s}(wn);Mf.prototype.bytesPerElement=8,ht("StructArrayLayout4i8",Mf);var bu=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y,v,b,T){var I=this.length;return this.resize(I+1),this.emplace(I,u,p,y,v,b,T)},s.prototype.emplace=function(u,p,y,v,b,T,I){var M=6*u;return this.int16[M+0]=p,this.int16[M+1]=y,this.int16[M+2]=v,this.int16[M+3]=b,this.int16[M+4]=T,this.int16[M+5]=I,u},s}(wn);bu.prototype.bytesPerElement=12,ht("StructArrayLayout2i4i12",bu);var kf=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y,v,b,T){var I=this.length;return this.resize(I+1),this.emplace(I,u,p,y,v,b,T)},s.prototype.emplace=function(u,p,y,v,b,T,I){var M=4*u,L=8*u;return this.int16[M+0]=p,this.int16[M+1]=y,this.uint8[L+4]=v,this.uint8[L+5]=b,this.uint8[L+6]=T,this.uint8[L+7]=I,u},s}(wn);kf.prototype.bytesPerElement=8,ht("StructArrayLayout2i4ub8",kf);var Li=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y,v,b,T,I,M,L,z){var U=this.length;return this.resize(U+1),this.emplace(U,u,p,y,v,b,T,I,M,L,z)},s.prototype.emplace=function(u,p,y,v,b,T,I,M,L,z,U){var H=10*u;return this.uint16[H+0]=p,this.uint16[H+1]=y,this.uint16[H+2]=v,this.uint16[H+3]=b,this.uint16[H+4]=T,this.uint16[H+5]=I,this.uint16[H+6]=M,this.uint16[H+7]=L,this.uint16[H+8]=z,this.uint16[H+9]=U,u},s}(wn);Li.prototype.bytesPerElement=20,ht("StructArrayLayout10ui20",Li);var Ri=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y,v,b,T,I,M,L,z,U,H){var ee=this.length;return this.resize(ee+1),this.emplace(ee,u,p,y,v,b,T,I,M,L,z,U,H)},s.prototype.emplace=function(u,p,y,v,b,T,I,M,L,z,U,H,ee){var te=12*u;return this.int16[te+0]=p,this.int16[te+1]=y,this.int16[te+2]=v,this.int16[te+3]=b,this.uint16[te+4]=T,this.uint16[te+5]=I,this.uint16[te+6]=M,this.uint16[te+7]=L,this.int16[te+8]=z,this.int16[te+9]=U,this.int16[te+10]=H,this.int16[te+11]=ee,u},s}(wn);Ri.prototype.bytesPerElement=24,ht("StructArrayLayout4i4ui4i24",Ri);var Ac=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y){var v=this.length;return this.resize(v+1),this.emplace(v,u,p,y)},s.prototype.emplace=function(u,p,y,v){var b=3*u;return this.float32[b+0]=p,this.float32[b+1]=y,this.float32[b+2]=v,u},s}(wn);Ac.prototype.bytesPerElement=12,ht("StructArrayLayout3f12",Ac);var wu=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},s.prototype.emplace=function(u,p){return this.uint32[1*u+0]=p,u},s}(wn);wu.prototype.bytesPerElement=4,ht("StructArrayLayout1ul4",wu);var Cc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y,v,b,T,I,M,L){var z=this.length;return this.resize(z+1),this.emplace(z,u,p,y,v,b,T,I,M,L)},s.prototype.emplace=function(u,p,y,v,b,T,I,M,L,z){var U=10*u,H=5*u;return this.int16[U+0]=p,this.int16[U+1]=y,this.int16[U+2]=v,this.int16[U+3]=b,this.int16[U+4]=T,this.int16[U+5]=I,this.uint32[H+3]=M,this.uint16[U+8]=L,this.uint16[U+9]=z,u},s}(wn);Cc.prototype.bytesPerElement=20,ht("StructArrayLayout6i1ul2ui20",Cc);var Ms=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y,v,b,T){var I=this.length;return this.resize(I+1),this.emplace(I,u,p,y,v,b,T)},s.prototype.emplace=function(u,p,y,v,b,T,I){var M=6*u;return this.int16[M+0]=p,this.int16[M+1]=y,this.int16[M+2]=v,this.int16[M+3]=b,this.int16[M+4]=T,this.int16[M+5]=I,u},s}(wn);Ms.prototype.bytesPerElement=12,ht("StructArrayLayout2i2i2i12",Ms);var Eu=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y,v,b){var T=this.length;return this.resize(T+1),this.emplace(T,u,p,y,v,b)},s.prototype.emplace=function(u,p,y,v,b,T){var I=4*u,M=8*u;return this.float32[I+0]=p,this.float32[I+1]=y,this.float32[I+2]=v,this.int16[M+6]=b,this.int16[M+7]=T,u},s}(wn);Eu.prototype.bytesPerElement=16,ht("StructArrayLayout2f1f2i16",Eu);var Lf=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y,v){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y,v)},s.prototype.emplace=function(u,p,y,v,b){var T=12*u,I=3*u;return this.uint8[T+0]=p,this.uint8[T+1]=y,this.float32[I+1]=v,this.float32[I+2]=b,u},s}(wn);Lf.prototype.bytesPerElement=12,ht("StructArrayLayout2ub2f12",Lf);var Xo=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y){var v=this.length;return this.resize(v+1),this.emplace(v,u,p,y)},s.prototype.emplace=function(u,p,y,v){var b=3*u;return this.uint16[b+0]=p,this.uint16[b+1]=y,this.uint16[b+2]=v,u},s}(wn);Xo.prototype.bytesPerElement=6,ht("StructArrayLayout3ui6",Xo);var ks=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y,v,b,T,I,M,L,z,U,H,ee,te,pe,ce,be){var Se=this.length;return this.resize(Se+1),this.emplace(Se,u,p,y,v,b,T,I,M,L,z,U,H,ee,te,pe,ce,be)},s.prototype.emplace=function(u,p,y,v,b,T,I,M,L,z,U,H,ee,te,pe,ce,be,Se){var Ie=24*u,Me=12*u,Ne=48*u;return this.int16[Ie+0]=p,this.int16[Ie+1]=y,this.uint16[Ie+2]=v,this.uint16[Ie+3]=b,this.uint32[Me+2]=T,this.uint32[Me+3]=I,this.uint32[Me+4]=M,this.uint16[Ie+10]=L,this.uint16[Ie+11]=z,this.uint16[Ie+12]=U,this.float32[Me+7]=H,this.float32[Me+8]=ee,this.uint8[Ne+36]=te,this.uint8[Ne+37]=pe,this.uint8[Ne+38]=ce,this.uint32[Me+10]=be,this.int16[Ie+22]=Se,u},s}(wn);ks.prototype.bytesPerElement=48,ht("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ks);var Rf=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y,v,b,T,I,M,L,z,U,H,ee,te,pe,ce,be,Se,Ie,Me,Ne,$e,Qe,pt,at,vt,it,Gt){var St=this.length;return this.resize(St+1),this.emplace(St,u,p,y,v,b,T,I,M,L,z,U,H,ee,te,pe,ce,be,Se,Ie,Me,Ne,$e,Qe,pt,at,vt,it,Gt)},s.prototype.emplace=function(u,p,y,v,b,T,I,M,L,z,U,H,ee,te,pe,ce,be,Se,Ie,Me,Ne,$e,Qe,pt,at,vt,it,Gt,St){var ut=34*u,Xt=17*u;return this.int16[ut+0]=p,this.int16[ut+1]=y,this.int16[ut+2]=v,this.int16[ut+3]=b,this.int16[ut+4]=T,this.int16[ut+5]=I,this.int16[ut+6]=M,this.int16[ut+7]=L,this.uint16[ut+8]=z,this.uint16[ut+9]=U,this.uint16[ut+10]=H,this.uint16[ut+11]=ee,this.uint16[ut+12]=te,this.uint16[ut+13]=pe,this.uint16[ut+14]=ce,this.uint16[ut+15]=be,this.uint16[ut+16]=Se,this.uint16[ut+17]=Ie,this.uint16[ut+18]=Me,this.uint16[ut+19]=Ne,this.uint16[ut+20]=$e,this.uint16[ut+21]=Qe,this.uint16[ut+22]=pt,this.uint32[Xt+12]=at,this.float32[Xt+13]=vt,this.float32[Xt+14]=it,this.float32[Xt+15]=Gt,this.float32[Xt+16]=St,u},s}(wn);Rf.prototype.bytesPerElement=68,ht("StructArrayLayout8i15ui1ul4f68",Rf);var Ic=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},s.prototype.emplace=function(u,p){return this.float32[1*u+0]=p,u},s}(wn);Ic.prototype.bytesPerElement=4,ht("StructArrayLayout1f4",Ic);var qa=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y){var v=this.length;return this.resize(v+1),this.emplace(v,u,p,y)},s.prototype.emplace=function(u,p,y,v){var b=3*u;return this.int16[b+0]=p,this.int16[b+1]=y,this.int16[b+2]=v,u},s}(wn);qa.prototype.bytesPerElement=6,ht("StructArrayLayout3i6",qa);var Mc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y){var v=this.length;return this.resize(v+1),this.emplace(v,u,p,y)},s.prototype.emplace=function(u,p,y,v){var b=4*u;return this.uint32[2*u+0]=p,this.uint16[b+2]=y,this.uint16[b+3]=v,u},s}(wn);Mc.prototype.bytesPerElement=8,ht("StructArrayLayout1ul2ui8",Mc);var xa=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},s.prototype.emplace=function(u,p,y){var v=2*u;return this.uint16[v+0]=p,this.uint16[v+1]=y,u},s}(wn);xa.prototype.bytesPerElement=4,ht("StructArrayLayout2ui4",xa);var lo=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},s.prototype.emplace=function(u,p){return this.uint16[1*u+0]=p,u},s}(wn);lo.prototype.bytesPerElement=2,ht("StructArrayLayout1ui2",lo);var kc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},s.prototype.emplace=function(u,p,y){var v=2*u;return this.float32[v+0]=p,this.float32[v+1]=y,u},s}(wn);kc.prototype.bytesPerElement=8,ht("StructArrayLayout2f8",kc);var Of=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(u,p,y,v){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y,v)},s.prototype.emplace=function(u,p,y,v,b){var T=4*u;return this.float32[T+0]=p,this.float32[T+1]=y,this.float32[T+2]=v,this.float32[T+3]=b,u},s}(wn);Of.prototype.bytesPerElement=16,ht("StructArrayLayout4f16",Of);var zf=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new E(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,u),s}(Pc);zf.prototype.size=20;var c=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(u){return new zf(this,u)},s}(Cc);ht("CollisionBoxArray",c);var f=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,u),s}(Pc);f.prototype.size=48;var h=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(u){return new f(this,u)},s}(ks);ht("PlacedSymbolArray",h);var m=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,u),s}(Pc);m.prototype.size=68;var _=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(u){return new m(this,u)},s}(Rf);ht("SymbolInstanceArray",_);var w=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.getoffsetX=function(u){return this.float32[1*u+0]},s}(Ic);ht("GlyphOffsetArray",w);var S=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.getx=function(u){return this.int16[3*u+0]},s.prototype.gety=function(u){return this.int16[3*u+1]},s.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},s}(qa);ht("SymbolLineVertexArray",S);var C=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,u),s}(Pc);C.prototype.size=8;var k=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(u){return new C(this,u)},s}(Mc);ht("FeatureIndexArray",k);var N=Jr([{name:"a_pos",components:2,type:"Int16"}],4).members,V=function(i){i===void 0&&(i=[]),this.segments=i};function K(i,s){return 256*(i=X(Math.floor(i),0,255))+X(Math.floor(s),0,255)}V.prototype.prepareSegment=function(i,s,u,p){var y=this.segments[this.segments.length-1];return i>V.MAX_VERTEX_ARRAY_LENGTH&&Be("Max vertices per segment is "+V.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+i),(!y||y.vertexLength+i>V.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:s.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y},V.prototype.get=function(){return this.segments},V.prototype.destroy=function(){for(var i=0,s=this.segments;i<s.length;i+=1){var u=s[i];for(var p in u.vaos)u.vaos[p].destroy()}},V.simpleSegment=function(i,s,u,p){return new V([{vertexOffset:i,primitiveOffset:s,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])},V.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ht("SegmentVector",V);var $=Jr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ae=d(function(i){i.exports=function(s,u){var p,y,v,b,T,I,M,L;for(y=s.length-(p=3&s.length),v=u,T=3432918353,I=461845907,L=0;L<y;)M=255&s.charCodeAt(L)|(255&s.charCodeAt(++L))<<8|(255&s.charCodeAt(++L))<<16|(255&s.charCodeAt(++L))<<24,++L,v=27492+(65535&(b=5*(65535&(v=(v^=M=(65535&(M=(M=(65535&M)*T+(((M>>>16)*T&65535)<<16)&4294967295)<<15|M>>>17))*I+(((M>>>16)*I&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(M=0,p){case 3:M^=(255&s.charCodeAt(L+2))<<16;case 2:M^=(255&s.charCodeAt(L+1))<<8;case 1:v^=M=(65535&(M=(M=(65535&(M^=255&s.charCodeAt(L)))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<15|M>>>17))*I+(((M>>>16)*I&65535)<<16)&4294967295}return v^=s.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}}),se=d(function(i){i.exports=function(s,u){for(var p,y=s.length,v=u^y,b=0;y>=4;)p=1540483477*(65535&(p=255&s.charCodeAt(b)|(255&s.charCodeAt(++b))<<8|(255&s.charCodeAt(++b))<<16|(255&s.charCodeAt(++b))<<24))+((1540483477*(p>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++b;switch(y){case 3:v^=(255&s.charCodeAt(b+2))<<16;case 2:v^=(255&s.charCodeAt(b+1))<<8;case 1:v=1540483477*(65535&(v^=255&s.charCodeAt(b)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}}),fe=ae,ie=se;fe.murmur3=ae,fe.murmur2=ie;var he=function(){this.ids=[],this.positions=[],this.indexed=!1};he.prototype.add=function(i,s,u,p){this.ids.push(Te(i)),this.positions.push(s,u,p)},he.prototype.getPositions=function(i){for(var s=Te(i),u=0,p=this.ids.length-1;u<p;){var y=u+p>>1;this.ids[y]>=s?p=y:u=y+1}for(var v=[];this.ids[u]===s;)v.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return v},he.serialize=function(i,s){var u=new Float64Array(i.ids),p=new Uint32Array(i.positions);return function y(v,b,T,I){for(;T<I;){for(var M=v[T+I>>1],L=T-1,z=I+1;;){do L++;while(v[L]<M);do z--;while(v[z]>M);if(L>=z)break;Le(v,L,z),Le(b,3*L,3*z),Le(b,3*L+1,3*z+1),Le(b,3*L+2,3*z+2)}z-T<I-z?(y(v,b,T,z),T=z+1):(y(v,b,z+1,I),I=z)}}(u,p,0,u.length-1),s&&s.push(u.buffer,p.buffer),{ids:u,positions:p}},he.deserialize=function(i){var s=new he;return s.ids=i.ids,s.positions=i.positions,s.indexed=!0,s};var ve=Math.pow(2,53)-1;function Te(i){var s=+i;return!isNaN(s)&&s<=ve?s:fe(String(i))}function Le(i,s,u){var p=i[s];i[s]=i[u],i[u]=p}ht("FeaturePositionMap",he);var Ae=function(i,s){this.gl=i.gl,this.location=s},Re=function(i){function s(u,p){i.call(this,u,p),this.current=0}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},s}(Ae),je=function(i){function s(u,p){i.call(this,u,p),this.current=0}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},s}(Ae),Je=function(i){function s(u,p){i.call(this,u,p),this.current=[0,0]}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},s}(Ae),Ze=function(i){function s(u,p){i.call(this,u,p),this.current=[0,0,0]}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},s}(Ae),rt=function(i){function s(u,p){i.call(this,u,p),this.current=[0,0,0,0]}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},s}(Ae),ft=function(i){function s(u,p){i.call(this,u,p),this.current=At.transparent}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},s}(Ae),Mt=new Float32Array(16),wt=function(i){function s(u,p){i.call(this,u,p),this.current=Mt}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var p=1;p<16;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},s}(Ae);function Ht(i){return[K(255*i.r,255*i.g),K(255*i.b,255*i.a)]}var lt=function(i,s,u){this.value=i,this.uniformNames=s.map(function(p){return"u_"+p}),this.type=u};lt.prototype.setUniform=function(i,s,u){i.set(u.constantOr(this.value))},lt.prototype.getBinding=function(i,s,u){return this.type==="color"?new ft(i,s):new je(i,s)};var Ft=function(i,s){this.uniformNames=s.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ft.prototype.setConstantPatternPositions=function(i,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=i.tlbr},Ft.prototype.setUniform=function(i,s,u,p){var y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&i.set(y)},Ft.prototype.getBinding=function(i,s,u){return u.substr(0,9)==="u_pattern"?new rt(i,s):new je(i,s)};var Bt=function(i,s,u,p){this.expression=i,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new p};Bt.prototype.populatePaintArray=function(i,s,u,p,y){var v=this.paintVertexArray.length,b=this.expression.evaluate(new hn(0),s,{},p,[],y);this.paintVertexArray.resize(i),this._setPaintValue(v,i,b)},Bt.prototype.updatePaintArray=function(i,s,u,p){var y=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(i,s,y)},Bt.prototype._setPaintValue=function(i,s,u){if(this.type==="color")for(var p=Ht(u),y=i;y<s;y++)this.paintVertexArray.emplace(y,p[0],p[1]);else{for(var v=i;v<s;v++)this.paintVertexArray.emplace(v,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},Bt.prototype.upload=function(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Bt.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Et=function(i,s,u,p,y,v){this.expression=i,this.uniformNames=s.map(function(b){return"u_"+b+"_t"}),this.type=u,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=s.map(function(b){return{name:"a_"+b,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new v};Et.prototype.populatePaintArray=function(i,s,u,p,y){var v=this.expression.evaluate(new hn(this.zoom),s,{},p,[],y),b=this.expression.evaluate(new hn(this.zoom+1),s,{},p,[],y),T=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(T,i,v,b)},Et.prototype.updatePaintArray=function(i,s,u,p){var y=this.expression.evaluate({zoom:this.zoom},u,p),v=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(i,s,y,v)},Et.prototype._setPaintValue=function(i,s,u,p){if(this.type==="color")for(var y=Ht(u),v=Ht(p),b=i;b<s;b++)this.paintVertexArray.emplace(b,y[0],y[1],v[0],v[1]);else{for(var T=i;T<s;T++)this.paintVertexArray.emplace(T,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}},Et.prototype.upload=function(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Et.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Et.prototype.setUniform=function(i,s){var u=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,p=X(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);i.set(p)},Et.prototype.getBinding=function(i,s,u){return new je(i,s)};var Ot=function(i,s,u,p,y,v){this.expression=i,this.type=s,this.useIntegerZoom=u,this.zoom=p,this.layerId=v,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};Ot.prototype.populatePaintArray=function(i,s,u){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(p,i,s.patterns&&s.patterns[this.layerId],u)},Ot.prototype.updatePaintArray=function(i,s,u,p,y){this._setPaintValues(i,s,u.patterns&&u.patterns[this.layerId],y)},Ot.prototype._setPaintValues=function(i,s,u,p){if(p&&u){var y=p[u.min],v=p[u.mid],b=p[u.max];if(y&&v&&b)for(var T=i;T<s;T++)this.zoomInPaintVertexArray.emplace(T,v.tl[0],v.tl[1],v.br[0],v.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],v.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(T,v.tl[0],v.tl[1],v.br[0],v.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],v.pixelRatio,b.pixelRatio)}},Ot.prototype.upload=function(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,$.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,$.members,this.expression.isStateDependent))},Ot.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var jt=function(i,s,u){this.binders={},this._buffers=[];var p=[];for(var y in i.paint._values)if(u(y)){var v=i.paint.get(y);if(v instanceof ni&&pl(v.property.specification)){var b=Ut(y,i.type),T=v.value,I=v.property.specification.type,M=v.property.useIntegerZoom,L=v.property.specification["property-type"],z=L==="cross-faded"||L==="cross-faded-data-driven";if(T.kind==="constant")this.binders[y]=z?new Ft(T.value,b):new lt(T.value,b,I),p.push("/u_"+y);else if(T.kind==="source"||z){var U=Mr(y,I,"source");this.binders[y]=z?new Ot(T,I,M,s,U,i.id):new Bt(T,b,I,U),p.push("/a_"+y)}else{var H=Mr(y,I,"composite");this.binders[y]=new Et(T,b,I,M,s,H),p.push("/z_"+y)}}}this.cacheKey=p.sort().join("")};jt.prototype.getMaxValue=function(i){var s=this.binders[i];return s instanceof Bt||s instanceof Et?s.maxValue:0},jt.prototype.populatePaintArrays=function(i,s,u,p,y){for(var v in this.binders){var b=this.binders[v];(b instanceof Bt||b instanceof Et||b instanceof Ot)&&b.populatePaintArray(i,s,u,p,y)}},jt.prototype.setConstantPatternPositions=function(i,s){for(var u in this.binders){var p=this.binders[u];p instanceof Ft&&p.setConstantPatternPositions(i,s)}},jt.prototype.updatePaintArrays=function(i,s,u,p,y){var v=!1;for(var b in i)for(var T=0,I=s.getPositions(b);T<I.length;T+=1){var M=I[T],L=u.feature(M.index);for(var z in this.binders){var U=this.binders[z];if((U instanceof Bt||U instanceof Et||U instanceof Ot)&&U.expression.isStateDependent===!0){var H=p.paint.get(z);U.expression=H.value,U.updatePaintArray(M.start,M.end,L,i[b],y),v=!0}}}return v},jt.prototype.defines=function(){var i=[];for(var s in this.binders){var u=this.binders[s];(u instanceof lt||u instanceof Ft)&&i.push.apply(i,u.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return i},jt.prototype.getBinderAttributes=function(){var i=[];for(var s in this.binders){var u=this.binders[s];if(u instanceof Bt||u instanceof Et)for(var p=0;p<u.paintVertexAttributes.length;p++)i.push(u.paintVertexAttributes[p].name);else if(u instanceof Ot)for(var y=0;y<$.members.length;y++)i.push($.members[y].name)}return i},jt.prototype.getBinderUniforms=function(){var i=[];for(var s in this.binders){var u=this.binders[s];if(u instanceof lt||u instanceof Ft||u instanceof Et)for(var p=0,y=u.uniformNames;p<y.length;p+=1)i.push(y[p])}return i},jt.prototype.getPaintVertexBuffers=function(){return this._buffers},jt.prototype.getUniforms=function(i,s){var u=[];for(var p in this.binders){var y=this.binders[p];if(y instanceof lt||y instanceof Ft||y instanceof Et)for(var v=0,b=y.uniformNames;v<b.length;v+=1){var T=b[v];if(s[T]){var I=y.getBinding(i,s[T],T);u.push({name:T,property:p,binding:I})}}}return u},jt.prototype.setUniforms=function(i,s,u,p){for(var y=0,v=s;y<v.length;y+=1){var b=v[y],T=b.name,I=b.property;this.binders[I].setUniform(b.binding,p,u.get(I),T)}},jt.prototype.updatePaintBuffers=function(i){for(var s in this._buffers=[],this.binders){var u=this.binders[s];if(i&&u instanceof Ot){var p=i.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof Bt||u instanceof Et)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},jt.prototype.upload=function(i){for(var s in this.binders){var u=this.binders[s];(u instanceof Bt||u instanceof Et||u instanceof Ot)&&u.upload(i)}this.updatePaintBuffers()},jt.prototype.destroy=function(){for(var i in this.binders){var s=this.binders[i];(s instanceof Bt||s instanceof Et||s instanceof Ot)&&s.destroy()}};var It=function(i,s,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var p=0,y=i;p<y.length;p+=1){var v=y[p];this.programConfigurations[v.id]=new jt(v,s,u)}this.needsUpload=!1,this._featureMap=new he,this._bufferOffset=0};function Ut(i,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(s+"-","").replace(/-/g,"_")]}function Mr(i,s,u){var p={color:{source:kc,composite:Of},number:{source:Ic,composite:kc}},y=function(v){return{"line-pattern":{source:Li,composite:Li},"fill-pattern":{source:Li,composite:Li},"fill-extrusion-pattern":{source:Li,composite:Li}}[v]}(i);return y&&y[u]||p[s][u]}It.prototype.populatePaintArrays=function(i,s,u,p,y,v){for(var b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(i,s,p,y,v);s.id!==void 0&&this._featureMap.add(s.id,u,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0},It.prototype.updatePaintArrays=function(i,s,u,p){for(var y=0,v=u;y<v.length;y+=1){var b=v[y];this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(i,this._featureMap,s,b,p)||this.needsUpload}},It.prototype.get=function(i){return this.programConfigurations[i]},It.prototype.upload=function(i){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(i);this.needsUpload=!1}},It.prototype.destroy=function(){for(var i in this.programConfigurations)this.programConfigurations[i].destroy()},ht("ConstantBinder",lt),ht("CrossFadedConstantBinder",Ft),ht("SourceExpressionBinder",Bt),ht("CrossFadedCompositeBinder",Ot),ht("CompositeExpressionBinder",Et),ht("ProgramConfiguration",jt,{omit:["_buffers"]}),ht("ProgramConfigurationSet",It);var Xn=Math.pow(2,14)-1,xi=-Xn-1;function Pn(i){for(var s=8192/i.extent,u=i.loadGeometry(),p=0;p<u.length;p++)for(var y=u[p],v=0;v<y.length;v++){var b=y[v],T=Math.round(b.x*s),I=Math.round(b.y*s);b.x=X(T,xi,Xn),b.y=X(I,xi,Xn),(T<b.x||T>b.x+1||I<b.y||I>b.y+1)&&Be("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function fr(i,s,u,p,y){i.emplaceBack(2*s+(p+1)/2,2*u+(y+1)/2)}var Zn=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new xu,this.indexArray=new Xo,this.segments=new V,this.programConfigurations=new It(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Ao(i,s){for(var u=0;u<i.length;u++)if(Jo(s,i[u]))return!0;for(var p=0;p<s.length;p++)if(Jo(i,s[p]))return!0;return!!uo(i,s)}function Ls(i,s,u){return!!Jo(i,s)||!!xl(s,i,u)}function Yo(i,s){if(i.length===1)return bl(s,i[0]);for(var u=0;u<s.length;u++)for(var p=s[u],y=0;y<p.length;y++)if(Jo(i,p[y]))return!0;for(var v=0;v<i.length;v++)if(bl(s,i[v]))return!0;for(var b=0;b<s.length;b++)if(uo(i,s[b]))return!0;return!1}function bi(i,s,u){if(i.length>1){if(uo(i,s))return!0;for(var p=0;p<s.length;p++)if(xl(s[p],i,u))return!0}for(var y=0;y<i.length;y++)if(xl(i[y],s,u))return!0;return!1}function uo(i,s){if(i.length===0||s.length===0)return!1;for(var u=0;u<i.length-1;u++)for(var p=i[u],y=i[u+1],v=0;v<s.length-1;v++)if(Ko(p,y,s[v],s[v+1]))return!0;return!1}function Ko(i,s,u,p){return He(i,u,p)!==He(s,u,p)&&He(i,s,u)!==He(i,s,p)}function xl(i,s,u){var p=u*u;if(s.length===1)return i.distSqr(s[0])<p;for(var y=1;y<s.length;y++)if(Za(i,s[y-1],s[y])<p)return!0;return!1}function Za(i,s,u){var p=s.distSqr(u);if(p===0)return i.distSqr(s);var y=((i.x-s.x)*(u.x-s.x)+(i.y-s.y)*(u.y-s.y))/p;return i.distSqr(y<0?s:y>1?u:u.sub(s)._mult(y)._add(s))}function bl(i,s){for(var u,p,y,v=!1,b=0;b<i.length;b++)for(var T=0,I=(u=i[b]).length-1;T<u.length;I=T++)(p=u[T]).y>s.y!=(y=u[I]).y>s.y&&s.x<(y.x-p.x)*(s.y-p.y)/(y.y-p.y)+p.x&&(v=!v);return v}function Jo(i,s){for(var u=!1,p=0,y=i.length-1;p<i.length;y=p++){var v=i[p],b=i[y];v.y>s.y!=b.y>s.y&&s.x<(b.x-v.x)*(s.y-v.y)/(b.y-v.y)+v.x&&(u=!u)}return u}function Tu(i,s,u){var p=u[0],y=u[2];if(i.x<p.x&&s.x<p.x||i.x>y.x&&s.x>y.x||i.y<p.y&&s.y<p.y||i.y>y.y&&s.y>y.y)return!1;var v=He(i,s,u[0]);return v!==He(i,s,u[1])||v!==He(i,s,u[2])||v!==He(i,s,u[3])}function $a(i,s,u){var p=s.paint.get(i).value;return p.kind==="constant"?p.value:u.programConfigurations.get(s.id).getMaxValue(i)}function ba(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function kr(i,s,u,p,y){if(!s[0]&&!s[1])return i;var v=E.convert(s)._mult(y);u==="viewport"&&v._rotate(-p);for(var b=[],T=0;T<i.length;T++)b.push(i[T].sub(v));return b}Zn.prototype.populate=function(i,s,u){var p=this.layers[0],y=[],v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(var b=0,T=i;b<T.length;b+=1){var I=T[b],M=I.feature,L=I.id,z=I.index,U=I.sourceLayerIndex,H=this.layers[0]._featureFilter.needGeometry,ee={type:M.type,id:L,properties:M.properties,geometry:H?Pn(M):[]};if(this.layers[0]._featureFilter.filter(new hn(this.zoom),ee,u)){H||(ee.geometry=Pn(M));var te=v?v.evaluate(ee,{},u):void 0;y.push({id:L,properties:M.properties,type:M.type,sourceLayerIndex:U,index:z,geometry:ee.geometry,patterns:{},sortKey:te})}}v&&y.sort(function($e,Qe){return $e.sortKey-Qe.sortKey});for(var pe=0,ce=y;pe<ce.length;pe+=1){var be=ce[pe],Se=be.geometry,Ie=be.index,Me=be.sourceLayerIndex,Ne=i[Ie].feature;this.addFeature(be,Se,Ie,u),s.featureIndex.insert(Ne,Se,Ie,Me,this.index)}},Zn.prototype.update=function(i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,u)},Zn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Zn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Zn.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,N),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},Zn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Zn.prototype.addFeature=function(i,s,u,p){for(var y=0,v=s;y<v.length;y+=1)for(var b=0,T=v[y];b<T.length;b+=1){var I=T[b],M=I.x,L=I.y;if(!(M<0||M>=8192||L<0||L>=8192)){var z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),U=z.vertexLength;fr(this.layoutVertexArray,M,L,-1,-1),fr(this.layoutVertexArray,M,L,1,-1),fr(this.layoutVertexArray,M,L,1,1),fr(this.layoutVertexArray,M,L,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+3,U+2),z.vertexLength+=4,z.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,{},p)},ht("CircleBucket",Zn,{omit:["layers"]});var wl=new hr({"circle-sort-key":new Ct(Z.layout_circle["circle-sort-key"])}),Lc={paint:new hr({"circle-radius":new Ct(Z.paint_circle["circle-radius"]),"circle-color":new Ct(Z.paint_circle["circle-color"]),"circle-blur":new Ct(Z.paint_circle["circle-blur"]),"circle-opacity":new Ct(Z.paint_circle["circle-opacity"]),"circle-translate":new gt(Z.paint_circle["circle-translate"]),"circle-translate-anchor":new gt(Z.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gt(Z.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gt(Z.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ct(Z.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ct(Z.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ct(Z.paint_circle["circle-stroke-opacity"])}),layout:wl},xr=typeof Float32Array<"u"?Float32Array:Array;function Rs(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function er(i,s,u){var p=s[0],y=s[1],v=s[2],b=s[3],T=s[4],I=s[5],M=s[6],L=s[7],z=s[8],U=s[9],H=s[10],ee=s[11],te=s[12],pe=s[13],ce=s[14],be=s[15],Se=u[0],Ie=u[1],Me=u[2],Ne=u[3];return i[0]=Se*p+Ie*T+Me*z+Ne*te,i[1]=Se*y+Ie*I+Me*U+Ne*pe,i[2]=Se*v+Ie*M+Me*H+Ne*ce,i[3]=Se*b+Ie*L+Me*ee+Ne*be,i[4]=(Se=u[4])*p+(Ie=u[5])*T+(Me=u[6])*z+(Ne=u[7])*te,i[5]=Se*y+Ie*I+Me*U+Ne*pe,i[6]=Se*v+Ie*M+Me*H+Ne*ce,i[7]=Se*b+Ie*L+Me*ee+Ne*be,i[8]=(Se=u[8])*p+(Ie=u[9])*T+(Me=u[10])*z+(Ne=u[11])*te,i[9]=Se*y+Ie*I+Me*U+Ne*pe,i[10]=Se*v+Ie*M+Me*H+Ne*ce,i[11]=Se*b+Ie*L+Me*ee+Ne*be,i[12]=(Se=u[12])*p+(Ie=u[13])*T+(Me=u[14])*z+(Ne=u[15])*te,i[13]=Se*y+Ie*I+Me*U+Ne*pe,i[14]=Se*v+Ie*M+Me*H+Ne*ce,i[15]=Se*b+Ie*L+Me*ee+Ne*be,i}Math.hypot||(Math.hypot=function(){for(var i=arguments,s=0,u=arguments.length;u--;)s+=i[u]*i[u];return Math.sqrt(s)});var Oi,zi=er;function Os(i,s,u){var p=s[0],y=s[1],v=s[2],b=s[3];return i[0]=u[0]*p+u[4]*y+u[8]*v+u[12]*b,i[1]=u[1]*p+u[5]*y+u[9]*v+u[13]*b,i[2]=u[2]*p+u[6]*y+u[10]*v+u[14]*b,i[3]=u[3]*p+u[7]*y+u[11]*v+u[15]*b,i}Oi=new xr(3),xr!=Float32Array&&(Oi[0]=0,Oi[1]=0,Oi[2]=0),function(){var i=new xr(4);xr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0)}();var _v=(function(){var i=new xr(2);xr!=Float32Array&&(i[0]=0,i[1]=0)}(),function(i){function s(u){i.call(this,u,Lc)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.createBucket=function(u){return new Zn(u)},s.prototype.queryRadius=function(u){var p=u;return $a("circle-radius",this,p)+$a("circle-stroke-width",this,p)+ba(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(u,p,y,v,b,T,I,M){for(var L=kr(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,I),z=this.paint.get("circle-radius").evaluate(p,y)+this.paint.get("circle-stroke-width").evaluate(p,y),U=this.paint.get("circle-pitch-alignment")==="map",H=U?L:function($e,Qe){return $e.map(function(pt){return rm(pt,Qe)})}(L,M),ee=U?z*I:z,te=0,pe=v;te<pe.length;te+=1)for(var ce=0,be=pe[te];ce<be.length;ce+=1){var Se=be[ce],Ie=U?Se:rm(Se,M),Me=ee,Ne=Os([],[Se.x,Se.y,0,1],M);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Me*=Ne[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Me*=T.cameraToCenterDistance/Ne[3]),Ls(H,Ie,Me))return!0}return!1},s}(ui));function rm(i,s){var u=Os([],[i.x,i.y,0,1],s);return new E(u[0]/u[3],u[1]/u[3])}var im=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Zn);function El(i,s,u,p){var y=s.width,v=s.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==y*v*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(y*v*u);return i.width=y,i.height=v,i.data=p,i}function om(i,s,u){var p=s.width,y=s.height;if(p!==i.width||y!==i.height){var v=El({},{width:p,height:y},u);Tl(i,v,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,p),height:Math.min(i.height,y)},u),i.width=p,i.height=y,i.data=v.data}}function Tl(i,s,u,p,y,v){if(y.width===0||y.height===0)return s;if(y.width>i.width||y.height>i.height||u.x>i.width-y.width||u.y>i.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>s.width||y.height>s.height||p.x>s.width-y.width||p.y>s.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var b=i.data,T=s.data,I=0;I<y.height;I++)for(var M=((u.y+I)*i.width+u.x)*v,L=((p.y+I)*s.width+p.x)*v,z=0;z<y.width*v;z++)T[L+z]=b[M+z];return s}ht("HeatmapBucket",im,{omit:["layers"]});var wa=function(i,s){El(this,i,1,s)};wa.prototype.resize=function(i){om(this,i,1)},wa.prototype.clone=function(){return new wa({width:this.width,height:this.height},new Uint8Array(this.data))},wa.copy=function(i,s,u,p,y){Tl(i,s,u,p,y,1)};var Di=function(i,s){El(this,i,4,s)};Di.prototype.resize=function(i){om(this,i,4)},Di.prototype.replace=function(i,s){s?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i},Di.prototype.clone=function(){return new Di({width:this.width,height:this.height},new Uint8Array(this.data))},Di.copy=function(i,s,u,p,y){Tl(i,s,u,p,y,4)},ht("AlphaImage",wa),ht("RGBAImage",Di);var YM={paint:new hr({"heatmap-radius":new Ct(Z.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ct(Z.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gt(Z.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vu(Z.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gt(Z.paint_heatmap["heatmap-opacity"])})};function bb(i,s){for(var u=new Uint8Array(1024),p={},y=0,v=0;y<256;y++,v+=4){p[s]=y/255;var b=i.evaluate(p);u[v+0]=Math.floor(255*b.r/b.a),u[v+1]=Math.floor(255*b.g/b.a),u[v+2]=Math.floor(255*b.b/b.a),u[v+3]=Math.floor(255*b.a)}return new Di({width:256,height:1},u)}var KM=function(i){function s(u){i.call(this,u,YM),this._updateColorRamp()}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.createBucket=function(u){return new im(u)},s.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=bb(this._transitionablePaint._values["heatmap-color"].value.expression,"heatmapDensity"),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(ui),JM={paint:new hr({"hillshade-illumination-direction":new gt(Z.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gt(Z.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gt(Z.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gt(Z.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gt(Z.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gt(Z.paint_hillshade["hillshade-accent-color"])})},QM=function(i){function s(u){i.call(this,u,JM)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(ui),ek=Jr([{name:"a_pos",components:2,type:"Int16"}],4).members,xv=am,tk=am;function am(i,s,u){u=u||2;var p,y,v,b,T,I,M,L=s&&s.length,z=L?s[0]*u:i.length,U=wb(i,0,z,u,!0),H=[];if(!U||U.next===U.prev)return H;if(L&&(U=function(te,pe,ce,be){var Se,Ie,Me,Ne=[];for(Se=0,Ie=pe.length;Se<Ie;Se++)(Me=wb(te,pe[Se]*be,Se<Ie-1?pe[Se+1]*be:te.length,be,!1))===Me.next&&(Me.steiner=!0),Ne.push(uk(Me));for(Ne.sort(ak),Se=0;Se<Ne.length;Se++)sk(Ne[Se],ce),ce=Sl(ce,ce.next);return ce}(i,s,U,u)),i.length>80*u){p=v=i[0],y=b=i[1];for(var ee=u;ee<z;ee+=u)(T=i[ee])<p&&(p=T),(I=i[ee+1])<y&&(y=I),T>v&&(v=T),I>b&&(b=I);M=(M=Math.max(v-p,b-y))!==0?1/M:0}return Df(U,H,u,p,y,M),H}function wb(i,s,u,p,y){var v,b;if(y===Ev(i,s,u,p)>0)for(v=s;v<u;v+=p)b=Sb(v,i[v],i[v+1],b);else for(v=u-p;v>=s;v-=p)b=Sb(v,i[v],i[v+1],b);return b&&sm(b,b.next)&&(Nf(b),b=b.next),b}function Sl(i,s){if(!i)return i;s||(s=i);var u,p=i;do if(u=!1,p.steiner||!sm(p,p.next)&&br(p.prev,p,p.next)!==0)p=p.next;else{if(Nf(p),(p=s=p.prev)===p.next)break;u=!0}while(u||p!==s);return s}function Df(i,s,u,p,y,v,b){if(i){!b&&v&&function(L,z,U,H){var ee=L;do ee.z===null&&(ee.z=bv(ee.x,ee.y,z,U,H)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next;while(ee!==L);ee.prevZ.nextZ=null,ee.prevZ=null,function(te){var pe,ce,be,Se,Ie,Me,Ne,$e,Qe=1;do{for(ce=te,te=null,Ie=null,Me=0;ce;){for(Me++,be=ce,Ne=0,pe=0;pe<Qe&&(Ne++,be=be.nextZ);pe++);for($e=Qe;Ne>0||$e>0&&be;)Ne!==0&&($e===0||!be||ce.z<=be.z)?(Se=ce,ce=ce.nextZ,Ne--):(Se=be,be=be.nextZ,$e--),Ie?Ie.nextZ=Se:te=Se,Se.prevZ=Ie,Ie=Se;ce=be}Ie.nextZ=null,Qe*=2}while(Me>1)}(ee)}(i,p,y,v);for(var T,I,M=i;i.prev!==i.next;)if(T=i.prev,I=i.next,v?rk(i,p,y,v):nk(i))s.push(T.i/u),s.push(i.i/u),s.push(I.i/u),Nf(i),i=I.next,M=I.next;else if((i=I)===M){b?b===1?Df(i=ik(Sl(i),s,u),s,u,p,y,v,2):b===2&&ok(i,s,u,p,y,v):Df(Sl(i),s,u,p,y,v,1);break}}}function nk(i){var s=i.prev,u=i,p=i.next;if(br(s,u,p)>=0)return!1;for(var y=i.next.next;y!==i.prev;){if(Rc(s.x,s.y,u.x,u.y,p.x,p.y,y.x,y.y)&&br(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function rk(i,s,u,p){var y=i.prev,v=i,b=i.next;if(br(y,v,b)>=0)return!1;for(var T=y.x>v.x?y.x>b.x?y.x:b.x:v.x>b.x?v.x:b.x,I=y.y>v.y?y.y>b.y?y.y:b.y:v.y>b.y?v.y:b.y,M=bv(y.x<v.x?y.x<b.x?y.x:b.x:v.x<b.x?v.x:b.x,y.y<v.y?y.y<b.y?y.y:b.y:v.y<b.y?v.y:b.y,s,u,p),L=bv(T,I,s,u,p),z=i.prevZ,U=i.nextZ;z&&z.z>=M&&U&&U.z<=L;){if(z!==i.prev&&z!==i.next&&Rc(y.x,y.y,v.x,v.y,b.x,b.y,z.x,z.y)&&br(z.prev,z,z.next)>=0||(z=z.prevZ,U!==i.prev&&U!==i.next&&Rc(y.x,y.y,v.x,v.y,b.x,b.y,U.x,U.y)&&br(U.prev,U,U.next)>=0))return!1;U=U.nextZ}for(;z&&z.z>=M;){if(z!==i.prev&&z!==i.next&&Rc(y.x,y.y,v.x,v.y,b.x,b.y,z.x,z.y)&&br(z.prev,z,z.next)>=0)return!1;z=z.prevZ}for(;U&&U.z<=L;){if(U!==i.prev&&U!==i.next&&Rc(y.x,y.y,v.x,v.y,b.x,b.y,U.x,U.y)&&br(U.prev,U,U.next)>=0)return!1;U=U.nextZ}return!0}function ik(i,s,u){var p=i;do{var y=p.prev,v=p.next.next;!sm(y,v)&&Eb(y,p,p.next,v)&&Ff(y,v)&&Ff(v,y)&&(s.push(y.i/u),s.push(p.i/u),s.push(v.i/u),Nf(p),Nf(p.next),p=i=v),p=p.next}while(p!==i);return Sl(p)}function ok(i,s,u,p,y,v){var b=i;do{for(var T=b.next.next;T!==b.prev;){if(b.i!==T.i&&ck(b,T)){var I=Tb(b,T);return b=Sl(b,b.next),I=Sl(I,I.next),Df(b,s,u,p,y,v),void Df(I,s,u,p,y,v)}T=T.next}b=b.next}while(b!==i)}function ak(i,s){return i.x-s.x}function sk(i,s){if(s=function(p,y){var v,b=y,T=p.x,I=p.y,M=-1/0;do{if(I<=b.y&&I>=b.next.y&&b.next.y!==b.y){var L=b.x+(I-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(L<=T&&L>M){if(M=L,L===T){if(I===b.y)return b;if(I===b.next.y)return b.next}v=b.x<b.next.x?b:b.next}}b=b.next}while(b!==y);if(!v)return null;if(T===M)return v;var z,U=v,H=v.x,ee=v.y,te=1/0;b=v;do T>=b.x&&b.x>=H&&T!==b.x&&Rc(I<ee?T:M,I,H,ee,I<ee?M:T,I,b.x,b.y)&&(z=Math.abs(I-b.y)/(T-b.x),Ff(b,p)&&(z<te||z===te&&(b.x>v.x||b.x===v.x&&lk(v,b)))&&(v=b,te=z)),b=b.next;while(b!==U);return v}(i,s)){var u=Tb(s,i);Sl(s,s.next),Sl(u,u.next)}}function lk(i,s){return br(i.prev,i,s.prev)<0&&br(s.next,i,i.next)<0}function bv(i,s,u,p,y){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-u)*y)|i<<8))|i<<4))|i<<2))|i<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-p)*y)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function uk(i){var s=i,u=i;do(s.x<u.x||s.x===u.x&&s.y<u.y)&&(u=s),s=s.next;while(s!==i);return u}function Rc(i,s,u,p,y,v,b,T){return(y-b)*(s-T)-(i-b)*(v-T)>=0&&(i-b)*(p-T)-(u-b)*(s-T)>=0&&(u-b)*(v-T)-(y-b)*(p-T)>=0}function ck(i,s){return i.next.i!==s.i&&i.prev.i!==s.i&&!function(u,p){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==p.i&&y.next.i!==p.i&&Eb(y,y.next,u,p))return!0;y=y.next}while(y!==u);return!1}(i,s)&&(Ff(i,s)&&Ff(s,i)&&function(u,p){var y=u,v=!1,b=(u.x+p.x)/2,T=(u.y+p.y)/2;do y.y>T!=y.next.y>T&&y.next.y!==y.y&&b<(y.next.x-y.x)*(T-y.y)/(y.next.y-y.y)+y.x&&(v=!v),y=y.next;while(y!==u);return v}(i,s)&&(br(i.prev,i,s.prev)||br(i,s.prev,s))||sm(i,s)&&br(i.prev,i,i.next)>0&&br(s.prev,s,s.next)>0)}function br(i,s,u){return(s.y-i.y)*(u.x-s.x)-(s.x-i.x)*(u.y-s.y)}function sm(i,s){return i.x===s.x&&i.y===s.y}function Eb(i,s,u,p){var y=um(br(i,s,u)),v=um(br(i,s,p)),b=um(br(u,p,i)),T=um(br(u,p,s));return y!==v&&b!==T||!(y!==0||!lm(i,u,s))||!(v!==0||!lm(i,p,s))||!(b!==0||!lm(u,i,p))||!(T!==0||!lm(u,s,p))}function lm(i,s,u){return s.x<=Math.max(i.x,u.x)&&s.x>=Math.min(i.x,u.x)&&s.y<=Math.max(i.y,u.y)&&s.y>=Math.min(i.y,u.y)}function um(i){return i>0?1:i<0?-1:0}function Ff(i,s){return br(i.prev,i,i.next)<0?br(i,s,i.next)>=0&&br(i,i.prev,s)>=0:br(i,s,i.prev)<0||br(i,i.next,s)<0}function Tb(i,s){var u=new wv(i.i,i.x,i.y),p=new wv(s.i,s.x,s.y),y=i.next,v=s.prev;return i.next=s,s.prev=i,u.next=y,y.prev=u,p.next=u,u.prev=p,v.next=p,p.prev=v,p}function Sb(i,s,u,p){var y=new wv(i,s,u);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function Nf(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function wv(i,s,u){this.i=i,this.x=s,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ev(i,s,u,p){for(var y=0,v=s,b=u-p;v<u;v+=p)y+=(i[b]-i[v])*(i[v+1]+i[b+1]),b=v;return y}function hk(i,s,u,p,y){(function v(b,T,I,M,L){for(;M>I;){if(M-I>600){var z=M-I+1,U=T-I+1,H=Math.log(z),ee=.5*Math.exp(2*H/3),te=.5*Math.sqrt(H*ee*(z-ee)/z)*(U-z/2<0?-1:1);v(b,T,Math.max(I,Math.floor(T-U*ee/z+te)),Math.min(M,Math.floor(T+(z-U)*ee/z+te)),L)}var pe=b[T],ce=I,be=M;for(Bf(b,I,T),L(b[M],pe)>0&&Bf(b,I,M);ce<be;){for(Bf(b,ce,be),ce++,be--;L(b[ce],pe)<0;)ce++;for(;L(b[be],pe)>0;)be--}L(b[I],pe)===0?Bf(b,I,be):Bf(b,++be,M),be<=T&&(I=be+1),T<=be&&(M=be-1)}})(i,s,u||0,p||i.length-1,y||fk)}function Bf(i,s,u){var p=i[s];i[s]=i[u],i[u]=p}function fk(i,s){return i<s?-1:i>s?1:0}function Tv(i,s){var u=i.length;if(u<=1)return[i];for(var p,y,v=[],b=0;b<u;b++){var T=We(i[b]);T!==0&&(i[b].area=Math.abs(T),y===void 0&&(y=T<0),y===T<0?(p&&v.push(p),p=[i[b]]):p.push(i[b]))}if(p&&v.push(p),s>1)for(var I=0;I<v.length;I++)v[I].length<=s||(hk(v[I],s,1,v[I].length-1,pk),v[I]=v[I].slice(0,s));return v}function pk(i,s){return s.area-i.area}function Sv(i,s,u){for(var p=u.patternDependencies,y=!1,v=0,b=s;v<b.length;v+=1){var T=b[v].paint.get(i+"-pattern");T.isConstant()||(y=!0);var I=T.constantOr(null);I&&(y=!0,p[I.to]=!0,p[I.from]=!0)}return y}function Pv(i,s,u,p,y){for(var v=y.patternDependencies,b=0,T=s;b<T.length;b+=1){var I=T[b],M=I.paint.get(i+"-pattern").value;if(M.kind!=="constant"){var L=M.evaluate({zoom:p-1},u,{},y.availableImages),z=M.evaluate({zoom:p},u,{},y.availableImages),U=M.evaluate({zoom:p+1},u,{},y.availableImages);z=z&&z.name?z.name:z,U=U&&U.name?U.name:U,v[L=L&&L.name?L.name:L]=!0,v[z]=!0,v[U]=!0,u.patterns[I.id]={min:L,mid:z,max:U}}}return u}am.deviation=function(i,s,u,p){var y=s&&s.length,v=Math.abs(Ev(i,0,y?s[0]*u:i.length,u));if(y)for(var b=0,T=s.length;b<T;b++)v-=Math.abs(Ev(i,s[b]*u,b<T-1?s[b+1]*u:i.length,u));var I=0;for(b=0;b<p.length;b+=3){var M=p[b]*u,L=p[b+1]*u,z=p[b+2]*u;I+=Math.abs((i[M]-i[z])*(i[L+1]-i[M+1])-(i[M]-i[L])*(i[z+1]-i[M+1]))}return v===0&&I===0?0:Math.abs((I-v)/v)},am.flatten=function(i){for(var s=i[0][0].length,u={vertices:[],holes:[],dimensions:s},p=0,y=0;y<i.length;y++){for(var v=0;v<i[y].length;v++)for(var b=0;b<s;b++)u.vertices.push(i[y][v][b]);y>0&&u.holes.push(p+=i[y-1].length)}return u},xv.default=tk;var Ea=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xu,this.indexArray=new Xo,this.indexArray2=new xa,this.programConfigurations=new It(i.layers,i.zoom),this.segments=new V,this.segments2=new V,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};Ea.prototype.populate=function(i,s,u){this.hasPattern=Sv("fill",this.layers,s);for(var p=this.layers[0].layout.get("fill-sort-key"),y=[],v=0,b=i;v<b.length;v+=1){var T=b[v],I=T.feature,M=T.id,L=T.index,z=T.sourceLayerIndex,U=this.layers[0]._featureFilter.needGeometry,H={type:I.type,id:M,properties:I.properties,geometry:U?Pn(I):[]};if(this.layers[0]._featureFilter.filter(new hn(this.zoom),H,u)){U||(H.geometry=Pn(I));var ee=p?p.evaluate(H,{},u,s.availableImages):void 0;y.push({id:M,properties:I.properties,type:I.type,sourceLayerIndex:z,index:L,geometry:H.geometry,patterns:{},sortKey:ee})}}p&&y.sort(function(Ne,$e){return Ne.sortKey-$e.sortKey});for(var te=0,pe=y;te<pe.length;te+=1){var ce=pe[te],be=ce.geometry,Se=ce.index,Ie=ce.sourceLayerIndex;if(this.hasPattern){var Me=Pv("fill",this.layers,ce,this.zoom,s);this.patternFeatures.push(Me)}else this.addFeature(ce,be,Se,u,{});s.featureIndex.insert(i[Se].feature,be,Se,Ie,this.index)}},Ea.prototype.update=function(i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,u)},Ea.prototype.addFeatures=function(i,s,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var v=y[p];this.addFeature(v,v.geometry,v.index,s,u)}},Ea.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ea.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ea.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ek),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0},Ea.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ea.prototype.addFeature=function(i,s,u,p,y){for(var v=0,b=Tv(s,500);v<b.length;v+=1){for(var T=b[v],I=0,M=0,L=T;M<L.length;M+=1)I+=L[M].length;for(var z=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),U=z.vertexLength,H=[],ee=[],te=0,pe=T;te<pe.length;te+=1){var ce=pe[te];if(ce.length!==0){ce!==T[0]&&ee.push(H.length/2);var be=this.segments2.prepareSegment(ce.length,this.layoutVertexArray,this.indexArray2),Se=be.vertexLength;this.layoutVertexArray.emplaceBack(ce[0].x,ce[0].y),this.indexArray2.emplaceBack(Se+ce.length-1,Se),H.push(ce[0].x),H.push(ce[0].y);for(var Ie=1;Ie<ce.length;Ie++)this.layoutVertexArray.emplaceBack(ce[Ie].x,ce[Ie].y),this.indexArray2.emplaceBack(Se+Ie-1,Se+Ie),H.push(ce[Ie].x),H.push(ce[Ie].y);be.vertexLength+=ce.length,be.primitiveLength+=ce.length}}for(var Me=xv(H,ee),Ne=0;Ne<Me.length;Ne+=3)this.indexArray.emplaceBack(U+Me[Ne],U+Me[Ne+1],U+Me[Ne+2]);z.vertexLength+=I,z.primitiveLength+=Me.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,y,p)},ht("FillBucket",Ea,{omit:["layers","patternFeatures"]});var dk=new hr({"fill-sort-key":new Ct(Z.layout_fill["fill-sort-key"])}),mk={paint:new hr({"fill-antialias":new gt(Z.paint_fill["fill-antialias"]),"fill-opacity":new Ct(Z.paint_fill["fill-opacity"]),"fill-color":new Ct(Z.paint_fill["fill-color"]),"fill-outline-color":new Ct(Z.paint_fill["fill-outline-color"]),"fill-translate":new gt(Z.paint_fill["fill-translate"]),"fill-translate-anchor":new gt(Z.paint_fill["fill-translate-anchor"]),"fill-pattern":new _l(Z.paint_fill["fill-pattern"])}),layout:dk},gk=function(i){function s(u){i.call(this,u,mk)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.recalculate=function(u,p){i.prototype.recalculate.call(this,u,p);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(u){return new Ea(u)},s.prototype.queryRadius=function(){return ba(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(u,p,y,v,b,T,I){return Yo(kr(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,I),v)},s.prototype.isTileClipped=function(){return!0},s}(ui),yk=Jr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Pb=Oc;function Oc(i,s,u,p,y){this.properties={},this.extent=u,this.type=0,this._pbf=i,this._geometry=-1,this._keys=p,this._values=y,i.readFields(vk,this,s)}function vk(i,s,u){i==1?s.id=u.readVarint():i==2?function(p,y){for(var v=p.readVarint()+p.pos;p.pos<v;){var b=y._keys[p.readVarint()],T=y._values[p.readVarint()];y.properties[b]=T}}(u,s):i==3?s.type=u.readVarint():i==4&&(s._geometry=u.pos)}function _k(i){for(var s,u,p=0,y=0,v=i.length,b=v-1;y<v;b=y++)p+=((u=i[b]).x-(s=i[y]).x)*(s.y+u.y);return p}Oc.types=["Unknown","Point","LineString","Polygon"],Oc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var s,u=i.readVarint()+i.pos,p=1,y=0,v=0,b=0,T=[];i.pos<u;){if(y<=0){var I=i.readVarint();p=7&I,y=I>>3}if(y--,p===1||p===2)v+=i.readSVarint(),b+=i.readSVarint(),p===1&&(s&&T.push(s),s=[]),s.push(new E(v,b));else{if(p!==7)throw new Error("unknown command "+p);s&&s.push(s[0].clone())}}return s&&T.push(s),T},Oc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var s=i.readVarint()+i.pos,u=1,p=0,y=0,v=0,b=1/0,T=-1/0,I=1/0,M=-1/0;i.pos<s;){if(p<=0){var L=i.readVarint();u=7&L,p=L>>3}if(p--,u===1||u===2)(y+=i.readSVarint())<b&&(b=y),y>T&&(T=y),(v+=i.readSVarint())<I&&(I=v),v>M&&(M=v);else if(u!==7)throw new Error("unknown command "+u)}return[b,I,T,M]},Oc.prototype.toGeoJSON=function(i,s,u){var p,y,v=this.extent*Math.pow(2,u),b=this.extent*i,T=this.extent*s,I=this.loadGeometry(),M=Oc.types[this.type];function L(H){for(var ee=0;ee<H.length;ee++){var te=H[ee];H[ee]=[360*(te.x+b)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(te.y+T)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(p=0;p<I.length;p++)z[p]=I[p][0];L(I=z);break;case 2:for(p=0;p<I.length;p++)L(I[p]);break;case 3:for(I=function(H){var ee=H.length;if(ee<=1)return[H];for(var te,pe,ce=[],be=0;be<ee;be++){var Se=_k(H[be]);Se!==0&&(pe===void 0&&(pe=Se<0),pe===Se<0?(te&&ce.push(te),te=[H[be]]):te.push(H[be]))}return te&&ce.push(te),ce}(I),p=0;p<I.length;p++)for(y=0;y<I[p].length;y++)L(I[p][y])}I.length===1?I=I[0]:M="Multi"+M;var U={type:"Feature",geometry:{type:M,coordinates:I},properties:this.properties};return"id"in this&&(U.id=this.id),U};var Ab=Cb;function Cb(i,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(xk,this,s),this.length=this._features.length}function xk(i,s,u){i===15?s.version=u.readVarint():i===1?s.name=u.readString():i===5?s.extent=u.readVarint():i===2?s._features.push(u.pos):i===3?s._keys.push(u.readString()):i===4&&s._values.push(function(p){for(var y=null,v=p.readVarint()+p.pos;p.pos<v;){var b=p.readVarint()>>3;y=b===1?p.readString():b===2?p.readFloat():b===3?p.readDouble():b===4?p.readVarint64():b===5?p.readVarint():b===6?p.readSVarint():b===7?p.readBoolean():null}return y}(u))}function bk(i,s,u){if(i===3){var p=new Ab(u,u.readVarint()+u.pos);p.length&&(s[p.name]=p)}}Cb.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var s=this._pbf.readVarint()+this._pbf.pos;return new Pb(this._pbf,s,this.extent,this._keys,this._values)};var zc={VectorTile:function(i,s){this.layers=i.readFields(bk,{},s)},VectorTileFeature:Pb,VectorTileLayer:Ab},wk=zc.VectorTileFeature.types,Av=Math.pow(2,13);function Uf(i,s,u,p,y,v,b,T){i.emplaceBack(s,u,2*Math.floor(p*Av)+b,y*Av*2,v*Av*2,Math.round(T))}var Ta=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new bu,this.indexArray=new Xo,this.programConfigurations=new It(i.layers,i.zoom),this.segments=new V,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Ek(i,s){return i.x===s.x&&(i.x<0||i.x>8192)||i.y===s.y&&(i.y<0||i.y>8192)}Ta.prototype.populate=function(i,s,u){this.features=[],this.hasPattern=Sv("fill-extrusion",this.layers,s);for(var p=0,y=i;p<y.length;p+=1){var v=y[p],b=v.feature,T=v.id,I=v.index,M=v.sourceLayerIndex,L=this.layers[0]._featureFilter.needGeometry,z={type:b.type,id:T,properties:b.properties,geometry:L?Pn(b):[]};if(this.layers[0]._featureFilter.filter(new hn(this.zoom),z,u)){var U={id:T,sourceLayerIndex:M,index:I,geometry:L?z.geometry:Pn(b),properties:b.properties,type:b.type,patterns:{}};b.id!==void 0&&(U.id=b.id),this.hasPattern?this.features.push(Pv("fill-extrusion",this.layers,U,this.zoom,s)):this.addFeature(U,U.geometry,I,u,{}),s.featureIndex.insert(b,U.geometry,I,M,this.index,!0)}}},Ta.prototype.addFeatures=function(i,s,u){for(var p=0,y=this.features;p<y.length;p+=1){var v=y[p];this.addFeature(v,v.geometry,v.index,s,u)}},Ta.prototype.update=function(i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,u)},Ta.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ta.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ta.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,yk),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},Ta.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ta.prototype.addFeature=function(i,s,u,p,y){for(var v=0,b=Tv(s,500);v<b.length;v+=1){for(var T=b[v],I=0,M=0,L=T;M<L.length;M+=1)I+=L[M].length;for(var z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),U=0,H=T;U<H.length;U+=1){var ee=H[U];if(ee.length!==0&&!((Xt=ee).every(function(Dt){return Dt.x<0})||Xt.every(function(Dt){return Dt.x>8192})||Xt.every(function(Dt){return Dt.y<0})||Xt.every(function(Dt){return Dt.y>8192})))for(var te=0,pe=0;pe<ee.length;pe++){var ce=ee[pe];if(pe>=1){var be=ee[pe-1];if(!Ek(ce,be)){z.vertexLength+4>V.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Se=ce.sub(be)._perp()._unit(),Ie=be.dist(ce);te+Ie>32768&&(te=0),Uf(this.layoutVertexArray,ce.x,ce.y,Se.x,Se.y,0,0,te),Uf(this.layoutVertexArray,ce.x,ce.y,Se.x,Se.y,0,1,te),Uf(this.layoutVertexArray,be.x,be.y,Se.x,Se.y,0,0,te+=Ie),Uf(this.layoutVertexArray,be.x,be.y,Se.x,Se.y,0,1,te);var Me=z.vertexLength;this.indexArray.emplaceBack(Me,Me+2,Me+1),this.indexArray.emplaceBack(Me+1,Me+2,Me+3),z.vertexLength+=4,z.primitiveLength+=2}}}}if(z.vertexLength+I>V.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),wk[i.type]==="Polygon"){for(var Ne=[],$e=[],Qe=z.vertexLength,pt=0,at=T;pt<at.length;pt+=1){var vt=at[pt];if(vt.length!==0){vt!==T[0]&&$e.push(Ne.length/2);for(var it=0;it<vt.length;it++){var Gt=vt[it];Uf(this.layoutVertexArray,Gt.x,Gt.y,0,0,1,1,0),Ne.push(Gt.x),Ne.push(Gt.y)}}}for(var St=xv(Ne,$e),ut=0;ut<St.length;ut+=3)this.indexArray.emplaceBack(Qe+St[ut],Qe+St[ut+2],Qe+St[ut+1]);z.primitiveLength+=St.length/3,z.vertexLength+=I}}var Xt;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,y,p)},ht("FillExtrusionBucket",Ta,{omit:["layers","features"]});var Tk={paint:new hr({"fill-extrusion-opacity":new gt(Z["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ct(Z["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gt(Z["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gt(Z["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _l(Z["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ct(Z["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ct(Z["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gt(Z["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Sk=function(i){function s(u){i.call(this,u,Tk)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.createBucket=function(u){return new Ta(u)},s.prototype.queryRadius=function(){return ba(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(u,p,y,v,b,T,I,M){var L=kr(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,I),z=this.paint.get("fill-extrusion-height").evaluate(p,y),U=this.paint.get("fill-extrusion-base").evaluate(p,y),H=function(te,pe,ce,be){for(var Se=[],Ie=0,Me=te;Ie<Me.length;Ie+=1){var Ne=Me[Ie],$e=[Ne.x,Ne.y,0,1];Os($e,$e,pe),Se.push(new E($e[0]/$e[3],$e[1]/$e[3]))}return Se}(L,M),ee=function(te,pe,ce,be){for(var Se=[],Ie=[],Me=be[8]*pe,Ne=be[9]*pe,$e=be[10]*pe,Qe=be[11]*pe,pt=be[8]*ce,at=be[9]*ce,vt=be[10]*ce,it=be[11]*ce,Gt=0,St=te;Gt<St.length;Gt+=1){for(var ut=[],Xt=[],Dt=0,on=St[Gt];Dt<on.length;Dt+=1){var dt=on[Dt],un=dt.x,Rn=dt.y,Lr=be[0]*un+be[4]*Rn+be[12],Rr=be[1]*un+be[5]*Rn+be[13],On=be[2]*un+be[6]*Rn+be[14],pr=be[3]*un+be[7]*Rn+be[15],zn=On+$e,Tr=pr+Qe,hi=Lr+pt,Gr=Rr+at,wi=On+vt,Sr=pr+it,Pr=new E((Lr+Me)/Tr,(Rr+Ne)/Tr);Pr.z=zn/Tr,ut.push(Pr);var Kt=new E(hi/Sr,Gr/Sr);Kt.z=wi/Sr,Xt.push(Kt)}Se.push(ut),Ie.push(Xt)}return[Se,Ie]}(v,U,z,M);return function(te,pe,ce){var be=1/0;Yo(ce,pe)&&(be=Ib(ce,pe[0]));for(var Se=0;Se<pe.length;Se++)for(var Ie=pe[Se],Me=te[Se],Ne=0;Ne<Ie.length-1;Ne++){var $e=Ie[Ne],Qe=[$e,Ie[Ne+1],Me[Ne+1],Me[Ne],$e];Ao(ce,Qe)&&(be=Math.min(be,Ib(ce,Qe)))}return be!==1/0&&be}(ee[0],ee[1],H)},s}(ui);function Vf(i,s){return i.x*s.x+i.y*s.y}function Ib(i,s){if(i.length===1){for(var u,p=0,y=s[p++];!u||y.equals(u);)if(!(u=s[p++]))return 1/0;for(;p<s.length;p++){var v=s[p],b=i[0],T=u.sub(y),I=v.sub(y),M=b.sub(y),L=Vf(T,T),z=Vf(T,I),U=Vf(I,I),H=Vf(M,T),ee=Vf(M,I),te=L*U-z*z,pe=(U*H-z*ee)/te,ce=(L*ee-z*H)/te,be=y.z*(1-pe-ce)+u.z*pe+v.z*ce;if(isFinite(be))return be}return 1/0}for(var Se=1/0,Ie=0,Me=s;Ie<Me.length;Ie+=1)Se=Math.min(Se,Me[Ie].z);return Se}var Pk=Jr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ak=zc.VectorTileFeature.types,Ck=Math.cos(Math.PI/180*37.5),Mb=Math.pow(2,14)/.5,Fi=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new kf,this.indexArray=new Xo,this.programConfigurations=new It(i.layers,i.zoom),this.segments=new V,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};Fi.prototype.populate=function(i,s,u){this.hasPattern=Sv("line",this.layers,s);for(var p=this.layers[0].layout.get("line-sort-key"),y=[],v=0,b=i;v<b.length;v+=1){var T=b[v],I=T.feature,M=T.id,L=T.index,z=T.sourceLayerIndex,U=this.layers[0]._featureFilter.needGeometry,H={type:I.type,id:M,properties:I.properties,geometry:U?Pn(I):[]};if(this.layers[0]._featureFilter.filter(new hn(this.zoom),H,u)){U||(H.geometry=Pn(I));var ee=p?p.evaluate(H,{},u):void 0;y.push({id:M,properties:I.properties,type:I.type,sourceLayerIndex:z,index:L,geometry:H.geometry,patterns:{},sortKey:ee})}}p&&y.sort(function(Ne,$e){return Ne.sortKey-$e.sortKey});for(var te=0,pe=y;te<pe.length;te+=1){var ce=pe[te],be=ce.geometry,Se=ce.index,Ie=ce.sourceLayerIndex;if(this.hasPattern){var Me=Pv("line",this.layers,ce,this.zoom,s);this.patternFeatures.push(Me)}else this.addFeature(ce,be,Se,u,{});s.featureIndex.insert(i[Se].feature,be,Se,Ie,this.index)}},Fi.prototype.update=function(i,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,u)},Fi.prototype.addFeatures=function(i,s,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var v=y[p];this.addFeature(v,v.geometry,v.index,s,u)}},Fi.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Fi.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Fi.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Pk),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},Fi.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Fi.prototype.addFeature=function(i,s,u,p,y){for(var v=this.layers[0].layout,b=v.get("line-join").evaluate(i,{}),T=v.get("line-cap"),I=v.get("line-miter-limit"),M=v.get("line-round-limit"),L=0,z=s;L<z.length;L+=1)this.addLine(z[L],i,b,T,I,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,y,p)},Fi.prototype.addLine=function(i,s,u,p,y,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,s.properties&&s.properties.hasOwnProperty("mapbox_clip_start")&&s.properties.hasOwnProperty("mapbox_clip_end")){this.clipStart=+s.properties.mapbox_clip_start,this.clipEnd=+s.properties.mapbox_clip_end;for(var b=0;b<i.length-1;b++)this.totalDistance+=i[b].dist(i[b+1]);this.updateScaledDistance()}for(var T=Ak[s.type]==="Polygon",I=i.length;I>=2&&i[I-1].equals(i[I-2]);)I--;for(var M=0;M<I-1&&i[M].equals(i[M+1]);)M++;if(!(I<(T?3:2))){u==="bevel"&&(y=1.05);var L,z=this.overscaling<=16?122880/(512*this.overscaling):0,U=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray),H=void 0,ee=void 0,te=void 0,pe=void 0;this.e1=this.e2=-1,T&&(pe=i[M].sub(L=i[I-2])._unit()._perp());for(var ce=M;ce<I;ce++)if(!(ee=ce===I-1?T?i[M+1]:void 0:i[ce+1])||!i[ce].equals(ee)){pe&&(te=pe),L&&(H=L),L=i[ce],pe=ee?ee.sub(L)._unit()._perp():te;var be=(te=te||pe).add(pe);be.x===0&&be.y===0||be._unit();var Se=te.x*pe.x+te.y*pe.y,Ie=be.x*pe.x+be.y*pe.y,Me=Ie!==0?1/Ie:1/0,Ne=2*Math.sqrt(2-2*Ie),$e=Ie<Ck&&H&&ee,Qe=te.x*pe.y-te.y*pe.x>0;if($e&&ce>M){var pt=L.dist(H);if(pt>2*z){var at=L.sub(L.sub(H)._mult(z/pt)._round());this.updateDistance(H,at),this.addCurrentVertex(at,te,0,0,U),H=at}}var vt=H&&ee,it=vt?u:T?"butt":p;if(vt&&it==="round"&&(Me<v?it="miter":Me<=2&&(it="fakeround")),it==="miter"&&Me>y&&(it="bevel"),it==="bevel"&&(Me>2&&(it="flipbevel"),Me<y&&(it="miter")),H&&this.updateDistance(H,L),it==="miter")be._mult(Me),this.addCurrentVertex(L,be,0,0,U);else if(it==="flipbevel"){if(Me>100)be=pe.mult(-1);else{var Gt=Me*te.add(pe).mag()/te.sub(pe).mag();be._perp()._mult(Gt*(Qe?-1:1))}this.addCurrentVertex(L,be,0,0,U),this.addCurrentVertex(L,be.mult(-1),0,0,U)}else if(it==="bevel"||it==="fakeround"){var St=-Math.sqrt(Me*Me-1),ut=Qe?St:0,Xt=Qe?0:St;if(H&&this.addCurrentVertex(L,te,ut,Xt,U),it==="fakeround")for(var Dt=Math.round(180*Ne/Math.PI/20),on=1;on<Dt;on++){var dt=on/Dt;if(dt!==.5){var un=dt-.5;dt+=dt*un*(dt-1)*((1.0904+Se*(Se*(3.55645-1.43519*Se)-3.2452))*un*un+(.848013+Se*(.215638*Se-1.06021)))}var Rn=pe.sub(te)._mult(dt)._add(te)._unit()._mult(Qe?-1:1);this.addHalfVertex(L,Rn.x,Rn.y,!1,Qe,0,U)}ee&&this.addCurrentVertex(L,pe,-ut,-Xt,U)}else if(it==="butt")this.addCurrentVertex(L,be,0,0,U);else if(it==="square"){var Lr=H?1:-1;this.addCurrentVertex(L,be,Lr,Lr,U)}else it==="round"&&(H&&(this.addCurrentVertex(L,te,0,0,U),this.addCurrentVertex(L,te,1,1,U,!0)),ee&&(this.addCurrentVertex(L,pe,-1,-1,U,!0),this.addCurrentVertex(L,pe,0,0,U)));if($e&&ce<I-1){var Rr=L.dist(ee);if(Rr>2*z){var On=L.add(ee.sub(L)._mult(z/Rr)._round());this.updateDistance(L,On),this.addCurrentVertex(On,pe,0,0,U),L=On}}}}},Fi.prototype.addCurrentVertex=function(i,s,u,p,y,v){v===void 0&&(v=!1);var b=s.y*p-s.x,T=-s.y-s.x*p;this.addHalfVertex(i,s.x+s.y*u,s.y-s.x*u,v,!1,u,y),this.addHalfVertex(i,b,T,v,!0,-p,y),this.distance>Mb/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(i,s,u,p,y,v))},Fi.prototype.addHalfVertex=function(i,s,u,p,y,v,b){var T=.5*this.scaledDistance;this.layoutVertexArray.emplaceBack((i.x<<1)+(p?1:0),(i.y<<1)+(y?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1)|(63&T)<<2,T>>6);var I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),y?this.e2=I:this.e1=I},Fi.prototype.updateScaledDistance=function(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(Mb-1):this.distance},Fi.prototype.updateDistance=function(i,s){this.distance+=i.dist(s),this.updateScaledDistance()},ht("LineBucket",Fi,{omit:["layers","patternFeatures"]});var Ik=new hr({"line-cap":new gt(Z.layout_line["line-cap"]),"line-join":new Ct(Z.layout_line["line-join"]),"line-miter-limit":new gt(Z.layout_line["line-miter-limit"]),"line-round-limit":new gt(Z.layout_line["line-round-limit"]),"line-sort-key":new Ct(Z.layout_line["line-sort-key"])}),kb={paint:new hr({"line-opacity":new Ct(Z.paint_line["line-opacity"]),"line-color":new Ct(Z.paint_line["line-color"]),"line-translate":new gt(Z.paint_line["line-translate"]),"line-translate-anchor":new gt(Z.paint_line["line-translate-anchor"]),"line-width":new Ct(Z.paint_line["line-width"]),"line-gap-width":new Ct(Z.paint_line["line-gap-width"]),"line-offset":new Ct(Z.paint_line["line-offset"]),"line-blur":new Ct(Z.paint_line["line-blur"]),"line-dasharray":new Qn(Z.paint_line["line-dasharray"]),"line-pattern":new _l(Z.paint_line["line-pattern"]),"line-gradient":new vu(Z.paint_line["line-gradient"])}),layout:Ik},Lb=new(function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(u,p){return p=new hn(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),i.prototype.possiblyEvaluate.call(this,u,p)},s.prototype.evaluate=function(u,p,y,v){return p=F({},p,{zoom:Math.floor(p.zoom)}),i.prototype.evaluate.call(this,u,p,y,v)},s}(Ct))(kb.paint.properties["line-width"].specification);Lb.useIntegerZoom=!0;var Mk=function(i){function s(u){i.call(this,u,kb)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&this._updateGradient()},s.prototype._updateGradient=function(){this.gradient=bb(this._transitionablePaint._values["line-gradient"].value.expression,"lineProgress"),this.gradientTexture=null},s.prototype.recalculate=function(u,p){i.prototype.recalculate.call(this,u,p),this.paint._values["line-floorwidth"]=Lb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},s.prototype.createBucket=function(u){return new Fi(u)},s.prototype.queryRadius=function(u){var p=u,y=Rb($a("line-width",this,p),$a("line-gap-width",this,p)),v=$a("line-offset",this,p);return y/2+Math.abs(v)+ba(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(u,p,y,v,b,T,I){var M=kr(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,I),L=I/2*Rb(this.paint.get("line-width").evaluate(p,y),this.paint.get("line-gap-width").evaluate(p,y)),z=this.paint.get("line-offset").evaluate(p,y);return z&&(v=function(U,H){for(var ee=[],te=new E(0,0),pe=0;pe<U.length;pe++){for(var ce=U[pe],be=[],Se=0;Se<ce.length;Se++){var Ie=ce[Se],Me=ce[Se+1],Ne=Se===0?te:Ie.sub(ce[Se-1])._unit()._perp(),$e=Se===ce.length-1?te:Me.sub(Ie)._unit()._perp(),Qe=Ne._add($e)._unit();Qe._mult(1/(Qe.x*$e.x+Qe.y*$e.y)),be.push(Qe._mult(H)._add(Ie))}ee.push(be)}return ee}(v,z*I)),function(U,H,ee){for(var te=0;te<H.length;te++){var pe=H[te];if(U.length>=3){for(var ce=0;ce<pe.length;ce++)if(Jo(U,pe[ce]))return!0}if(bi(U,pe,ee))return!0}return!1}(M,v,L)},s.prototype.isTileClipped=function(){return!0},s}(ui);function Rb(i,s){return s>0?s+2*i:i}var kk=Jr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Lk=Jr([{name:"a_projected_pos",components:3,type:"Float32"}],4),Rk=(Jr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Jr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Ob=(Jr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Jr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ok=Jr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function zk(i,s,u){return i.sections.forEach(function(p){p.text=function(y,v,b){var T=v.layout.get("text-transform").evaluate(b,{});return T==="uppercase"?y=y.toLocaleUpperCase():T==="lowercase"&&(y=y.toLocaleLowerCase()),Xi.applyArabicShaping&&(y=Xi.applyArabicShaping(y)),y}(p.text,s,u)}),i}Jr([{name:"triangle",components:3,type:"Uint16"}]),Jr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Jr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Jr([{type:"Float32",name:"offsetX"}]),Jr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var jf={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},zb=function(i,s,u,p,y){var v,b,T=8*y-p-1,I=(1<<T)-1,M=I>>1,L=-7,z=u?y-1:0,U=u?-1:1,H=i[s+z];for(z+=U,v=H&(1<<-L)-1,H>>=-L,L+=T;L>0;v=256*v+i[s+z],z+=U,L-=8);for(b=v&(1<<-L)-1,v>>=-L,L+=p;L>0;b=256*b+i[s+z],z+=U,L-=8);if(v===0)v=1-M;else{if(v===I)return b?NaN:1/0*(H?-1:1);b+=Math.pow(2,p),v-=M}return(H?-1:1)*b*Math.pow(2,v-p)},Db=function(i,s,u,p,y,v){var b,T,I,M=8*v-y-1,L=(1<<M)-1,z=L>>1,U=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=p?0:v-1,ee=p?1:-1,te=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(T=isNaN(s)?1:0,b=L):(b=Math.floor(Math.log(s)/Math.LN2),s*(I=Math.pow(2,-b))<1&&(b--,I*=2),(s+=b+z>=1?U/I:U*Math.pow(2,1-z))*I>=2&&(b++,I/=2),b+z>=L?(T=0,b=L):b+z>=1?(T=(s*I-1)*Math.pow(2,y),b+=z):(T=s*Math.pow(2,z-1)*Math.pow(2,y),b=0));y>=8;i[u+H]=255&T,H+=ee,T/=256,y-=8);for(b=b<<y|T,M+=y;M>0;i[u+H]=255&b,H+=ee,b/=256,M-=8);i[u+H-ee]|=128*te},cm=In;function In(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}In.Varint=0,In.Fixed64=1,In.Bytes=2,In.Fixed32=5;var Fb=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function zs(i){return i.type===In.Bytes?i.readVarint()+i.pos:i.pos+1}function Dc(i,s,u){return u?4294967296*s+(i>>>0):4294967296*(s>>>0)+(i>>>0)}function Nb(i,s,u){var p=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));u.realloc(p);for(var y=u.pos-1;y>=i;y--)u.buf[y+p]=u.buf[y]}function Dk(i,s){for(var u=0;u<i.length;u++)s.writeVarint(i[u])}function Fk(i,s){for(var u=0;u<i.length;u++)s.writeSVarint(i[u])}function Nk(i,s){for(var u=0;u<i.length;u++)s.writeFloat(i[u])}function Bk(i,s){for(var u=0;u<i.length;u++)s.writeDouble(i[u])}function Uk(i,s){for(var u=0;u<i.length;u++)s.writeBoolean(i[u])}function Vk(i,s){for(var u=0;u<i.length;u++)s.writeFixed32(i[u])}function jk(i,s){for(var u=0;u<i.length;u++)s.writeSFixed32(i[u])}function Gk(i,s){for(var u=0;u<i.length;u++)s.writeFixed64(i[u])}function Wk(i,s){for(var u=0;u<i.length;u++)s.writeSFixed64(i[u])}function hm(i,s){return(i[s]|i[s+1]<<8|i[s+2]<<16)+16777216*i[s+3]}function Fc(i,s,u){i[u]=s,i[u+1]=s>>>8,i[u+2]=s>>>16,i[u+3]=s>>>24}function Bb(i,s){return(i[s]|i[s+1]<<8|i[s+2]<<16)+(i[s+3]<<24)}function Hk(i,s,u){i===1&&u.readMessage(qk,s)}function qk(i,s,u){if(i===3){var p=u.readMessage(Zk,{}),y=p.width,v=p.height,b=p.left,T=p.top,I=p.advance;s.push({id:p.id,bitmap:new wa({width:y+6,height:v+6},p.bitmap),metrics:{width:y,height:v,left:b,top:T,advance:I}})}}function Zk(i,s,u){i===1?s.id=u.readVarint():i===2?s.bitmap=u.readBytes():i===3?s.width=u.readVarint():i===4?s.height=u.readVarint():i===5?s.left=u.readSVarint():i===6?s.top=u.readSVarint():i===7&&(s.advance=u.readVarint())}function Ub(i){for(var s=0,u=0,p=0,y=i;p<y.length;p+=1){var v=y[p];s+=v.w*v.h,u=Math.max(u,v.w)}i.sort(function(te,pe){return pe.h-te.h});for(var b=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),u),h:1/0}],T=0,I=0,M=0,L=i;M<L.length;M+=1)for(var z=L[M],U=b.length-1;U>=0;U--){var H=b[U];if(!(z.w>H.w||z.h>H.h)){if(z.x=H.x,z.y=H.y,I=Math.max(I,z.y+z.h),T=Math.max(T,z.x+z.w),z.w===H.w&&z.h===H.h){var ee=b.pop();U<b.length&&(b[U]=ee)}else z.h===H.h?(H.x+=z.w,H.w-=z.w):z.w===H.w?(H.y+=z.h,H.h-=z.h):(b.push({x:H.x+z.w,y:H.y,w:H.w-z.w,h:z.h}),H.y+=z.h,H.h-=z.h);break}}return{w:T,h:I,fill:s/(T*I)||0}}In.prototype={destroy:function(){this.buf=null},readFields:function(i,s,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),y=p>>3,v=this.pos;this.type=7&p,i(y,s,this),this.pos===v&&this.skip(p)}return s},readMessage:function(i,s){return this.readFields(i,s,this.readVarint()+this.pos)},readFixed32:function(){var i=hm(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Bb(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=hm(this.buf,this.pos)+4294967296*hm(this.buf,this.pos+4);return this.pos+=8,i},readSFixed64:function(){var i=hm(this.buf,this.pos)+4294967296*Bb(this.buf,this.pos+4);return this.pos+=8,i},readFloat:function(){var i=zb(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=zb(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var s,u,p=this.buf;return s=127&(u=p[this.pos++]),u<128?s:(s|=(127&(u=p[this.pos++]))<<7,u<128?s:(s|=(127&(u=p[this.pos++]))<<14,u<128?s:(s|=(127&(u=p[this.pos++]))<<21,u<128?s:function(y,v,b){var T,I,M=b.buf;if(T=(112&(I=M[b.pos++]))>>4,I<128||(T|=(127&(I=M[b.pos++]))<<3,I<128)||(T|=(127&(I=M[b.pos++]))<<10,I<128)||(T|=(127&(I=M[b.pos++]))<<17,I<128)||(T|=(127&(I=M[b.pos++]))<<24,I<128)||(T|=(1&(I=M[b.pos++]))<<31,I<128))return Dc(y,T,v);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(u=p[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,s=this.pos;return this.pos=i,i-s>=12&&Fb?function(u,p,y){return Fb.decode(u.subarray(p,y))}(this.buf,s,i):function(u,p,y){for(var v="",b=p;b<y;){var T,I,M,L=u[b],z=null,U=L>239?4:L>223?3:L>191?2:1;if(b+U>y)break;U===1?L<128&&(z=L):U===2?(192&(T=u[b+1]))==128&&(z=(31&L)<<6|63&T)<=127&&(z=null):U===3?(I=u[b+2],(192&(T=u[b+1]))==128&&(192&I)==128&&((z=(15&L)<<12|(63&T)<<6|63&I)<=2047||z>=55296&&z<=57343)&&(z=null)):U===4&&(I=u[b+2],M=u[b+3],(192&(T=u[b+1]))==128&&(192&I)==128&&(192&M)==128&&((z=(15&L)<<18|(63&T)<<12|(63&I)<<6|63&M)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,U=1):z>65535&&(z-=65536,v+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),v+=String.fromCharCode(z),b+=U}return v}(this.buf,s,i)},readBytes:function(){var i=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,i);return this.pos=i,s},readPackedVarint:function(i,s){if(this.type!==In.Bytes)return i.push(this.readVarint(s));var u=zs(this);for(i=i||[];this.pos<u;)i.push(this.readVarint(s));return i},readPackedSVarint:function(i){if(this.type!==In.Bytes)return i.push(this.readSVarint());var s=zs(this);for(i=i||[];this.pos<s;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==In.Bytes)return i.push(this.readBoolean());var s=zs(this);for(i=i||[];this.pos<s;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==In.Bytes)return i.push(this.readFloat());var s=zs(this);for(i=i||[];this.pos<s;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==In.Bytes)return i.push(this.readDouble());var s=zs(this);for(i=i||[];this.pos<s;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==In.Bytes)return i.push(this.readFixed32());var s=zs(this);for(i=i||[];this.pos<s;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==In.Bytes)return i.push(this.readSFixed32());var s=zs(this);for(i=i||[];this.pos<s;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==In.Bytes)return i.push(this.readFixed64());var s=zs(this);for(i=i||[];this.pos<s;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==In.Bytes)return i.push(this.readSFixed64());var s=zs(this);for(i=i||[];this.pos<s;)i.push(this.readSFixed64());return i},skip:function(i){var s=7&i;if(s===In.Varint)for(;this.buf[this.pos++]>127;);else if(s===In.Bytes)this.pos=this.readVarint()+this.pos;else if(s===In.Fixed32)this.pos+=4;else{if(s!==In.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(i,s){this.writeVarint(i<<3|s)},realloc:function(i){for(var s=this.length||16;s<this.pos+i;)s*=2;if(s!==this.length){var u=new Uint8Array(s);u.set(this.buf),this.buf=u,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Fc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Fc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Fc(this.buf,-1&i,this.pos),Fc(this.buf,Math.floor(i*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Fc(this.buf,-1&i,this.pos),Fc(this.buf,Math.floor(i*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(s,u){var p,y;if(s>=0?(p=s%4294967296|0,y=s/4294967296|0):(y=~(-s/4294967296),4294967295^(p=~(-s%4294967296))?p=p+1|0:(p=0,y=y+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(v,b,T){T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,T.buf[T.pos]=127&(v>>>=7)}(p,0,u),function(v,b){var T=(7&v)<<4;b.buf[b.pos++]|=T|((v>>>=3)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v)))))}(y,u)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var s=this.pos;this.pos=function(p,y,v){for(var b,T,I=0;I<y.length;I++){if((b=y.charCodeAt(I))>55295&&b<57344){if(!T){b>56319||I+1===y.length?(p[v++]=239,p[v++]=191,p[v++]=189):T=b;continue}if(b<56320){p[v++]=239,p[v++]=191,p[v++]=189,T=b;continue}b=T-55296<<10|b-56320|65536,T=null}else T&&(p[v++]=239,p[v++]=191,p[v++]=189,T=null);b<128?p[v++]=b:(b<2048?p[v++]=b>>6|192:(b<65536?p[v++]=b>>12|224:(p[v++]=b>>18|240,p[v++]=b>>12&63|128),p[v++]=b>>6&63|128),p[v++]=63&b|128)}return v}(this.buf,i,this.pos);var u=this.pos-s;u>=128&&Nb(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u},writeFloat:function(i){this.realloc(4),Db(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Db(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var s=i.length;this.writeVarint(s),this.realloc(s);for(var u=0;u<s;u++)this.buf[this.pos++]=i[u]},writeRawMessage:function(i,s){this.pos++;var u=this.pos;i(s,this);var p=this.pos-u;p>=128&&Nb(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(i,s,u){this.writeTag(i,In.Bytes),this.writeRawMessage(s,u)},writePackedVarint:function(i,s){s.length&&this.writeMessage(i,Dk,s)},writePackedSVarint:function(i,s){s.length&&this.writeMessage(i,Fk,s)},writePackedBoolean:function(i,s){s.length&&this.writeMessage(i,Uk,s)},writePackedFloat:function(i,s){s.length&&this.writeMessage(i,Nk,s)},writePackedDouble:function(i,s){s.length&&this.writeMessage(i,Bk,s)},writePackedFixed32:function(i,s){s.length&&this.writeMessage(i,Vk,s)},writePackedSFixed32:function(i,s){s.length&&this.writeMessage(i,jk,s)},writePackedFixed64:function(i,s){s.length&&this.writeMessage(i,Gk,s)},writePackedSFixed64:function(i,s){s.length&&this.writeMessage(i,Wk,s)},writeBytesField:function(i,s){this.writeTag(i,In.Bytes),this.writeBytes(s)},writeFixed32Field:function(i,s){this.writeTag(i,In.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(i,s){this.writeTag(i,In.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(i,s){this.writeTag(i,In.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(i,s){this.writeTag(i,In.Fixed64),this.writeSFixed64(s)},writeVarintField:function(i,s){this.writeTag(i,In.Varint),this.writeVarint(s)},writeSVarintField:function(i,s){this.writeTag(i,In.Varint),this.writeSVarint(s)},writeStringField:function(i,s){this.writeTag(i,In.Bytes),this.writeString(s)},writeFloatField:function(i,s){this.writeTag(i,In.Fixed32),this.writeFloat(s)},writeDoubleField:function(i,s){this.writeTag(i,In.Fixed64),this.writeDouble(s)},writeBooleanField:function(i,s){this.writeVarintField(i,Boolean(s))}};var fm=function(i,s){var u=s.pixelRatio,p=s.version,y=s.stretchX,v=s.stretchY,b=s.content;this.paddedRect=i,this.pixelRatio=u,this.stretchX=y,this.stretchY=v,this.content=b,this.version=p},Gf={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Gf.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Gf.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Gf.tlbr.get=function(){return this.tl.concat(this.br)},Gf.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(fm.prototype,Gf);var Wf=function(i,s){var u={},p={};this.haveRenderCallbacks=[];var y=[];this.addImages(i,u,y),this.addImages(s,p,y);var v=Ub(y),b=new Di({width:v.w||1,height:v.h||1});for(var T in i){var I=i[T],M=u[T].paddedRect;Di.copy(I.data,b,{x:0,y:0},{x:M.x+1,y:M.y+1},I.data)}for(var L in s){var z=s[L],U=p[L].paddedRect,H=U.x+1,ee=U.y+1,te=z.data.width,pe=z.data.height;Di.copy(z.data,b,{x:0,y:0},{x:H,y:ee},z.data),Di.copy(z.data,b,{x:0,y:pe-1},{x:H,y:ee-1},{width:te,height:1}),Di.copy(z.data,b,{x:0,y:0},{x:H,y:ee+pe},{width:te,height:1}),Di.copy(z.data,b,{x:te-1,y:0},{x:H-1,y:ee},{width:1,height:pe}),Di.copy(z.data,b,{x:0,y:0},{x:H+te,y:ee},{width:1,height:pe})}this.image=b,this.iconPositions=u,this.patternPositions=p};Wf.prototype.addImages=function(i,s,u){for(var p in i){var y=i[p],v={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(v),s[p]=new fm(v,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},Wf.prototype.patchUpdatedImages=function(i,s){for(var u in i.dispatchRenderCallbacks(this.haveRenderCallbacks),i.updatedImages)this.patchUpdatedImage(this.iconPositions[u],i.getImage(u),s),this.patchUpdatedImage(this.patternPositions[u],i.getImage(u),s)},Wf.prototype.patchUpdatedImage=function(i,s,u){if(i&&s&&i.version!==s.version){i.version=s.version;var p=i.tl;u.update(s.data,void 0,{x:p[0],y:p[1]})}},ht("ImagePosition",fm),ht("ImageAtlas",Wf);var co={horizontal:1,vertical:2,horizontalOnly:3},Nc=function(){this.scale=1,this.fontStack="",this.imageName=null};Nc.forText=function(i,s){var u=new Nc;return u.scale=i||1,u.fontStack=s,u},Nc.forImage=function(i){var s=new Nc;return s.imageName=i,s};var ci=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function pm(i,s,u,p,y,v,b,T,I,M,L,z,U,H,ee,te){var pe,ce=ci.fromFeature(i,y);z===co.vertical&&ce.verticalizePunctuation();var be=Xi.processBidirectionalText,Se=Xi.processStyledBidirectionalText;if(be&&ce.sections.length===1){pe=[];for(var Ie=0,Me=be(ce.toString(),Cv(ce,M,v,s,p,H,ee));Ie<Me.length;Ie+=1){var Ne=Me[Ie],$e=new ci;$e.text=Ne,$e.sections=ce.sections;for(var Qe=0;Qe<Ne.length;Qe++)$e.sectionIndex.push(0);pe.push($e)}}else if(Se){pe=[];for(var pt=0,at=Se(ce.text,ce.sectionIndex,Cv(ce,M,v,s,p,H,ee));pt<at.length;pt+=1){var vt=at[pt],it=new ci;it.text=vt[0],it.sectionIndex=vt[1],it.sections=ce.sections,pe.push(it)}}else pe=function(ut,Xt){for(var Dt=[],on=ut.text,dt=0,un=0,Rn=Xt;un<Rn.length;un+=1){var Lr=Rn[un];Dt.push(ut.substring(dt,Lr)),dt=Lr}return dt<on.length&&Dt.push(ut.substring(dt,on.length)),Dt}(ce,Cv(ce,M,v,s,p,H,ee));var Gt=[],St={positionedLines:Gt,text:ce.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(ut,Xt,Dt,on,dt,un,Rn,Lr,Rr,On,pr,zn){for(var Tr=0,hi=-17,Gr=0,wi=0,Sr=Lr==="right"?1:Lr==="left"?0:.5,Pr=0,Kt=0,_n=dt;Kt<_n.length;Kt+=1){var Dn=_n[Kt];Dn.trim();var nn=Dn.getMaxScale(),dr=24*(nn-1),ri={positionedGlyphs:[],lineOffset:0};ut.positionedLines[Pr]=ri;var Or=ri.positionedGlyphs,tr=0;if(Dn.length()){for(var zr=0;zr<Dn.length();zr++){var Fn=Dn.getSection(zr),ir=Dn.getSectionIndex(zr),ho=Dn.getCharCode(zr),Xa=0,or=null,Ya=null,Qo=null,qc=24,Cu=!(Rr===co.horizontal||!pr&&!_i(ho)||pr&&(dm[ho]||(Bs=ho,nt.Arabic(Bs)||nt["Arabic Supplement"](Bs)||nt["Arabic Extended-A"](Bs)||nt["Arabic Presentation Forms-A"](Bs)||nt["Arabic Presentation Forms-B"](Bs))));if(Fn.imageName){var Zc=on[Fn.imageName];if(!Zc)continue;Qo=Fn.imageName,ut.iconsInText=ut.iconsInText||!0,Ya=Zc.paddedRect;var Ns=Zc.displaySize;Fn.scale=24*Fn.scale/zn,Xa=dr+(24-Ns[1]*Fn.scale),qc=(or={width:Ns[0],height:Ns[1],left:1,top:-3,advance:Cu?Ns[1]:Ns[0]}).advance;var $c=Cu?Ns[0]*Fn.scale-24*nn:Ns[1]*Fn.scale-24*nn;$c>0&&$c>tr&&(tr=$c)}else{var Em=Dt[Fn.fontStack],Xc=Em&&Em[ho];if(Xc&&Xc.rect)Ya=Xc.rect,or=Xc.metrics;else{var Zf=Xt[Fn.fontStack],Tm=Zf&&Zf[ho];if(!Tm)continue;or=Tm.metrics}Xa=24*(nn-Fn.scale)}Cu?(ut.verticalizable=!0,Or.push({glyph:ho,imageName:Qo,x:Tr,y:hi+Xa,vertical:Cu,scale:Fn.scale,fontStack:Fn.fontStack,sectionIndex:ir,metrics:or,rect:Ya}),Tr+=qc*Fn.scale+On):(Or.push({glyph:ho,imageName:Qo,x:Tr,y:hi+Xa,vertical:Cu,scale:Fn.scale,fontStack:Fn.fontStack,sectionIndex:ir,metrics:or,rect:Ya}),Tr+=or.advance*Fn.scale+On)}Or.length!==0&&(Gr=Math.max(Tr-On,Gr),Xk(Or,0,Or.length-1,Sr,tr)),Tr=0;var Sm=un*nn+tr;ri.lineOffset=Math.max(tr,dr),hi+=Sm,wi=Math.max(Sm,wi),++Pr}else hi+=un,++Pr}var Bs,$f=hi- -17,Yc=Iv(Rn),Al=Yc.horizontalAlign,Kc=Yc.verticalAlign;(function(Pm,Am,Xf,Yf,Cm,Kf,Jf,Qf,Im){var Jc,Mm=(Am-Xf)*Cm;Jc=Kf!==Jf?-Qf*Yf- -17:(-Yf*Im+.5)*Jf;for(var Qc=0,ep=Pm;Qc<ep.length;Qc+=1)for(var Iu=0,tp=ep[Qc].positionedGlyphs;Iu<tp.length;Iu+=1){var eh=tp[Iu];eh.x+=Mm,eh.y+=Jc}})(ut.positionedLines,Sr,Al,Kc,Gr,wi,un,$f,dt.length),ut.top+=-Kc*$f,ut.bottom=ut.top+$f,ut.left+=-Al*Gr,ut.right=ut.left+Gr}(St,s,u,p,pe,b,T,I,z,M,U,te),!function(ut){for(var Xt=0,Dt=ut;Xt<Dt.length;Xt+=1)if(Dt[Xt].positionedGlyphs.length!==0)return!1;return!0}(Gt)&&St}ci.fromFeature=function(i,s){for(var u=new ci,p=0;p<i.sections.length;p++){var y=i.sections[p];y.image?u.addImageSection(y):u.addTextSection(y,s)}return u},ci.prototype.length=function(){return this.text.length},ci.prototype.getSection=function(i){return this.sections[this.sectionIndex[i]]},ci.prototype.getSectionIndex=function(i){return this.sectionIndex[i]},ci.prototype.getCharCode=function(i){return this.text.charCodeAt(i)},ci.prototype.verticalizePunctuation=function(){this.text=function(i){for(var s="",u=0;u<i.length;u++){var p=i.charCodeAt(u+1)||null,y=i.charCodeAt(u-1)||null;s+=p&&Qd(p)&&!jf[i[u+1]]||y&&Qd(y)&&!jf[i[u-1]]||!jf[i[u]]?i[u]:jf[i[u]]}return s}(this.text)},ci.prototype.trim=function(){for(var i=0,s=0;s<this.text.length&&dm[this.text.charCodeAt(s)];s++)i++;for(var u=this.text.length,p=this.text.length-1;p>=0&&p>=i&&dm[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(i,u),this.sectionIndex=this.sectionIndex.slice(i,u)},ci.prototype.substring=function(i,s){var u=new ci;return u.text=this.text.substring(i,s),u.sectionIndex=this.sectionIndex.slice(i,s),u.sections=this.sections,u},ci.prototype.toString=function(){return this.text},ci.prototype.getMaxScale=function(){var i=this;return this.sectionIndex.reduce(function(s,u){return Math.max(s,i.sections[u].scale)},0)},ci.prototype.addTextSection=function(i,s){this.text+=i.text,this.sections.push(Nc.forText(i.scale,i.fontStack||s));for(var u=this.sections.length-1,p=0;p<i.text.length;++p)this.sectionIndex.push(u)},ci.prototype.addImageSection=function(i){var s=i.image?i.image.name:"";if(s.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Nc.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Be("Reached maximum number of images 6401")}else Be("Can't add FormattedSection with an empty image.")},ci.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var dm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ji={};function Vb(i,s,u,p,y,v){if(s.imageName){var b=p[s.imageName];return b?b.displaySize[0]*s.scale*24/v+y:0}var T=u[s.fontStack],I=T&&T[i];return I?I.metrics.advance*s.scale+y:0}function jb(i,s,u,p){var y=Math.pow(i-s,2);return p?i<s?y/2:2*y:y+Math.abs(u)*u}function $k(i,s,u){var p=0;return i===10&&(p-=1e4),u&&(p+=150),i!==40&&i!==65288||(p+=50),s!==41&&s!==65289||(p+=50),p}function Gb(i,s,u,p,y,v){for(var b=null,T=jb(s,u,y,v),I=0,M=p;I<M.length;I+=1){var L=M[I],z=jb(s-L.x,u,y,v)+L.badness;z<=T&&(b=L,T=z)}return{index:i,x:s,priorBreak:b,badness:T}}function Cv(i,s,u,p,y,v,b){if(v!=="point")return[];if(!i)return[];for(var T,I=[],M=function(pe,ce,be,Se,Ie,Me){for(var Ne=0,$e=0;$e<pe.length();$e++){var Qe=pe.getSection($e);Ne+=Vb(pe.getCharCode($e),Qe,Se,Ie,ce,Me)}return Ne/Math.max(1,Math.ceil(Ne/be))}(i,s,u,p,y,b),L=i.text.indexOf("")>=0,z=0,U=0;U<i.length();U++){var H=i.getSection(U),ee=i.getCharCode(U);if(dm[ee]||(z+=Vb(ee,H,p,y,s,b)),U<i.length()-1){var te=!((T=ee)<11904||!(nt["Bopomofo Extended"](T)||nt.Bopomofo(T)||nt["CJK Compatibility Forms"](T)||nt["CJK Compatibility Ideographs"](T)||nt["CJK Compatibility"](T)||nt["CJK Radicals Supplement"](T)||nt["CJK Strokes"](T)||nt["CJK Symbols and Punctuation"](T)||nt["CJK Unified Ideographs Extension A"](T)||nt["CJK Unified Ideographs"](T)||nt["Enclosed CJK Letters and Months"](T)||nt["Halfwidth and Fullwidth Forms"](T)||nt.Hiragana(T)||nt["Ideographic Description Characters"](T)||nt["Kangxi Radicals"](T)||nt["Katakana Phonetic Extensions"](T)||nt.Katakana(T)||nt["Vertical Forms"](T)||nt["Yi Radicals"](T)||nt["Yi Syllables"](T)));(Ji[ee]||te||H.imageName)&&I.push(Gb(U+1,z,M,I,$k(ee,i.getCharCode(U+1),te&&L),!1))}}return function pe(ce){return ce?pe(ce.priorBreak).concat(ce.index):[]}(Gb(i.length(),z,M,I,0,!0))}function Iv(i){var s=.5,u=.5;switch(i){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:s,verticalAlign:u}}function Xk(i,s,u,p,y){if(p||y)for(var v=i[u],b=(i[u].x+v.metrics.advance*v.scale)*p,T=s;T<=u;T++)i[T].x-=b,i[T].y+=y}function Wb(i,s,u,p,y,v){var b,T=i.image;if(T.content){var I=T.content,M=T.pixelRatio||1;b=[I[0]/M,I[1]/M,T.displaySize[0]-I[2]/M,T.displaySize[1]-I[3]/M]}var L,z,U,H,ee=s.left*v,te=s.right*v;u==="width"||u==="both"?(H=y[0]+ee-p[3],z=y[0]+te+p[1]):z=(H=y[0]+(ee+te-T.displaySize[0])/2)+T.displaySize[0];var pe=s.top*v,ce=s.bottom*v;return u==="height"||u==="both"?(L=y[1]+pe-p[0],U=y[1]+ce+p[2]):U=(L=y[1]+(pe+ce-T.displaySize[1])/2)+T.displaySize[1],{image:T,top:L,right:z,bottom:U,left:H,collisionPadding:b}}Ji[10]=!0,Ji[32]=!0,Ji[38]=!0,Ji[40]=!0,Ji[41]=!0,Ji[43]=!0,Ji[45]=!0,Ji[47]=!0,Ji[173]=!0,Ji[183]=!0,Ji[8203]=!0,Ji[8208]=!0,Ji[8211]=!0,Ji[8231]=!0;var Bc=function(i){function s(u,p,y,v){i.call(this,u,p),this.angle=y,v!==void 0&&(this.segment=v)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(E);function Mv(i,s){var u=s.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new hn(i+1))};if(u.kind==="source")return{kind:"source"};for(var p=u.zoomStops,y=u.interpolationType,v=0;v<p.length&&p[v]<=i;)v++;for(var b=v=Math.max(0,v-1);b<p.length&&p[b]<i+1;)b++;b=Math.min(p.length-1,b);var T=p[v],I=p[b];return u.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:y}:{kind:"camera",minZoom:T,maxZoom:I,minSize:u.evaluate(new hn(T)),maxSize:u.evaluate(new hn(I)),interpolationType:y}}function Hb(i,s,u){var p=s.uSize,y=u.lowerSize;return i.kind==="source"?y/128:i.kind==="composite"?Cr(y/128,u.upperSize/128,s.uSizeT):p}function qb(i,s){var u=0,p=0;if(i.kind==="constant")p=i.layoutSize;else if(i.kind!=="source"){var y=i.interpolationType,v=y?X(Kr.interpolationFactor(y,s,i.minZoom,i.maxZoom),0,1):0;i.kind==="camera"?p=Cr(i.minSize,i.maxSize,v):u=v}return{uSizeT:u,uSize:p}}ht("Anchor",Bc);var Yk=Object.freeze({__proto__:null,getSizeData:Mv,evaluateSizeForFeature:Hb,evaluateSizeForZoom:qb,SIZE_PACK_FACTOR:128});function Zb(i,s,u,p,y){if(s.segment===void 0)return!0;for(var v=s,b=s.segment+1,T=0;T>-u/2;){if(--b<0)return!1;T-=i[b].dist(v),v=i[b]}T+=i[b].dist(i[b+1]),b++;for(var I=[],M=0;T<u/2;){var L=i[b],z=i[b+1];if(!z)return!1;var U=i[b-1].angleTo(L)-L.angleTo(z);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:U}),M+=U;T-I[0].distance>p;)M-=I.shift().angleDelta;if(M>y)return!1;b++,T+=L.dist(z)}return!0}function $b(i){for(var s=0,u=0;u<i.length-1;u++)s+=i[u].dist(i[u+1]);return s}function Xb(i,s,u){return i?.6*s*u:0}function Yb(i,s){return Math.max(i?i.right-i.left:0,s?s.right-s.left:0)}function Kk(i,s,u,p,y,v){for(var b=Xb(u,y,v),T=Yb(u,p)*v,I=0,M=$b(i)/2,L=0;L<i.length-1;L++){var z=i[L],U=i[L+1],H=z.dist(U);if(I+H>M){var ee=(M-I)/H,te=Cr(z.x,U.x,ee),pe=Cr(z.y,U.y,ee),ce=new Bc(te,pe,U.angleTo(z),L);return ce._round(),!b||Zb(i,ce,T,b,s)?ce:void 0}I+=H}}function Jk(i,s,u,p,y,v,b,T,I){var M=Xb(p,v,b),L=Yb(p,y),z=L*b,U=i[0].x===0||i[0].x===I||i[0].y===0||i[0].y===I;return s-z<s/4&&(s=z+s/4),function H(ee,te,pe,ce,be,Se,Ie,Me,Ne){for(var $e=Se/2,Qe=$b(ee),pt=0,at=te-pe,vt=[],it=0;it<ee.length-1;it++){for(var Gt=ee[it],St=ee[it+1],ut=Gt.dist(St),Xt=St.angleTo(Gt);at+pe<pt+ut;){var Dt=((at+=pe)-pt)/ut,on=Cr(Gt.x,St.x,Dt),dt=Cr(Gt.y,St.y,Dt);if(on>=0&&on<Ne&&dt>=0&&dt<Ne&&at-$e>=0&&at+$e<=Qe){var un=new Bc(on,dt,Xt,it);un._round(),ce&&!Zb(ee,un,Se,ce,be)||vt.push(un)}}pt+=ut}return Me||vt.length||Ie||(vt=H(ee,pt/2,pe,ce,be,Se,Ie,!0,Ne)),vt}(i,U?s/2*T%s:(L/2+2*v)*b*T%s,s,M,u,z,U,!1,I)}function Kb(i,s,u,p,y){for(var v=[],b=0;b<i.length;b++)for(var T=i[b],I=void 0,M=0;M<T.length-1;M++){var L=T[M],z=T[M+1];L.x<s&&z.x<s||(L.x<s?L=new E(s,L.y+(s-L.x)/(z.x-L.x)*(z.y-L.y))._round():z.x<s&&(z=new E(s,L.y+(s-L.x)/(z.x-L.x)*(z.y-L.y))._round()),L.y<u&&z.y<u||(L.y<u?L=new E(L.x+(u-L.y)/(z.y-L.y)*(z.x-L.x),u)._round():z.y<u&&(z=new E(L.x+(u-L.y)/(z.y-L.y)*(z.x-L.x),u)._round()),L.x>=p&&z.x>=p||(L.x>=p?L=new E(p,L.y+(p-L.x)/(z.x-L.x)*(z.y-L.y))._round():z.x>=p&&(z=new E(p,L.y+(p-L.x)/(z.x-L.x)*(z.y-L.y))._round()),L.y>=y&&z.y>=y||(L.y>=y?L=new E(L.x+(y-L.y)/(z.y-L.y)*(z.x-L.x),y)._round():z.y>=y&&(z=new E(L.x+(y-L.y)/(z.y-L.y)*(z.x-L.x),y)._round()),I&&L.equals(I[I.length-1])||v.push(I=[L]),I.push(z)))))}return v}function Jb(i,s,u,p){var y=[],v=i.image,b=v.pixelRatio,T=v.paddedRect.w-2,I=v.paddedRect.h-2,M=i.right-i.left,L=i.bottom-i.top,z=v.stretchX||[[0,T]],U=v.stretchY||[[0,I]],H=function(on,dt){return on+dt[1]-dt[0]},ee=z.reduce(H,0),te=U.reduce(H,0),pe=T-ee,ce=I-te,be=0,Se=ee,Ie=0,Me=te,Ne=0,$e=pe,Qe=0,pt=ce;if(v.content&&p){var at=v.content;be=mm(z,0,at[0]),Ie=mm(U,0,at[1]),Se=mm(z,at[0],at[2]),Me=mm(U,at[1],at[3]),Ne=at[0]-be,Qe=at[1]-Ie,$e=at[2]-at[0]-Se,pt=at[3]-at[1]-Me}var vt=function(on,dt,un,Rn){var Lr=gm(on.stretch-be,Se,M,i.left),Rr=ym(on.fixed-Ne,$e,on.stretch,ee),On=gm(dt.stretch-Ie,Me,L,i.top),pr=ym(dt.fixed-Qe,pt,dt.stretch,te),zn=gm(un.stretch-be,Se,M,i.left),Tr=ym(un.fixed-Ne,$e,un.stretch,ee),hi=gm(Rn.stretch-Ie,Me,L,i.top),Gr=ym(Rn.fixed-Qe,pt,Rn.stretch,te),wi=new E(Lr,On),Sr=new E(zn,On),Pr=new E(zn,hi),Kt=new E(Lr,hi),_n=new E(Rr/b,pr/b),Dn=new E(Tr/b,Gr/b),nn=s*Math.PI/180;if(nn){var dr=Math.sin(nn),ri=Math.cos(nn),Or=[ri,-dr,dr,ri];wi._matMult(Or),Sr._matMult(Or),Kt._matMult(Or),Pr._matMult(Or)}var tr=on.stretch+on.fixed,zr=dt.stretch+dt.fixed;return{tl:wi,tr:Sr,bl:Kt,br:Pr,tex:{x:v.paddedRect.x+1+tr,y:v.paddedRect.y+1+zr,w:un.stretch+un.fixed-tr,h:Rn.stretch+Rn.fixed-zr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:_n,pixelOffsetBR:Dn,minFontScaleX:$e/b/M,minFontScaleY:pt/b/L,isSDF:u}};if(p&&(v.stretchX||v.stretchY))for(var it=Qb(z,pe,ee),Gt=Qb(U,ce,te),St=0;St<it.length-1;St++)for(var ut=it[St],Xt=it[St+1],Dt=0;Dt<Gt.length-1;Dt++)y.push(vt(ut,Gt[Dt],Xt,Gt[Dt+1]));else y.push(vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:I+1}));return y}function mm(i,s,u){for(var p=0,y=0,v=i;y<v.length;y+=1){var b=v[y];p+=Math.max(s,Math.min(u,b[1]))-Math.max(s,Math.min(u,b[0]))}return p}function Qb(i,s,u){for(var p=[{fixed:-1,stretch:0}],y=0,v=i;y<v.length;y+=1){var b=v[y],T=b[0],I=b[1],M=p[p.length-1];p.push({fixed:T-M.stretch,stretch:M.stretch}),p.push({fixed:T-M.stretch,stretch:M.stretch+(I-T)})}return p.push({fixed:s+1,stretch:u}),p}function gm(i,s,u,p){return i/s*u+p}function ym(i,s,u,p){return i-s*u/p}var vm=function(i,s,u,p,y,v,b,T,I,M){if(this.boxStartIndex=i.length,I){var L=v.top,z=v.bottom,U=v.collisionPadding;U&&(L-=U[1],z+=U[3]);var H=z-L;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{var ee=v.top*b-T,te=v.bottom*b+T,pe=v.left*b-T,ce=v.right*b+T,be=v.collisionPadding;if(be&&(pe-=be[0]*b,ee-=be[1]*b,ce+=be[2]*b,te+=be[3]*b),M){var Se=new E(pe,ee),Ie=new E(ce,ee),Me=new E(pe,te),Ne=new E(ce,te),$e=M*Math.PI/180;Se._rotate($e),Ie._rotate($e),Me._rotate($e),Ne._rotate($e),pe=Math.min(Se.x,Ie.x,Me.x,Ne.x),ce=Math.max(Se.x,Ie.x,Me.x,Ne.x),ee=Math.min(Se.y,Ie.y,Me.y,Ne.y),te=Math.max(Se.y,Ie.y,Me.y,Ne.y)}i.emplaceBack(s.x,s.y,pe,ee,ce,te,u,p,y)}this.boxEndIndex=i.length},Uc=function(i,s){if(i===void 0&&(i=[]),s===void 0&&(s=Qk),this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function Qk(i,s){return i<s?-1:i>s?1:0}function eL(i,s,u){s===void 0&&(s=1),u===void 0&&(u=!1);for(var p=1/0,y=1/0,v=-1/0,b=-1/0,T=i[0],I=0;I<T.length;I++){var M=T[I];(!I||M.x<p)&&(p=M.x),(!I||M.y<y)&&(y=M.y),(!I||M.x>v)&&(v=M.x),(!I||M.y>b)&&(b=M.y)}var L=Math.min(v-p,b-y),z=L/2,U=new Uc([],tL);if(L===0)return new E(p,y);for(var H=p;H<v;H+=L)for(var ee=y;ee<b;ee+=L)U.push(new Vc(H+z,ee+z,z,i));for(var te=function(be){for(var Se=0,Ie=0,Me=0,Ne=be[0],$e=0,Qe=Ne.length,pt=Qe-1;$e<Qe;pt=$e++){var at=Ne[$e],vt=Ne[pt],it=at.x*vt.y-vt.x*at.y;Ie+=(at.x+vt.x)*it,Me+=(at.y+vt.y)*it,Se+=3*it}return new Vc(Ie/Se,Me/Se,0,be)}(i),pe=U.length;U.length;){var ce=U.pop();(ce.d>te.d||!te.d)&&(te=ce,u&&console.log("found best %d after %d probes",Math.round(1e4*ce.d)/1e4,pe)),ce.max-te.d<=s||(U.push(new Vc(ce.p.x-(z=ce.h/2),ce.p.y-z,z,i)),U.push(new Vc(ce.p.x+z,ce.p.y-z,z,i)),U.push(new Vc(ce.p.x-z,ce.p.y+z,z,i)),U.push(new Vc(ce.p.x+z,ce.p.y+z,z,i)),pe+=4)}return u&&(console.log("num probes: "+pe),console.log("best distance: "+te.d)),te.p}function tL(i,s){return s.max-i.max}function Vc(i,s,u,p){this.p=new E(i,s),this.h=u,this.d=function(y,v){for(var b=!1,T=1/0,I=0;I<v.length;I++)for(var M=v[I],L=0,z=M.length,U=z-1;L<z;U=L++){var H=M[L],ee=M[U];H.y>y.y!=ee.y>y.y&&y.x<(ee.x-H.x)*(y.y-H.y)/(ee.y-H.y)+H.x&&(b=!b),T=Math.min(T,Za(y,H,ee))}return(b?1:-1)*Math.sqrt(T)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}Uc.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},Uc.prototype.pop=function(){if(this.length!==0){var i=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),i}},Uc.prototype.peek=function(){return this.data[0]},Uc.prototype._up=function(i){for(var s=this.data,u=this.compare,p=s[i];i>0;){var y=i-1>>1,v=s[y];if(u(p,v)>=0)break;s[i]=v,i=y}s[i]=p},Uc.prototype._down=function(i){for(var s=this.data,u=this.compare,p=this.length>>1,y=s[i];i<p;){var v=1+(i<<1),b=s[v],T=v+1;if(T<this.length&&u(s[T],b)<0&&(v=T,b=s[T]),u(b,y)>=0)break;s[i]=b,i=v}s[i]=y};var kv=Number.POSITIVE_INFINITY;function ew(i,s){return s[1]!==kv?function(u,p,y){var v=0,b=0;switch(p=Math.abs(p),y=Math.abs(y),u){case"top-right":case"top-left":case"top":b=y-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-y}switch(u){case"top-right":case"bottom-right":case"right":v=-p;break;case"top-left":case"bottom-left":case"left":v=p}return[v,b]}(i,s[0],s[1]):function(u,p){var y=0,v=0;p<0&&(p=0);var b=p/Math.sqrt(2);switch(u){case"top-right":case"top-left":v=b-7;break;case"bottom-right":case"bottom-left":v=7-b;break;case"bottom":v=7-p;break;case"top":v=p-7}switch(u){case"top-right":case"bottom-right":y=-b;break;case"top-left":case"bottom-left":y=b;break;case"left":y=p;break;case"right":y=-p}return[y,v]}(i,s[0])}function Lv(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tw(i,s,u,p,y,v,b,T,I,M,L,z,U,H,ee){var te=function(Ie,Me,Ne,$e,Qe,pt,at,vt){for(var it=$e.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,Gt=[],St=0,ut=Me.positionedLines;St<ut.length;St+=1)for(var Xt=ut[St],Dt=0,on=Xt.positionedGlyphs;Dt<on.length;Dt+=1){var dt=on[Dt];if(dt.rect){var un=dt.rect||{},Rn=4,Lr=!0,Rr=1,On=0,pr=(Qe||vt)&&dt.vertical,zn=dt.metrics.advance*dt.scale/2;if(vt&&Me.verticalizable&&(On=Xt.lineOffset/2-(dt.imageName?-(24-dt.metrics.width*dt.scale)/2:24*(dt.scale-1))),dt.imageName){var Tr=at[dt.imageName];Lr=Tr.sdf,Rn=1/(Rr=Tr.pixelRatio)}var hi=Qe?[dt.x+zn,dt.y]:[0,0],Gr=Qe?[0,0]:[dt.x+zn+Ne[0],dt.y+Ne[1]-On],wi=[0,0];pr&&(wi=Gr,Gr=[0,0]);var Sr=(dt.metrics.left-Rn)*dt.scale-zn+Gr[0],Pr=(-dt.metrics.top-Rn)*dt.scale+Gr[1],Kt=Sr+un.w*dt.scale/Rr,_n=Pr+un.h*dt.scale/Rr,Dn=new E(Sr,Pr),nn=new E(Kt,Pr),dr=new E(Sr,_n),ri=new E(Kt,_n);if(pr){var Or=new E(-zn,zn- -17),tr=-Math.PI/2,zr=12-zn,Fn=new E(22-zr,-(dt.imageName?zr:0)),ir=new(Function.prototype.bind.apply(E,[null].concat(wi)));Dn._rotateAround(tr,Or)._add(Fn)._add(ir),nn._rotateAround(tr,Or)._add(Fn)._add(ir),dr._rotateAround(tr,Or)._add(Fn)._add(ir),ri._rotateAround(tr,Or)._add(Fn)._add(ir)}if(it){var ho=Math.sin(it),Xa=Math.cos(it),or=[Xa,-ho,ho,Xa];Dn._matMult(or),nn._matMult(or),dr._matMult(or),ri._matMult(or)}var Ya=new E(0,0),Qo=new E(0,0);Gt.push({tl:Dn,tr:nn,bl:dr,br:ri,tex:un,writingMode:Me.writingMode,glyphOffset:hi,sectionIndex:dt.sectionIndex,isSDF:Lr,pixelOffsetTL:Ya,pixelOffsetBR:Qo,minFontScaleX:0,minFontScaleY:0})}}return Gt}(0,u,T,y,v,b,p,i.allowVerticalPlacement),pe=i.textSizeData,ce=null;pe.kind==="source"?(ce=[128*y.layout.get("text-size").evaluate(b,{})])[0]>32640&&Be(i.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):pe.kind==="composite"&&((ce=[128*H.compositeTextSizes[0].evaluate(b,{},ee),128*H.compositeTextSizes[1].evaluate(b,{},ee)])[0]>32640||ce[1]>32640)&&Be(i.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),i.addSymbols(i.text,te,ce,T,v,b,M,s,I.lineStartIndex,I.lineLength,U,ee);for(var be=0,Se=L;be<Se.length;be+=1)z[Se[be]]=i.text.placedSymbolArray.length-1;return 4*te.length}function nw(i){for(var s in i)return i[s];return null}function nL(i,s,u,p){var y=i.compareText;if(s in y){for(var v=y[s],b=v.length-1;b>=0;b--)if(p.dist(v[b])<u)return!0}else y[s]=[];return y[s].push(p),!1}var rL=zc.VectorTileFeature.types,iL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _m(i,s,u,p,y,v,b,T,I,M,L,z,U){var H=T?Math.min(32640,Math.round(T[0])):0,ee=T?Math.min(32640,Math.round(T[1])):0;i.emplaceBack(s,u,Math.round(32*p),Math.round(32*y),v,b,(H<<1)+(I?1:0),ee,16*M,16*L,256*z,256*U)}function Rv(i,s,u){i.emplaceBack(s.x,s.y,u),i.emplaceBack(s.x,s.y,u),i.emplaceBack(s.x,s.y,u),i.emplaceBack(s.x,s.y,u)}function oL(i){for(var s=0,u=i.sections;s<u.length;s+=1)if(So(u[s].text))return!0;return!1}var jc=function(i){this.layoutVertexArray=new Ri,this.indexArray=new Xo,this.programConfigurations=i,this.segments=new V,this.dynamicLayoutVertexArray=new Ac,this.opacityVertexArray=new wu,this.placedSymbolArray=new h};jc.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},jc.prototype.upload=function(i,s,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,kk.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Lk.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,iL,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(i))},jc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},ht("SymbolBuffers",jc);var Hf=function(i,s,u){this.layoutVertexArray=new i,this.layoutAttributes=s,this.indexArray=new u,this.segments=new V,this.collisionVertexArray=new Lf};Hf.prototype.upload=function(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Rk.members,!0)},Hf.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},ht("CollisionBuffers",Hf);var vn=function(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(v){return v.id}),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rs([]),this.placementViewportMatrix=Rs([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Mv(this.zoom,s["text-size"]),this.iconSizeData=Mv(this.zoom,s["icon-size"]);var u=this.layers[0].layout,p=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.sortFeaturesByKey=y!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&(u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement")),u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(v){return co[v]})),this.stateDependentLayerIds=this.layers.filter(function(v){return v.isStateDependent()}).map(function(v){return v.id}),this.sourceID=i.sourceID};vn.prototype.createArrays=function(){this.text=new jc(new It(this.layers,this.zoom,function(i){return/^text/.test(i)})),this.icon=new jc(new It(this.layers,this.zoom,function(i){return/^icon/.test(i)})),this.glyphOffsetArray=new w,this.lineVertexArray=new S,this.symbolInstances=new _},vn.prototype.calculateGlyphDependencies=function(i,s,u,p,y){for(var v=0;v<i.length;v++)if(s[i.charCodeAt(v)]=!0,(u||p)&&y){var b=jf[i.charAt(v)];b&&(s[b.charCodeAt(0)]=!0)}},vn.prototype.populate=function(i,s,u){var p=this.layers[0],y=p.layout,v=y.get("text-font"),b=y.get("text-field"),T=y.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof bn&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),M=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,L=y.get("symbol-sort-key");if(this.features=[],I||M){for(var z=s.iconDependencies,U=s.glyphDependencies,H=s.availableImages,ee=new hn(this.zoom),te=0,pe=i;te<pe.length;te+=1){var ce=pe[te],be=ce.feature,Se=ce.id,Ie=ce.index,Me=ce.sourceLayerIndex,Ne=p._featureFilter.needGeometry,$e={type:be.type,id:Se,properties:be.properties,geometry:Ne?Pn(be):[]};if(p._featureFilter.filter(ee,$e,u)){Ne||($e.geometry=Pn(be));var Qe=void 0;if(I){var pt=p.getValueAndResolveTokens("text-field",$e,u,H),at=bn.factory(pt);oL(at)&&(this.hasRTLText=!0),(!this.hasRTLText||yu()==="unavailable"||this.hasRTLText&&Xi.isParsed())&&(Qe=zk(at,p,$e))}var vt=void 0;if(M){var it=p.getValueAndResolveTokens("icon-image",$e,u,H);vt=it instanceof Nr?it:Nr.fromString(it)}if(Qe||vt){var Gt=this.sortFeaturesByKey?L.evaluate($e,{},u):void 0,St={id:Se,text:Qe,icon:vt,index:Ie,sourceLayerIndex:Me,geometry:Pn(be),properties:be.properties,type:rL[be.type],sortKey:Gt};if(this.features.push(St),vt&&(z[vt.name]=!0),Qe){var ut=v.evaluate($e,{},u).join(","),Xt=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(co.vertical)>=0;for(var Dt=0,on=Qe.sections;Dt<on.length;Dt+=1){var dt=on[Dt];if(dt.image)z[dt.image.name]=!0;else{var un=Af(Qe.toString()),Rn=dt.fontStack||ut,Lr=U[Rn]=U[Rn]||{};this.calculateGlyphDependencies(dt.text,Lr,Xt,this.allowVerticalPlacement,un)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(Rr){var On={},pr={},zn=[],Tr=0;function hi(tr){zn.push(Rr[tr]),Tr++}function Gr(tr,zr,Fn){var ir=pr[tr];return delete pr[tr],pr[zr]=ir,zn[ir].geometry[0].pop(),zn[ir].geometry[0]=zn[ir].geometry[0].concat(Fn[0]),ir}function wi(tr,zr,Fn){var ir=On[zr];return delete On[zr],On[tr]=ir,zn[ir].geometry[0].shift(),zn[ir].geometry[0]=Fn[0].concat(zn[ir].geometry[0]),ir}function Sr(tr,zr,Fn){var ir=Fn?zr[0][zr[0].length-1]:zr[0][0];return tr+":"+ir.x+":"+ir.y}for(var Pr=0;Pr<Rr.length;Pr++){var Kt=Rr[Pr],_n=Kt.geometry,Dn=Kt.text?Kt.text.toString():null;if(Dn){var nn=Sr(Dn,_n),dr=Sr(Dn,_n,!0);if(nn in pr&&dr in On&&pr[nn]!==On[dr]){var ri=wi(nn,dr,_n),Or=Gr(nn,dr,zn[ri].geometry);delete On[nn],delete pr[dr],pr[Sr(Dn,zn[Or].geometry,!0)]=Or,zn[ri].geometry=null}else nn in pr?Gr(nn,dr,_n):dr in On?wi(nn,dr,_n):(hi(Pr),On[nn]=Tr-1,pr[dr]=Tr-1)}else hi(Pr)}return zn.filter(function(tr){return tr.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Rr,On){return Rr.sortKey-On.sortKey})}},vn.prototype.update=function(i,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,s,this.layers,u),this.icon.programConfigurations.updatePaintArrays(i,s,this.layers,u))},vn.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},vn.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},vn.prototype.upload=function(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},vn.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},vn.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},vn.prototype.addToLineVertexArray=function(i,s){var u=this.lineVertexArray.length;if(i.segment!==void 0){for(var p=i.dist(s[i.segment+1]),y=i.dist(s[i.segment]),v={},b=i.segment+1;b<s.length;b++)v[b]={x:s[b].x,y:s[b].y,tileUnitDistanceFromAnchor:p},b<s.length-1&&(p+=s[b+1].dist(s[b]));for(var T=i.segment||0;T>=0;T--)v[T]={x:s[T].x,y:s[T].y,tileUnitDistanceFromAnchor:y},T>0&&(y+=s[T-1].dist(s[T]));for(var I=0;I<s.length;I++){var M=v[I];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},vn.prototype.addSymbols=function(i,s,u,p,y,v,b,T,I,M,L,z){for(var U=i.indexArray,H=i.layoutVertexArray,ee=i.segments.prepareSegment(4*s.length,H,U,v.sortKey),te=this.glyphOffsetArray.length,pe=ee.vertexLength,ce=this.allowVerticalPlacement&&b===co.vertical?Math.PI/2:0,be=v.text&&v.text.sections,Se=0;Se<s.length;Se++){var Ie=s[Se],Me=Ie.tl,Ne=Ie.tr,$e=Ie.bl,Qe=Ie.br,pt=Ie.tex,at=Ie.pixelOffsetTL,vt=Ie.pixelOffsetBR,it=Ie.minFontScaleX,Gt=Ie.minFontScaleY,St=Ie.glyphOffset,ut=Ie.isSDF,Xt=Ie.sectionIndex,Dt=ee.vertexLength,on=St[1];_m(H,T.x,T.y,Me.x,on+Me.y,pt.x,pt.y,u,ut,at.x,at.y,it,Gt),_m(H,T.x,T.y,Ne.x,on+Ne.y,pt.x+pt.w,pt.y,u,ut,vt.x,at.y,it,Gt),_m(H,T.x,T.y,$e.x,on+$e.y,pt.x,pt.y+pt.h,u,ut,at.x,vt.y,it,Gt),_m(H,T.x,T.y,Qe.x,on+Qe.y,pt.x+pt.w,pt.y+pt.h,u,ut,vt.x,vt.y,it,Gt),Rv(i.dynamicLayoutVertexArray,T,ce),U.emplaceBack(Dt,Dt+1,Dt+2),U.emplaceBack(Dt+1,Dt+2,Dt+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),Se!==s.length-1&&Xt===s[Se+1].sectionIndex||i.programConfigurations.populatePaintArrays(H.length,v,v.index,{},z,be&&be[Xt])}i.placedSymbolArray.emplaceBack(T.x,T.y,te,this.glyphOffsetArray.length-te,pe,I,M,T.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],b,0,!1,0,L)},vn.prototype._addCollisionDebugVertex=function(i,s,u,p,y,v){return s.emplaceBack(0,0),i.emplaceBack(u.x,u.y,p,y,Math.round(v.x),Math.round(v.y))},vn.prototype.addCollisionDebugVertices=function(i,s,u,p,y,v,b){var T=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),I=T.vertexLength,M=y.layoutVertexArray,L=y.collisionVertexArray,z=b.anchorX,U=b.anchorY;this._addCollisionDebugVertex(M,L,v,z,U,new E(i,s)),this._addCollisionDebugVertex(M,L,v,z,U,new E(u,s)),this._addCollisionDebugVertex(M,L,v,z,U,new E(u,p)),this._addCollisionDebugVertex(M,L,v,z,U,new E(i,p)),T.vertexLength+=4;var H=y.indexArray;H.emplaceBack(I,I+1),H.emplaceBack(I+1,I+2),H.emplaceBack(I+2,I+3),H.emplaceBack(I+3,I),T.primitiveLength+=4},vn.prototype.addDebugCollisionBoxes=function(i,s,u,p){for(var y=i;y<s;y++){var v=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,p?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,u)}},vn.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Hf(Ms,Ob.members,xa),this.iconCollisionBox=new Hf(Ms,Ob.members,xa);for(var i=0;i<this.symbolInstances.length;i++){var s=this.symbolInstances.get(i);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},vn.prototype._deserializeCollisionBoxesForSymbol=function(i,s,u,p,y,v,b,T,I){for(var M={},L=s;L<u;L++){var z=i.get(L);M.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},M.textFeatureIndex=z.featureIndex;break}for(var U=p;U<y;U++){var H=i.get(U);M.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},M.verticalTextFeatureIndex=H.featureIndex;break}for(var ee=v;ee<b;ee++){var te=i.get(ee);M.iconBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},M.iconFeatureIndex=te.featureIndex;break}for(var pe=T;pe<I;pe++){var ce=i.get(pe);M.verticalIconBox={x1:ce.x1,y1:ce.y1,x2:ce.x2,y2:ce.y2,anchorPointX:ce.anchorPointX,anchorPointY:ce.anchorPointY},M.verticalIconFeatureIndex=ce.featureIndex;break}return M},vn.prototype.deserializeCollisionBoxes=function(i){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},vn.prototype.hasTextData=function(){return this.text.segments.get().length>0},vn.prototype.hasIconData=function(){return this.icon.segments.get().length>0},vn.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},vn.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},vn.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},vn.prototype.addIndicesForPlacedSymbol=function(i,s){for(var u=i.placedSymbolArray.get(s),p=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<p;y+=4)i.indexArray.emplaceBack(y,y+1,y+2),i.indexArray.emplaceBack(y+1,y+2,y+3)},vn.prototype.getSortedSymbolIndexes=function(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(i),u=Math.cos(i),p=[],y=[],v=[],b=0;b<this.symbolInstances.length;++b){v.push(b);var T=this.symbolInstances.get(b);p.push(0|Math.round(s*T.anchorX+u*T.anchorY)),y.push(T.featureIndex)}return v.sort(function(I,M){return p[I]-p[M]||y[M]-y[I]}),v},vn.prototype.addToSortKeyRanges=function(i,s){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:i,symbolInstanceEnd:i+1})},vn.prototype.sortFeatures=function(i){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,p=this.symbolInstanceIndexes;u<p.length;u+=1){var y=this.symbolInstances.get(p[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(v,b,T){v>=0&&T.indexOf(v)===b&&s.addIndicesForPlacedSymbol(s.text,v)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},ht("SymbolBucket",vn,{omit:["layers","collisionBoxArray","features","compareText"]}),vn.MAX_GLYPHS=65535,vn.addDynamicAttributes=Rv;var aL=new hr({"symbol-placement":new gt(Z.layout_symbol["symbol-placement"]),"symbol-spacing":new gt(Z.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gt(Z.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ct(Z.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gt(Z.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gt(Z.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gt(Z.layout_symbol["icon-ignore-placement"]),"icon-optional":new gt(Z.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gt(Z.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ct(Z.layout_symbol["icon-size"]),"icon-text-fit":new gt(Z.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gt(Z.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ct(Z.layout_symbol["icon-image"]),"icon-rotate":new Ct(Z.layout_symbol["icon-rotate"]),"icon-padding":new gt(Z.layout_symbol["icon-padding"]),"icon-keep-upright":new gt(Z.layout_symbol["icon-keep-upright"]),"icon-offset":new Ct(Z.layout_symbol["icon-offset"]),"icon-anchor":new Ct(Z.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gt(Z.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gt(Z.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gt(Z.layout_symbol["text-rotation-alignment"]),"text-field":new Ct(Z.layout_symbol["text-field"]),"text-font":new Ct(Z.layout_symbol["text-font"]),"text-size":new Ct(Z.layout_symbol["text-size"]),"text-max-width":new Ct(Z.layout_symbol["text-max-width"]),"text-line-height":new gt(Z.layout_symbol["text-line-height"]),"text-letter-spacing":new Ct(Z.layout_symbol["text-letter-spacing"]),"text-justify":new Ct(Z.layout_symbol["text-justify"]),"text-radial-offset":new Ct(Z.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gt(Z.layout_symbol["text-variable-anchor"]),"text-anchor":new Ct(Z.layout_symbol["text-anchor"]),"text-max-angle":new gt(Z.layout_symbol["text-max-angle"]),"text-writing-mode":new gt(Z.layout_symbol["text-writing-mode"]),"text-rotate":new Ct(Z.layout_symbol["text-rotate"]),"text-padding":new gt(Z.layout_symbol["text-padding"]),"text-keep-upright":new gt(Z.layout_symbol["text-keep-upright"]),"text-transform":new Ct(Z.layout_symbol["text-transform"]),"text-offset":new Ct(Z.layout_symbol["text-offset"]),"text-allow-overlap":new gt(Z.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gt(Z.layout_symbol["text-ignore-placement"]),"text-optional":new gt(Z.layout_symbol["text-optional"])}),Ov={paint:new hr({"icon-opacity":new Ct(Z.paint_symbol["icon-opacity"]),"icon-color":new Ct(Z.paint_symbol["icon-color"]),"icon-halo-color":new Ct(Z.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ct(Z.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ct(Z.paint_symbol["icon-halo-blur"]),"icon-translate":new gt(Z.paint_symbol["icon-translate"]),"icon-translate-anchor":new gt(Z.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ct(Z.paint_symbol["text-opacity"]),"text-color":new Ct(Z.paint_symbol["text-color"],{runtimeType:Tt,getOverride:function(i){return i.textColor},hasOverride:function(i){return!!i.textColor}}),"text-halo-color":new Ct(Z.paint_symbol["text-halo-color"]),"text-halo-width":new Ct(Z.paint_symbol["text-halo-width"]),"text-halo-blur":new Ct(Z.paint_symbol["text-halo-blur"]),"text-translate":new gt(Z.paint_symbol["text-translate"]),"text-translate-anchor":new gt(Z.paint_symbol["text-translate-anchor"])}),layout:aL},Gc=function(i){this.type=i.property.overrides?i.property.overrides.runtimeType:qe,this.defaultValue=i};Gc.prototype.evaluate=function(i){if(i.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(i.formattedSection))return s.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default},Gc.prototype.eachChild=function(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)},Gc.prototype.outputDefined=function(){return!1},Gc.prototype.serialize=function(){return null},ht("FormatSectionOverride",Gc,{omit:["defaultValue"]});var sL=function(i){function s(u){i.call(this,u,Ov)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.recalculate=function(u,p){if(i.prototype.recalculate.call(this,u,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var v=[],b=0,T=y;b<T.length;b+=1){var I=T[b];v.indexOf(I)<0&&v.push(I)}this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(u,p,y,v){var b=this.layout.get(u).evaluate(p,{},y,v),T=this._unevaluatedLayout._values[u];return T.isDataDriven()||Ps(T.value)||!b?b:function(I,M){return M.replace(/{([^{}]+)}/g,function(L,z){return z in I?String(I[z]):""})}(p.properties,b)},s.prototype.createBucket=function(u){return new vn(u)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var u=0,p=Ov.paint.overridableProperties;u<p.length;u+=1){var y=p[u];if(s.hasPaintOverride(this.layout,y)){var v,b=this.paint.get(y),T=new Gc(b),I=new fu(T,b.property.specification);v=b.value.kind==="constant"||b.value.kind==="source"?new ml("source",I):new gl("composite",I,b.value.zoomStops,b.value._interpolationType),this.paint._values[y]=new ni(b.property,v,b.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!(!this.layout||p.isDataDriven()||y.isDataDriven())&&s.hasPaintOverride(this.layout,u)},s.hasPaintOverride=function(u,p){var y=u.get("text-field"),v=Ov.paint.properties[p],b=!1,T=function(L){for(var z=0,U=L;z<U.length;z+=1)if(v.overrides&&v.overrides.hasOverride(U[z]))return void(b=!0)};if(y.value.kind==="constant"&&y.value.value instanceof bn)T(y.value.value.sections);else if(y.value.kind==="source"){var I=function(L){b||(L instanceof Xr&&Hn(L.value)===Rt?T(L.value.sections):L instanceof Ln?T(L.sections):L.eachChild(I))},M=y.value;M._styleExpression&&I(M._styleExpression.expression)}return b},s}(ui),lL={paint:new hr({"background-color":new gt(Z.paint_background["background-color"]),"background-pattern":new Qn(Z.paint_background["background-pattern"]),"background-opacity":new gt(Z.paint_background["background-opacity"])})},uL=function(i){function s(u){i.call(this,u,lL)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(ui),cL={paint:new hr({"raster-opacity":new gt(Z.paint_raster["raster-opacity"]),"raster-hue-rotate":new gt(Z.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gt(Z.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gt(Z.paint_raster["raster-brightness-max"]),"raster-saturation":new gt(Z.paint_raster["raster-saturation"]),"raster-contrast":new gt(Z.paint_raster["raster-contrast"]),"raster-resampling":new gt(Z.paint_raster["raster-resampling"]),"raster-fade-duration":new gt(Z.paint_raster["raster-fade-duration"])})},hL=function(i){function s(u){i.call(this,u,cL)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(ui),fL=function(i){function s(u){i.call(this,u,{}),this.implementation=u}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},s.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},s}(ui),pL={circle:_v,heatmap:KM,hillshade:QM,fill:gk,"fill-extrusion":Sk,line:Mk,symbol:sL,background:uL,raster:hL},rw=A.HTMLImageElement,iw=A.HTMLCanvasElement,ow=A.HTMLVideoElement,aw=A.ImageData,xm=A.ImageBitmap,Su=function(i,s,u,p){this.context=i,this.format=u,this.texture=i.gl.createTexture(),this.update(s,p)};Su.prototype.update=function(i,s,u){var p=i.width,y=i.height,v=!(this.size&&this.size[0]===p&&this.size[1]===y||u),b=this.context,T=b.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[p,y],i instanceof rw||i instanceof iw||i instanceof ow||i instanceof aw||xm&&i instanceof xm?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,i):T.texImage2D(T.TEXTURE_2D,0,this.format,p,y,0,this.format,T.UNSIGNED_BYTE,i.data);else{var I=u||{x:0,y:0},M=I.x,L=I.y;i instanceof rw||i instanceof iw||i instanceof ow||i instanceof aw||xm&&i instanceof xm?T.texSubImage2D(T.TEXTURE_2D,0,M,L,T.RGBA,T.UNSIGNED_BYTE,i):T.texSubImage2D(T.TEXTURE_2D,0,M,L,p,y,T.RGBA,T.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)},Su.prototype.bind=function(i,s,u){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),i!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||i),this.filter=i),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)},Su.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Su.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var zv=function(i){var s=this;this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};zv.prototype.trigger=function(){var i=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){i._triggered=!1,i._callback()},0))},zv.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Wc=function(i,s,u){this.target=i,this.parent=s,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ye(["receive","process"],this),this.invoker=new zv(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=_t()?i:A};function sw(i,s,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[i*p-2*Math.PI*6378137/2,s*p-2*Math.PI*6378137/2]}Wc.prototype.send=function(i,s,u,p,y){var v=this;y===void 0&&(y=!1);var b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[b]=u);var T=$n(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:i,hasCallback:!!u,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:Cs(s,T)},T),{cancel:function(){u&&delete v.callbacks[b],v.target.postMessage({id:b,type:"<cancel>",targetMapId:p,sourceMapId:v.mapId})}}},Wc.prototype.receive=function(i){var s=i.data,u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[u];var p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p()}else _t()||s.mustQueue?(this.tasks[u]=s,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,s)},Wc.prototype.process=function(){if(this.taskQueue.length){var i=this.taskQueue.shift(),s=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(i,s)}},Wc.prototype.processTask=function(i,s){var u=this;if(s.type==="<response>"){var p=this.callbacks[i];delete this.callbacks[i],p&&(s.error?p(ma(s.error)):p(null,ma(s.data)))}else{var y=!1,v=$n(this.globalScope)?void 0:[],b=s.hasCallback?function(L,z){y=!0,delete u.cancelCallbacks[i],u.target.postMessage({id:i,type:"<response>",sourceMapId:u.mapId,error:L?Cs(L):null,data:Cs(z,v)},v)}:function(L){y=!0},T=null,I=ma(s.data);if(this.parent[s.type])T=this.parent[s.type](s.sourceMapId,I,b);else if(this.parent.getWorkerSource){var M=s.type.split(".");T=this.parent.getWorkerSource(s.sourceMapId,M[0],I.source)[M[1]](I,b)}else b(new Error("Could not find function "+s.type));!y&&T&&T.cancel&&(this.cancelCallbacks[i]=T.cancel)}},Wc.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var wr=function(i,s){i&&(s?this.setSouthWest(i).setNorthEast(s):i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))};wr.prototype.setNorthEast=function(i){return this._ne=i instanceof Un?new Un(i.lng,i.lat):Un.convert(i),this},wr.prototype.setSouthWest=function(i){return this._sw=i instanceof Un?new Un(i.lng,i.lat):Un.convert(i),this},wr.prototype.extend=function(i){var s,u,p=this._sw,y=this._ne;if(i instanceof Un)s=i,u=i;else{if(!(i instanceof wr))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(wr.convert(i)):this.extend(Un.convert(i)):this;if(u=i._ne,!(s=i._sw)||!u)return this}return p||y?(p.lng=Math.min(s.lng,p.lng),p.lat=Math.min(s.lat,p.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new Un(s.lng,s.lat),this._ne=new Un(u.lng,u.lat)),this},wr.prototype.getCenter=function(){return new Un((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},wr.prototype.getSouthWest=function(){return this._sw},wr.prototype.getNorthEast=function(){return this._ne},wr.prototype.getNorthWest=function(){return new Un(this.getWest(),this.getNorth())},wr.prototype.getSouthEast=function(){return new Un(this.getEast(),this.getSouth())},wr.prototype.getWest=function(){return this._sw.lng},wr.prototype.getSouth=function(){return this._sw.lat},wr.prototype.getEast=function(){return this._ne.lng},wr.prototype.getNorth=function(){return this._ne.lat},wr.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},wr.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},wr.prototype.isEmpty=function(){return!(this._sw&&this._ne)},wr.prototype.contains=function(i){var s=Un.convert(i),u=s.lng,p=s.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&y},wr.convert=function(i){return!i||i instanceof wr?i:new wr(i)};var Un=function(i,s){if(isNaN(i)||isNaN(s))throw new Error("Invalid LngLat object: ("+i+", "+s+")");if(this.lng=+i,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Un.prototype.wrap=function(){return new Un(D(this.lng,-180,180),this.lat)},Un.prototype.toArray=function(){return[this.lng,this.lat]},Un.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Un.prototype.distanceTo=function(i){var s=Math.PI/180,u=this.lat*s,p=i.lat*s,y=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((i.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(y,1))},Un.prototype.toBounds=function(i){i===void 0&&(i=0);var s=360*i/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new wr(new Un(this.lng-u,this.lat-s),new Un(this.lng+u,this.lat+s))},Un.convert=function(i){if(i instanceof Un)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Un(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Un(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var lw=2*Math.PI*63710088e-1;function uw(i){return lw*Math.cos(i*Math.PI/180)}function cw(i){return(180+i)/360}function hw(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function fw(i,s){return i/uw(s)}function Dv(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}var Pu=function(i,s,u){u===void 0&&(u=0),this.x=+i,this.y=+s,this.z=+u};Pu.fromLngLat=function(i,s){s===void 0&&(s=0);var u=Un.convert(i);return new Pu(cw(u.lng),hw(u.lat),fw(s,u.lat))},Pu.prototype.toLngLat=function(){return new Un(360*this.x-180,Dv(this.y))},Pu.prototype.toAltitude=function(){return this.z*uw(Dv(this.y))},Pu.prototype.meterInMercatorCoordinateUnits=function(){return 1/lw*(i=Dv(this.y),1/Math.cos(i*Math.PI/180));var i};var Au=function(i,s,u){this.z=i,this.x=s,this.y=u,this.key=qf(0,i,i,s,u)};Au.prototype.equals=function(i){return this.z===i.z&&this.x===i.x&&this.y===i.y},Au.prototype.url=function(i,s){var u,p,y,v,b,T=(p=this.y,y=this.z,v=sw(256*(u=this.x),256*(p=Math.pow(2,y)-p-1),y),b=sw(256*(u+1),256*(p+1),y),v[0]+","+v[1]+","+b[0]+","+b[1]),I=function(M,L,z){for(var U,H="",ee=M;ee>0;ee--)H+=(L&(U=1<<ee-1)?1:0)+(z&U?2:0);return H}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",I).replace("{bbox-epsg-3857}",T)},Au.prototype.getTilePoint=function(i){var s=Math.pow(2,this.z);return new E(8192*(i.x*s-this.x),8192*(i.y*s-this.y))},Au.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var pw=function(i,s){this.wrap=i,this.canonical=s,this.key=qf(i,s.z,s.z,s.x,s.y)},Er=function(i,s,u,p,y){this.overscaledZ=i,this.wrap=s,this.canonical=new Au(u,+p,+y),this.key=qf(s,i,u,p,y)};function qf(i,s,u,p,y){(i*=2)<0&&(i=-1*i-1);var v=1<<u;return(v*v*i+v*y+p).toString(36)+u.toString(36)+s.toString(36)}Er.prototype.equals=function(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)},Er.prototype.scaledTo=function(i){var s=this.canonical.z-i;return i>this.canonical.z?new Er(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Er(i,this.wrap,i,this.canonical.x>>s,this.canonical.y>>s)},Er.prototype.calculateScaledKey=function(i,s){var u=this.canonical.z-i;return i>this.canonical.z?qf(this.wrap*+s,i,this.canonical.z,this.canonical.x,this.canonical.y):qf(this.wrap*+s,i,i,this.canonical.x>>u,this.canonical.y>>u)},Er.prototype.isChildOf=function(i){if(i.wrap!==this.wrap)return!1;var s=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>s&&i.canonical.y===this.canonical.y>>s},Er.prototype.children=function(i){if(this.overscaledZ>=i)return[new Er(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new Er(s,this.wrap,s,u,p),new Er(s,this.wrap,s,u+1,p),new Er(s,this.wrap,s,u,p+1),new Er(s,this.wrap,s,u+1,p+1)]},Er.prototype.isLessThan=function(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))},Er.prototype.wrapped=function(){return new Er(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Er.prototype.unwrapTo=function(i){return new Er(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)},Er.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Er.prototype.toUnwrapped=function(){return new pw(this.wrap,this.canonical)},Er.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Er.prototype.getTilePoint=function(i){return this.canonical.getTilePoint(new Pu(i.x-this.wrap,i.y))},ht("CanonicalTileID",Au),ht("OverscaledTileID",Er,{omit:["posMatrix"]});var Ds=function(i,s,u){if(this.uid=i,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return Be('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var p=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<p;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(p,y)]=this.data[this._idx(p-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,p)]=this.data[this._idx(y,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};Ds.prototype.get=function(i,s){var u=new Uint8Array(this.data.buffer),p=4*this._idx(i,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])},Ds.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Ds.prototype._idx=function(i,s){if(i<-1||i>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(i+1)},Ds.prototype._unpackMapbox=function(i,s,u){return(256*i*256+256*s+u)/10-1e4},Ds.prototype._unpackTerrarium=function(i,s,u){return 256*i+s+u/256-32768},Ds.prototype.getPixels=function(){return new Di({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Ds.prototype.backfillBorder=function(i,s,u){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");var p=s*this.dim,y=s*this.dim+this.dim,v=u*this.dim,b=u*this.dim+this.dim;switch(s){case-1:p=y-1;break;case 1:y=p+1}switch(u){case-1:v=b-1;break;case 1:b=v+1}for(var T=-s*this.dim,I=-u*this.dim,M=v;M<b;M++)for(var L=p;L<y;L++)this.data[this._idx(L,M)]=i.data[this._idx(L+T,M+I)]},ht("DEMData",Ds);var bm=function(i){this._stringToNumber={},this._numberToString=[];for(var s=0;s<i.length;s++){var u=i[s];this._stringToNumber[u]=s,this._numberToString[s]=u}};bm.prototype.encode=function(i){return this._stringToNumber[i]},bm.prototype.decode=function(i){return this._numberToString[i]};var wm=function(i,s,u,p,y){this.type="Feature",this._vectorTileFeature=i,i._z=s,i._x=u,i._y=p,this.properties=i.properties,this.id=y},Fv={geometry:{configurable:!0}};Fv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Fv.geometry.set=function(i){this._geometry=i},wm.prototype.toJSON=function(){var i={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(i[s]=this[s]);return i},Object.defineProperties(wm.prototype,Fv);var Hc=function(){this.state={},this.stateChanges={},this.deletedStates={}};Hc.prototype.updateState=function(i,s,u){var p=String(s);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][p]=this.stateChanges[i][p]||{},F(this.stateChanges[i][p],u),this.deletedStates[i]===null)for(var y in this.deletedStates[i]={},this.state[i])y!==p&&(this.deletedStates[i][y]=null);else if(this.deletedStates[i]&&this.deletedStates[i][p]===null)for(var v in this.deletedStates[i][p]={},this.state[i][p])u[v]||(this.deletedStates[i][p][v]=null);else for(var b in u)this.deletedStates[i]&&this.deletedStates[i][p]&&this.deletedStates[i][p][b]===null&&delete this.deletedStates[i][p][b]},Hc.prototype.removeFeatureState=function(i,s,u){if(this.deletedStates[i]!==null){var p=String(s);if(this.deletedStates[i]=this.deletedStates[i]||{},u&&s!==void 0)this.deletedStates[i][p]!==null&&(this.deletedStates[i][p]=this.deletedStates[i][p]||{},this.deletedStates[i][p][u]=null);else if(s!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][p])for(u in this.deletedStates[i][p]={},this.stateChanges[i][p])this.deletedStates[i][p][u]=null;else this.deletedStates[i][p]=null;else this.deletedStates[i]=null}},Hc.prototype.getState=function(i,s){var u=String(s),p=F({},(this.state[i]||{})[u],(this.stateChanges[i]||{})[u]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){var y=this.deletedStates[i][s];if(y===null)return{};for(var v in y)delete p[v]}return p},Hc.prototype.initializeTileState=function(i,s){i.setFeatureState(this.state,s)},Hc.prototype.coalesceChanges=function(i,s){var u={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var y={};for(var v in this.stateChanges[p])this.state[p][v]||(this.state[p][v]={}),F(this.state[p][v],this.stateChanges[p][v]),y[v]=this.state[p][v];u[p]=y}for(var b in this.deletedStates){this.state[b]=this.state[b]||{};var T={};if(this.deletedStates[b]===null)for(var I in this.state[b])T[I]={},this.state[b][I]={};else for(var M in this.deletedStates[b]){if(this.deletedStates[b][M]===null)this.state[b][M]={};else for(var L=0,z=Object.keys(this.deletedStates[b][M]);L<z.length;L+=1)delete this.state[b][M][z[L]];T[M]=this.state[b][M]}u[b]=u[b]||{},F(u[b],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var U in i)i[U].setFeatureState(u,s)};var Fs=function(i,s){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new $o(8192,16,0),this.grid3D=new $o(8192,16,0),this.featureIndexArray=new k,this.promoteId=s};function dw(i,s,u,p,y){return Pe(i,function(v,b){var T=s instanceof Po?s.get(b):null;return T&&T.evaluate?T.evaluate(u,p,y):T})}function mw(i){for(var s=1/0,u=1/0,p=-1/0,y=-1/0,v=0,b=i;v<b.length;v+=1){var T=b[v];s=Math.min(s,T.x),u=Math.min(u,T.y),p=Math.max(p,T.x),y=Math.max(y,T.y)}return{minX:s,minY:u,maxX:p,maxY:y}}function dL(i,s){return s-i}Fs.prototype.insert=function(i,s,u,p,y,v){var b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,y);for(var T=v?this.grid3D:this.grid,I=0;I<s.length;I++){for(var M=s[I],L=[1/0,1/0,-1/0,-1/0],z=0;z<M.length;z++){var U=M[z];L[0]=Math.min(L[0],U.x),L[1]=Math.min(L[1],U.y),L[2]=Math.max(L[2],U.x),L[3]=Math.max(L[3],U.y)}L[0]<8192&&L[1]<8192&&L[2]>=0&&L[3]>=0&&T.insert(b,L[0],L[1],L[2],L[3])}},Fs.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new zc.VectorTile(new cm(this.rawTileData)).layers,this.sourceLayerCoder=new bm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Fs.prototype.query=function(i,s,u,p){var y=this;this.loadVTLayers();for(var v=i.params||{},b=8192/i.tileSize/i.scale,T=mu(v.filter),I=i.queryGeometry,M=i.queryPadding*b,L=mw(I),z=this.grid.query(L.minX-M,L.minY-M,L.maxX+M,L.maxY+M),U=mw(i.cameraQueryGeometry),H=this.grid3D.query(U.minX-M,U.minY-M,U.maxX+M,U.maxY+M,function(Ie,Me,Ne,$e){return function(Qe,pt,at,vt,it){for(var Gt=0,St=Qe;Gt<St.length;Gt+=1){var ut=St[Gt];if(pt<=ut.x&&at<=ut.y&&vt>=ut.x&&it>=ut.y)return!0}var Xt=[new E(pt,at),new E(pt,it),new E(vt,it),new E(vt,at)];if(Qe.length>2){for(var Dt=0,on=Xt;Dt<on.length;Dt+=1)if(Jo(Qe,on[Dt]))return!0}for(var dt=0;dt<Qe.length-1;dt++)if(Tu(Qe[dt],Qe[dt+1],Xt))return!0;return!1}(i.cameraQueryGeometry,Ie-M,Me-M,Ne+M,$e+M)}),ee=0,te=H;ee<te.length;ee+=1)z.push(te[ee]);z.sort(dL);for(var pe,ce={},be=function(Ie){var Me=z[Ie];if(Me!==pe){pe=Me;var Ne=y.featureIndexArray.get(Me),$e=null;y.loadMatchingFeature(ce,Ne.bucketIndex,Ne.sourceLayerIndex,Ne.featureIndex,T,v.layers,v.availableImages,s,u,p,function(Qe,pt,at){return $e||($e=Pn(Qe)),pt.queryIntersectsFeature(I,Qe,at,$e,y.z,i.transform,b,i.pixelPosMatrix)})}},Se=0;Se<z.length;Se++)be(Se);return ce},Fs.prototype.loadMatchingFeature=function(i,s,u,p,y,v,b,T,I,M,L){var z=this.bucketLayerIDs[s];if(!v||function($e,Qe){for(var pt=0;pt<$e.length;pt++)if(Qe.indexOf($e[pt])>=0)return!0;return!1}(v,z)){var U=this.sourceLayerCoder.decode(u),H=this.vtLayers[U].feature(p);if(y.filter(new hn(this.tileID.overscaledZ),H))for(var ee=this.getId(H,U),te=0;te<z.length;te++){var pe=z[te];if(!(v&&v.indexOf(pe)<0)){var ce=T[pe];if(ce){var be={};ee!==void 0&&M&&(be=M.getState(ce.sourceLayer||"_geojsonTileLayer",ee));var Se=I[pe];Se.paint=dw(Se.paint,ce.paint,H,be,b),Se.layout=dw(Se.layout,ce.layout,H,be,b);var Ie=!L||L(H,ce,be);if(Ie){var Me=new wm(H,this.z,this.x,this.y,ee);Me.layer=Se;var Ne=i[pe];Ne===void 0&&(Ne=i[pe]=[]),Ne.push({featureIndex:p,feature:Me,intersectionZ:Ie})}}}}}},Fs.prototype.lookupSymbolFeatures=function(i,s,u,p,y,v,b,T){var I={};this.loadVTLayers();for(var M=mu(y),L=0,z=i;L<z.length;L+=1)this.loadMatchingFeature(I,u,p,z[L],M,v,b,T,s);return I},Fs.prototype.hasLayer=function(i){for(var s=0,u=this.bucketLayerIDs;s<u.length;s+=1)for(var p=0,y=u[s];p<y.length;p+=1)if(i===y[p])return!0;return!1},Fs.prototype.getId=function(i,s){var u=i.id;return this.promoteId&&typeof(u=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(u=Number(u)),u},ht("FeatureIndex",Fs,{omit:["rawTileData","sourceLayerCoder"]});var jr=function(i,s){this.tileID=i,this.uid=J(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};jr.prototype.registerFadeDuration=function(i){var s=i+this.timeAdded;s<Pt.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},jr.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},jr.prototype.loadVectorData=function(i,s,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){for(var p in i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(M,L){var z={};if(!L)return z;for(var U=function(){var te=ee[H],pe=te.layerIds.map(function(Se){return L.getLayer(Se)}).filter(Boolean);if(pe.length!==0){te.layers=pe,te.stateDependentLayerIds&&(te.stateDependentLayers=te.stateDependentLayerIds.map(function(Se){return pe.filter(function(Ie){return Ie.id===Se})[0]}));for(var ce=0,be=pe;ce<be.length;ce+=1)z[be[ce].id]=te}},H=0,ee=M;H<ee.length;H+=1)U();return z}(i.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[p];if(y instanceof vn){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var v in this.buckets){var b=this.buckets[v];if(b instanceof vn&&b.hasRTLText){this.hasRTLText=!0,Xi.isLoading()||Xi.isLoaded()||yu()!=="deferred"||nm();break}}for(var T in this.queryPadding=0,this.buckets){var I=this.buckets[T];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(T).queryRadius(I))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new c},jr.prototype.unloadVectorData=function(){for(var i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},jr.prototype.getBucket=function(i){return this.buckets[i.id]},jr.prototype.upload=function(i){for(var s in this.buckets){var u=this.buckets[s];u.uploadPending()&&u.upload(i)}var p=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Su(i,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Su(i,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},jr.prototype.prepare=function(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)},jr.prototype.queryRenderedFeatures=function(i,s,u,p,y,v,b,T,I,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:v,tileSize:this.tileSize,pixelPosMatrix:M,transform:T,params:b,queryPadding:this.queryPadding*I},i,s,u):{}},jr.prototype.querySourceFeatures=function(i,s){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var p=u.loadVTLayers(),y=s?s.sourceLayer:"",v=p._geojsonTileLayer||p[y];if(v)for(var b=mu(s&&s.filter),T=this.tileID.canonical,I=T.z,M=T.x,L=T.y,z={z:I,x:M,y:L},U=0;U<v.length;U++){var H=v.feature(U);if(b.filter(new hn(this.tileID.overscaledZ),H)){var ee=u.getId(H,y),te=new wm(H,I,M,L,ee);te.tile=z,i.push(te)}}}},jr.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},jr.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},jr.prototype.setExpiryData=function(i){var s=this.expirationTime;if(i.cacheControl){var u=gn(i.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){var p=Date.now(),y=!1;if(this.expirationTime>p)y=!1;else if(s)if(this.expirationTime<s)y=!0;else{var v=this.expirationTime-s;v?this.expirationTime=p+Math.max(v,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},jr.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},jr.prototype.setFeatureState=function(i,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(i).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(s.style.hasLayer(p)){var y=this.buckets[p],v=y.layers[0].sourceLayer||"_geojsonTileLayer",b=u[v],T=i[v];if(b&&T&&Object.keys(T).length!==0){y.update(T,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});var I=s&&s.style&&s.style.getLayer(p);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(y)))}}}},jr.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},jr.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Pt.now()},jr.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},jr.prototype.setHoldDuration=function(i){this.symbolFadeHoldUntil=Pt.now()+i},jr.prototype.setDependencies=function(i,s){for(var u={},p=0,y=s;p<y.length;p+=1)u[y[p]]=!0;this.dependencies[i]=u},jr.prototype.hasDependency=function(i,s){for(var u=0,p=i;u<p.length;u+=1){var y=this.dependencies[p[u]];if(y){for(var v=0,b=s;v<b.length;v+=1)if(y[b[v]])return!0}}return!1};var Pl=A.performance,gw=function(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},Pl.mark(this._marks.start)};gw.prototype.finish=function(){Pl.mark(this._marks.end);var i=Pl.getEntriesByName(this._marks.measure);return i.length===0&&(Pl.measure(this._marks.measure,this._marks.start,this._marks.end),i=Pl.getEntriesByName(this._marks.measure),Pl.clearMarks(this._marks.start),Pl.clearMarks(this._marks.end),Pl.clearMeasures(this._marks.measure)),i},a.Actor=Wc,a.AlphaImage=wa,a.CanonicalTileID=Au,a.CollisionBoxArray=c,a.Color=At,a.DEMData=Ds,a.DataConstantProperty=gt,a.DictionaryCoder=bm,a.EXTENT=8192,a.ErrorEvent=Y,a.EvaluationParameters=hn,a.Event=G,a.Evented=ne,a.FeatureIndex=Fs,a.FillBucket=Ea,a.FillExtrusionBucket=Ta,a.ImageAtlas=Wf,a.ImagePosition=fm,a.LineBucket=Fi,a.LngLat=Un,a.LngLatBounds=wr,a.MercatorCoordinate=Pu,a.ONE_EM=24,a.OverscaledTileID=Er,a.Point=E,a.Point$1=E,a.Properties=hr,a.Protobuf=cm,a.RGBAImage=Di,a.RequestManager=Jn,a.RequestPerformance=gw,a.ResourceType=_s,a.SegmentVector=V,a.SourceFeatureState=Hc,a.StructArrayLayout1ui2=lo,a.StructArrayLayout2f1f2i16=Eu,a.StructArrayLayout2i4=xu,a.StructArrayLayout3ui6=Xo,a.StructArrayLayout4i8=Mf,a.SymbolBucket=vn,a.Texture=Su,a.Tile=jr,a.Transitionable=Yi,a.Uniform1f=je,a.Uniform1i=Re,a.Uniform2f=Je,a.Uniform3f=Ze,a.Uniform4f=rt,a.UniformColor=ft,a.UniformMatrix4f=wt,a.UnwrappedTileID=pw,a.ValidationError=re,a.WritingMode=co,a.ZoomHistory=ga,a.add=function(i,s,u){return i[0]=s[0]+u[0],i[1]=s[1]+u[1],i[2]=s[2]+u[2],i},a.addDynamicAttributes=Rv,a.asyncAll=function(i,s,u){if(!i.length)return u(null,[]);var p=i.length,y=new Array(i.length),v=null;i.forEach(function(b,T){s(b,function(I,M){I&&(v=I),y[T]=M,--p==0&&u(v,y)})})},a.bezier=R,a.bindAll=ye,a.browser=Pt,a.cacheEntryPossiblyAdded=function(i){++Oa>vo&&(i.getActor().send("enforceCacheSizeLimit",ca),Oa=0)},a.clamp=X,a.clearTileCache=function(i){var s=A.caches.delete("mapbox-tiles");i&&s.catch(i).then(function(){return i()})},a.clipLine=Kb,a.clone=function(i){var s=new xr(16);return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},a.clone$1=ze,a.clone$2=function(i){var s=new xr(3);return s[0]=i[0],s[1]=i[1],s[2]=i[2],s},a.collisionCircleLayout=Ok,a.config=Nt,a.create=function(){var i=new xr(16);return xr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a.create$1=function(){var i=new xr(9);return xr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},a.create$2=function(){var i=new xr(4);return xr!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},a.createCommonjsModule=d,a.createExpression=pu,a.createLayout=Jr,a.createStyleLayer=function(i){return i.type==="custom"?new fL(i):new pL[i.type](i)},a.cross=function(i,s,u){var p=s[0],y=s[1],v=s[2],b=u[0],T=u[1],I=u[2];return i[0]=y*I-v*T,i[1]=v*b-p*I,i[2]=p*T-y*b,i},a.deepEqual=function i(s,u){if(Array.isArray(s)){if(!Array.isArray(u)||s.length!==u.length)return!1;for(var p=0;p<s.length;p++)if(!i(s[p],u[p]))return!1;return!0}if(typeof s=="object"&&s!==null&&u!==null){if(typeof u!="object"||Object.keys(s).length!==Object.keys(u).length)return!1;for(var y in s)if(!i(s[y],u[y]))return!1;return!0}return s===u},a.dot=function(i,s){return i[0]*s[0]+i[1]*s[1]+i[2]*s[2]},a.dot$1=function(i,s){return i[0]*s[0]+i[1]*s[1]+i[2]*s[2]+i[3]*s[3]},a.ease=j,a.emitValidationErrors=Jd,a.endsWith=Ee,a.enforceCacheSizeLimit=function(i){Wo(),vi&&vi.then(function(s){s.keys().then(function(u){for(var p=0;p<u.length-i;p++)s.delete(u[p])})})},a.evaluateSizeForFeature=Hb,a.evaluateSizeForZoom=qb,a.evaluateVariableOffset=ew,a.evented=If,a.extend=F,a.featureFilter=mu,a.filterObject=we,a.fromRotation=function(i,s){var u=Math.sin(s),p=Math.cos(s);return i[0]=p,i[1]=u,i[2]=0,i[3]=-u,i[4]=p,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},a.getAnchorAlignment=Iv,a.getAnchorJustification=Lv,a.getArrayBuffer=fa,a.getImage=Wn,a.getJSON=function(i,s){return _o(F(i,{type:"json"}),s)},a.getRTLTextPluginStatus=yu,a.getReferrer=xs,a.getVideo=function(i,s){var u,p,y=A.document.createElement("video");y.muted=!0,y.onloadstart=function(){s(null,y)};for(var v=0;v<i.length;v++){var b=A.document.createElement("source");u=i[v],p=void 0,(p=A.document.createElement("a")).href=u,(p.protocol!==A.document.location.protocol||p.host!==A.document.location.host)&&(y.crossOrigin="Anonymous"),b.src=i[v],y.appendChild(b)}return{cancel:function(){}}},a.identity=Rs,a.invert=function(i,s){var u=s[0],p=s[1],y=s[2],v=s[3],b=s[4],T=s[5],I=s[6],M=s[7],L=s[8],z=s[9],U=s[10],H=s[11],ee=s[12],te=s[13],pe=s[14],ce=s[15],be=u*T-p*b,Se=u*I-y*b,Ie=u*M-v*b,Me=p*I-y*T,Ne=p*M-v*T,$e=y*M-v*I,Qe=L*te-z*ee,pt=L*pe-U*ee,at=L*ce-H*ee,vt=z*pe-U*te,it=z*ce-H*te,Gt=U*ce-H*pe,St=be*Gt-Se*it+Ie*vt+Me*at-Ne*pt+$e*Qe;return St?(i[0]=(T*Gt-I*it+M*vt)*(St=1/St),i[1]=(y*it-p*Gt-v*vt)*St,i[2]=(te*$e-pe*Ne+ce*Me)*St,i[3]=(U*Ne-z*$e-H*Me)*St,i[4]=(I*at-b*Gt-M*pt)*St,i[5]=(u*Gt-y*at+v*pt)*St,i[6]=(pe*Ie-ee*$e-ce*Se)*St,i[7]=(L*$e-U*Ie+H*Se)*St,i[8]=(b*it-T*at+M*Qe)*St,i[9]=(p*at-u*it-v*Qe)*St,i[10]=(ee*Ne-te*Ie+ce*be)*St,i[11]=(z*Ie-L*Ne-H*be)*St,i[12]=(T*pt-b*vt-I*Qe)*St,i[13]=(u*vt-p*pt+y*Qe)*St,i[14]=(te*Se-ee*Me-pe*be)*St,i[15]=(L*Me-z*Se+U*be)*St,i):null},a.isChar=nt,a.isMapboxURL=Zr,a.keysDifference=function(i,s){var u=[];for(var p in i)p in s||u.push(p);return u},a.makeRequest=_o,a.mapObject=Pe,a.mercatorXfromLng=cw,a.mercatorYfromLat=hw,a.mercatorZfromAltitude=fw,a.mul=zi,a.multiply=er,a.mvt=zc,a.normalize=function(i,s){var u=s[0],p=s[1],y=s[2],v=u*u+p*p+y*y;return v>0&&(v=1/Math.sqrt(v)),i[0]=s[0]*v,i[1]=s[1]*v,i[2]=s[2]*v,i},a.number=Cr,a.offscreenCanvasSupported=vs,a.ortho=function(i,s,u,p,y,v,b){var T=1/(s-u),I=1/(p-y),M=1/(v-b);return i[0]=-2*T,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*I,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*M,i[11]=0,i[12]=(s+u)*T,i[13]=(y+p)*I,i[14]=(b+v)*M,i[15]=1,i},a.parseGlyphPBF=function(i){return new cm(i).readFields(Hk,[])},a.pbf=cm,a.performSymbolLayout=function(i,s,u,p,y,v,b){i.createArrays(),i.tilePixelRatio=8192/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;var T=i.layers[0].layout,I=i.layers[0]._unevaluatedLayout._values,M={};if(i.textSizeData.kind==="composite"){var L=i.textSizeData,z=L.maxZoom;M.compositeTextSizes=[I["text-size"].possiblyEvaluate(new hn(L.minZoom),b),I["text-size"].possiblyEvaluate(new hn(z),b)]}if(i.iconSizeData.kind==="composite"){var U=i.iconSizeData,H=U.maxZoom;M.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new hn(U.minZoom),b),I["icon-size"].possiblyEvaluate(new hn(H),b)]}M.layoutTextSize=I["text-size"].possiblyEvaluate(new hn(i.zoom+1),b),M.layoutIconSize=I["icon-size"].possiblyEvaluate(new hn(i.zoom+1),b),M.textMaxSize=I["text-size"].possiblyEvaluate(new hn(18));for(var ee=24*T.get("text-line-height"),te=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",pe=T.get("text-keep-upright"),ce=T.get("text-size"),be=function(){var Me=Ie[Se],Ne=T.get("text-font").evaluate(Me,{},b).join(","),$e=ce.evaluate(Me,{},b),Qe=M.layoutTextSize.evaluate(Me,{},b),pt=M.layoutIconSize.evaluate(Me,{},b),at={horizontal:{},vertical:void 0},vt=Me.text,it=[0,0];if(vt){var Gt=vt.toString(),St=24*T.get("text-letter-spacing").evaluate(Me,{},b),ut=function(Kt){for(var _n=0,Dn=Kt;_n<Dn.length;_n+=1)if(nn=Dn[_n].charCodeAt(0),nt.Arabic(nn)||nt["Arabic Supplement"](nn)||nt["Arabic Extended-A"](nn)||nt["Arabic Presentation Forms-A"](nn)||nt["Arabic Presentation Forms-B"](nn))return!1;var nn;return!0}(Gt)?St:0,Xt=T.get("text-anchor").evaluate(Me,{},b),Dt=T.get("text-variable-anchor");if(!Dt){var on=T.get("text-radial-offset").evaluate(Me,{},b);it=on?ew(Xt,[24*on,kv]):T.get("text-offset").evaluate(Me,{},b).map(function(Kt){return 24*Kt})}var dt=te?"center":T.get("text-justify").evaluate(Me,{},b),un=T.get("symbol-placement"),Rn=un==="point"?24*T.get("text-max-width").evaluate(Me,{},b):0,Lr=function(){i.allowVerticalPlacement&&Af(Gt)&&(at.vertical=pm(vt,s,u,y,Ne,Rn,ee,Xt,"left",ut,it,co.vertical,!0,un,Qe,$e))};if(!te&&Dt){for(var Rr=dt==="auto"?Dt.map(function(Kt){return Lv(Kt)}):[dt],On=!1,pr=0;pr<Rr.length;pr++){var zn=Rr[pr];if(!at.horizontal[zn])if(On)at.horizontal[zn]=at.horizontal[0];else{var Tr=pm(vt,s,u,y,Ne,Rn,ee,"center",zn,ut,it,co.horizontal,!1,un,Qe,$e);Tr&&(at.horizontal[zn]=Tr,On=Tr.positionedLines.length===1)}}Lr()}else{dt==="auto"&&(dt=Lv(Xt));var hi=pm(vt,s,u,y,Ne,Rn,ee,Xt,dt,ut,it,co.horizontal,!1,un,Qe,$e);hi&&(at.horizontal[dt]=hi),Lr(),Af(Gt)&&te&&pe&&(at.vertical=pm(vt,s,u,y,Ne,Rn,ee,Xt,dt,ut,it,co.vertical,!1,un,Qe,$e))}}var Gr=void 0,wi=!1;if(Me.icon&&Me.icon.name){var Sr=p[Me.icon.name];Sr&&(Gr=function(Kt,_n,Dn){var nn=Iv(Dn),dr=_n[0]-Kt.displaySize[0]*nn.horizontalAlign,ri=_n[1]-Kt.displaySize[1]*nn.verticalAlign;return{image:Kt,top:ri,bottom:ri+Kt.displaySize[1],left:dr,right:dr+Kt.displaySize[0]}}(y[Me.icon.name],T.get("icon-offset").evaluate(Me,{},b),T.get("icon-anchor").evaluate(Me,{},b)),wi=Sr.sdf,i.sdfIcons===void 0?i.sdfIcons=Sr.sdf:i.sdfIcons!==Sr.sdf&&Be("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Sr.pixelRatio!==i.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}var Pr=nw(at.horizontal)||at.vertical;i.iconsInText=!!Pr&&Pr.iconsInText,(Pr||Gr)&&function(Kt,_n,Dn,nn,dr,ri,Or,tr,zr,Fn,ir){var ho=ri.textMaxSize.evaluate(_n,{});ho===void 0&&(ho=Or);var Xa,or=Kt.layers[0].layout,Ya=or.get("icon-offset").evaluate(_n,{},ir),Qo=nw(Dn.horizontal),qc=Or/24,Cu=Kt.tilePixelRatio*qc,Zc=Kt.tilePixelRatio*ho/24,Ns=Kt.tilePixelRatio*tr,$c=Kt.tilePixelRatio*or.get("symbol-spacing"),Em=or.get("text-padding")*Kt.tilePixelRatio,Xc=or.get("icon-padding")*Kt.tilePixelRatio,Zf=or.get("text-max-angle")/180*Math.PI,Tm=or.get("text-rotation-alignment")==="map"&&or.get("symbol-placement")!=="point",Sm=or.get("icon-rotation-alignment")==="map"&&or.get("symbol-placement")!=="point",Bs=or.get("symbol-placement"),$f=$c/2,Yc=or.get("icon-text-fit");nn&&Yc!=="none"&&(Kt.allowVerticalPlacement&&Dn.vertical&&(Xa=Wb(nn,Dn.vertical,Yc,or.get("icon-text-fit-padding"),Ya,qc)),Qo&&(nn=Wb(nn,Qo,Yc,or.get("icon-text-fit-padding"),Ya,qc)));var Al=function(mL,np){np.x<0||np.x>=8192||np.y<0||np.y>=8192||function(ar,Sa,gL,Cl,Vv,_w,km,Ka,Lm,rp,Rm,Om,jv,xw,ip,bw,ww,Ew,Tw,Sw,fo,zm,Pw,Ja,yL){var Aw,Mu,th,nh,rh,ih=ar.addToLineVertexArray(Sa,gL),Cw=0,Iw=0,Mw=0,kw=0,Gv=-1,Wv=-1,Us={},Lw=fe(""),Hv=0,qv=0;if(Ka._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Hv=(Aw=Ka.layout.get("text-offset").evaluate(fo,{},Ja).map(function(ap){return 24*ap}))[0],qv=Aw[1]):(Hv=24*Ka.layout.get("text-radial-offset").evaluate(fo,{},Ja),qv=kv),ar.allowVerticalPlacement&&Cl.vertical){var Rw=Ka.layout.get("text-rotate").evaluate(fo,{},Ja)+90;nh=new vm(Lm,Sa,rp,Rm,Om,Cl.vertical,jv,xw,ip,Rw),km&&(rh=new vm(Lm,Sa,rp,Rm,Om,km,ww,Ew,ip,Rw))}if(Vv){var Zv=Ka.layout.get("icon-rotate").evaluate(fo,{}),Ow=Ka.layout.get("icon-text-fit")!=="none",zw=Jb(Vv,Zv,Pw,Ow),$v=km?Jb(km,Zv,Pw,Ow):void 0;th=new vm(Lm,Sa,rp,Rm,Om,Vv,ww,Ew,!1,Zv),Cw=4*zw.length;var Dw=ar.iconSizeData,op=null;Dw.kind==="source"?(op=[128*Ka.layout.get("icon-size").evaluate(fo,{})])[0]>32640&&Be(ar.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Dw.kind==="composite"&&((op=[128*zm.compositeIconSizes[0].evaluate(fo,{},Ja),128*zm.compositeIconSizes[1].evaluate(fo,{},Ja)])[0]>32640||op[1]>32640)&&Be(ar.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),ar.addSymbols(ar.icon,zw,op,Sw,Tw,fo,!1,Sa,ih.lineStartIndex,ih.lineLength,-1,Ja),Gv=ar.icon.placedSymbolArray.length-1,$v&&(Iw=4*$v.length,ar.addSymbols(ar.icon,$v,op,Sw,Tw,fo,co.vertical,Sa,ih.lineStartIndex,ih.lineLength,-1,Ja),Wv=ar.icon.placedSymbolArray.length-1)}for(var Fw in Cl.horizontal){var Dm=Cl.horizontal[Fw];if(!Mu){Lw=fe(Dm.text);var vL=Ka.layout.get("text-rotate").evaluate(fo,{},Ja);Mu=new vm(Lm,Sa,rp,Rm,Om,Dm,jv,xw,ip,vL)}var Nw=Dm.positionedLines.length===1;if(Mw+=tw(ar,Sa,Dm,_w,Ka,ip,fo,bw,ih,Cl.vertical?co.horizontal:co.horizontalOnly,Nw?Object.keys(Cl.horizontal):[Fw],Us,Gv,zm,Ja),Nw)break}Cl.vertical&&(kw+=tw(ar,Sa,Cl.vertical,_w,Ka,ip,fo,bw,ih,co.vertical,["vertical"],Us,Wv,zm,Ja));var _L=Mu?Mu.boxStartIndex:ar.collisionBoxArray.length,xL=Mu?Mu.boxEndIndex:ar.collisionBoxArray.length,bL=nh?nh.boxStartIndex:ar.collisionBoxArray.length,wL=nh?nh.boxEndIndex:ar.collisionBoxArray.length,EL=th?th.boxStartIndex:ar.collisionBoxArray.length,TL=th?th.boxEndIndex:ar.collisionBoxArray.length,SL=rh?rh.boxStartIndex:ar.collisionBoxArray.length,PL=rh?rh.boxEndIndex:ar.collisionBoxArray.length,Qa=-1,Fm=function(ap,Uw){return ap&&ap.circleDiameter?Math.max(ap.circleDiameter,Uw):Uw};Qa=Fm(Mu,Qa),Qa=Fm(nh,Qa),Qa=Fm(th,Qa);var Bw=(Qa=Fm(rh,Qa))>-1?1:0;Bw&&(Qa*=yL/24),ar.glyphOffsetArray.length>=vn.MAX_GLYPHS&&Be("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),fo.sortKey!==void 0&&ar.addToSortKeyRanges(ar.symbolInstances.length,fo.sortKey),ar.symbolInstances.emplaceBack(Sa.x,Sa.y,Us.right>=0?Us.right:-1,Us.center>=0?Us.center:-1,Us.left>=0?Us.left:-1,Us.vertical||-1,Gv,Wv,Lw,_L,xL,bL,wL,EL,TL,SL,PL,rp,Mw,kw,Cw,Iw,Bw,0,jv,Hv,qv,Qa)}(Kt,np,mL,Dn,nn,dr,Xa,Kt.layers[0],Kt.collisionBoxArray,_n.index,_n.sourceLayerIndex,Kt.index,Cu,Em,Tm,zr,Ns,Xc,Sm,Ya,_n,ri,Fn,ir,Or)};if(Bs==="line")for(var Kc=0,Pm=Kb(_n.geometry,0,0,8192,8192);Kc<Pm.length;Kc+=1)for(var Am=Pm[Kc],Xf=0,Yf=Jk(Am,$c,Zf,Dn.vertical||Qo,nn,24,Zc,Kt.overscaling,8192);Xf<Yf.length;Xf+=1){var Cm=Yf[Xf];Qo&&nL(Kt,Qo.text,$f,Cm)||Al(Am,Cm)}else if(Bs==="line-center")for(var Kf=0,Jf=_n.geometry;Kf<Jf.length;Kf+=1){var Qf=Jf[Kf];if(Qf.length>1){var Im=Kk(Qf,Zf,Dn.vertical||Qo,nn,24,Zc);Im&&Al(Qf,Im)}}else if(_n.type==="Polygon")for(var Jc=0,Mm=Tv(_n.geometry,0);Jc<Mm.length;Jc+=1){var Qc=Mm[Jc],ep=eL(Qc,16);Al(Qc[0],new Bc(ep.x,ep.y,0))}else if(_n.type==="LineString")for(var Iu=0,tp=_n.geometry;Iu<tp.length;Iu+=1){var eh=tp[Iu];Al(eh,new Bc(eh[0].x,eh[0].y,0))}else if(_n.type==="Point")for(var Nv=0,yw=_n.geometry;Nv<yw.length;Nv+=1)for(var Bv=0,vw=yw[Nv];Bv<vw.length;Bv+=1){var Uv=vw[Bv];Al([Uv],new Bc(Uv.x,Uv.y,0))}}(i,Me,at,Gr,p,M,Qe,pt,it,wi,b)},Se=0,Ie=i.features;Se<Ie.length;Se+=1)be();v&&i.generateCollisionDebugBuffers()},a.perspective=function(i,s,u,p,y){var v,b=1/Math.tan(s/2);return i[0]=b/u,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,y!=null&&y!==1/0?(i[10]=(y+p)*(v=1/(p-y)),i[14]=2*y*p*v):(i[10]=-1,i[14]=-2*p),i},a.pick=function(i,s){for(var u={},p=0;p<s.length;p++){var y=s[p];y in i&&(u[y]=i[y])}return u},a.plugin=Xi,a.polygonIntersectsPolygon=Ao,a.postMapLoadEvent=ys,a.postTurnstileEvent=ol,a.potpack=Ub,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.register=ht,a.registerForPluginStateChange=function(i){return i({pluginStatus:ti,pluginURL:ya}),If.on("pluginStateChange",i),i},a.rotate=function(i,s,u){var p=s[0],y=s[1],v=s[2],b=s[3],T=Math.sin(u),I=Math.cos(u);return i[0]=p*I+v*T,i[1]=y*I+b*T,i[2]=p*-T+v*I,i[3]=y*-T+b*I,i},a.rotateX=function(i,s,u){var p=Math.sin(u),y=Math.cos(u),v=s[4],b=s[5],T=s[6],I=s[7],M=s[8],L=s[9],z=s[10],U=s[11];return s!==i&&(i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[4]=v*y+M*p,i[5]=b*y+L*p,i[6]=T*y+z*p,i[7]=I*y+U*p,i[8]=M*y-v*p,i[9]=L*y-b*p,i[10]=z*y-T*p,i[11]=U*y-I*p,i},a.rotateZ=function(i,s,u){var p=Math.sin(u),y=Math.cos(u),v=s[0],b=s[1],T=s[2],I=s[3],M=s[4],L=s[5],z=s[6],U=s[7];return s!==i&&(i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[0]=v*y+M*p,i[1]=b*y+L*p,i[2]=T*y+z*p,i[3]=I*y+U*p,i[4]=M*y-v*p,i[5]=L*y-b*p,i[6]=z*y-T*p,i[7]=U*y-I*p,i},a.scale=function(i,s,u){var p=u[0],y=u[1],v=u[2];return i[0]=s[0]*p,i[1]=s[1]*p,i[2]=s[2]*p,i[3]=s[3]*p,i[4]=s[4]*y,i[5]=s[5]*y,i[6]=s[6]*y,i[7]=s[7]*y,i[8]=s[8]*v,i[9]=s[9]*v,i[10]=s[10]*v,i[11]=s[11]*v,i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},a.scale$1=function(i,s,u){return i[0]=s[0]*u,i[1]=s[1]*u,i[2]=s[2]*u,i[3]=s[3]*u,i},a.scale$2=function(i,s,u){return i[0]=s[0]*u,i[1]=s[1]*u,i[2]=s[2]*u,i},a.setCacheLimits=function(i,s){ca=i,vo=s},a.setRTLTextPlugin=function(i,s,u){if(u===void 0&&(u=!1),ti==="deferred"||ti==="loading"||ti==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");ya=Pt.resolveURL(i),ti="deferred",li=s,Sc(),u||nm()},a.sphericalToCartesian=function(i){var s=i[0],u=i[1],p=i[2];return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:s*Math.cos(u)*Math.sin(p),y:s*Math.sin(u)*Math.sin(p),z:s*Math.cos(p)}},a.sqrLen=function(i){var s=i[0],u=i[1];return s*s+u*u},a.styleSpec=Z,a.sub=function(i,s,u){return i[0]=s[0]-u[0],i[1]=s[1]-u[1],i[2]=s[2]-u[2],i},a.symbolSize=Yk,a.transformMat3=function(i,s,u){var p=s[0],y=s[1],v=s[2];return i[0]=p*u[0]+y*u[3]+v*u[6],i[1]=p*u[1]+y*u[4]+v*u[7],i[2]=p*u[2]+y*u[5]+v*u[8],i},a.transformMat4=Os,a.translate=function(i,s,u){var p,y,v,b,T,I,M,L,z,U,H,ee,te=u[0],pe=u[1],ce=u[2];return s===i?(i[12]=s[0]*te+s[4]*pe+s[8]*ce+s[12],i[13]=s[1]*te+s[5]*pe+s[9]*ce+s[13],i[14]=s[2]*te+s[6]*pe+s[10]*ce+s[14],i[15]=s[3]*te+s[7]*pe+s[11]*ce+s[15]):(y=s[1],v=s[2],b=s[3],T=s[4],I=s[5],M=s[6],L=s[7],z=s[8],U=s[9],H=s[10],ee=s[11],i[0]=p=s[0],i[1]=y,i[2]=v,i[3]=b,i[4]=T,i[5]=I,i[6]=M,i[7]=L,i[8]=z,i[9]=U,i[10]=H,i[11]=ee,i[12]=p*te+T*pe+z*ce+s[12],i[13]=y*te+I*pe+U*ce+s[13],i[14]=v*te+M*pe+H*ce+s[14],i[15]=b*te+L*pe+ee*ce+s[15]),i},a.triggerPluginCompletionEvent=tm,a.uniqueId=J,a.validateCustomStyleLayer=function(i){var s=[],u=i.id;return u===void 0&&s.push({message:"layers."+u+': missing required property "id"'}),i.render===void 0&&s.push({message:"layers."+u+': missing required method "render"'}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&s.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),s},a.validateLight=gv,a.validateStyle=Wa,a.values=function(i){var s=[];for(var u in i)s.push(i[u]);return s},a.vectorTile=zc,a.version="1.11.0",a.warnOnce=Be,a.webpSupported=qt,a.window=A,a.wrap=D}),l(["./shared"],function(a){function d(O){var B=typeof O;if(B==="number"||B==="boolean"||B==="string"||O==null)return JSON.stringify(O);if(Array.isArray(O)){for(var G="[",Y=0,ne=O;Y<ne.length;Y+=1)G+=d(ne[Y])+",";return G+"]"}for(var Z=Object.keys(O).sort(),re="{",ge=0;ge<Z.length;ge++)re+=JSON.stringify(Z[ge])+":"+d(O[Z[ge]])+",";return re+"}"}function g(O){for(var B="",G=0,Y=a.refProperties;G<Y.length;G+=1)B+="/"+d(O[Y[G]]);return B}var x=function(O){this.keyCache={},O&&this.replace(O)};x.prototype.replace=function(O){this._layerConfigs={},this._layers={},this.update(O,[])},x.prototype.update=function(O,B){for(var G=this,Y=0,ne=O;Y<ne.length;Y+=1){var Z=ne[Y];this._layerConfigs[Z.id]=Z;var re=this._layers[Z.id]=a.createStyleLayer(Z);re._featureFilter=a.featureFilter(re.filter),this.keyCache[Z.id]&&delete this.keyCache[Z.id]}for(var ge=0,xe=B;ge<xe.length;ge+=1){var _e=xe[ge];delete this.keyCache[_e],delete this._layerConfigs[_e],delete this._layers[_e]}this.familiesBySource={};for(var Ue=0,Ge=function(xt,Ve){for(var zt={},Rt=0;Rt<xt.length;Rt++){var Zt=Ve&&Ve[xt[Rt].id]||g(xt[Rt]);Ve&&(Ve[xt[Rt].id]=Zt);var en=zt[Zt];en||(en=zt[Zt]=[]),en.push(xt[Rt])}var bt=[];for(var mn in zt)bt.push(zt[mn]);return bt}(a.values(this._layerConfigs),this.keyCache);Ue<Ge.length;Ue+=1){var Oe=Ge[Ue].map(function(xt){return G._layers[xt.id]}),qe=Oe[0];if(qe.visibility!=="none"){var ke=qe.source||"",Xe=this.familiesBySource[ke];Xe||(Xe=this.familiesBySource[ke]={});var Ye=qe.sourceLayer||"_geojsonTileLayer",Tt=Xe[Ye];Tt||(Tt=Xe[Ye]=[]),Tt.push(Oe)}}};var E=function(O){var B={},G=[];for(var Y in O){var ne=O[Y],Z=B[Y]={};for(var re in ne){var ge=ne[+re];if(ge&&ge.bitmap.width!==0&&ge.bitmap.height!==0){var xe={x:0,y:0,w:ge.bitmap.width+2,h:ge.bitmap.height+2};G.push(xe),Z[re]={rect:xe,metrics:ge.metrics}}}}var _e=a.potpack(G),Ue=new a.AlphaImage({width:_e.w||1,height:_e.h||1});for(var Ge in O){var Oe=O[Ge];for(var qe in Oe){var ke=Oe[+qe];if(ke&&ke.bitmap.width!==0&&ke.bitmap.height!==0){var Xe=B[Ge][qe].rect;a.AlphaImage.copy(ke.bitmap,Ue,{x:0,y:0},{x:Xe.x+1,y:Xe.y+1},ke.bitmap)}}}this.image=Ue,this.positions=B};a.register("GlyphAtlas",E);var P=function(O){this.tileID=new a.OverscaledTileID(O.tileID.overscaledZ,O.tileID.wrap,O.tileID.canonical.z,O.tileID.canonical.x,O.tileID.canonical.y),this.uid=O.uid,this.zoom=O.zoom,this.pixelRatio=O.pixelRatio,this.tileSize=O.tileSize,this.source=O.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=O.showCollisionBoxes,this.collectResourceTiming=!!O.collectResourceTiming,this.returnDependencies=!!O.returnDependencies,this.promoteId=O.promoteId};function A(O,B,G){for(var Y=new a.EvaluationParameters(B),ne=0,Z=O;ne<Z.length;ne+=1)Z[ne].recalculate(Y,G)}function R(O,B){var G=a.getArrayBuffer(O.request,function(Y,ne,Z,re){Y?B(Y):ne&&B(null,{vectorTile:new a.vectorTile.VectorTile(new a.pbf(ne)),rawData:ne,cacheControl:Z,expires:re})});return function(){G.cancel(),B()}}P.prototype.parse=function(O,B,G,Y,ne){var Z=this;this.status="parsing",this.data=O,this.collisionBoxArray=new a.CollisionBoxArray;var re=new a.DictionaryCoder(Object.keys(O.layers).sort()),ge=new a.FeatureIndex(this.tileID,this.promoteId);ge.bucketLayerIDs=[];var xe,_e,Ue,Ge,Oe={},qe={featureIndex:ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:G},ke=B.familiesBySource[this.source];for(var Xe in ke){var Ye=O.layers[Xe];if(Ye){Ye.version===1&&a.warnOnce('Vector tile source "'+this.source+'" layer "'+Xe+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Tt=re.encode(Xe),xt=[],Ve=0;Ve<Ye.length;Ve++){var zt=Ye.feature(Ve),Rt=ge.getId(zt,Xe);xt.push({feature:zt,id:Rt,index:Ve,sourceLayerIndex:Tt})}for(var Zt=0,en=ke[Xe];Zt<en.length;Zt+=1){var bt=en[Zt],mn=bt[0];mn.minzoom&&this.zoom<Math.floor(mn.minzoom)||mn.maxzoom&&this.zoom>=mn.maxzoom||mn.visibility!=="none"&&(A(bt,this.zoom,G),(Oe[mn.id]=mn.createBucket({index:ge.bucketLayerIDs.length,layers:bt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Tt,sourceID:this.source})).populate(xt,qe,this.tileID.canonical),ge.bucketLayerIDs.push(bt.map(function(At){return At.id})))}}}var sn=a.mapObject(qe.glyphDependencies,function(At){return Object.keys(At).map(Number)});Object.keys(sn).length?Y.send("getGlyphs",{uid:this.uid,stacks:sn},function(At,Vt){xe||(xe=At,_e=Vt,xn.call(Z))}):_e={};var kn=Object.keys(qe.iconDependencies);kn.length?Y.send("getImages",{icons:kn,source:this.source,tileID:this.tileID,type:"icons"},function(At,Vt){xe||(xe=At,Ue=Vt,xn.call(Z))}):Ue={};var $t=Object.keys(qe.patternDependencies);function xn(){if(xe)return ne(xe);if(_e&&Ue&&Ge){var At=new E(_e),Vt=new a.ImageAtlas(Ue,Ge);for(var Qr in Oe){var bn=Oe[Qr];bn instanceof a.SymbolBucket?(A(bn.layers,this.zoom,G),a.performSymbolLayout(bn,_e,At.positions,Ue,Vt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):bn.hasPattern&&(bn instanceof a.LineBucket||bn instanceof a.FillBucket||bn instanceof a.FillExtrusionBucket)&&(A(bn.layers,this.zoom,G),bn.addFeatures(qe,this.tileID.canonical,Vt.patternPositions))}this.status="done",ne(null,{buckets:a.values(Oe).filter(function(Nr){return!Nr.isEmpty()}),featureIndex:ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:At.image,imageAtlas:Vt,glyphMap:this.returnDependencies?_e:null,iconMap:this.returnDependencies?Ue:null,glyphPositions:this.returnDependencies?At.positions:null})}}$t.length?Y.send("getImages",{icons:$t,source:this.source,tileID:this.tileID,type:"patterns"},function(At,Vt){xe||(xe=At,Ge=Vt,xn.call(Z))}):Ge={},xn.call(this)};var j=function(O,B,G,Y){this.actor=O,this.layerIndex=B,this.availableImages=G,this.loadVectorData=Y||R,this.loading={},this.loaded={}};j.prototype.loadTile=function(O,B){var G=this,Y=O.uid;this.loading||(this.loading={});var ne=!!(O&&O.request&&O.request.collectResourceTiming)&&new a.RequestPerformance(O.request),Z=this.loading[Y]=new P(O);Z.abort=this.loadVectorData(O,function(re,ge){if(delete G.loading[Y],re||!ge)return Z.status="done",G.loaded[Y]=Z,B(re);var xe=ge.rawData,_e={};ge.expires&&(_e.expires=ge.expires),ge.cacheControl&&(_e.cacheControl=ge.cacheControl);var Ue={};if(ne){var Ge=ne.finish();Ge&&(Ue.resourceTiming=JSON.parse(JSON.stringify(Ge)))}Z.vectorTile=ge.vectorTile,Z.parse(ge.vectorTile,G.layerIndex,G.availableImages,G.actor,function(Oe,qe){if(Oe||!qe)return B(Oe);B(null,a.extend({rawTileData:xe.slice(0)},qe,_e,Ue))}),G.loaded=G.loaded||{},G.loaded[Y]=Z})},j.prototype.reloadTile=function(O,B){var G=this,Y=this.loaded,ne=O.uid,Z=this;if(Y&&Y[ne]){var re=Y[ne];re.showCollisionBoxes=O.showCollisionBoxes;var ge=function(xe,_e){var Ue=re.reloadCallback;Ue&&(delete re.reloadCallback,re.parse(re.vectorTile,Z.layerIndex,G.availableImages,Z.actor,Ue)),B(xe,_e)};re.status==="parsing"?re.reloadCallback=ge:re.status==="done"&&(re.vectorTile?re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,ge):ge())}},j.prototype.abortTile=function(O,B){var G=this.loading,Y=O.uid;G&&G[Y]&&G[Y].abort&&(G[Y].abort(),delete G[Y]),B()},j.prototype.removeTile=function(O,B){var G=this.loaded,Y=O.uid;G&&G[Y]&&delete G[Y],B()};var X=a.window.ImageBitmap,D=function(){this.loaded={}};function F(O,B){if(O.length!==0){W(O[0],B);for(var G=1;G<O.length;G++)W(O[G],!B)}}function W(O,B){for(var G=0,Y=0,ne=O.length,Z=ne-1;Y<ne;Z=Y++)G+=(O[Y][0]-O[Z][0])*(O[Z][1]+O[Y][1]);G>=0!=!!B&&O.reverse()}D.prototype.loadTile=function(O,B){var G=O.uid,Y=O.encoding,ne=O.rawImageData,Z=X&&ne instanceof X?this.getImageData(ne):ne,re=new a.DEMData(G,Z,Y);this.loaded=this.loaded||{},this.loaded[G]=re,B(null,re)},D.prototype.getImageData=function(O){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(O.width,O.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=O.width,this.offscreenCanvas.height=O.height,this.offscreenCanvasContext.drawImage(O,0,0,O.width,O.height);var B=this.offscreenCanvasContext.getImageData(-1,-1,O.width+2,O.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:B.width,height:B.height},B.data)},D.prototype.removeTile=function(O){var B=this.loaded,G=O.uid;B&&B[G]&&delete B[G]};var J=a.vectorTile.VectorTileFeature.prototype.toGeoJSON,le=function(O){this._feature=O,this.extent=a.EXTENT,this.type=O.type,this.properties=O.tags,"id"in O&&!isNaN(O.id)&&(this.id=parseInt(O.id,10))};le.prototype.loadGeometry=function(){if(this._feature.type===1){for(var O=[],B=0,G=this._feature.geometry;B<G.length;B+=1){var Y=G[B];O.push([new a.Point$1(Y[0],Y[1])])}return O}for(var ne=[],Z=0,re=this._feature.geometry;Z<re.length;Z+=1){for(var ge=[],xe=0,_e=re[Z];xe<_e.length;xe+=1){var Ue=_e[xe];ge.push(new a.Point$1(Ue[0],Ue[1]))}ne.push(ge)}return ne},le.prototype.toGeoJSON=function(O,B,G){return J.call(this,O,B,G)};var ue=function(O){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=O.length,this._features=O};ue.prototype.feature=function(O){return new le(this._features[O])};var ye=a.vectorTile.VectorTileFeature,Ee=Pe;function Pe(O,B){this.options=B||{},this.features=O,this.length=O.length}function we(O,B){this.id=typeof O.id=="number"?O.id:void 0,this.type=O.type,this.rawGeometry=O.type===1?[O.geometry]:O.geometry,this.properties=O.tags,this.extent=B||4096}Pe.prototype.feature=function(O){return new we(this.features[O],this.options.extent)},we.prototype.loadGeometry=function(){var O=this.rawGeometry;this.geometry=[];for(var B=0;B<O.length;B++){for(var G=O[B],Y=[],ne=0;ne<G.length;ne++)Y.push(new a.Point$1(G[ne][0],G[ne][1]));this.geometry.push(Y)}return this.geometry},we.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var O=this.geometry,B=1/0,G=-1/0,Y=1/0,ne=-1/0,Z=0;Z<O.length;Z++)for(var re=O[Z],ge=0;ge<re.length;ge++){var xe=re[ge];B=Math.min(B,xe.x),G=Math.max(G,xe.x),Y=Math.min(Y,xe.y),ne=Math.max(ne,xe.y)}return[B,Y,G,ne]},we.prototype.toGeoJSON=ye.prototype.toGeoJSON;var ze=Be,Fe=Ee;function Be(O){var B=new a.pbf;return function(G,Y){for(var ne in G.layers)Y.writeMessage(3,He,G.layers[ne])}(O,B),B.finish()}function He(O,B){var G;B.writeVarintField(15,O.version||1),B.writeStringField(1,O.name||""),B.writeVarintField(5,O.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(G=0;G<O.length;G++)Y.feature=O.feature(G),B.writeMessage(2,We,Y);var ne=Y.keys;for(G=0;G<ne.length;G++)B.writeStringField(3,ne[G]);var Z=Y.values;for(G=0;G<Z.length;G++)B.writeMessage(4,Tn,Z[G])}function We(O,B){var G=O.feature;G.id!==void 0&&B.writeVarintField(1,G.id),B.writeMessage(2,_t,O),B.writeVarintField(3,G.type),B.writeMessage(4,$n,G)}function _t(O,B){var G=O.feature,Y=O.keys,ne=O.values,Z=O.keycache,re=O.valuecache;for(var ge in G.properties){var xe=Z[ge];xe===void 0&&(Y.push(ge),Z[ge]=xe=Y.length-1),B.writeVarint(xe);var _e=G.properties[ge],Ue=typeof _e;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(_e=JSON.stringify(_e));var Ge=Ue+":"+_e,Oe=re[Ge];Oe===void 0&&(ne.push(_e),re[Ge]=Oe=ne.length-1),B.writeVarint(Oe)}}function gn(O,B){return(B<<3)+(7&O)}function pn(O){return O<<1^O>>31}function $n(O,B){for(var G=O.loadGeometry(),Y=O.type,ne=0,Z=0,re=G.length,ge=0;ge<re;ge++){var xe=G[ge],_e=1;Y===1&&(_e=xe.length),B.writeVarint(gn(1,_e));for(var Ue=Y===3?xe.length-1:xe.length,Ge=0;Ge<Ue;Ge++){Ge===1&&Y!==1&&B.writeVarint(gn(2,Ue-1));var Oe=xe[Ge].x-ne,qe=xe[Ge].y-Z;B.writeVarint(pn(Oe)),B.writeVarint(pn(qe)),ne+=Oe,Z+=qe}Y===3&&B.writeVarint(gn(7,1))}}function Tn(O,B){var G=typeof O;G==="string"?B.writeStringField(1,O):G==="boolean"?B.writeBooleanField(7,O):G==="number"&&(O%1!=0?B.writeDoubleField(3,O):O<0?B.writeSVarintField(6,O):B.writeVarintField(5,O))}function lr(O,B,G,Y){Jt(O,G,Y),Jt(B,2*G,2*Y),Jt(B,2*G+1,2*Y+1)}function Jt(O,B,G){var Y=O[B];O[B]=O[G],O[G]=Y}function dn(O,B,G,Y){var ne=O-G,Z=B-Y;return ne*ne+Z*Z}ze.fromVectorTileJs=Be,ze.fromGeojsonVt=function(O,B){B=B||{};var G={};for(var Y in O)G[Y]=new Ee(O[Y].features,B),G[Y].name=Y,G[Y].version=B.version,G[Y].extent=B.extent;return Be({layers:G})},ze.GeoJSONWrapper=Fe;var An=function(O){return O[0]},et=function(O){return O[1]},yt=function(O,B,G,Y,ne){B===void 0&&(B=An),G===void 0&&(G=et),Y===void 0&&(Y=64),ne===void 0&&(ne=Float64Array),this.nodeSize=Y,this.points=O;for(var Z=O.length<65536?Uint16Array:Uint32Array,re=this.ids=new Z(O.length),ge=this.coords=new ne(2*O.length),xe=0;xe<O.length;xe++)re[xe]=xe,ge[2*xe]=B(O[xe]),ge[2*xe+1]=G(O[xe]);(function _e(Ue,Ge,Oe,qe,ke,Xe){if(!(ke-qe<=Oe)){var Ye=qe+ke>>1;(function Tt(xt,Ve,zt,Rt,Zt,en){for(;Zt>Rt;){if(Zt-Rt>600){var bt=Zt-Rt+1,mn=zt-Rt+1,sn=Math.log(bt),kn=.5*Math.exp(2*sn/3),$t=.5*Math.sqrt(sn*kn*(bt-kn)/bt)*(mn-bt/2<0?-1:1);Tt(xt,Ve,zt,Math.max(Rt,Math.floor(zt-mn*kn/bt+$t)),Math.min(Zt,Math.floor(zt+(bt-mn)*kn/bt+$t)),en)}var xn=Ve[2*zt+en],At=Rt,Vt=Zt;for(lr(xt,Ve,Rt,zt),Ve[2*Zt+en]>xn&&lr(xt,Ve,Rt,Zt);At<Vt;){for(lr(xt,Ve,At,Vt),At++,Vt--;Ve[2*At+en]<xn;)At++;for(;Ve[2*Vt+en]>xn;)Vt--}Ve[2*Rt+en]===xn?lr(xt,Ve,Rt,Vt):lr(xt,Ve,++Vt,Zt),Vt<=zt&&(Rt=Vt+1),zt<=Vt&&(Zt=Vt-1)}})(Ue,Ge,Ye,qe,ke,Xe%2),_e(Ue,Ge,Oe,qe,Ye-1,Xe+1),_e(Ue,Ge,Oe,Ye+1,ke,Xe+1)}})(re,ge,Y,0,re.length-1,0)};yt.prototype.range=function(O,B,G,Y){return function(ne,Z,re,ge,xe,_e,Ue){for(var Ge,Oe,qe=[0,ne.length-1,0],ke=[];qe.length;){var Xe=qe.pop(),Ye=qe.pop(),Tt=qe.pop();if(Ye-Tt<=Ue)for(var xt=Tt;xt<=Ye;xt++)Oe=Z[2*xt+1],(Ge=Z[2*xt])>=re&&Ge<=xe&&Oe>=ge&&Oe<=_e&&ke.push(ne[xt]);else{var Ve=Math.floor((Tt+Ye)/2);Oe=Z[2*Ve+1],(Ge=Z[2*Ve])>=re&&Ge<=xe&&Oe>=ge&&Oe<=_e&&ke.push(ne[Ve]);var zt=(Xe+1)%2;(Xe===0?re<=Ge:ge<=Oe)&&(qe.push(Tt),qe.push(Ve-1),qe.push(zt)),(Xe===0?xe>=Ge:_e>=Oe)&&(qe.push(Ve+1),qe.push(Ye),qe.push(zt))}}return ke}(this.ids,this.coords,O,B,G,Y,this.nodeSize)},yt.prototype.within=function(O,B,G){return function(Y,ne,Z,re,ge,xe){for(var _e=[0,Y.length-1,0],Ue=[],Ge=ge*ge;_e.length;){var Oe=_e.pop(),qe=_e.pop(),ke=_e.pop();if(qe-ke<=xe)for(var Xe=ke;Xe<=qe;Xe++)dn(ne[2*Xe],ne[2*Xe+1],Z,re)<=Ge&&Ue.push(Y[Xe]);else{var Ye=Math.floor((ke+qe)/2),Tt=ne[2*Ye],xt=ne[2*Ye+1];dn(Tt,xt,Z,re)<=Ge&&Ue.push(Y[Ye]);var Ve=(Oe+1)%2;(Oe===0?Z-ge<=Tt:re-ge<=xt)&&(_e.push(ke),_e.push(Ye-1),_e.push(Ve)),(Oe===0?Z+ge>=Tt:re+ge>=xt)&&(_e.push(Ye+1),_e.push(qe),_e.push(Ve))}}return Ue}(this.ids,this.coords,O,B,G,this.nodeSize)};var Qt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(O){return O}},Pt=function(O){this.options=Jn(Object.create(Qt),O),this.trees=new Array(this.options.maxZoom+1)};function Nt(O,B,G,Y,ne){return{x:O,y:B,zoom:1/0,id:G,parentId:-1,numPoints:Y,properties:ne}}function qt(O,B){var G=O.geometry.coordinates,Y=G[1];return{x:Kn(G[0]),y:Wt(Y),zoom:1/0,index:B,parentId:-1}}function yn(O){return{type:"Feature",id:O.id,properties:ai(O),geometry:{type:"Point",coordinates:[(Y=O.x,360*(Y-.5)),(B=O.y,G=(180-360*B)*Math.PI/180,360*Math.atan(Math.exp(G))/Math.PI-90)]}};var B,G,Y}function ai(O){var B=O.numPoints,G=B>=1e4?Math.round(B/1e3)+"k":B>=1e3?Math.round(B/100)/10+"k":B;return Jn(Jn({},O.properties),{cluster:!0,cluster_id:O.id,point_count:B,point_count_abbreviated:G})}function Kn(O){return O/360+.5}function Wt(O){var B=Math.sin(O*Math.PI/180),G=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return G<0?0:G>1?1:G}function Jn(O,B){for(var G in B)O[G]=B[G];return O}function Zr(O){return O.x}function mi(O){return O.y}function gi(O,B,G,Y,ne,Z){var re=ne-G,ge=Z-Y;if(re!==0||ge!==0){var xe=((O-G)*re+(B-Y)*ge)/(re*re+ge*ge);xe>1?(G=ne,Y=Z):xe>0&&(G+=re*xe,Y+=ge*xe)}return(re=O-G)*re+(ge=B-Y)*ge}function Go(O,B,G,Y){var ne={id:O===void 0?null:O,type:B,geometry:G,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Z){var re=Z.geometry,ge=Z.type;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")yi(Z,re);else if(ge==="Polygon"||ge==="MultiLineString")for(var xe=0;xe<re.length;xe++)yi(Z,re[xe]);else if(ge==="MultiPolygon")for(xe=0;xe<re.length;xe++)for(var _e=0;_e<re[xe].length;_e++)yi(Z,re[xe][_e])}(ne),ne}function yi(O,B){for(var G=0;G<B.length;G+=3)O.minX=Math.min(O.minX,B[G]),O.minY=Math.min(O.minY,B[G+1]),O.maxX=Math.max(O.maxX,B[G]),O.maxY=Math.max(O.maxY,B[G+1])}function Hi(O,B,G,Y){if(B.geometry){var ne=B.geometry.coordinates,Z=B.geometry.type,re=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),ge=[],xe=B.id;if(G.promoteId?xe=B.properties[G.promoteId]:G.generateId&&(xe=Y||0),Z==="Point")$r(ne,ge);else if(Z==="MultiPoint")for(var _e=0;_e<ne.length;_e++)$r(ne[_e],ge);else if(Z==="LineString")Mi(ne,ge,re,!1);else if(Z==="MultiLineString"){if(G.lineMetrics){for(_e=0;_e<ne.length;_e++)Mi(ne[_e],ge=[],re,!1),O.push(Go(xe,"LineString",ge,B.properties));return}vi(ne,ge,re,!1)}else if(Z==="Polygon")vi(ne,ge,re,!0);else{if(Z!=="MultiPolygon"){if(Z==="GeometryCollection"){for(_e=0;_e<B.geometry.geometries.length;_e++)Hi(O,{id:xe,geometry:B.geometry.geometries[_e],properties:B.properties},G,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_e=0;_e<ne.length;_e++){var Ue=[];vi(ne[_e],Ue,re,!0),ge.push(Ue)}}O.push(Go(xe,Z,ge,B.properties))}}function $r(O,B){B.push(ua(O[0])),B.push(il(O[1])),B.push(0)}function Mi(O,B,G,Y){for(var ne,Z,re=0,ge=0;ge<O.length;ge++){var xe=ua(O[ge][0]),_e=il(O[ge][1]);B.push(xe),B.push(_e),B.push(0),ge>0&&(re+=Y?(ne*_e-xe*Z)/2:Math.sqrt(Math.pow(xe-ne,2)+Math.pow(_e-Z,2))),ne=xe,Z=_e}var Ue=B.length-3;B[2]=1,function Ge(Oe,qe,ke,Xe){for(var Ye,Tt=Xe,xt=ke-qe>>1,Ve=ke-qe,zt=Oe[qe],Rt=Oe[qe+1],Zt=Oe[ke],en=Oe[ke+1],bt=qe+3;bt<ke;bt+=3){var mn=gi(Oe[bt],Oe[bt+1],zt,Rt,Zt,en);if(mn>Tt)Ye=bt,Tt=mn;else if(mn===Tt){var sn=Math.abs(bt-xt);sn<Ve&&(Ye=bt,Ve=sn)}}Tt>Xe&&(Ye-qe>3&&Ge(Oe,qe,Ye,Xe),Oe[Ye+2]=Tt,ke-Ye>3&&Ge(Oe,Ye,ke,Xe))}(B,0,Ue,G),B[Ue+2]=1,B.size=Math.abs(re),B.start=0,B.end=B.size}function vi(O,B,G,Y){for(var ne=0;ne<O.length;ne++){var Z=[];Mi(O[ne],Z,G,Y),B.push(Z)}}function ua(O){return O/360+.5}function il(O){var B=Math.sin(O*Math.PI/180),G=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return G<0?0:G>1?1:G}function ki(O,B,G,Y,ne,Z,re,ge){if(Y/=B,Z>=(G/=B)&&re<Y)return O;if(re<G||Z>=Y)return null;for(var xe=[],_e=0;_e<O.length;_e++){var Ue=O[_e],Ge=Ue.geometry,Oe=Ue.type,qe=ne===0?Ue.minX:Ue.minY,ke=ne===0?Ue.maxX:Ue.maxY;if(qe>=G&&ke<Y)xe.push(Ue);else if(!(ke<G||qe>=Y)){var Xe=[];if(Oe==="Point"||Oe==="MultiPoint")ol(Ge,Xe,G,Y,ne);else if(Oe==="LineString")La(Ge,Xe,G,Y,ne,!1,ge.lineMetrics);else if(Oe==="MultiLineString")ca(Ge,Xe,G,Y,ne,!1);else if(Oe==="Polygon")ca(Ge,Xe,G,Y,ne,!0);else if(Oe==="MultiPolygon")for(var Ye=0;Ye<Ge.length;Ye++){var Tt=[];ca(Ge[Ye],Tt,G,Y,ne,!0),Tt.length&&Xe.push(Tt)}if(Xe.length){if(ge.lineMetrics&&Oe==="LineString"){for(Ye=0;Ye<Xe.length;Ye++)xe.push(Go(Ue.id,Oe,Xe[Ye],Ue.tags));continue}Oe!=="LineString"&&Oe!=="MultiLineString"||(Xe.length===1?(Oe="LineString",Xe=Xe[0]):Oe="MultiLineString"),Oe!=="Point"&&Oe!=="MultiPoint"||(Oe=Xe.length===3?"Point":"MultiPoint"),xe.push(Go(Ue.id,Oe,Xe,Ue.tags))}}}return xe.length?xe:null}function ol(O,B,G,Y,ne){for(var Z=0;Z<O.length;Z+=3){var re=O[Z+ne];re>=G&&re<=Y&&(B.push(O[Z]),B.push(O[Z+1]),B.push(O[Z+2]))}}function La(O,B,G,Y,ne,Z,re){for(var ge,xe,_e=ys(O),Ue=ne===0?Wo:al,Ge=O.start,Oe=0;Oe<O.length-3;Oe+=3){var qe=O[Oe],ke=O[Oe+1],Xe=O[Oe+2],Ye=O[Oe+3],Tt=O[Oe+4],xt=ne===0?qe:ke,Ve=ne===0?Ye:Tt,zt=!1;re&&(ge=Math.sqrt(Math.pow(qe-Ye,2)+Math.pow(ke-Tt,2))),xt<G?Ve>G&&(xe=Ue(_e,qe,ke,Ye,Tt,G),re&&(_e.start=Ge+ge*xe)):xt>Y?Ve<Y&&(xe=Ue(_e,qe,ke,Ye,Tt,Y),re&&(_e.start=Ge+ge*xe)):vo(_e,qe,ke,Xe),Ve<G&&xt>=G&&(xe=Ue(_e,qe,ke,Ye,Tt,G),zt=!0),Ve>Y&&xt<=Y&&(xe=Ue(_e,qe,ke,Ye,Tt,Y),zt=!0),!Z&&zt&&(re&&(_e.end=Ge+ge*xe),B.push(_e),_e=ys(O)),re&&(Ge+=ge)}var Rt=O.length-3;qe=O[Rt],ke=O[Rt+1],Xe=O[Rt+2],(xt=ne===0?qe:ke)>=G&&xt<=Y&&vo(_e,qe,ke,Xe),Rt=_e.length-3,Z&&Rt>=3&&(_e[Rt]!==_e[0]||_e[Rt+1]!==_e[1])&&vo(_e,_e[0],_e[1],_e[2]),_e.length&&B.push(_e)}function ys(O){var B=[];return B.size=O.size,B.start=O.start,B.end=O.end,B}function ca(O,B,G,Y,ne,Z){for(var re=0;re<O.length;re++)La(O[re],B,G,Y,ne,Z,!1)}function vo(O,B,G,Y){O.push(B),O.push(G),O.push(Y)}function Wo(O,B,G,Y,ne,Z){var re=(Z-B)/(Y-B);return O.push(Z),O.push(G+(ne-G)*re),O.push(1),re}function al(O,B,G,Y,ne,Z){var re=(Z-G)/(ne-G);return O.push(B+(Y-B)*re),O.push(Z),O.push(1),re}function Ra(O,B){for(var G=[],Y=0;Y<O.length;Y++){var ne,Z=O[Y],re=Z.type;if(re==="Point"||re==="MultiPoint"||re==="LineString")ne=Oa(Z.geometry,B);else if(re==="MultiLineString"||re==="Polygon"){ne=[];for(var ge=0;ge<Z.geometry.length;ge++)ne.push(Oa(Z.geometry[ge],B))}else if(re==="MultiPolygon")for(ne=[],ge=0;ge<Z.geometry.length;ge++){for(var xe=[],_e=0;_e<Z.geometry[ge].length;_e++)xe.push(Oa(Z.geometry[ge][_e],B));ne.push(xe)}G.push(Go(Z.id,re,ne,Z.tags))}return G}function Oa(O,B){var G=[];G.size=O.size,O.start!==void 0&&(G.start=O.start,G.end=O.end);for(var Y=0;Y<O.length;Y+=3)G.push(O[Y]+B,O[Y+1],O[Y+2]);return G}function vs(O,B){if(O.transformed)return O;var G,Y,ne,Z=1<<O.z,re=O.x,ge=O.y;for(G=0;G<O.features.length;G++){var xe=O.features[G],_e=xe.geometry,Ue=xe.type;if(xe.geometry=[],Ue===1)for(Y=0;Y<_e.length;Y+=2)xe.geometry.push(_s(_e[Y],_e[Y+1],B,Z,re,ge));else for(Y=0;Y<_e.length;Y++){var Ge=[];for(ne=0;ne<_e[Y].length;ne+=2)Ge.push(_s(_e[Y][ne],_e[Y][ne+1],B,Z,re,ge));xe.geometry.push(Ge)}}return O.transformed=!0,O}function _s(O,B,G,Y,ne,Z){return[Math.round(G*(O*Y-ne)),Math.round(G*(B*Y-Z))]}function ha(O,B,G,Y,ne){for(var Z=B===ne.maxZoom?0:ne.tolerance/((1<<B)*ne.extent),re={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:G,y:Y,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ge=0;ge<O.length;ge++){re.numFeatures++,xs(re,O[ge],Z,ne);var xe=O[ge].minX,_e=O[ge].minY,Ue=O[ge].maxX,Ge=O[ge].maxY;xe<re.minX&&(re.minX=xe),_e<re.minY&&(re.minY=_e),Ue>re.maxX&&(re.maxX=Ue),Ge>re.maxY&&(re.maxY=Ge)}return re}function xs(O,B,G,Y){var ne=B.geometry,Z=B.type,re=[];if(Z==="Point"||Z==="MultiPoint")for(var ge=0;ge<ne.length;ge+=3)re.push(ne[ge]),re.push(ne[ge+1]),O.numPoints++,O.numSimplified++;else if(Z==="LineString")Ho(re,ne,O,G,!1,!1);else if(Z==="MultiLineString"||Z==="Polygon")for(ge=0;ge<ne.length;ge++)Ho(re,ne[ge],O,G,Z==="Polygon",ge===0);else if(Z==="MultiPolygon")for(var xe=0;xe<ne.length;xe++){var _e=ne[xe];for(ge=0;ge<_e.length;ge++)Ho(re,_e[ge],O,G,!0,ge===0)}if(re.length){var Ue=B.tags||null;if(Z==="LineString"&&Y.lineMetrics){for(var Ge in Ue={},B.tags)Ue[Ge]=B.tags[Ge];Ue.mapbox_clip_start=ne.start/ne.size,Ue.mapbox_clip_end=ne.end/ne.size}var Oe={geometry:re,type:Z==="Polygon"||Z==="MultiPolygon"?3:Z==="LineString"||Z==="MultiLineString"?2:1,tags:Ue};B.id!==null&&(Oe.id=B.id),O.features.push(Oe)}}function Ho(O,B,G,Y,ne,Z){var re=Y*Y;if(Y>0&&B.size<(ne?re:Y))G.numPoints+=B.length/3;else{for(var ge=[],xe=0;xe<B.length;xe+=3)(Y===0||B[xe+2]>re)&&(G.numSimplified++,ge.push(B[xe]),ge.push(B[xe+1])),G.numPoints++;ne&&function(_e,Ue){for(var Ge=0,Oe=0,qe=_e.length,ke=qe-2;Oe<qe;ke=Oe,Oe+=2)Ge+=(_e[Oe]-_e[ke])*(_e[Oe+1]+_e[ke+1]);if(Ge>0===Ue)for(Oe=0,qe=_e.length;Oe<qe/2;Oe+=2){var Xe=_e[Oe],Ye=_e[Oe+1];_e[Oe]=_e[qe-2-Oe],_e[Oe+1]=_e[qe-1-Oe],_e[qe-2-Oe]=Xe,_e[qe-1-Oe]=Ye}}(ge,Z),O.push(ge)}}function qi(O,B){var G=(B=this.options=function(ne,Z){for(var re in Z)ne[re]=Z[re];return ne}(Object.create(this.options),B)).debug;if(G&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y=function(ne,Z){var re=[];if(ne.type==="FeatureCollection")for(var ge=0;ge<ne.features.length;ge++)Hi(re,ne.features[ge],Z,ge);else Hi(re,ne.type==="Feature"?ne:{geometry:ne},Z);return re}(O,B);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Y=function(ne,Z){var re=Z.buffer/Z.extent,ge=ne,xe=ki(ne,1,-1-re,re,0,-1,2,Z),_e=ki(ne,1,1-re,2+re,0,-1,2,Z);return(xe||_e)&&(ge=ki(ne,1,-re,1+re,0,-1,2,Z)||[],xe&&(ge=Ra(xe,1).concat(ge)),_e&&(ge=ge.concat(Ra(_e,-1)))),ge}(Y,B)).length&&this.splitTile(Y,0,0,0),G&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function _o(O,B,G){return 32*((1<<O)*G+B)+O}function fa(O,B){var G=O.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);var Y=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!Y)return B(null,null);var ne=new ue(Y.features),Z=ze(ne);Z.byteOffset===0&&Z.byteLength===Z.buffer.byteLength||(Z=new Uint8Array(Z)),B(null,{vectorTile:ne,rawData:Z.buffer})}Pt.prototype.load=function(O){var B=this.options,G=B.log,Y=B.minZoom,ne=B.maxZoom,Z=B.nodeSize;G&&console.time("total time");var re="prepare "+O.length+" points";G&&console.time(re),this.points=O;for(var ge=[],xe=0;xe<O.length;xe++)O[xe].geometry&&ge.push(qt(O[xe],xe));this.trees[ne+1]=new yt(ge,Zr,mi,Z,Float32Array),G&&console.timeEnd(re);for(var _e=ne;_e>=Y;_e--){var Ue=+Date.now();ge=this._cluster(ge,_e),this.trees[_e]=new yt(ge,Zr,mi,Z,Float32Array),G&&console.log("z%d: %d clusters in %dms",_e,ge.length,+Date.now()-Ue)}return G&&console.timeEnd("total time"),this},Pt.prototype.getClusters=function(O,B){var G=((O[0]+180)%360+360)%360-180,Y=Math.max(-90,Math.min(90,O[1])),ne=O[2]===180?180:((O[2]+180)%360+360)%360-180,Z=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)G=-180,ne=180;else if(G>ne){var re=this.getClusters([G,Y,180,Z],B),ge=this.getClusters([-180,Y,ne,Z],B);return re.concat(ge)}for(var xe=this.trees[this._limitZoom(B)],_e=[],Ue=0,Ge=xe.range(Kn(G),Wt(Z),Kn(ne),Wt(Y));Ue<Ge.length;Ue+=1){var Oe=xe.points[Ge[Ue]];_e.push(Oe.numPoints?yn(Oe):this.points[Oe.index])}return _e},Pt.prototype.getChildren=function(O){var B=this._getOriginId(O),G=this._getOriginZoom(O),Y="No cluster with the specified id.",ne=this.trees[G];if(!ne)throw new Error(Y);var Z=ne.points[B];if(!Z)throw new Error(Y);for(var re=this.options.radius/(this.options.extent*Math.pow(2,G-1)),ge=[],xe=0,_e=ne.within(Z.x,Z.y,re);xe<_e.length;xe+=1){var Ue=ne.points[_e[xe]];Ue.parentId===O&&ge.push(Ue.numPoints?yn(Ue):this.points[Ue.index])}if(ge.length===0)throw new Error(Y);return ge},Pt.prototype.getLeaves=function(O,B,G){var Y=[];return this._appendLeaves(Y,O,B=B||10,G=G||0,0),Y},Pt.prototype.getTile=function(O,B,G){var Y=this.trees[this._limitZoom(O)],ne=Math.pow(2,O),Z=this.options,re=Z.radius/Z.extent,ge=(G-re)/ne,xe=(G+1+re)/ne,_e={features:[]};return this._addTileFeatures(Y.range((B-re)/ne,ge,(B+1+re)/ne,xe),Y.points,B,G,ne,_e),B===0&&this._addTileFeatures(Y.range(1-re/ne,ge,1,xe),Y.points,ne,G,ne,_e),B===ne-1&&this._addTileFeatures(Y.range(0,ge,re/ne,xe),Y.points,-1,G,ne,_e),_e.features.length?_e:null},Pt.prototype.getClusterExpansionZoom=function(O){for(var B=this._getOriginZoom(O)-1;B<=this.options.maxZoom;){var G=this.getChildren(O);if(B++,G.length!==1)break;O=G[0].properties.cluster_id}return B},Pt.prototype._appendLeaves=function(O,B,G,Y,ne){for(var Z=0,re=this.getChildren(B);Z<re.length;Z+=1){var ge=re[Z],xe=ge.properties;if(xe&&xe.cluster?ne+xe.point_count<=Y?ne+=xe.point_count:ne=this._appendLeaves(O,xe.cluster_id,G,Y,ne):ne<Y?ne++:O.push(ge),O.length===G)break}return ne},Pt.prototype._addTileFeatures=function(O,B,G,Y,ne,Z){for(var re=0,ge=O;re<ge.length;re+=1){var xe=B[ge[re]],_e=xe.numPoints,Ue={type:1,geometry:[[Math.round(this.options.extent*(xe.x*ne-G)),Math.round(this.options.extent*(xe.y*ne-Y))]],tags:_e?ai(xe):this.points[xe.index].properties},Ge=void 0;_e?Ge=xe.id:this.options.generateId?Ge=xe.index:this.points[xe.index].id&&(Ge=this.points[xe.index].id),Ge!==void 0&&(Ue.id=Ge),Z.features.push(Ue)}},Pt.prototype._limitZoom=function(O){return Math.max(this.options.minZoom,Math.min(+O,this.options.maxZoom+1))},Pt.prototype._cluster=function(O,B){for(var G=[],Y=this.options,ne=Y.reduce,Z=Y.minPoints,re=Y.radius/(Y.extent*Math.pow(2,B)),ge=0;ge<O.length;ge++){var xe=O[ge];if(!(xe.zoom<=B)){xe.zoom=B;for(var _e=this.trees[B+1],Ue=_e.within(xe.x,xe.y,re),Ge=xe.numPoints||1,Oe=Ge,qe=0,ke=Ue;qe<ke.length;qe+=1){var Xe=_e.points[ke[qe]];Xe.zoom>B&&(Oe+=Xe.numPoints||1)}if(Oe>=Z){for(var Ye=xe.x*Ge,Tt=xe.y*Ge,xt=ne&&Ge>1?this._map(xe,!0):null,Ve=(ge<<5)+(B+1)+this.points.length,zt=0,Rt=Ue;zt<Rt.length;zt+=1){var Zt=_e.points[Rt[zt]];if(!(Zt.zoom<=B)){Zt.zoom=B;var en=Zt.numPoints||1;Ye+=Zt.x*en,Tt+=Zt.y*en,Zt.parentId=Ve,ne&&(xt||(xt=this._map(xe,!0)),ne(xt,this._map(Zt)))}}xe.parentId=Ve,G.push(Nt(Ye/Oe,Tt/Oe,Ve,Oe,xt))}else if(G.push(xe),Oe>1)for(var bt=0,mn=Ue;bt<mn.length;bt+=1){var sn=_e.points[mn[bt]];sn.zoom<=B||(sn.zoom=B,G.push(sn))}}}return G},Pt.prototype._getOriginId=function(O){return O-this.points.length>>5},Pt.prototype._getOriginZoom=function(O){return(O-this.points.length)%32},Pt.prototype._map=function(O,B){if(O.numPoints)return B?Jn({},O.properties):O.properties;var G=this.points[O.index].properties,Y=this.options.map(G);return B&&Y===G?Jn({},Y):Y},qi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},qi.prototype.splitTile=function(O,B,G,Y,ne,Z,re){for(var ge=[O,B,G,Y],xe=this.options,_e=xe.debug;ge.length;){Y=ge.pop(),G=ge.pop(),B=ge.pop(),O=ge.pop();var Ue=1<<B,Ge=_o(B,G,Y),Oe=this.tiles[Ge];if(!Oe&&(_e>1&&console.time("creation"),Oe=this.tiles[Ge]=ha(O,B,G,Y,xe),this.tileCoords.push({z:B,x:G,y:Y}),_e)){_e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,G,Y,Oe.numFeatures,Oe.numPoints,Oe.numSimplified),console.timeEnd("creation"));var qe="z"+B;this.stats[qe]=(this.stats[qe]||0)+1,this.total++}if(Oe.source=O,ne){if(B===xe.maxZoom||B===ne)continue;var ke=1<<ne-B;if(G!==Math.floor(Z/ke)||Y!==Math.floor(re/ke))continue}else if(B===xe.indexMaxZoom||Oe.numPoints<=xe.indexMaxPoints)continue;if(Oe.source=null,O.length!==0){_e>1&&console.time("clipping");var Xe,Ye,Tt,xt,Ve,zt,Rt=.5*xe.buffer/xe.extent,Zt=.5-Rt,en=.5+Rt,bt=1+Rt;Xe=Ye=Tt=xt=null,Ve=ki(O,Ue,G-Rt,G+en,0,Oe.minX,Oe.maxX,xe),zt=ki(O,Ue,G+Zt,G+bt,0,Oe.minX,Oe.maxX,xe),O=null,Ve&&(Xe=ki(Ve,Ue,Y-Rt,Y+en,1,Oe.minY,Oe.maxY,xe),Ye=ki(Ve,Ue,Y+Zt,Y+bt,1,Oe.minY,Oe.maxY,xe),Ve=null),zt&&(Tt=ki(zt,Ue,Y-Rt,Y+en,1,Oe.minY,Oe.maxY,xe),xt=ki(zt,Ue,Y+Zt,Y+bt,1,Oe.minY,Oe.maxY,xe),zt=null),_e>1&&console.timeEnd("clipping"),ge.push(Xe||[],B+1,2*G,2*Y),ge.push(Ye||[],B+1,2*G,2*Y+1),ge.push(Tt||[],B+1,2*G+1,2*Y),ge.push(xt||[],B+1,2*G+1,2*Y+1)}}},qi.prototype.getTile=function(O,B,G){var Y=this.options,ne=Y.extent,Z=Y.debug;if(O<0||O>24)return null;var re=1<<O,ge=_o(O,B=(B%re+re)%re,G);if(this.tiles[ge])return vs(this.tiles[ge],ne);Z>1&&console.log("drilling down to z%d-%d-%d",O,B,G);for(var xe,_e=O,Ue=B,Ge=G;!xe&&_e>0;)_e--,Ue=Math.floor(Ue/2),Ge=Math.floor(Ge/2),xe=this.tiles[_o(_e,Ue,Ge)];return xe&&xe.source?(Z>1&&console.log("found parent tile z%d-%d-%d",_e,Ue,Ge),Z>1&&console.time("drilling down"),this.splitTile(xe.source,_e,Ue,Ge,O,B,G),Z>1&&console.timeEnd("drilling down"),this.tiles[ge]?vs(this.tiles[ge],ne):null):null};var ou=function(O){function B(G,Y,ne,Z){O.call(this,G,Y,ne,fa),Z&&(this.loadGeoJSON=Z)}return O&&(B.__proto__=O),(B.prototype=Object.create(O&&O.prototype)).constructor=B,B.prototype.loadData=function(G,Y){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Y,this._pendingLoadDataParams=G,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},B.prototype._loadData=function(){var G=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Y=this._pendingCallback,ne=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Z=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new a.RequestPerformance(ne.request);this.loadGeoJSON(ne,function(re,ge){if(re||!ge)return Y(re);if(typeof ge!="object")return Y(new Error("Input data given to '"+ne.source+"' is not a valid GeoJSON object."));(function Ue(Ge,Oe){var qe,ke=Ge&&Ge.type;if(ke==="FeatureCollection")for(qe=0;qe<Ge.features.length;qe++)Ue(Ge.features[qe],Oe);else if(ke==="GeometryCollection")for(qe=0;qe<Ge.geometries.length;qe++)Ue(Ge.geometries[qe],Oe);else if(ke==="Feature")Ue(Ge.geometry,Oe);else if(ke==="Polygon")F(Ge.coordinates,Oe);else if(ke==="MultiPolygon")for(qe=0;qe<Ge.coordinates.length;qe++)F(Ge.coordinates[qe],Oe);return Ge})(ge,!0);try{G._geoJSONIndex=ne.cluster?new Pt(function(Ue){var Ge=Ue.superclusterOptions,Oe=Ue.clusterProperties;if(!Oe||!Ge)return Ge;for(var qe={},ke={},Xe={accumulated:null,zoom:0},Ye={properties:null},Tt=Object.keys(Oe),xt=0,Ve=Tt;xt<Ve.length;xt+=1){var zt=Ve[xt],Rt=Oe[zt],Zt=Rt[0],en=a.createExpression(Rt[1]),bt=a.createExpression(typeof Zt=="string"?[Zt,["accumulated"],["get",zt]]:Zt);qe[zt]=en.value,ke[zt]=bt.value}return Ge.map=function(mn){Ye.properties=mn;for(var sn={},kn=0,$t=Tt;kn<$t.length;kn+=1){var xn=$t[kn];sn[xn]=qe[xn].evaluate(Xe,Ye)}return sn},Ge.reduce=function(mn,sn){Ye.properties=sn;for(var kn=0,$t=Tt;kn<$t.length;kn+=1){var xn=$t[kn];Xe.accumulated=mn[xn],mn[xn]=ke[xn].evaluate(Xe,Ye)}},Ge}(ne)).load(ge.features):function(Ue,Ge){return new qi(Ue,Ge)}(ge,ne.geojsonVtOptions)}catch(Ue){return Y(Ue)}G.loaded={};var xe={};if(Z){var _e=Z.finish();_e&&(xe.resourceTiming={},xe.resourceTiming[ne.source]=JSON.parse(JSON.stringify(_e)))}Y(null,xe)})}},B.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},B.prototype.reloadTile=function(G,Y){var ne=this.loaded;return ne&&ne[G.uid]?O.prototype.reloadTile.call(this,G,Y):this.loadTile(G,Y)},B.prototype.loadGeoJSON=function(G,Y){if(G.request)a.getJSON(G.request,Y);else{if(typeof G.data!="string")return Y(new Error("Input data given to '"+G.source+"' is not a valid GeoJSON object."));try{return Y(null,JSON.parse(G.data))}catch{return Y(new Error("Input data given to '"+G.source+"' is not a valid GeoJSON object."))}}},B.prototype.removeSource=function(G,Y){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Y()},B.prototype.getClusterExpansionZoom=function(G,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(ne){Y(ne)}},B.prototype.getClusterChildren=function(G,Y){try{Y(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(ne){Y(ne)}},B.prototype.getClusterLeaves=function(G,Y){try{Y(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(ne){Y(ne)}},B}(j),Wn=function(O){var B=this;this.self=O,this.actor=new a.Actor(O,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:j,geojson:ou},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(G,Y){if(B.workerSourceTypes[G])throw new Error('Worker source with name "'+G+'" already registered.');B.workerSourceTypes[G]=Y},this.self.registerRTLTextPlugin=function(G){if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=G.applyArabicShaping,a.plugin.processBidirectionalText=G.processBidirectionalText,a.plugin.processStyledBidirectionalText=G.processStyledBidirectionalText}};return Wn.prototype.setReferrer=function(O,B){this.referrer=B},Wn.prototype.setImages=function(O,B,G){for(var Y in this.availableImages[O]=B,this.workerSources[O]){var ne=this.workerSources[O][Y];for(var Z in ne)ne[Z].availableImages=B}G()},Wn.prototype.setLayers=function(O,B,G){this.getLayerIndex(O).replace(B),G()},Wn.prototype.updateLayers=function(O,B,G){this.getLayerIndex(O).update(B.layers,B.removedIds),G()},Wn.prototype.loadTile=function(O,B,G){this.getWorkerSource(O,B.type,B.source).loadTile(B,G)},Wn.prototype.loadDEMTile=function(O,B,G){this.getDEMWorkerSource(O,B.source).loadTile(B,G)},Wn.prototype.reloadTile=function(O,B,G){this.getWorkerSource(O,B.type,B.source).reloadTile(B,G)},Wn.prototype.abortTile=function(O,B,G){this.getWorkerSource(O,B.type,B.source).abortTile(B,G)},Wn.prototype.removeTile=function(O,B,G){this.getWorkerSource(O,B.type,B.source).removeTile(B,G)},Wn.prototype.removeDEMTile=function(O,B){this.getDEMWorkerSource(O,B.source).removeTile(B)},Wn.prototype.removeSource=function(O,B,G){if(this.workerSources[O]&&this.workerSources[O][B.type]&&this.workerSources[O][B.type][B.source]){var Y=this.workerSources[O][B.type][B.source];delete this.workerSources[O][B.type][B.source],Y.removeSource!==void 0?Y.removeSource(B,G):G()}},Wn.prototype.loadWorkerSource=function(O,B,G){try{this.self.importScripts(B.url),G()}catch(Y){G(Y.toString())}},Wn.prototype.syncRTLPluginState=function(O,B,G){try{a.plugin.setState(B);var Y=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&Y!=null){this.self.importScripts(Y);var ne=a.plugin.isParsed();G(ne?void 0:new Error("RTL Text Plugin failed to import scripts from "+Y),ne)}}catch(Z){G(Z.toString())}},Wn.prototype.getAvailableImages=function(O){var B=this.availableImages[O];return B||(B=[]),B},Wn.prototype.getLayerIndex=function(O){var B=this.layerIndexes[O];return B||(B=this.layerIndexes[O]=new x),B},Wn.prototype.getWorkerSource=function(O,B,G){var Y=this;return this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][B]||(this.workerSources[O][B]={}),this.workerSources[O][B][G]||(this.workerSources[O][B][G]=new this.workerSourceTypes[B]({send:function(ne,Z,re){Y.actor.send(ne,Z,re,O)}},this.getLayerIndex(O),this.getAvailableImages(O))),this.workerSources[O][B][G]},Wn.prototype.getDEMWorkerSource=function(O,B){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][B]||(this.demWorkerSources[O][B]=new D),this.demWorkerSources[O][B]},Wn.prototype.enforceCacheSizeLimit=function(O,B){a.enforceCacheSizeLimit(B)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Wn(self)),Wn}),l(["./shared"],function(a){var d=a.createCommonjsModule(function(c){function f(_){return!h(_)}function h(_){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var S,C,k=new Blob([""],{type:"text/javascript"}),N=URL.createObjectURL(k);try{C=new Worker(N),S=!0}catch{S=!1}return C&&C.terminate(),URL.revokeObjectURL(N),S}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var S=document.createElement("canvas");S.width=S.height=1;var C=S.getContext("2d");if(!C)return!1;var k=C.getImageData(0,0,1,1);return k&&k.width===S.width}()?(m[w=_&&_.failIfMajorPerformanceCaveat]===void 0&&(m[w]=function(S){var C=function(N){var V=document.createElement("canvas"),K=Object.create(f.webGLContextAttributes);return K.failIfMajorPerformanceCaveat=N,V.probablySupportsContext?V.probablySupportsContext("webgl",K)||V.probablySupportsContext("experimental-webgl",K):V.supportsContext?V.supportsContext("webgl",K)||V.supportsContext("experimental-webgl",K):V.getContext("webgl",K)||V.getContext("experimental-webgl",K)}(S);if(!C)return!1;var k=C.createShader(C.VERTEX_SHADER);return!(!k||C.isContextLost())&&(C.shaderSource(k,"void main() {}"),C.compileShader(k),C.getShaderParameter(k,C.COMPILE_STATUS)===!0)}(w)),m[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}c.exports?c.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=h);var m={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),g={create:function(c,f,h){var m=a.window.document.createElement(c);return f!==void 0&&(m.className=f),h&&h.appendChild(m),m},createNS:function(c,f){return a.window.document.createElementNS(c,f)}},x=a.window.document&&a.window.document.documentElement.style;function E(c){if(!x)return c[0];for(var f=0;f<c.length;f++)if(c[f]in x)return c[f];return c[0]}var P,A=E(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);g.disableDrag=function(){x&&A&&(P=x[A],x[A]="none")},g.enableDrag=function(){x&&A&&(x[A]=P)};var R=E(["transform","WebkitTransform"]);g.setTransform=function(c,f){c.style[R]=f};var j=!1;try{var X=Object.defineProperty({},"passive",{get:function(){j=!0}});a.window.addEventListener("test",X,X),a.window.removeEventListener("test",X,X)}catch{j=!1}g.addEventListener=function(c,f,h,m){m===void 0&&(m={}),c.addEventListener(f,h,"passive"in m&&j?m:m.capture)},g.removeEventListener=function(c,f,h,m){m===void 0&&(m={}),c.removeEventListener(f,h,"passive"in m&&j?m:m.capture)};var D=function(c){c.preventDefault(),c.stopPropagation(),a.window.removeEventListener("click",D,!0)};function F(c){var f=c.userImage;return!!(f&&f.render&&f.render())&&(c.data.replace(new Uint8Array(f.data.buffer)),!0)}g.suppressClick=function(){a.window.addEventListener("click",D,!0),a.window.setTimeout(function(){a.window.removeEventListener("click",D,!0)},0)},g.mousePos=function(c,f){var h=c.getBoundingClientRect();return new a.Point(f.clientX-h.left-c.clientLeft,f.clientY-h.top-c.clientTop)},g.touchPos=function(c,f){for(var h=c.getBoundingClientRect(),m=[],_=0;_<f.length;_++)m.push(new a.Point(f[_].clientX-h.left-c.clientLeft,f[_].clientY-h.top-c.clientTop));return m},g.mouseButton=function(c){return a.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button},g.remove=function(c){c.parentNode&&c.parentNode.removeChild(c)};var W=function(c){function f(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var m=0,_=this.requestors;m<_.length;m+=1){var w=_[m];this._notify(w.ids,w.callback)}this.requestors=[]}},f.prototype.getImage=function(h){return this.images[h]},f.prototype.addImage=function(h,m){this._validate(h,m)&&(this.images[h]=m)},f.prototype._validate=function(h,m){var _=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new a.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),_=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new a.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),_=!1),this._validateContent(m.content,m)||(this.fire(new a.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),_=!1),_},f.prototype._validateStretch=function(h,m){if(!h)return!0;for(var _=0,w=0,S=h;w<S.length;w+=1){var C=S[w];if(C[0]<_||C[1]<C[0]||m<C[1])return!1;_=C[1]}return!0},f.prototype._validateContent=function(h,m){return!(h&&(h.length!==4||h[0]<0||m.data.width<h[0]||h[1]<0||m.data.height<h[1]||h[2]<0||m.data.width<h[2]||h[3]<0||m.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},f.prototype.updateImage=function(h,m){m.version=this.images[h].version+1,this.images[h]=m,this.updatedImages[h]=!0},f.prototype.removeImage=function(h){var m=this.images[h];delete this.images[h],delete this.patterns[h],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(h,m){var _=!0;if(!this.isLoaded())for(var w=0,S=h;w<S.length;w+=1)this.images[S[w]]||(_=!1);this.isLoaded()||_?this._notify(h,m):this.requestors.push({ids:h,callback:m})},f.prototype._notify=function(h,m){for(var _={},w=0,S=h;w<S.length;w+=1){var C=S[w];this.images[C]||this.fire(new a.Event("styleimagemissing",{id:C}));var k=this.images[C];k?_[C]={data:k.data.clone(),pixelRatio:k.pixelRatio,sdf:k.sdf,version:k.version,stretchX:k.stretchX,stretchY:k.stretchY,content:k.content,hasRenderCallback:Boolean(k.userImage&&k.userImage.render)}:a.warnOnce('Image "'+C+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}m(null,_)},f.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},f.prototype.getPattern=function(h){var m=this.patterns[h],_=this.getImage(h);if(!_)return null;if(m&&m.position.version===_.version)return m.position;if(m)m.position.version=_.version;else{var w={w:_.data.width+2,h:_.data.height+2,x:0,y:0},S=new a.ImagePosition(w,_);this.patterns[h]={bin:w,position:S}}return this._updatePatternAtlas(),this.patterns[h].position},f.prototype.bind=function(h){var m=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(h,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var h=[];for(var m in this.patterns)h.push(this.patterns[m].bin);var _=a.potpack(h),w=_.w,S=_.h,C=this.atlasImage;for(var k in C.resize({width:w||1,height:S||1}),this.patterns){var N=this.patterns[k].bin,V=N.x+1,K=N.y+1,$=this.images[k].data,ae=$.width,se=$.height;a.RGBAImage.copy($,C,{x:0,y:0},{x:V,y:K},{width:ae,height:se}),a.RGBAImage.copy($,C,{x:0,y:se-1},{x:V,y:K-1},{width:ae,height:1}),a.RGBAImage.copy($,C,{x:0,y:0},{x:V,y:K+se},{width:ae,height:1}),a.RGBAImage.copy($,C,{x:ae-1,y:0},{x:V-1,y:K},{width:1,height:se}),a.RGBAImage.copy($,C,{x:0,y:0},{x:V+ae,y:K},{width:1,height:se})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(h){for(var m=0,_=h;m<_.length;m+=1){var w=_[m];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var S=this.images[w];F(S)&&this.updateImage(w,S)}}},f}(a.Evented),J=ye,le=ye,ue=1e20;function ye(c,f,h,m,_,w){this.fontSize=c||24,this.buffer=f===void 0?3:f,this.cutoff=m||.25,this.fontFamily=_||"sans-serif",this.fontWeight=w||"normal",this.radius=h||8;var S=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=S,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.d=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Int16Array(S),this.middle=Math.round(S/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ee(c,f,h,m,_,w,S){for(var C=0;C<f;C++){for(var k=0;k<h;k++)m[k]=c[k*f+C];for(Pe(m,_,w,S,h),k=0;k<h;k++)c[k*f+C]=_[k]}for(k=0;k<h;k++){for(C=0;C<f;C++)m[C]=c[k*f+C];for(Pe(m,_,w,S,f),C=0;C<f;C++)c[k*f+C]=Math.sqrt(_[C])}}function Pe(c,f,h,m,_){h[0]=0,m[0]=-ue,m[1]=+ue;for(var w=1,S=0;w<_;w++){for(var C=(c[w]+w*w-(c[h[S]]+h[S]*h[S]))/(2*w-2*h[S]);C<=m[S];)S--,C=(c[w]+w*w-(c[h[S]]+h[S]*h[S]))/(2*w-2*h[S]);h[++S]=w,m[S]=C,m[S+1]=+ue}for(w=0,S=0;w<_;w++){for(;m[S+1]<w;)S++;f[w]=(w-h[S])*(w-h[S])+c[h[S]]}}ye.prototype.draw=function(c){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(c,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),m=0;m<this.size*this.size;m++){var _=f.data[4*m+3]/255;this.gridOuter[m]=_===1?0:_===0?ue:Math.pow(Math.max(0,.5-_),2),this.gridInner[m]=_===1?ue:_===0?0:Math.pow(Math.max(0,_-.5),2)}for(Ee(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Ee(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),m=0;m<this.size*this.size;m++)h[m]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[m]-this.gridInner[m])/this.radius+this.cutoff))));return h},J.default=le;var we=function(c,f){this.requestManager=c,this.localIdeographFontFamily=f,this.entries={}};we.prototype.setURL=function(c){this.url=c},we.prototype.getGlyphs=function(c,f){var h=this,m=[];for(var _ in c)for(var w=0,S=c[_];w<S.length;w+=1)m.push({stack:_,id:S[w]});a.asyncAll(m,function(C,k){var N=C.stack,V=C.id,K=h.entries[N];K||(K=h.entries[N]={glyphs:{},requests:{},ranges:{}});var $=K.glyphs[V];if($===void 0){if($=h._tinySDF(K,N,V))return K.glyphs[V]=$,void k(null,{stack:N,id:V,glyph:$});var ae=Math.floor(V/256);if(256*ae>65535)k(new Error("glyphs > 65535 not supported"));else if(K.ranges[ae])k(null,{stack:N,id:V,glyph:$});else{var se=K.requests[ae];se||(se=K.requests[ae]=[],we.loadGlyphRange(N,ae,h.url,h.requestManager,function(fe,ie){if(ie){for(var he in ie)h._doesCharSupportLocalGlyph(+he)||(K.glyphs[+he]=ie[+he]);K.ranges[ae]=!0}for(var ve=0,Te=se;ve<Te.length;ve+=1)(0,Te[ve])(fe,ie);delete K.requests[ae]})),se.push(function(fe,ie){fe?k(fe):ie&&k(null,{stack:N,id:V,glyph:ie[V]||null})})}}else k(null,{stack:N,id:V,glyph:$})},function(C,k){if(C)f(C);else if(k){for(var N={},V=0,K=k;V<K.length;V+=1){var $=K[V],ae=$.stack,se=$.id,fe=$.glyph;(N[ae]||(N[ae]={}))[se]=fe&&{id:fe.id,bitmap:fe.bitmap.clone(),metrics:fe.metrics}}f(null,N)}})},we.prototype._doesCharSupportLocalGlyph=function(c){return!!this.localIdeographFontFamily&&(a.isChar["CJK Unified Ideographs"](c)||a.isChar["Hangul Syllables"](c)||a.isChar.Hiragana(c)||a.isChar.Katakana(c))},we.prototype._tinySDF=function(c,f,h){var m=this.localIdeographFontFamily;if(m&&this._doesCharSupportLocalGlyph(h)){var _=c.tinySDF;if(!_){var w="400";/bold/i.test(f)?w="900":/medium/i.test(f)?w="500":/light/i.test(f)&&(w="200"),_=c.tinySDF=new we.TinySDF(24,3,8,.25,m,w)}return{id:h,bitmap:new a.AlphaImage({width:30,height:30},_.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},we.loadGlyphRange=function(c,f,h,m,_){var w=256*f,S=w+255,C=m.transformRequest(m.normalizeGlyphsURL(h).replace("{fontstack}",c).replace("{range}",w+"-"+S),a.ResourceType.Glyphs);a.getArrayBuffer(C,function(k,N){if(k)_(k);else if(N){for(var V={},K=0,$=a.parseGlyphPBF(N);K<$.length;K+=1){var ae=$[K];V[ae.id]=ae}_(null,V)}})},we.TinySDF=J;var ze=function(){this.specification=a.styleSpec.light.position};ze.prototype.possiblyEvaluate=function(c,f){return a.sphericalToCartesian(c.expression.evaluate(f))},ze.prototype.interpolate=function(c,f,h){return{x:a.number(c.x,f.x,h),y:a.number(c.y,f.y,h),z:a.number(c.z,f.z,h)}};var Fe=new a.Properties({anchor:new a.DataConstantProperty(a.styleSpec.light.anchor),position:new ze,color:new a.DataConstantProperty(a.styleSpec.light.color),intensity:new a.DataConstantProperty(a.styleSpec.light.intensity)}),Be=function(c){function f(h){c.call(this),this._transitionable=new a.Transitionable(Fe),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(h,m){if(m===void 0&&(m={}),!this._validate(a.validateLight,h,m))for(var _ in h){var w=h[_];a.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),w):this._transitionable.setValue(_,w)}},f.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},f.prototype._validate=function(h,m,_){return(!_||_.validate!==!1)&&a.emitValidationErrors(this,h.call(a.validateStyle,a.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:a.styleSpec})))},f}(a.Evented),He=function(c,f){this.width=c,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};He.prototype.getDash=function(c,f){var h=c.join(",")+String(f);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(c,f)),this.dashEntry[h]},He.prototype.getDashRanges=function(c,f,h){var m=[],_=c.length%2==1?-c[c.length-1]*h:0,w=c[0]*h,S=!0;m.push({left:_,right:w,isDash:S,zeroLength:c[0]===0});for(var C=c[0],k=1;k<c.length;k++){var N=c[k];m.push({left:_=C*h,right:w=(C+=N)*h,isDash:S=!S,zeroLength:N===0})}return m},He.prototype.addRoundDash=function(c,f,h){for(var m=f/2,_=-h;_<=h;_++)for(var w=this.width*(this.nextRow+h+_),S=0,C=c[S],k=0;k<this.width;k++){k/C.right>1&&(C=c[++S]);var N=Math.abs(k-C.left),V=Math.abs(k-C.right),K=Math.min(N,V),$=void 0,ae=_/h*(m+1);if(C.isDash){var se=m-Math.abs(ae);$=Math.sqrt(K*K+se*se)}else $=m-Math.sqrt(K*K+ae*ae);this.data[w+k]=Math.max(0,Math.min(255,$+128))}},He.prototype.addRegularDash=function(c){for(var f=c.length-1;f>=0;--f){var h=c[f],m=c[f+1];h.zeroLength?c.splice(f,1):m&&m.isDash===h.isDash&&(m.left=h.left,c.splice(f,1))}var _=c[0],w=c[c.length-1];_.isDash===w.isDash&&(_.left=w.left-this.width,w.right=_.right+this.width);for(var S=this.width*this.nextRow,C=0,k=c[C],N=0;N<this.width;N++){N/k.right>1&&(k=c[++C]);var V=Math.abs(N-k.left),K=Math.abs(N-k.right),$=Math.min(V,K);this.data[S+N]=Math.max(0,Math.min(255,(k.isDash?$:-$)+128))}},He.prototype.addDash=function(c,f){var h=f?7:0,m=2*h+1;if(this.nextRow+m>this.height)return a.warnOnce("LineAtlas out of space"),null;for(var _=0,w=0;w<c.length;w++)_+=c[w];if(_!==0){var S=this.width/_,C=this.getDashRanges(c,this.width,S);f?this.addRoundDash(C,S,h):this.addRegularDash(C)}var k={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:_};return this.nextRow+=m,this.dirty=!0,k},He.prototype.bind=function(c){var f=c.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var We=function c(f,h){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=a.uniqueId();for(var m=this.workerPool.acquire(this.id),_=0;_<m.length;_++){var w=new c.Actor(m[_],h,this.id);w.name="Worker "+_,this.actors.push(w)}};function _t(c,f,h){var m=function(_,w){if(_)return h(_);if(w){var S=a.pick(a.extend(w,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(S.vectorLayers=w.vector_layers,S.vectorLayerIds=S.vectorLayers.map(function(C){return C.id})),S.tiles=f.canonicalizeTileset(S,c.url),h(null,S)}};return c.url?a.getJSON(f.transformRequest(f.normalizeSourceURL(c.url),a.ResourceType.Source),m):a.browser.frame(function(){return m(null,c)})}We.prototype.broadcast=function(c,f,h){a.asyncAll(this.actors,function(m,_){m.send(c,f,_)},h=h||function(){})},We.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},We.prototype.remove=function(){this.actors.forEach(function(c){c.remove()}),this.actors=[],this.workerPool.release(this.id)},We.Actor=a.Actor;var gn=function(c,f,h){this.bounds=a.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=f||0,this.maxzoom=h||24};gn.prototype.validateBounds=function(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]},gn.prototype.contains=function(c){var f=Math.pow(2,c.z),h=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*f),m=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*f),_=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*f),w=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*f);return c.x>=h&&c.x<_&&c.y>=m&&c.y<w};var pn=function(c){function f(h,m,_,w){if(c.call(this),this.id=h,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(m,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=_t(this._options,this.map._requestManager,function(m,_){h._tileJSONRequest=null,h._loaded=!0,m?h.fire(new a.ErrorEvent(m)):_&&(a.extend(h,_),_.bounds&&(h.tileBounds=new gn(_.bounds,h.minzoom,h.maxzoom)),a.postTurnstileEvent(_.tiles,h.map._requestManager._customAccessToken),a.postMapLoadEvent(_.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},f.prototype.onAdd=function(h){this.map=h,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return a.extend({},this._options)},f.prototype.loadTile=function(h,m){var _=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(_,a.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function S(C,k){return delete h.request,h.aborted?m(null):C&&C.status!==404?m(C):(k&&k.resourceTiming&&(h.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&h.setExpiryData(k),h.loadVectorData(k,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=m:h.request=h.actor.send("reloadTile",w,S.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",w,S.bind(this)))},f.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(a.Evented),$n=function(c){function f(h,m,_,w){c.call(this),this.id=h,this.dispatcher=_,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},m),a.extend(this,a.pick(m,["url","scheme","tileSize"]))}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=_t(this._options,this.map._requestManager,function(m,_){h._tileJSONRequest=null,h._loaded=!0,m?h.fire(new a.ErrorEvent(m)):_&&(a.extend(h,_),_.bounds&&(h.tileBounds=new gn(_.bounds,h.minzoom,h.maxzoom)),a.postTurnstileEvent(_.tiles),a.postMapLoadEvent(_.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(h){this.map=h,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return a.extend({},this._options)},f.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},f.prototype.loadTile=function(h,m){var _=this,w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=a.getImage(this.map._requestManager.transformRequest(w,a.ResourceType.Tile),function(S,C){if(delete h.request,h.aborted)h.state="unloaded",m(null);else if(S)h.state="errored",m(S);else if(C){_.map._refreshExpiredTiles&&h.setExpiryData(C),delete C.cacheControl,delete C.expires;var k=_.map.painter.context,N=k.gl;h.texture=_.map.painter.getTileTexture(C.width),h.texture?h.texture.update(C,{useMipmap:!0}):(h.texture=new a.Texture(k,C,N.RGBA,{useMipmap:!0}),h.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),k.extTextureFilterAnisotropic&&N.texParameterf(N.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax)),h.state="loaded",a.cacheEntryPossiblyAdded(_.dispatcher),m(null)}})},f.prototype.abortTile=function(h,m){h.request&&(h.request.cancel(),delete h.request),m()},f.prototype.unloadTile=function(h,m){h.texture&&this.map.painter.saveTileTexture(h.texture),m()},f.prototype.hasTransition=function(){return!1},f}(a.Evented),Tn=function(c){function f(h,m,_,w){c.call(this,h,m,_,w),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox"}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(h,m){var _=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(S,C){S&&(h.state="errored",m(S)),C&&(h.dem=C,h.needsHillshadePrepare=!0,h.state="loaded",m(null))}h.request=a.getImage(this.map._requestManager.transformRequest(_,a.ResourceType.Tile),function(S,C){if(delete h.request,h.aborted)h.state="unloaded",m(null);else if(S)h.state="errored",m(S);else if(C){this.map._refreshExpiredTiles&&h.setExpiryData(C),delete C.cacheControl,delete C.expires;var k=a.window.ImageBitmap&&C instanceof a.window.ImageBitmap&&a.offscreenCanvasSupported()?C:a.browser.getImageData(C,1),N={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:k,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",N,w.bind(this)))}}.bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},f.prototype._getNeighboringTiles=function(h){var m=h.canonical,_=Math.pow(2,m.z),w=(m.x-1+_)%_,S=m.x===0?h.wrap-1:h.wrap,C=(m.x+1+_)%_,k=m.x+1===_?h.wrap+1:h.wrap,N={};return N[new a.OverscaledTileID(h.overscaledZ,S,m.z,w,m.y).key]={backfilled:!1},N[new a.OverscaledTileID(h.overscaledZ,k,m.z,C,m.y).key]={backfilled:!1},m.y>0&&(N[new a.OverscaledTileID(h.overscaledZ,S,m.z,w,m.y-1).key]={backfilled:!1},N[new a.OverscaledTileID(h.overscaledZ,h.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},N[new a.OverscaledTileID(h.overscaledZ,k,m.z,C,m.y-1).key]={backfilled:!1}),m.y+1<_&&(N[new a.OverscaledTileID(h.overscaledZ,S,m.z,w,m.y+1).key]={backfilled:!1},N[new a.OverscaledTileID(h.overscaledZ,h.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},N[new a.OverscaledTileID(h.overscaledZ,k,m.z,C,m.y+1).key]={backfilled:!1}),N},f.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},f}($n),lr=function(c){function f(h,m,_,w){c.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=_.getActor(),this.setEventedParent(w),this._data=m.data,this._options=a.extend({},m),this._collectResourceTiming=m.collectResourceTiming,this._resourceTiming=[],m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId;var S=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:(m.buffer!==void 0?m.buffer:128)*S,tolerance:(m.tolerance!==void 0?m.tolerance:.375)*S,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:m.clusterMaxZoom!==void 0?Math.min(m.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,m.clusterMinPoints||2),extent:a.EXTENT,radius:(m.clusterRadius||50)*S,log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties},m.workerOptions)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.load=function(){var h=this;this.fire(new a.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(m){if(m)h.fire(new a.ErrorEvent(m));else{var _={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(_.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new a.Event("data",_))}})},f.prototype.onAdd=function(h){this.map=h,this.load()},f.prototype.setData=function(h){var m=this;return this._data=h,this.fire(new a.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(_){if(_)m.fire(new a.ErrorEvent(_));else{var w={dataType:"source",sourceDataType:"content"};m._collectResourceTiming&&m._resourceTiming&&m._resourceTiming.length>0&&(w.resourceTiming=m._resourceTiming,m._resourceTiming=[]),m.fire(new a.Event("data",w))}}),this},f.prototype.getClusterExpansionZoom=function(h,m){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},m),this},f.prototype.getClusterChildren=function(h,m){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},m),this},f.prototype.getClusterLeaves=function(h,m,_,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:m,offset:_},w),this},f.prototype._updateWorkerData=function(h){var m=this;this._loaded=!1;var _=a.extend({},this.workerOptions),w=this._data;typeof w=="string"?(_.request=this.map._requestManager.transformRequest(a.browser.resolveURL(w),a.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(w),this.actor.send(this.type+".loadData",_,function(S,C){m._removed||C&&C.abandoned||(m._loaded=!0,C&&C.resourceTiming&&C.resourceTiming[m.id]&&(m._resourceTiming=C.resourceTiming[m.id].slice(0)),m.actor.send(m.type+".coalesce",{source:_.source},null),h(S))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(h,m){var _=this,w=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(w,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(S,C){return delete h.request,h.unloadVectorData(),h.aborted?m(null):S?m(S):(h.loadVectorData(C,_.map.painter,w==="reloadTile"),m(null))})},f.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},f.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return a.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(a.Evented),Jt=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),dn=function(c){function f(h,m,_,w){c.call(this),this.id=h,this.dispatcher=_,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=m}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.load=function(h,m){var _=this;this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),function(w,S){_._loaded=!0,w?_.fire(new a.ErrorEvent(w)):S&&(_.image=S,h&&(_.coordinates=h),m&&m(),_._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(h){var m=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){m.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(h){this.map=h,this.load()},f.prototype.setCoordinates=function(h){var m=this;this.coordinates=h;var _=h.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(S){for(var C=1/0,k=1/0,N=-1/0,V=-1/0,K=0,$=S;K<$.length;K+=1){var ae=$[K];C=Math.min(C,ae.x),k=Math.min(k,ae.y),N=Math.max(N,ae.x),V=Math.max(V,ae.y)}var se=Math.max(N-C,V-k),fe=Math.max(0,Math.floor(-Math.log(se)/Math.LN2)),ie=Math.pow(2,fe);return new a.CanonicalTileID(fe,Math.floor((C+N)/2*ie),Math.floor((k+V)/2*ie))}(_),this.minzoom=this.maxzoom=this.tileID.z;var w=_.map(function(S){return m.tileID.getTilePoint(S)._round()});return this._boundsArray=new a.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,m=h.gl;for(var _ in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Jt.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new a.Texture(h,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[_];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.loadTile=function(h,m){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},m(null)):(h.state="errored",m(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(a.Evented),An=function(c){function f(h,m,_,w){c.call(this,h,m,_,w),this.roundZoom=!0,this.type="video",this.options=m}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.load=function(){var h=this;this._loaded=!1;var m=this.options;this.urls=[];for(var _=0,w=m.urls;_<w.length;_+=1)this.urls.push(this.map._requestManager.transformRequest(w[_],a.ResourceType.Source).url);a.getVideo(this.urls,function(S,C){h._loaded=!0,S?h.fire(new a.ErrorEvent(S)):C&&(h.video=C,h.video.loop=!0,h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(h){if(this.video){var m=this.video.seekable;h<m.start(0)||h>m.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+m.start(0)+" and "+m.end(0)+"-second mark."))):this.video.currentTime=h}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,m=h.gl;for(var _ in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Jt.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(h,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[_];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(dn),et=function(c){function f(h,m,_,w){c.call(this,h,m,_,w),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some(function(S){return!Array.isArray(S)||S.length!==2||S.some(function(C){return typeof C!="number"})})||this.fire(new a.ErrorEvent(new a.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError("sources."+h,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var m=this.map.painter.context,_=m.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,Jt.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(m,this.canvas,_.RGBA,{premultiply:!0}),this.tiles){var S=this.tiles[w];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var h=0,m=[this.canvas.width,this.canvas.height];h<m.length;h+=1){var _=m[h];if(isNaN(_)||_<=0)return!0}return!1},f}(dn),yt={vector:pn,raster:$n,"raster-dem":Tn,geojson:lr,video:An,image:dn,canvas:et};function Qt(c,f){var h=a.identity([]);return a.translate(h,h,[1,1,0]),a.scale(h,h,[.5*c.width,.5*c.height,1]),a.multiply(h,h,c.calculatePosMatrix(f.toUnwrapped()))}function Pt(c,f,h,m,_,w){var S=function(fe,ie,he){if(fe)for(var ve=0,Te=fe;ve<Te.length;ve+=1){var Le=ie[Te[ve]];if(Le&&Le.source===he&&Le.type==="fill-extrusion")return!0}else for(var Ae in ie){var Re=ie[Ae];if(Re.source===he&&Re.type==="fill-extrusion")return!0}return!1}(_&&_.layers,f,c.id),C=w.maxPitchScaleFactor(),k=c.tilesIn(m,C,S);k.sort(Nt);for(var N=[],V=0,K=k;V<K.length;V+=1){var $=K[V];N.push({wrappedTileID:$.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(f,h,c._state,$.queryGeometry,$.cameraQueryGeometry,$.scale,_,w,C,Qt(c.transform,$.tileID))})}var ae=function(fe){for(var ie={},he={},ve=0,Te=fe;ve<Te.length;ve+=1){var Le=Te[ve],Ae=Le.queryResults,Re=Le.wrappedTileID,je=he[Re]=he[Re]||{};for(var Je in Ae)for(var Ze=Ae[Je],rt=je[Je]=je[Je]||{},ft=ie[Je]=ie[Je]||[],Mt=0,wt=Ze;Mt<wt.length;Mt+=1){var Ht=wt[Mt];rt[Ht.featureIndex]||(rt[Ht.featureIndex]=!0,ft.push(Ht))}}return ie}(N);for(var se in ae)ae[se].forEach(function(fe){var ie=fe.feature,he=c.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=he});return ae}function Nt(c,f){var h=c.tileID,m=f.tileID;return h.overscaledZ-m.overscaledZ||h.canonical.y-m.canonical.y||h.wrap-m.wrap||h.canonical.x-m.canonical.x}var qt=function(c,f){this.max=c,this.onRemove=f,this.reset()};qt.prototype.reset=function(){for(var c in this.data)for(var f=0,h=this.data[c];f<h.length;f+=1){var m=h[f];m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value)}return this.data={},this.order=[],this},qt.prototype.add=function(c,f,h){var m=this,_=c.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);var w={value:f,timeout:void 0};if(h!==void 0&&(w.timeout=setTimeout(function(){m.remove(c,w)},h)),this.data[_].push(w),this.order.push(_),this.order.length>this.max){var S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this},qt.prototype.has=function(c){return c.wrapped().key in this.data},qt.prototype.getAndRemove=function(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null},qt.prototype._getAndRemoveByKey=function(c){var f=this.data[c].shift();return f.timeout&&clearTimeout(f.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),f.value},qt.prototype.getByKey=function(c){var f=this.data[c];return f?f[0].value:null},qt.prototype.get=function(c){return this.has(c)?this.data[c.wrapped().key][0].value:null},qt.prototype.remove=function(c,f){if(!this.has(c))return this;var h=c.wrapped().key,m=f===void 0?0:this.data[h].indexOf(f),_=this.data[h][m];return this.data[h].splice(m,1),_.timeout&&clearTimeout(_.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this},qt.prototype.setMaxSize=function(c){for(this.max=c;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},qt.prototype.filter=function(c){var f=[];for(var h in this.data)for(var m=0,_=this.data[h];m<_.length;m+=1){var w=_[m];c(w.value)||f.push(w)}for(var S=0,C=f;S<C.length;S+=1){var k=C[S];this.remove(k.value.tileID,k)}};var yn=function(c,f,h){this.context=c;var m=c.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};yn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},yn.prototype.updateData=function(c){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)},yn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ai={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Kn=function(c,f,h,m){this.length=f.length,this.attributes=h,this.itemSize=f.bytesPerElement,this.dynamicDraw=m,this.context=c;var _=c.gl;this.buffer=_.createBuffer(),c.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Kn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Kn.prototype.updateData=function(c){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,c.arrayBuffer)},Kn.prototype.enableAttributes=function(c,f){for(var h=0;h<this.attributes.length;h++){var m=f.attributes[this.attributes[h].name];m!==void 0&&c.enableVertexAttribArray(m)}},Kn.prototype.setVertexAttribPointers=function(c,f,h){for(var m=0;m<this.attributes.length;m++){var _=this.attributes[m],w=f.attributes[_.name];w!==void 0&&c.vertexAttribPointer(w,_.components,c[ai[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}},Kn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Wt=function(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Wt.prototype.get=function(){return this.current},Wt.prototype.set=function(c){},Wt.prototype.getDefault=function(){return this.default},Wt.prototype.setDefault=function(){this.set(this.default)};var Jn=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return a.Color.transparent},f.prototype.set=function(h){var m=this.current;(h.r!==m.r||h.g!==m.g||h.b!==m.b||h.a!==m.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},f}(Wt),Zr=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},f}(Wt),mi=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},f}(Wt),gi=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||h[2]!==m[2]||h[3]!==m[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},f}(Wt),Go=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},f}(Wt),yi=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},f}(Wt),Hi=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(h){var m=this.current;(h.func!==m.func||h.ref!==m.ref||h.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},f}(Wt),$r=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},f.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||h[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},f}(Wt),Mi=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;h?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=h,this.dirty=!1}},f}(Wt),vi=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},f}(Wt),ua=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;h?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=h,this.dirty=!1}},f}(Wt),il=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},f}(Wt),ki=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;h?m.enable(m.BLEND):m.disable(m.BLEND),this.current=h,this.dirty=!1}},f}(Wt),ol=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},f.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},f}(Wt),La=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return a.Color.transparent},f.prototype.set=function(h){var m=this.current;(h.r!==m.r||h.g!==m.g||h.b!==m.b||h.a!==m.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},f}(Wt),ys=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},f}(Wt),ca=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;h?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=h,this.dirty=!1}},f}(Wt),vo=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},f}(Wt),Wo=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},f}(Wt),al=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},f}(Wt),Ra=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},f}(Wt),Oa=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},f.prototype.set=function(h){var m=this.current;(h[0]!==m[0]||h[1]!==m[1]||h[2]!==m[2]||h[3]!==m[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},f}(Wt),vs=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},f}(Wt),_s=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,h),this.current=h,this.dirty=!1}},f}(Wt),ha=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.bindTexture(m.TEXTURE_2D,h),this.current=h,this.dirty=!1}},f}(Wt),xs=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},f}(Wt),Ho=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){var m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},f}(Wt),qi=function(c){function f(h){c.call(this,h),this.vao=h.extVertexArrayObject}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},f}(Wt),_o=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},f}(Wt),fa=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},f}(Wt),ou=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(h){if(h!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},f}(Wt),Wn=function(c){function f(h,m){c.call(this,h),this.context=h,this.parent=m}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(Wt),O=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},f}(Wn),B=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,h),this.current=h,this.dirty=!1}},f}(Wn),G=function(c,f,h,m){this.context=c,this.width=f,this.height=h;var _=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new O(c,_),m&&(this.depthAttachment=new B(c,_))};G.prototype.destroy=function(){var c=this.context.gl,f=this.colorAttachment.get();if(f&&c.deleteTexture(f),this.depthAttachment){var h=this.depthAttachment.get();h&&c.deleteRenderbuffer(h)}c.deleteFramebuffer(this.framebuffer)};var Y=function(c,f,h){this.func=c,this.mask=f,this.range=h};Y.ReadOnly=!1,Y.ReadWrite=!0,Y.disabled=new Y(519,Y.ReadOnly,[0,1]);var ne=function(c,f,h,m,_,w){this.test=c,this.ref=f,this.mask=h,this.fail=m,this.depthFail=_,this.pass=w};ne.disabled=new ne({func:519,mask:0},0,0,7680,7680,7680);var Z=function(c,f,h){this.blendFunction=c,this.blendColor=f,this.mask=h};Z.disabled=new Z(Z.Replace=[1,0],a.Color.transparent,[!1,!1,!1,!1]),Z.unblended=new Z(Z.Replace,a.Color.transparent,[!0,!0,!0,!0]),Z.alphaBlended=new Z([1,771],a.Color.transparent,[!0,!0,!0,!0]);var re=function(c,f,h){this.enable=c,this.mode=f,this.frontFace=h};re.disabled=new re(!1,1029,2305),re.backCCW=new re(!0,1029,2305);var ge=function(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Jn(this),this.clearDepth=new Zr(this),this.clearStencil=new mi(this),this.colorMask=new gi(this),this.depthMask=new Go(this),this.stencilMask=new yi(this),this.stencilFunc=new Hi(this),this.stencilOp=new $r(this),this.stencilTest=new Mi(this),this.depthRange=new vi(this),this.depthTest=new ua(this),this.depthFunc=new il(this),this.blend=new ki(this),this.blendFunc=new ol(this),this.blendColor=new La(this),this.blendEquation=new ys(this),this.cullFace=new ca(this),this.cullFaceSide=new vo(this),this.frontFace=new Wo(this),this.program=new al(this),this.activeTexture=new Ra(this),this.viewport=new Oa(this),this.bindFramebuffer=new vs(this),this.bindRenderbuffer=new _s(this),this.bindTexture=new ha(this),this.bindVertexBuffer=new xs(this),this.bindElementBuffer=new Ho(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new qi(this),this.pixelStoreUnpack=new _o(this),this.pixelStoreUnpackPremultiplyAlpha=new fa(this),this.pixelStoreUnpackFlipY=new ou(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query")};ge.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ge.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ge.prototype.createIndexBuffer=function(c,f){return new yn(this,c,f)},ge.prototype.createVertexBuffer=function(c,f,h){return new Kn(this,c,f,h)},ge.prototype.createRenderbuffer=function(c,f,h){var m=this.gl,_=m.createRenderbuffer();return this.bindRenderbuffer.set(_),m.renderbufferStorage(m.RENDERBUFFER,c,f,h),this.bindRenderbuffer.set(null),_},ge.prototype.createFramebuffer=function(c,f,h){return new G(this,c,f,h)},ge.prototype.clear=function(c){var f=c.color,h=c.depth,m=this.gl,_=0;f&&(_|=m.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(_|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),m.clear(_)},ge.prototype.setCullFace=function(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))},ge.prototype.setDepthMode=function(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)},ge.prototype.setStencilMode=function(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)},ge.prototype.setColorMode=function(c){a.deepEqual(c.blendFunction,Z.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)},ge.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var xe=function(c){function f(h,m,_){var w=this;c.call(this),this.id=h,this.dispatcher=_,this.on("data",function(S){S.dataType==="source"&&S.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&S.dataType==="source"&&S.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(S,C,k,N){var V=new yt[C.type](S,C,k,N);if(V.id!==S)throw new Error("Expected Source id to be "+S+" instead of "+V.id);return a.bindAll(["load","abort","unload","serialize","prepare"],V),V}(h,m,_,this),this._tiles={},this._cache=new qt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new a.SourceFeatureState}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},f.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var m=this._tiles[h];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(h,m){return this._source.loadTile(h,m)},f.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},f.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(h){for(var m in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var _=this._tiles[m];_.upload(h),_.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return a.values(this._tiles).map(function(h){return h.tileID}).sort(_e).map(function(h){return h.key})},f.prototype.getRenderableIds=function(h){var m=this,_=[];for(var w in this._tiles)this._isIdRenderable(w,h)&&_.push(this._tiles[w]);return h?_.sort(function(S,C){var k=S.tileID,N=C.tileID,V=new a.Point(k.canonical.x,k.canonical.y)._rotate(m.transform.angle),K=new a.Point(N.canonical.x,N.canonical.y)._rotate(m.transform.angle);return k.overscaledZ-N.overscaledZ||K.y-V.y||K.x-V.x}).map(function(S){return S.tileID.key}):_.map(function(S){return S.tileID}).sort(_e).map(function(S){return S.key})},f.prototype.hasRenderableParent=function(h){var m=this.findLoadedParent(h,0);return!!m&&this._isIdRenderable(m.tileID.key)},f.prototype._isIdRenderable=function(h,m){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(m||!this._tiles[h].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},f.prototype._reloadTile=function(h,m){var _=this._tiles[h];_&&(_.state!=="loading"&&(_.state=m),this._loadTile(_,this._tileLoaded.bind(this,_,h,m)))},f.prototype._tileLoaded=function(h,m,_,w){if(w)return h.state="errored",void(w.status!==404?this._source.fire(new a.ErrorEvent(w,{tile:h})):this.update(this.transform));h.timeAdded=a.browser.now(),_==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(m,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new a.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},f.prototype._backfillDEM=function(h){for(var m=this.getRenderableIds(),_=0;_<m.length;_++){var w=m[_];if(h.neighboringTiles&&h.neighboringTiles[w]){var S=this.getTileByID(w);C(h,S),C(S,h)}}function C(k,N){k.needsHillshadePrepare=!0;var V=N.tileID.canonical.x-k.tileID.canonical.x,K=N.tileID.canonical.y-k.tileID.canonical.y,$=Math.pow(2,k.tileID.canonical.z),ae=N.tileID.key;V===0&&K===0||Math.abs(K)>1||(Math.abs(V)>1&&(Math.abs(V+$)===1?V+=$:Math.abs(V-$)===1&&(V-=$)),N.dem&&k.dem&&(k.dem.backfillBorder(N.dem,V,K),k.neighboringTiles&&k.neighboringTiles[ae]&&(k.neighboringTiles[ae].backfilled=!0)))}},f.prototype.getTile=function(h){return this.getTileByID(h.key)},f.prototype.getTileByID=function(h){return this._tiles[h]},f.prototype._retainLoadedChildren=function(h,m,_,w){for(var S in this._tiles){var C=this._tiles[S];if(!(w[S]||!C.hasData()||C.tileID.overscaledZ<=m||C.tileID.overscaledZ>_)){for(var k=C.tileID;C&&C.tileID.overscaledZ>m+1;){var N=C.tileID.scaledTo(C.tileID.overscaledZ-1);(C=this._tiles[N.key])&&C.hasData()&&(k=N)}for(var V=k;V.overscaledZ>m;)if(h[(V=V.scaledTo(V.overscaledZ-1)).key]){w[k.key]=k;break}}}},f.prototype.findLoadedParent=function(h,m){if(h.key in this._loadedParentTiles){var _=this._loadedParentTiles[h.key];return _&&_.tileID.overscaledZ>=m?_:null}for(var w=h.overscaledZ-1;w>=m;w--){var S=h.scaledTo(w),C=this._getLoadedTile(S);if(C)return C}},f.prototype._getLoadedTile=function(h){var m=this._tiles[h.key];return m&&m.hasData()?m:this._cache.getByKey(h.wrapped().key)},f.prototype.updateCacheSize=function(h){var m=Math.ceil(h.width/this._source.tileSize)+1,_=Math.ceil(h.height/this._source.tileSize)+1,w=Math.floor(m*_*5),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(S)},f.prototype.handleWrapJump=function(h){var m=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,m){var _={};for(var w in this._tiles){var S=this._tiles[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+m),_[S.tileID.key]=S}for(var C in this._tiles=_,this._timers)clearTimeout(this._timers[C]),delete this._timers[C];for(var k in this._tiles)this._setTileReloadTimer(k,this._tiles[k])}},f.prototype.update=function(h){var m=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var _;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?_=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(je){return new a.OverscaledTileID(je.canonical.z,je.wrap,je.canonical.z,je.canonical.x,je.canonical.y)}):(_=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(_=_.filter(function(je){return m._source.hasTile(je)}))):_=[];var w=h.coveringZoomLevel(this._source),S=Math.max(w-f.maxOverzooming,this._source.minzoom),C=Math.max(w+f.maxUnderzooming,this._source.minzoom),k=this._updateRetainedTiles(_,w);if(Ue(this._source.type)){for(var N={},V={},K=0,$=Object.keys(k);K<$.length;K+=1){var ae=$[K],se=k[ae],fe=this._tiles[ae];if(fe&&!(fe.fadeEndTime&&fe.fadeEndTime<=a.browser.now())){var ie=this.findLoadedParent(se,S);ie&&(this._addTile(ie.tileID),N[ie.tileID.key]=ie.tileID),V[ae]=se}}for(var he in this._retainLoadedChildren(V,w,C,k),N)k[he]||(this._coveredTiles[he]=!0,k[he]=N[he])}for(var ve in k)this._tiles[ve].clearFadeHold();for(var Te=0,Le=a.keysDifference(this._tiles,k);Te<Le.length;Te+=1){var Ae=Le[Te],Re=this._tiles[Ae];Re.hasSymbolBuckets&&!Re.holdingForFade()?Re.setHoldDuration(this.map._fadeDuration):Re.hasSymbolBuckets&&!Re.symbolFadeFinished()||this._removeTile(Ae)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},f.prototype._updateRetainedTiles=function(h,m){for(var _={},w={},S=Math.max(m-f.maxOverzooming,this._source.minzoom),C=Math.max(m+f.maxUnderzooming,this._source.minzoom),k={},N=0,V=h;N<V.length;N+=1){var K=V[N],$=this._addTile(K);_[K.key]=K,$.hasData()||m<this._source.maxzoom&&(k[K.key]=K)}this._retainLoadedChildren(k,m,C,_);for(var ae=0,se=h;ae<se.length;ae+=1){var fe=se[ae],ie=this._tiles[fe.key];if(!ie.hasData()){if(m+1>this._source.maxzoom){var he=fe.children(this._source.maxzoom)[0],ve=this.getTile(he);if(ve&&ve.hasData()){_[he.key]=he;continue}}else{var Te=fe.children(this._source.maxzoom);if(_[Te[0].key]&&_[Te[1].key]&&_[Te[2].key]&&_[Te[3].key])continue}for(var Le=ie.wasRequested(),Ae=fe.overscaledZ-1;Ae>=S;--Ae){var Re=fe.scaledTo(Ae);if(w[Re.key]||(w[Re.key]=!0,!(ie=this.getTile(Re))&&Le&&(ie=this._addTile(Re)),ie&&(_[Re.key]=Re,Le=ie.wasRequested(),ie.hasData())))break}}}return _},f.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var m=[],_=void 0,w=this._tiles[h].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){_=this._loadedParentTiles[w.key];break}m.push(w.key);var S=w.scaledTo(w.overscaledZ-1);if(_=this._getLoadedTile(S))break;w=S}for(var C=0,k=m;C<k.length;C+=1)this._loadedParentTiles[k[C]]=_}},f.prototype._addTile=function(h){var m=this._tiles[h.key];if(m)return m;(m=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,m),m.tileID=h,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,m)));var _=Boolean(m);return _||(m=new a.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(m,this._tileLoaded.bind(this,m,h.key,m.state))),m?(m.uses++,this._tiles[h.key]=m,_||this._source.fire(new a.Event("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m):null},f.prototype._setTileReloadTimer=function(h,m){var _=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var w=m.getExpiryTimeout();w&&(this._timers[h]=setTimeout(function(){_._reloadTile(h,"expired"),delete _._timers[h]},w))},f.prototype._removeTile=function(h){var m=this._tiles[h];m&&(m.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))},f.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},f.prototype.tilesIn=function(h,m,_){var w=this,S=[],C=this.transform;if(!C)return S;for(var k=_?C.getCameraQueryGeometry(h):h,N=h.map(function(Ae){return C.pointCoordinate(Ae)}),V=k.map(function(Ae){return C.pointCoordinate(Ae)}),K=this.getIds(),$=1/0,ae=1/0,se=-1/0,fe=-1/0,ie=0,he=V;ie<he.length;ie+=1){var ve=he[ie];$=Math.min($,ve.x),ae=Math.min(ae,ve.y),se=Math.max(se,ve.x),fe=Math.max(fe,ve.y)}for(var Te=function(Ae){var Re=w._tiles[K[Ae]];if(!Re.holdingForFade()){var je=Re.tileID,Je=Math.pow(2,C.zoom-Re.tileID.overscaledZ),Ze=m*Re.queryPadding*a.EXTENT/Re.tileSize/Je,rt=[je.getTilePoint(new a.MercatorCoordinate($,ae)),je.getTilePoint(new a.MercatorCoordinate(se,fe))];if(rt[0].x-Ze<a.EXTENT&&rt[0].y-Ze<a.EXTENT&&rt[1].x+Ze>=0&&rt[1].y+Ze>=0){var ft=N.map(function(wt){return je.getTilePoint(wt)}),Mt=V.map(function(wt){return je.getTilePoint(wt)});S.push({tile:Re,tileID:je,queryGeometry:ft,cameraQueryGeometry:Mt,scale:Je})}}},Le=0;Le<K.length;Le++)Te(Le);return S},f.prototype.getVisibleCoordinates=function(h){for(var m=this,_=this.getRenderableIds(h).map(function(k){return m._tiles[k].tileID}),w=0,S=_;w<S.length;w+=1){var C=S[w];C.posMatrix=this.transform.calculatePosMatrix(C.toUnwrapped())}return _},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Ue(this._source.type))for(var h in this._tiles){var m=this._tiles[h];if(m.fadeEndTime!==void 0&&m.fadeEndTime>=a.browser.now())return!0}return!1},f.prototype.setFeatureState=function(h,m,_){this._state.updateState(h=h||"_geojsonTileLayer",m,_)},f.prototype.removeFeatureState=function(h,m,_){this._state.removeFeatureState(h=h||"_geojsonTileLayer",m,_)},f.prototype.getFeatureState=function(h,m){return this._state.getState(h=h||"_geojsonTileLayer",m)},f.prototype.setDependencies=function(h,m,_){var w=this._tiles[h];w&&w.setDependencies(m,_)},f.prototype.reloadTilesForDependencies=function(h,m){for(var _ in this._tiles)this._tiles[_].hasDependency(h,m)&&this._reloadTile(_,"reloading");this._cache.filter(function(w){return!w.hasDependency(h,m)})},f}(a.Evented);function _e(c,f){var h=Math.abs(2*c.wrap)-+(c.wrap<0),m=Math.abs(2*f.wrap)-+(f.wrap<0);return c.overscaledZ-f.overscaledZ||m-h||f.canonical.y-c.canonical.y||f.canonical.x-c.canonical.x}function Ue(c){return c==="raster"||c==="image"||c==="video"}function Ge(){return new a.window.Worker(zf.workerUrl)}xe.maxOverzooming=10,xe.maxUnderzooming=3;var Oe="mapboxgl_preloaded_worker_pool",qe=function(){this.active={}};qe.prototype.acquire=function(c){if(!this.workers)for(this.workers=[];this.workers.length<qe.workerCount;)this.workers.push(new Ge);return this.active[c]=!0,this.workers.slice()},qe.prototype.release=function(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},qe.prototype.isPreloaded=function(){return!!this.active[Oe]},qe.prototype.numActive=function(){return Object.keys(this.active).length};var ke,Xe=Math.floor(a.browser.hardwareConcurrency/2);function Ye(){return ke||(ke=new qe),ke}function Tt(c,f){var h={};for(var m in c)m!=="ref"&&(h[m]=c[m]);return a.refProperties.forEach(function(_){_ in f&&(h[_]=f[_])}),h}function xt(c){c=c.slice();for(var f=Object.create(null),h=0;h<c.length;h++)f[c[h].id]=c[h];for(var m=0;m<c.length;m++)"ref"in c[m]&&(c[m]=Tt(c[m],f[c[m].ref]));return c}qe.workerCount=Math.max(Math.min(Xe,6),1);var Ve={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function zt(c,f,h){h.push({command:Ve.addSource,args:[c,f[c]]})}function Rt(c,f,h){f.push({command:Ve.removeSource,args:[c]}),h[c]=!0}function Zt(c,f,h,m){Rt(c,h,m),zt(c,f,h)}function en(c,f,h){var m;for(m in c[h])if(c[h].hasOwnProperty(m)&&m!=="data"&&!a.deepEqual(c[h][m],f[h][m]))return!1;for(m in f[h])if(f[h].hasOwnProperty(m)&&m!=="data"&&!a.deepEqual(c[h][m],f[h][m]))return!1;return!0}function bt(c,f,h,m,_,w){var S;for(S in f=f||{},c=c||{})c.hasOwnProperty(S)&&(a.deepEqual(c[S],f[S])||h.push({command:w,args:[m,S,f[S],_]}));for(S in f)f.hasOwnProperty(S)&&!c.hasOwnProperty(S)&&(a.deepEqual(c[S],f[S])||h.push({command:w,args:[m,S,f[S],_]}))}function mn(c){return c.id}function sn(c,f){return c[f.id]=f,c}var kn=function(c,f){this.reset(c,f)};kn.prototype.reset=function(c,f){this.points=c||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},kn.prototype.lerp=function(c){if(this.points.length===1)return this.points[0];c=a.clamp(c,0,1);for(var f=1,h=this._distances[f],m=c*this.paddedLength+this.padding;h<m&&f<this._distances.length;)h=this._distances[++f];var _=f-1,w=this._distances[_],S=h-w,C=S>0?(m-w)/S:0;return this.points[_].mult(1-C).add(this.points[f].mult(C))};var $t=function(c,f,h){var m=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(c/h),this.yCellCount=Math.ceil(f/h);for(var w=0;w<this.xCellCount*this.yCellCount;w++)m.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=f,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function xn(c,f,h,m,_){var w=a.create();return f?(a.scale(w,w,[1/_,1/_,1]),h||a.rotateZ(w,w,m.angle)):a.multiply(w,m.labelPlaneMatrix,c),w}function At(c,f,h,m,_){if(f){var w=a.clone(c);return a.scale(w,w,[_,_,1]),h||a.rotateZ(w,w,-m.angle),w}return m.glCoordMatrix}function Vt(c,f){var h=[c.x,c.y,0,1];yr(h,h,f);var m=h[3];return{point:new a.Point(h[0]/m,h[1]/m),signedDistanceFromCamera:m}}function Qr(c,f){return .5+c/f*.5}function bn(c,f){var h=c[0]/c[3],m=c[1]/c[3];return h>=-f[0]&&h<=f[0]&&m>=-f[1]&&m<=f[1]}function Nr(c,f,h,m,_,w,S,C){var k=m?c.textSizeData:c.iconSizeData,N=a.evaluateSizeForZoom(k,h.transform.zoom),V=[256/h.width*2+1,256/h.height*2+1],K=m?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;K.clear();for(var $=c.lineVertexArray,ae=m?c.text.placedSymbolArray:c.icon.placedSymbolArray,se=h.transform.width/h.transform.height,fe=!1,ie=0;ie<ae.length;ie++){var he=ae.get(ie);if(he.hidden||he.writingMode===a.WritingMode.vertical&&!fe)io(he.numGlyphs,K);else{fe=!1;var ve=[he.anchorX,he.anchorY,0,1];if(a.transformMat4(ve,ve,f),bn(ve,V)){var Te=Qr(h.transform.cameraToCenterDistance,ve[3]),Le=a.evaluateSizeForFeature(k,N,he),Ae=S?Le/Te:Le*Te,Re=new a.Point(he.anchorX,he.anchorY),je=Vt(Re,_).point,Je={},Ze=Hn(he,Ae,!1,C,f,_,w,c.glyphOffsetArray,$,K,je,Re,Je,se);fe=Ze.useVertical,(Ze.notEnoughRoom||fe||Ze.needsFlipping&&Hn(he,Ae,!0,C,f,_,w,c.glyphOffsetArray,$,K,je,Re,Je,se).notEnoughRoom)&&io(he.numGlyphs,K)}else io(he.numGlyphs,K)}}m?c.text.dynamicLayoutVertexBuffer.updateData(K):c.icon.dynamicLayoutVertexBuffer.updateData(K)}function za(c,f,h,m,_,w,S,C,k,N,V){var K=C.glyphStartIndex+C.numGlyphs,$=C.lineStartIndex,ae=C.lineStartIndex+C.lineLength,se=f.getoffsetX(C.glyphStartIndex),fe=f.getoffsetX(K-1),ie=Xr(c*se,h,m,_,w,S,C.segment,$,ae,k,N,V);if(!ie)return null;var he=Xr(c*fe,h,m,_,w,S,C.segment,$,ae,k,N,V);return he?{first:ie,last:he}:null}function ei(c,f,h,m){return c===a.WritingMode.horizontal&&Math.abs(h.y-f.y)>Math.abs(h.x-f.x)*m?{useVertical:!0}:(c===a.WritingMode.vertical?f.y<h.y:f.x>h.x)?{needsFlipping:!0}:null}function Hn(c,f,h,m,_,w,S,C,k,N,V,K,$,ae){var se,fe=f/24,ie=c.lineOffsetX*fe,he=c.lineOffsetY*fe;if(c.numGlyphs>1){var ve=c.glyphStartIndex+c.numGlyphs,Te=c.lineStartIndex,Le=c.lineStartIndex+c.lineLength,Ae=za(fe,C,ie,he,h,V,K,c,k,w,$);if(!Ae)return{notEnoughRoom:!0};var Re=Vt(Ae.first.point,S).point,je=Vt(Ae.last.point,S).point;if(m&&!h){var Je=ei(c.writingMode,Re,je,ae);if(Je)return Je}se=[Ae.first];for(var Ze=c.glyphStartIndex+1;Ze<ve-1;Ze++)se.push(Xr(fe*C.getoffsetX(Ze),ie,he,h,V,K,c.segment,Te,Le,k,w,$));se.push(Ae.last)}else{if(m&&!h){var rt=Vt(K,_).point,ft=c.lineStartIndex+c.segment+1,Mt=new a.Point(k.getx(ft),k.gety(ft)),wt=Vt(Mt,_),Ht=wt.signedDistanceFromCamera>0?wt.point:qo(K,Mt,rt,1,_),lt=ei(c.writingMode,rt,Ht,ae);if(lt)return lt}var Ft=Xr(fe*C.getoffsetX(c.glyphStartIndex),ie,he,h,V,K,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,k,w,$);if(!Ft)return{notEnoughRoom:!0};se=[Ft]}for(var Bt=0,Et=se;Bt<Et.length;Bt+=1){var Ot=Et[Bt];a.addDynamicAttributes(N,Ot.point,Ot.angle)}return{}}function qo(c,f,h,m,_){var w=Vt(c.add(c.sub(f)._unit()),_).point,S=h.sub(w);return h.add(S._mult(m/S.mag()))}function Xr(c,f,h,m,_,w,S,C,k,N,V,K){var $=m?c-f:c+f,ae=$>0?1:-1,se=0;m&&(ae*=-1,se=Math.PI),ae<0&&(se+=Math.PI);for(var fe=ae>0?C+S:C+S+1,ie=_,he=_,ve=0,Te=0,Le=Math.abs($),Ae=[];ve+Te<=Le;){if((fe+=ae)<C||fe>=k)return null;if(he=ie,Ae.push(ie),(ie=K[fe])===void 0){var Re=new a.Point(N.getx(fe),N.gety(fe)),je=Vt(Re,V);if(je.signedDistanceFromCamera>0)ie=K[fe]=je.point;else{var Je=fe-ae;ie=qo(ve===0?w:new a.Point(N.getx(Je),N.gety(Je)),Re,he,Le-ve+1,V)}}ve+=Te,Te=he.dist(ie)}var Ze=(Le-ve)/Te,rt=ie.sub(he),ft=rt.mult(Ze)._add(he);ft._add(rt._unit()._perp()._mult(h*ae));var Mt=se+Math.atan2(ie.y-he.y,ie.x-he.x);return Ae.push(ft),{point:ft,angle:Mt,path:Ae}}$t.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},$t.prototype.insert=function(c,f,h,m,_){this._forEachCell(f,h,m,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(f),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(_)},$t.prototype.insertCircle=function(c,f,h,m){this._forEachCell(f-m,h-m,f+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(f),this.circles.push(h),this.circles.push(m)},$t.prototype._insertBoxCell=function(c,f,h,m,_,w){this.boxCells[_].push(w)},$t.prototype._insertCircleCell=function(c,f,h,m,_,w){this.circleCells[_].push(w)},$t.prototype._query=function(c,f,h,m,_,w){if(h<0||c>this.width||m<0||f>this.height)return!_&&[];var S=[];if(c<=0&&f<=0&&this.width<=h&&this.height<=m){if(_)return!0;for(var C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(var k=0;k<this.circleKeys.length;k++){var N=this.circles[3*k],V=this.circles[3*k+1],K=this.circles[3*k+2];S.push({key:this.circleKeys[k],x1:N-K,y1:V-K,x2:N+K,y2:V+K})}return w?S.filter(w):S}return this._forEachCell(c,f,h,m,this._queryCell,S,{hitTest:_,seenUids:{box:{},circle:{}}},w),_?S.length>0:S},$t.prototype._queryCircle=function(c,f,h,m,_){var w=c-h,S=c+h,C=f-h,k=f+h;if(S<0||w>this.width||k<0||C>this.height)return!m&&[];var N=[];return this._forEachCell(w,C,S,k,this._queryCellCircle,N,{hitTest:m,circle:{x:c,y:f,radius:h},seenUids:{box:{},circle:{}}},_),m?N.length>0:N},$t.prototype.query=function(c,f,h,m,_){return this._query(c,f,h,m,!1,_)},$t.prototype.hitTest=function(c,f,h,m,_){return this._query(c,f,h,m,!0,_)},$t.prototype.hitTestCircle=function(c,f,h,m){return this._queryCircle(c,f,h,!0,m)},$t.prototype._queryCell=function(c,f,h,m,_,w,S,C){var k=S.seenUids,N=this.boxCells[_];if(N!==null)for(var V=this.bboxes,K=0,$=N;K<$.length;K+=1){var ae=$[K];if(!k.box[ae]){k.box[ae]=!0;var se=4*ae;if(c<=V[se+2]&&f<=V[se+3]&&h>=V[se+0]&&m>=V[se+1]&&(!C||C(this.boxKeys[ae]))){if(S.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[ae],x1:V[se],y1:V[se+1],x2:V[se+2],y2:V[se+3]})}}}var fe=this.circleCells[_];if(fe!==null)for(var ie=this.circles,he=0,ve=fe;he<ve.length;he+=1){var Te=ve[he];if(!k.circle[Te]){k.circle[Te]=!0;var Le=3*Te;if(this._circleAndRectCollide(ie[Le],ie[Le+1],ie[Le+2],c,f,h,m)&&(!C||C(this.circleKeys[Te]))){if(S.hitTest)return w.push(!0),!0;var Ae=ie[Le],Re=ie[Le+1],je=ie[Le+2];w.push({key:this.circleKeys[Te],x1:Ae-je,y1:Re-je,x2:Ae+je,y2:Re+je})}}}},$t.prototype._queryCellCircle=function(c,f,h,m,_,w,S,C){var k=S.circle,N=S.seenUids,V=this.boxCells[_];if(V!==null)for(var K=this.bboxes,$=0,ae=V;$<ae.length;$+=1){var se=ae[$];if(!N.box[se]){N.box[se]=!0;var fe=4*se;if(this._circleAndRectCollide(k.x,k.y,k.radius,K[fe+0],K[fe+1],K[fe+2],K[fe+3])&&(!C||C(this.boxKeys[se])))return w.push(!0),!0}}var ie=this.circleCells[_];if(ie!==null)for(var he=this.circles,ve=0,Te=ie;ve<Te.length;ve+=1){var Le=Te[ve];if(!N.circle[Le]){N.circle[Le]=!0;var Ae=3*Le;if(this._circlesCollide(he[Ae],he[Ae+1],he[Ae+2],k.x,k.y,k.radius)&&(!C||C(this.circleKeys[Le])))return w.push(!0),!0}}},$t.prototype._forEachCell=function(c,f,h,m,_,w,S,C){for(var k=this._convertToXCellCoord(c),N=this._convertToYCellCoord(f),V=this._convertToXCellCoord(h),K=this._convertToYCellCoord(m),$=k;$<=V;$++)for(var ae=N;ae<=K;ae++)if(_.call(this,c,f,h,m,this.xCellCount*ae+$,w,S,C))return},$t.prototype._convertToXCellCoord=function(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))},$t.prototype._convertToYCellCoord=function(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))},$t.prototype._circlesCollide=function(c,f,h,m,_,w){var S=m-c,C=_-f,k=h+w;return k*k>S*S+C*C},$t.prototype._circleAndRectCollide=function(c,f,h,m,_,w,S){var C=(w-m)/2,k=Math.abs(c-(m+C));if(k>C+h)return!1;var N=(S-_)/2,V=Math.abs(f-(_+N));if(V>N+h)return!1;if(k<=C||V<=N)return!0;var K=k-C,$=V-N;return K*K+$*$<=h*h};var ur=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function io(c,f){for(var h=0;h<c;h++){var m=f.length;f.resize(m+4),f.float32.set(ur,3*m)}}function yr(c,f,h){var m=f[0],_=f[1];return c[0]=h[0]*m+h[4]*_+h[12],c[1]=h[1]*m+h[5]*_+h[13],c[3]=h[3]*m+h[7]*_+h[15],c}var Ln=function(c,f,h){f===void 0&&(f=new $t(c.width+200,c.height+200,25)),h===void 0&&(h=new $t(c.width+200,c.height+200,25)),this.transform=c,this.grid=f,this.ignoredGrid=h,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+100,this.screenBottomBoundary=c.height+100,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200};function cr(c,f,h){return f*(a.EXTENT/(c.tileSize*Math.pow(2,h-c.tileID.overscaledZ)))}Ln.prototype.placeCollisionBox=function(c,f,h,m,_){var w=this.projectAndGetPerspectiveRatio(m,c.anchorPointX,c.anchorPointY),S=h*w.perspectiveRatio,C=c.x1*S+w.point.x,k=c.y1*S+w.point.y,N=c.x2*S+w.point.x,V=c.y2*S+w.point.y;return!this.isInsideGrid(C,k,N,V)||!f&&this.grid.hitTest(C,k,N,V,_)?{box:[],offscreen:!1}:{box:[C,k,N,V],offscreen:this.isOffscreen(C,k,N,V)}},Ln.prototype.placeCollisionCircles=function(c,f,h,m,_,w,S,C,k,N,V,K,$){var ae=[],se=new a.Point(f.anchorX,f.anchorY),fe=Vt(se,w),ie=Qr(this.transform.cameraToCenterDistance,fe.signedDistanceFromCamera),he=(N?_/ie:_*ie)/a.ONE_EM,ve=Vt(se,S).point,Te=za(he,m,f.lineOffsetX*he,f.lineOffsetY*he,!1,ve,se,f,h,S,{}),Le=!1,Ae=!1,Re=!0;if(Te){for(var je=.5*K*ie+$,Je=new a.Point(-100,-100),Ze=new a.Point(this.screenRightBoundary,this.screenBottomBoundary),rt=new kn,ft=Te.first,Mt=Te.last,wt=[],Ht=ft.path.length-1;Ht>=1;Ht--)wt.push(ft.path[Ht]);for(var lt=1;lt<Mt.path.length;lt++)wt.push(Mt.path[lt]);var Ft=2.5*je;if(C){var Bt=wt.map(function(Ko){return Vt(Ko,C)});wt=Bt.some(function(Ko){return Ko.signedDistanceFromCamera<=0})?[]:Bt.map(function(Ko){return Ko.point})}var Et=[];if(wt.length>0){for(var Ot=wt[0].clone(),jt=wt[0].clone(),It=1;It<wt.length;It++)Ot.x=Math.min(Ot.x,wt[It].x),Ot.y=Math.min(Ot.y,wt[It].y),jt.x=Math.max(jt.x,wt[It].x),jt.y=Math.max(jt.y,wt[It].y);Et=Ot.x>=Je.x&&jt.x<=Ze.x&&Ot.y>=Je.y&&jt.y<=Ze.y?[wt]:jt.x<Je.x||Ot.x>Ze.x||jt.y<Je.y||Ot.y>Ze.y?[]:a.clipLine([wt],Je.x,Je.y,Ze.x,Ze.y)}for(var Ut=0,Mr=Et;Ut<Mr.length;Ut+=1){var Xn;rt.reset(Mr[Ut],.25*je),Xn=rt.length<=.5*je?1:Math.ceil(rt.paddedLength/Ft)+1;for(var xi=0;xi<Xn;xi++){var Pn=xi/Math.max(Xn-1,1),fr=rt.lerp(Pn),Zn=fr.x+100,Ao=fr.y+100;ae.push(Zn,Ao,je,0);var Ls=Zn-je,Yo=Ao-je,bi=Zn+je,uo=Ao+je;if(Re=Re&&this.isOffscreen(Ls,Yo,bi,uo),Ae=Ae||this.isInsideGrid(Ls,Yo,bi,uo),!c&&this.grid.hitTestCircle(Zn,Ao,je,V)&&(Le=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!k&&Le||!Ae?[]:ae,offscreen:Re,collisionDetected:Le}},Ln.prototype.queryRenderedSymbols=function(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],h=1/0,m=1/0,_=-1/0,w=-1/0,S=0,C=c;S<C.length;S+=1){var k=C[S],N=new a.Point(k.x+100,k.y+100);h=Math.min(h,N.x),m=Math.min(m,N.y),_=Math.max(_,N.x),w=Math.max(w,N.y),f.push(N)}for(var V={},K={},$=0,ae=this.grid.query(h,m,_,w).concat(this.ignoredGrid.query(h,m,_,w));$<ae.length;$+=1){var se=ae[$],fe=se.key;if(V[fe.bucketInstanceId]===void 0&&(V[fe.bucketInstanceId]={}),!V[fe.bucketInstanceId][fe.featureIndex]){var ie=[new a.Point(se.x1,se.y1),new a.Point(se.x2,se.y1),new a.Point(se.x2,se.y2),new a.Point(se.x1,se.y2)];a.polygonIntersectsPolygon(f,ie)&&(V[fe.bucketInstanceId][fe.featureIndex]=!0,K[fe.bucketInstanceId]===void 0&&(K[fe.bucketInstanceId]=[]),K[fe.bucketInstanceId].push(fe.featureIndex))}}return K},Ln.prototype.insertCollisionBox=function(c,f,h,m,_){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:_},c[0],c[1],c[2],c[3])},Ln.prototype.insertCollisionCircles=function(c,f,h,m,_){for(var w=f?this.ignoredGrid:this.grid,S={bucketInstanceId:h,featureIndex:m,collisionGroupID:_},C=0;C<c.length;C+=4)w.insertCircle(S,c[C],c[C+1],c[C+2])},Ln.prototype.projectAndGetPerspectiveRatio=function(c,f,h){var m=[f,h,0,1];return yr(m,m,c),{point:new a.Point((m[0]/m[3]+1)/2*this.transform.width+100,(-m[1]/m[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}},Ln.prototype.isOffscreen=function(c,f,h,m){return h<100||c>=this.screenRightBoundary||m<100||f>this.screenBottomBoundary},Ln.prototype.isInsideGrid=function(c,f,h,m){return h>=0&&c<this.gridRightBoundary&&m>=0&&f<this.gridBottomBoundary},Ln.prototype.getViewportMatrix=function(){var c=a.identity([]);return a.translate(c,c,[-100,-100,0]),c};var sl=function(c,f,h,m){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?f:-f))):m&&h?1:0,this.placed=h};sl.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var vr=function(c,f,h,m,_){this.text=new sl(c?c.text:null,f,h,_),this.icon=new sl(c?c.icon:null,f,m,_)};vr.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var au=function(c,f,h){this.text=c,this.icon=f,this.skipFade=h},Zo=function(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]},Br=function(c,f,h,m,_){this.bucketInstanceId=c,this.featureIndex=f,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=_},q=function(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}};function Q(c,f,h,m,_){var w=a.getAnchorAlignment(c),S=-(w.horizontalAlign-.5)*f,C=-(w.verticalAlign-.5)*h,k=a.evaluateVariableOffset(c,m);return new a.Point(S+k[0]*_,C+k[1]*_)}function de(c,f,h,m,_,w){var S=c.x1,C=c.x2,k=c.y1,N=c.y2,V=c.anchorPointX,K=c.anchorPointY,$=new a.Point(f,h);return m&&$._rotate(_?w:-w),{x1:S+$.x,y1:k+$.y,x2:C+$.x,y2:N+$.y,anchorPointX:V,anchorPointY:K}}q.prototype.get=function(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){var f=++this.maxGroupID;this.collisionGroups[c]={ID:f,predicate:function(h){return h.collisionGroupID===f}}}return this.collisionGroups[c]};var Ce=function(c,f,h,m){this.transform=c.clone(),this.collisionIndex=new Ln(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new q(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}};function Ke(c,f,h,m,_){c.emplaceBack(f?1:0,h?1:0,m||0,_||0),c.emplaceBack(f?1:0,h?1:0,m||0,_||0),c.emplaceBack(f?1:0,h?1:0,m||0,_||0),c.emplaceBack(f?1:0,h?1:0,m||0,_||0)}Ce.prototype.getBucketParts=function(c,f,h,m){var _=h.getBucket(f),w=h.latestFeatureIndex;if(_&&w&&f.id===_.layerIds[0]){var S=h.collisionBoxArray,C=_.layers[0].layout,k=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),N=h.tileSize/a.EXTENT,V=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),K=C.get("text-pitch-alignment")==="map",$=C.get("text-rotation-alignment")==="map",ae=cr(h,1,this.transform.zoom),se=xn(V,K,$,this.transform,ae),fe=null;if(K){var ie=At(V,K,$,this.transform,ae);fe=a.multiply([],this.transform.labelPlaneMatrix,ie)}this.retainedQueryData[_.bucketInstanceId]=new Br(_.bucketInstanceId,w,_.sourceLayerIndex,_.index,h.tileID);var he={bucket:_,layout:C,posMatrix:V,textLabelPlaneMatrix:se,labelToScreenMatrix:fe,scale:k,textPixelRatio:N,holdingForFade:h.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(m)for(var ve=0,Te=_.sortKeyRanges;ve<Te.length;ve+=1){var Le=Te[ve];c.push({sortKey:Le.sortKey,symbolInstanceStart:Le.symbolInstanceStart,symbolInstanceEnd:Le.symbolInstanceEnd,parameters:he})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:he})}},Ce.prototype.attemptAnchorPlacement=function(c,f,h,m,_,w,S,C,k,N,V,K,$,ae,se){var fe,ie=[K.textOffset0,K.textOffset1],he=Q(c,h,m,ie,_),ve=this.collisionIndex.placeCollisionBox(de(f,he.x,he.y,w,S,this.transform.angle),V,C,k,N.predicate);if(!se||this.collisionIndex.placeCollisionBox(de(se,he.x,he.y,w,S,this.transform.angle),V,C,k,N.predicate).box.length!==0)return ve.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID].text&&(fe=this.prevPlacement.variableOffsets[K.crossTileID].anchor),this.variableOffsets[K.crossTileID]={textOffset:ie,width:h,height:m,anchor:c,textBoxScale:_,prevAnchor:fe},this.markUsedJustification($,c,K,ae),$.allowVerticalPlacement&&(this.markUsedOrientation($,ae,K),this.placedOrientations[K.crossTileID]=ae),{shift:he,placedGlyphBoxes:ve}):void 0},Ce.prototype.placeLayerBucketPart=function(c,f,h){var m=this,_=c.parameters,w=_.bucket,S=_.layout,C=_.posMatrix,k=_.textLabelPlaneMatrix,N=_.labelToScreenMatrix,V=_.textPixelRatio,K=_.holdingForFade,$=_.collisionBoxArray,ae=_.partiallyEvaluatedTextSize,se=_.collisionGroup,fe=S.get("text-optional"),ie=S.get("icon-optional"),he=S.get("text-allow-overlap"),ve=S.get("icon-allow-overlap"),Te=S.get("text-rotation-alignment")==="map",Le=S.get("text-pitch-alignment")==="map",Ae=S.get("icon-text-fit")!=="none",Re=S.get("symbol-z-order")==="viewport-y",je=he&&(ve||!w.hasIconData()||ie),Je=ve&&(he||!w.hasTextData()||fe);!w.collisionArrays&&$&&w.deserializeCollisionBoxes($);var Ze=function(lt,Ft){if(!f[lt.crossTileID])if(K)m.placements[lt.crossTileID]=new au(!1,!1,!1);else{var Bt,Et=!1,Ot=!1,jt=!0,It=null,Ut={box:null,offscreen:null},Mr={box:null,offscreen:null},Xn=null,xi=null,Pn=0,fr=0,Zn=0;Ft.textFeatureIndex?Pn=Ft.textFeatureIndex:lt.useRuntimeCollisionCircles&&(Pn=lt.featureIndex),Ft.verticalTextFeatureIndex&&(fr=Ft.verticalTextFeatureIndex);var Ao=Ft.textBox;if(Ao){var Ls=function(er){var Oi=a.WritingMode.horizontal;if(w.allowVerticalPlacement&&!er&&m.prevPlacement){var zi=m.prevPlacement.placedOrientations[lt.crossTileID];zi&&(m.placedOrientations[lt.crossTileID]=zi,m.markUsedOrientation(w,Oi=zi,lt))}return Oi},Yo=function(er,Oi){if(w.allowVerticalPlacement&&lt.numVerticalGlyphVertices>0&&Ft.verticalTextBox)for(var zi=0,Os=w.writingModes;zi<Os.length&&(Os[zi]===a.WritingMode.vertical?(Ut=Oi(),Mr=Ut):Ut=er(),!(Ut&&Ut.box&&Ut.box.length));zi+=1);else Ut=er()};if(S.get("text-variable-anchor")){var bi=S.get("text-variable-anchor");if(m.prevPlacement&&m.prevPlacement.variableOffsets[lt.crossTileID]){var uo=m.prevPlacement.variableOffsets[lt.crossTileID];bi.indexOf(uo.anchor)>0&&(bi=bi.filter(function(er){return er!==uo.anchor})).unshift(uo.anchor)}var Ko=function(er,Oi,zi){for(var Os=er.x2-er.x1,_v=er.y2-er.y1,rm=lt.textBoxScale,im=Ae&&!ve?Oi:null,El={box:[],offscreen:!1},om=he?2*bi.length:bi.length,Tl=0;Tl<om;++Tl){var wa=m.attemptAnchorPlacement(bi[Tl%bi.length],er,Os,_v,rm,Te,Le,V,C,se,Tl>=bi.length,lt,w,zi,im);if(wa&&(El=wa.placedGlyphBoxes)&&El.box&&El.box.length){Et=!0,It=wa.shift;break}}return El};Yo(function(){return Ko(Ao,Ft.iconBox,a.WritingMode.horizontal)},function(){var er=Ft.verticalTextBox;return w.allowVerticalPlacement&&!(Ut&&Ut.box&&Ut.box.length)&&lt.numVerticalGlyphVertices>0&&er?Ko(er,Ft.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),Ut&&(Et=Ut.box,jt=Ut.offscreen);var xl=Ls(Ut&&Ut.box);if(!Et&&m.prevPlacement){var Za=m.prevPlacement.variableOffsets[lt.crossTileID];Za&&(m.variableOffsets[lt.crossTileID]=Za,m.markUsedJustification(w,Za.anchor,lt,xl))}}else{var bl=function(er,Oi){var zi=m.collisionIndex.placeCollisionBox(er,he,V,C,se.predicate);return zi&&zi.box&&zi.box.length&&(m.markUsedOrientation(w,Oi,lt),m.placedOrientations[lt.crossTileID]=Oi),zi};Yo(function(){return bl(Ao,a.WritingMode.horizontal)},function(){var er=Ft.verticalTextBox;return w.allowVerticalPlacement&&lt.numVerticalGlyphVertices>0&&er?bl(er,a.WritingMode.vertical):{box:null,offscreen:null}}),Ls(Ut&&Ut.box&&Ut.box.length)}}if(Et=(Bt=Ut)&&Bt.box&&Bt.box.length>0,jt=Bt&&Bt.offscreen,lt.useRuntimeCollisionCircles){var Jo=w.text.placedSymbolArray.get(lt.centerJustifiedTextSymbolIndex),Tu=a.evaluateSizeForFeature(w.textSizeData,ae,Jo),$a=S.get("text-padding");Xn=m.collisionIndex.placeCollisionCircles(he,Jo,w.lineVertexArray,w.glyphOffsetArray,Tu,C,k,N,h,Le,se.predicate,lt.collisionCircleDiameter,$a),Et=he||Xn.circles.length>0&&!Xn.collisionDetected,jt=jt&&Xn.offscreen}if(Ft.iconFeatureIndex&&(Zn=Ft.iconFeatureIndex),Ft.iconBox){var ba=function(er){var Oi=Ae&&It?de(er,It.x,It.y,Te,Le,m.transform.angle):er;return m.collisionIndex.placeCollisionBox(Oi,ve,V,C,se.predicate)};Ot=Mr&&Mr.box&&Mr.box.length&&Ft.verticalIconBox?(xi=ba(Ft.verticalIconBox)).box.length>0:(xi=ba(Ft.iconBox)).box.length>0,jt=jt&&xi.offscreen}var kr=fe||lt.numHorizontalGlyphVertices===0&&lt.numVerticalGlyphVertices===0,wl=ie||lt.numIconVertices===0;if(kr||wl?wl?kr||(Ot=Ot&&Et):Et=Ot&&Et:Ot=Et=Ot&&Et,Et&&Bt&&Bt.box&&m.collisionIndex.insertCollisionBox(Bt.box,S.get("text-ignore-placement"),w.bucketInstanceId,Mr&&Mr.box&&fr?fr:Pn,se.ID),Ot&&xi&&m.collisionIndex.insertCollisionBox(xi.box,S.get("icon-ignore-placement"),w.bucketInstanceId,Zn,se.ID),Xn&&(Et&&m.collisionIndex.insertCollisionCircles(Xn.circles,S.get("text-ignore-placement"),w.bucketInstanceId,Pn,se.ID),h)){var Lc=w.bucketInstanceId,xr=m.collisionCircleArrays[Lc];xr===void 0&&(xr=m.collisionCircleArrays[Lc]=new Zo);for(var Rs=0;Rs<Xn.circles.length;Rs+=4)xr.circles.push(Xn.circles[Rs+0]),xr.circles.push(Xn.circles[Rs+1]),xr.circles.push(Xn.circles[Rs+2]),xr.circles.push(Xn.collisionDetected?1:0)}m.placements[lt.crossTileID]=new au(Et||je,Ot||Je,jt||w.justReloaded),f[lt.crossTileID]=!0}};if(Re)for(var rt=w.getSortedSymbolIndexes(this.transform.angle),ft=rt.length-1;ft>=0;--ft){var Mt=rt[ft];Ze(w.symbolInstances.get(Mt),w.collisionArrays[Mt])}else for(var wt=c.symbolInstanceStart;wt<c.symbolInstanceEnd;wt++)Ze(w.symbolInstances.get(wt),w.collisionArrays[wt]);if(h&&w.bucketInstanceId in this.collisionCircleArrays){var Ht=this.collisionCircleArrays[w.bucketInstanceId];a.invert(Ht.invProjMatrix,C),Ht.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Ce.prototype.markUsedJustification=function(c,f,h,m){var _;_=m===a.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(f)];for(var w=0,S=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];w<S.length;w+=1){var C=S[w];C>=0&&(c.text.placedSymbolArray.get(C).crossTileID=_>=0&&C!==_?0:h.crossTileID)}},Ce.prototype.markUsedOrientation=function(c,f,h){for(var m=f===a.WritingMode.horizontal||f===a.WritingMode.horizontalOnly?f:0,_=f===a.WritingMode.vertical?f:0,w=0,S=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];w<S.length;w+=1)c.text.placedSymbolArray.get(S[w]).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=_)},Ce.prototype.commit=function(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,h=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var m=f?f.symbolFadeChange(c):1,_=f?f.opacities:{},w=f?f.variableOffsets:{},S=f?f.placedOrientations:{};for(var C in this.placements){var k=this.placements[C],N=_[C];N?(this.opacities[C]=new vr(N,m,k.text,k.icon),h=h||k.text!==N.text.placed||k.icon!==N.icon.placed):(this.opacities[C]=new vr(null,m,k.text,k.icon,k.skipFade),h=h||k.text||k.icon)}for(var V in _){var K=_[V];if(!this.opacities[V]){var $=new vr(K,m,!1,!1);$.isHidden()||(this.opacities[V]=$,h=h||K.text.placed||K.icon.placed)}}for(var ae in w)this.variableOffsets[ae]||!this.opacities[ae]||this.opacities[ae].isHidden()||(this.variableOffsets[ae]=w[ae]);for(var se in S)this.placedOrientations[se]||!this.opacities[se]||this.opacities[se].isHidden()||(this.placedOrientations[se]=S[se]);h?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:c)},Ce.prototype.updateLayerOpacities=function(c,f){for(var h={},m=0,_=f;m<_.length;m+=1){var w=_[m],S=w.getBucket(c);S&&w.latestFeatureIndex&&c.id===S.layerIds[0]&&this.updateBucketOpacities(S,h,w.collisionBoxArray)}},Ce.prototype.updateBucketOpacities=function(c,f,h){var m=this;c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();var _=c.layers[0].layout,w=new vr(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),k=_.get("text-variable-anchor"),N=_.get("text-rotation-alignment")==="map",V=_.get("text-pitch-alignment")==="map",K=_.get("icon-text-fit")!=="none",$=new vr(null,0,S&&(C||!c.hasIconData()||_.get("icon-optional")),C&&(S||!c.hasTextData()||_.get("text-optional")),!0);!c.collisionArrays&&h&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(h);for(var ae=function(he,ve,Te){for(var Le=0;Le<ve/4;Le++)he.opacityVertexArray.emplaceBack(Te)},se=function(he){var ve=c.symbolInstances.get(he),Te=ve.numHorizontalGlyphVertices,Le=ve.numVerticalGlyphVertices,Ae=ve.crossTileID,Re=m.opacities[Ae];f[Ae]?Re=w:Re||(m.opacities[Ae]=Re=$),f[Ae]=!0;var je=ve.numIconVertices>0,Je=m.placedOrientations[ve.crossTileID],Ze=Je===a.WritingMode.vertical,rt=Je===a.WritingMode.horizontal||Je===a.WritingMode.horizontalOnly;if(Te>0||Le>0){var ft=sf(Re.text);ae(c.text,Te,Ze?su:ft),ae(c.text,Le,rt?su:ft);var Mt=Re.text.isHidden();[ve.rightJustifiedTextSymbolIndex,ve.centerJustifiedTextSymbolIndex,ve.leftJustifiedTextSymbolIndex].forEach(function(Ut){Ut>=0&&(c.text.placedSymbolArray.get(Ut).hidden=Mt||Ze?1:0)}),ve.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(ve.verticalPlacedTextSymbolIndex).hidden=Mt||rt?1:0);var wt=m.variableOffsets[ve.crossTileID];wt&&m.markUsedJustification(c,wt.anchor,ve,Je);var Ht=m.placedOrientations[ve.crossTileID];Ht&&(m.markUsedJustification(c,"left",ve,Ht),m.markUsedOrientation(c,Ht,ve))}if(je){var lt=sf(Re.icon),Ft=!(K&&ve.verticalPlacedIconSymbolIndex&&Ze);ve.placedIconSymbolIndex>=0&&(ae(c.icon,ve.numIconVertices,Ft?lt:su),c.icon.placedSymbolArray.get(ve.placedIconSymbolIndex).hidden=Re.icon.isHidden()),ve.verticalPlacedIconSymbolIndex>=0&&(ae(c.icon,ve.numVerticalIconVertices,Ft?su:lt),c.icon.placedSymbolArray.get(ve.verticalPlacedIconSymbolIndex).hidden=Re.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){var Bt=c.collisionArrays[he];if(Bt){var Et=new a.Point(0,0);if(Bt.textBox||Bt.verticalTextBox){var Ot=!0;if(k){var jt=m.variableOffsets[Ae];jt?(Et=Q(jt.anchor,jt.width,jt.height,jt.textOffset,jt.textBoxScale),N&&Et._rotate(V?m.transform.angle:-m.transform.angle)):Ot=!1}Bt.textBox&&Ke(c.textCollisionBox.collisionVertexArray,Re.text.placed,!Ot||Ze,Et.x,Et.y),Bt.verticalTextBox&&Ke(c.textCollisionBox.collisionVertexArray,Re.text.placed,!Ot||rt,Et.x,Et.y)}var It=Boolean(!rt&&Bt.verticalIconBox);Bt.iconBox&&Ke(c.iconCollisionBox.collisionVertexArray,Re.icon.placed,It,K?Et.x:0,K?Et.y:0),Bt.verticalIconBox&&Ke(c.iconCollisionBox.collisionVertexArray,Re.icon.placed,!It,K?Et.x:0,K?Et.y:0)}}},fe=0;fe<c.symbolInstances.length;fe++)se(fe);if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){var ie=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=ie.invProjMatrix,c.placementViewportMatrix=ie.viewportMatrix,c.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}},Ce.prototype.symbolFadeChange=function(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ce.prototype.zoomAdjustment=function(c){return Math.max(0,(this.transform.zoom-c)/1.5)},Ce.prototype.hasTransitions=function(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration},Ce.prototype.stillRecent=function(c,f){var h=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*h>c},Ce.prototype.setStale=function(){this.stale=!0};var ct=Math.pow(2,25),tn=Math.pow(2,24),_r=Math.pow(2,17),Ur=Math.pow(2,16),Yr=Math.pow(2,9),oo=Math.pow(2,8),af=Math.pow(2,1);function sf(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;var f=c.placed?1:0,h=Math.floor(127*c.opacity);return h*ct+f*tn+h*_r+f*Ur+h*Yr+f*oo+h*af+f}var su=0,lf=function(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};lf.prototype.continuePlacement=function(c,f,h,m,_){for(var w=this._bucketParts;this._currentTileIndex<c.length;)if(f.getBucketParts(w,m,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(S,C){return S.sortKey-C.sortKey}));this._currentPartIndex<w.length;)if(f.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,_())return!0;return!1};var lu=function(c,f,h,m,_,w,S){this.placement=new Ce(c,_,w,S),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1};lu.prototype.isDone=function(){return this._done},lu.prototype.continuePlacement=function(c,f,h){for(var m=this,_=a.browser.now(),w=function(){var k=a.browser.now()-_;return!m._forceFullPlacement&&k>2};this._currentPlacementIndex>=0;){var S=f[c[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=C)&&(!S.maxzoom||S.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new lf(S)),this._inProgressLayer.continuePlacement(h[S.source],this.placement,this._showCollisionBoxes,S,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},lu.prototype.commit=function(c){return this.placement.commit(c),this.placement};var xo=512/a.EXTENT/2,ll=function(c,f,h){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var m=0;m<f.length;m++){var _=f.get(m),w=_.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,c)})}};ll.prototype.getScaledCoordinates=function(c,f){var h=xo/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*a.EXTENT+c.anchorX)*h),y:Math.floor((f.canonical.y*a.EXTENT+c.anchorY)*h)}},ll.prototype.findMatches=function(c,f,h){for(var m=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),_=0;_<c.length;_++){var w=c.get(_);if(!w.crossTileID){var S=this.indexedSymbolInstances[w.key];if(S)for(var C=this.getScaledCoordinates(w,f),k=0,N=S;k<N.length;k+=1){var V=N[k];if(Math.abs(V.coord.x-C.x)<=m&&Math.abs(V.coord.y-C.y)<=m&&!h[V.crossTileID]){h[V.crossTileID]=!0,w.crossTileID=V.crossTileID;break}}}}};var ul=function(){this.maxCrossTileID=0};ul.prototype.generate=function(){return++this.maxCrossTileID};var Da=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Da.prototype.handleWrapJump=function(c){var f=Math.round((c-this.lng)/360);if(f!==0)for(var h in this.indexes){var m=this.indexes[h],_={};for(var w in m){var S=m[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+f),_[S.tileID.key]=S}this.indexes[h]=_}this.lng=c},Da.prototype.addBucket=function(c,f,h){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(var m=0;m<f.symbolInstances.length;m++)f.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});var _=this.usedCrossTileIDs[c.overscaledZ];for(var w in this.indexes){var S=this.indexes[w];if(Number(w)>c.overscaledZ)for(var C in S){var k=S[C];k.tileID.isChildOf(c)&&k.findMatches(f.symbolInstances,c,_)}else{var N=S[c.scaledTo(Number(w)).key];N&&N.findMatches(f.symbolInstances,c,_)}}for(var V=0;V<f.symbolInstances.length;V++){var K=f.symbolInstances.get(V);K.crossTileID||(K.crossTileID=h.generate(),_[K.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new ll(c,f.symbolInstances,f.bucketInstanceId),!0},Da.prototype.removeBucketCrossTileIDs=function(c,f){for(var h in f.indexedSymbolInstances)for(var m=0,_=f.indexedSymbolInstances[h];m<_.length;m+=1)delete this.usedCrossTileIDs[c][_[m].crossTileID]},Da.prototype.removeStaleBuckets=function(c){var f=!1;for(var h in this.indexes){var m=this.indexes[h];for(var _ in m)c[m[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[_]),delete m[_],f=!0)}return f};var bo=function(){this.layerIndexes={},this.crossTileIDs=new ul,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};bo.prototype.addLayer=function(c,f,h){var m=this.layerIndexes[c.id];m===void 0&&(m=this.layerIndexes[c.id]=new Da);var _=!1,w={};m.handleWrapJump(h);for(var S=0,C=f;S<C.length;S+=1){var k=C[S],N=k.getBucket(c);N&&c.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(k.tileID,N,this.crossTileIDs)&&(_=!0),w[N.bucketInstanceId]=!0)}return m.removeStaleBuckets(w)&&(_=!0),_},bo.prototype.pruneUnusedLayers=function(c){var f={};for(var h in c.forEach(function(m){f[m]=!0}),this.layerIndexes)f[h]||delete this.layerIndexes[h]};var wo=function(c,f){return a.emitValidationErrors(c,f&&f.filter(function(h){return h.identifier!=="source.canvas"}))},gc=a.pick(Ve,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Fa=a.pick(Ve,["setCenter","setZoom","setBearing","setPitch"]),Cr=function(){var c={},f=a.styleSpec.$version;for(var h in a.styleSpec.$root){var m,_=a.styleSpec.$root[h];_.required&&(m=h==="version"?f:_.type==="array"?[]:{})!=null&&(c[h]=m)}return c}(),pa=function(c){function f(h,m){var _=this;m===void 0&&(m={}),c.call(this),this.map=h,this.dispatcher=new We(Ye(),this),this.imageManager=new W,this.imageManager.setEventedParent(this),this.glyphManager=new we(h._requestManager,m.localIdeographFontFamily),this.lineAtlas=new He(256,512),this.crossTileSymbolIndex=new bo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());var w=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(S){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},function(C,k){if(a.triggerPluginCompletionEvent(C),k&&k.every(function(V){return V}))for(var N in w.sourceCaches)w.sourceCaches[N].reload()})}),this.on("data",function(S){if(S.dataType==="source"&&S.sourceDataType==="metadata"){var C=_.sourceCaches[S.sourceId];if(C){var k=C.getSource();if(k&&k.vectorLayerIds)for(var N in _._layers){var V=_._layers[N];V.source===k.id&&_._validateLayer(V)}}}})}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.loadURL=function(h,m){var _=this;m===void 0&&(m={}),this.fire(new a.Event("dataloading",{dataType:"style"}));var w=typeof m.validate=="boolean"?m.validate:!a.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,m.accessToken);var S=this.map._requestManager.transformRequest(h,a.ResourceType.Style);this._request=a.getJSON(S,function(C,k){_._request=null,C?_.fire(new a.ErrorEvent(C)):k&&_._load(k,w)})},f.prototype.loadJSON=function(h,m){var _=this;m===void 0&&(m={}),this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.browser.frame(function(){_._request=null,_._load(h,m.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Cr,!1)},f.prototype._load=function(h,m){if(!m||!wo(this,a.validateStyle(h))){for(var _ in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(_,h.sources[_],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var w=xt(this.stylesheet.layers);this._order=w.map(function(N){return N.id}),this._layers={},this._serializedLayers={};for(var S=0,C=w;S<C.length;S+=1){var k=C[S];(k=a.createStyleLayer(k)).setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k,this._serializedLayers[k.id]=k.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Be(this.stylesheet.light),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}},f.prototype._loadSprite=function(h){var m=this;this._spriteRequest=function(_,w,S){var C,k,N,V=a.browser.devicePixelRatio>1?"@2x":"",K=a.getJSON(w.transformRequest(w.normalizeSpriteURL(_,V,".json"),a.ResourceType.SpriteJSON),function(se,fe){K=null,N||(N=se,C=fe,ae())}),$=a.getImage(w.transformRequest(w.normalizeSpriteURL(_,V,".png"),a.ResourceType.SpriteImage),function(se,fe){$=null,N||(N=se,k=fe,ae())});function ae(){if(N)S(N);else if(C&&k){var se=a.browser.getImageData(k),fe={};for(var ie in C){var he=C[ie],ve=he.width,Te=he.height,Le=he.x,Ae=he.y,Re=he.sdf,je=he.pixelRatio,Je=he.stretchX,Ze=he.stretchY,rt=he.content,ft=new a.RGBAImage({width:ve,height:Te});a.RGBAImage.copy(se,ft,{x:Le,y:Ae},{x:0,y:0},{width:ve,height:Te}),fe[ie]={data:ft,pixelRatio:je,sdf:Re,stretchX:Je,stretchY:Ze,content:rt}}S(null,fe)}}return{cancel:function(){K&&(K.cancel(),K=null),$&&($.cancel(),$=null)}}}(h,this.map._requestManager,function(_,w){if(m._spriteRequest=null,_)m.fire(new a.ErrorEvent(_));else if(w)for(var S in w)m.imageManager.addImage(S,w[S]);m.imageManager.setLoaded(!0),m._availableImages=m.imageManager.listImages(),m.dispatcher.broadcast("setImages",m._availableImages),m.fire(new a.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(h){var m=this.sourceCaches[h.source];if(m){var _=h.sourceLayer;if(_){var w=m.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(_)===-1)&&this.fire(new a.ErrorEvent(new Error('Source layer "'+_+'" does not exist on source "'+w.id+'" as specified by style layer "'+h.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(h){for(var m=[],_=0,w=h;_<w.length;_+=1){var S=this._layers[w[_]];S.type!=="custom"&&m.push(S.serialize())}return m},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var m in this._layers)if(this._layers[m].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(h){if(this._loaded){var m=this._changed;if(this._changed){var _=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var S in(_.length||w.length)&&this._updateWorkerLayers(_,w),this._updatedSources){var C=this._updatedSources[S];C==="reload"?this._reloadSource(S):C==="clear"&&this._clearSource(S)}for(var k in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[k].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}for(var N in this.sourceCaches)this.sourceCaches[N].used=!1;for(var V=0,K=this._order;V<K.length;V+=1){var $=this._layers[K[V]];$.recalculate(h,this._availableImages),!$.isHidden(h.zoom)&&$.source&&(this.sourceCaches[$.source].used=!0)}this.light.recalculate(h),this.z=h.zoom,m&&this.fire(new a.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},f.prototype._updateWorkerLayers=function(h,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:m})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(h){var m=this;if(this._checkLoaded(),wo(this,a.validateStyle(h)))return!1;(h=a.clone$1(h)).layers=xt(h.layers);var _=function(S,C){if(!S)return[{command:Ve.setStyle,args:[C]}];var k=[];try{if(!a.deepEqual(S.version,C.version))return[{command:Ve.setStyle,args:[C]}];a.deepEqual(S.center,C.center)||k.push({command:Ve.setCenter,args:[C.center]}),a.deepEqual(S.zoom,C.zoom)||k.push({command:Ve.setZoom,args:[C.zoom]}),a.deepEqual(S.bearing,C.bearing)||k.push({command:Ve.setBearing,args:[C.bearing]}),a.deepEqual(S.pitch,C.pitch)||k.push({command:Ve.setPitch,args:[C.pitch]}),a.deepEqual(S.sprite,C.sprite)||k.push({command:Ve.setSprite,args:[C.sprite]}),a.deepEqual(S.glyphs,C.glyphs)||k.push({command:Ve.setGlyphs,args:[C.glyphs]}),a.deepEqual(S.transition,C.transition)||k.push({command:Ve.setTransition,args:[C.transition]}),a.deepEqual(S.light,C.light)||k.push({command:Ve.setLight,args:[C.light]});var N={},V=[];(function($,ae,se,fe){var ie;for(ie in ae=ae||{},$=$||{})$.hasOwnProperty(ie)&&(ae.hasOwnProperty(ie)||Rt(ie,se,fe));for(ie in ae)ae.hasOwnProperty(ie)&&($.hasOwnProperty(ie)?a.deepEqual($[ie],ae[ie])||($[ie].type==="geojson"&&ae[ie].type==="geojson"&&en($,ae,ie)?se.push({command:Ve.setGeoJSONSourceData,args:[ie,ae[ie].data]}):Zt(ie,ae,se,fe)):zt(ie,ae,se))})(S.sources,C.sources,V,N);var K=[];S.layers&&S.layers.forEach(function($){N[$.source]?k.push({command:Ve.removeLayer,args:[$.id]}):K.push($)}),k=k.concat(V),function($,ae,se){ae=ae||[];var fe,ie,he,ve,Te,Le,Ae,Re=($=$||[]).map(mn),je=ae.map(mn),Je=$.reduce(sn,{}),Ze=ae.reduce(sn,{}),rt=Re.slice(),ft=Object.create(null);for(fe=0,ie=0;fe<Re.length;fe++)Ze.hasOwnProperty(he=Re[fe])?ie++:(se.push({command:Ve.removeLayer,args:[he]}),rt.splice(rt.indexOf(he,ie),1));for(fe=0,ie=0;fe<je.length;fe++)rt[rt.length-1-fe]!==(he=je[je.length-1-fe])&&(Je.hasOwnProperty(he)?(se.push({command:Ve.removeLayer,args:[he]}),rt.splice(rt.lastIndexOf(he,rt.length-ie),1)):ie++,se.push({command:Ve.addLayer,args:[Ze[he],Le=rt[rt.length-fe]]}),rt.splice(rt.length-fe,0,he),ft[he]=!0);for(fe=0;fe<je.length;fe++)if(ve=Je[he=je[fe]],Te=Ze[he],!ft[he]&&!a.deepEqual(ve,Te))if(a.deepEqual(ve.source,Te.source)&&a.deepEqual(ve["source-layer"],Te["source-layer"])&&a.deepEqual(ve.type,Te.type)){for(Ae in bt(ve.layout,Te.layout,se,he,null,Ve.setLayoutProperty),bt(ve.paint,Te.paint,se,he,null,Ve.setPaintProperty),a.deepEqual(ve.filter,Te.filter)||se.push({command:Ve.setFilter,args:[he,Te.filter]}),a.deepEqual(ve.minzoom,Te.minzoom)&&a.deepEqual(ve.maxzoom,Te.maxzoom)||se.push({command:Ve.setLayerZoomRange,args:[he,Te.minzoom,Te.maxzoom]}),ve)ve.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?bt(ve[Ae],Te[Ae],se,he,Ae.slice(6),Ve.setPaintProperty):a.deepEqual(ve[Ae],Te[Ae])||se.push({command:Ve.setLayerProperty,args:[he,Ae,Te[Ae]]}));for(Ae in Te)Te.hasOwnProperty(Ae)&&!ve.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?bt(ve[Ae],Te[Ae],se,he,Ae.slice(6),Ve.setPaintProperty):a.deepEqual(ve[Ae],Te[Ae])||se.push({command:Ve.setLayerProperty,args:[he,Ae,Te[Ae]]}))}else se.push({command:Ve.removeLayer,args:[he]}),Le=rt[rt.lastIndexOf(he)+1],se.push({command:Ve.addLayer,args:[Te,Le]})}(K,C.layers,k)}catch($){console.warn("Unable to compute style diff:",$),k=[{command:Ve.setStyle,args:[C]}]}return k}(this.serialize(),h).filter(function(S){return!(S.command in Fa)});if(_.length===0)return!1;var w=_.filter(function(S){return!(S.command in gc)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(S){return S.command}).join(", ")+".");return _.forEach(function(S){S.command!=="setTransition"&&m[S.command].apply(m,S.args)}),this.stylesheet=h,!0},f.prototype.addImage=function(h,m){if(this.getImage(h))return this.fire(new a.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,m),this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.fire(new a.Event("data",{dataType:"style"}))},f.prototype.updateImage=function(h,m){this.imageManager.updateImage(h,m)},f.prototype.getImage=function(h){return this.imageManager.getImage(h)},f.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new a.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.fire(new a.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(h,m,_){var w=this;if(_===void 0&&(_={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!m.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(m).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(a.validateStyle.source,"sources."+h,m,null,_))){this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);var S=this.sourceCaches[h]=new xe(h,m,this.dispatcher);S.style=this,S.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:S.serialize(),sourceId:h}}),S.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var m in this._layers)if(this._layers[m].source===h)return this.fire(new a.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+m+'" is using it.')));var _=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],_.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),_.setEventedParent(null),_.clearTiles(),_.onRemove&&_.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(h,m){this._checkLoaded(),this.sourceCaches[h].getSource().setData(m),this._changed=!0},f.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},f.prototype.addLayer=function(h,m,_){_===void 0&&(_={}),this._checkLoaded();var w=h.id;if(this.getLayer(w))this.fire(new a.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var S;if(h.type==="custom"){if(wo(this,a.validateCustomStyleLayer(h)))return;S=a.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(w,h.source),h=a.clone$1(h),h=a.extend(h,{source:w})),this._validate(a.validateStyle.layer,"layers."+w,h,{arrayIndex:-1},_))return;S=a.createStyleLayer(h),this._validateLayer(S),S.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[S.id]=S.serialize()}var C=m?this._order.indexOf(m):this._order.length;if(m&&C===-1)this.fire(new a.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.')));else{if(this._order.splice(C,0,w),this._layerOrderChanged=!0,this._layers[w]=S,this._removedLayers[w]&&S.source&&S.type!=="custom"){var k=this._removedLayers[w];delete this._removedLayers[w],k.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}},f.prototype.moveLayer=function(h,m){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==m){var _=this._order.indexOf(h);this._order.splice(_,1);var w=m?this._order.indexOf(m):this._order.length;m&&w===-1?this.fire(new a.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.'))):(this._order.splice(w,0,h),this._layerOrderChanged=!0)}}else this.fire(new a.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(h){this._checkLoaded();var m=this._layers[h];if(m){m.setEventedParent(null);var _=this._order.indexOf(h);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=m,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],m.onRemove&&m.onRemove(this.map)}else this.fire(new a.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(h){return this._layers[h]},f.prototype.hasLayer=function(h){return h in this._layers},f.prototype.setLayerZoomRange=function(h,m,_){this._checkLoaded();var w=this.getLayer(h);w?w.minzoom===m&&w.maxzoom===_||(m!=null&&(w.minzoom=m),_!=null&&(w.maxzoom=_),this._updateLayer(w)):this.fire(new a.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(h,m,_){_===void 0&&(_={}),this._checkLoaded();var w=this.getLayer(h);if(w){if(!a.deepEqual(w.filter,m))return m==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(a.validateStyle.filter,"layers."+w.id+".filter",m,null,_)||(w.filter=a.clone$1(m),this._updateLayer(w)))}else this.fire(new a.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(h){return a.clone$1(this.getLayer(h).filter)},f.prototype.setLayoutProperty=function(h,m,_,w){w===void 0&&(w={}),this._checkLoaded();var S=this.getLayer(h);S?a.deepEqual(S.getLayoutProperty(m),_)||(S.setLayoutProperty(m,_,w),this._updateLayer(S)):this.fire(new a.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(h,m){var _=this.getLayer(h);if(_)return _.getLayoutProperty(m);this.fire(new a.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(h,m,_,w){w===void 0&&(w={}),this._checkLoaded();var S=this.getLayer(h);S?a.deepEqual(S.getPaintProperty(m),_)||(S.setPaintProperty(m,_,w)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new a.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(h,m){return this.getLayer(h).getPaintProperty(m)},f.prototype.setFeatureState=function(h,m){this._checkLoaded();var _=h.source,w=h.sourceLayer,S=this.sourceCaches[_];if(S!==void 0){var C=S.getSource().type;C==="geojson"&&w?this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||w?(h.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),S.setFeatureState(w,h.id,m)):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(h,m){this._checkLoaded();var _=h.source,w=this.sourceCaches[_];if(w!==void 0){var S=w.getSource().type,C=S==="vector"?h.sourceLayer:void 0;S!=="vector"||C?m&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new a.ErrorEvent(new Error("A feature id is requred to remove its specific state property."))):w.removeFeatureState(C,h.id,m):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(h){this._checkLoaded();var m=h.source,_=h.sourceLayer,w=this.sourceCaches[m];if(w!==void 0){if(w.getSource().type!=="vector"||_)return h.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(_,h.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error("The source '"+m+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:a.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},f.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(h){for(var m=this,_=function(Je){return m._layers[Je].type==="fill-extrusion"},w={},S=[],C=this._order.length-1;C>=0;C--){var k=this._order[C];if(_(k)){w[k]=C;for(var N=0,V=h;N<V.length;N+=1){var K=V[N][k];if(K)for(var $=0,ae=K;$<ae.length;$+=1)S.push(ae[$])}}}S.sort(function(Je,Ze){return Ze.intersectionZ-Je.intersectionZ});for(var se=[],fe=this._order.length-1;fe>=0;fe--){var ie=this._order[fe];if(_(ie))for(var he=S.length-1;he>=0;he--){var ve=S[he].feature;if(w[ve.layer.id]<fe)break;se.push(ve),S.pop()}else for(var Te=0,Le=h;Te<Le.length;Te+=1){var Ae=Le[Te][ie];if(Ae)for(var Re=0,je=Ae;Re<je.length;Re+=1)se.push(je[Re].feature)}}return se},f.prototype.queryRenderedFeatures=function(h,m,_){m&&m.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",m.filter,null,m);var w={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var S=0,C=m.layers;S<C.length;S+=1){var k=C[S],N=this._layers[k];if(!N)return this.fire(new a.ErrorEvent(new Error("The layer '"+k+"' does not exist in the map's style and cannot be queried for features."))),[];w[N.source]=!0}}var V=[];for(var K in m.availableImages=this._availableImages,this.sourceCaches)m.layers&&!w[K]||V.push(Pt(this.sourceCaches[K],this._layers,this._serializedLayers,h,m,_));return this.placement&&V.push(function($,ae,se,fe,ie,he,ve){for(var Te={},Le=he.queryRenderedSymbols(fe),Ae=[],Re=0,je=Object.keys(Le).map(Number);Re<je.length;Re+=1)Ae.push(ve[je[Re]]);Ae.sort(Nt);for(var Je=function(){var wt=rt[Ze],Ht=wt.featureIndex.lookupSymbolFeatures(Le[wt.bucketInstanceId],ae,wt.bucketIndex,wt.sourceLayerIndex,ie.filter,ie.layers,ie.availableImages,$);for(var lt in Ht){var Ft=Te[lt]=Te[lt]||[],Bt=Ht[lt];Bt.sort(function(jt,It){var Ut=wt.featureSortOrder;if(Ut){var Mr=Ut.indexOf(jt.featureIndex);return Ut.indexOf(It.featureIndex)-Mr}return It.featureIndex-jt.featureIndex});for(var Et=0,Ot=Bt;Et<Ot.length;Et+=1)Ft.push(Ot[Et])}},Ze=0,rt=Ae;Ze<rt.length;Ze+=1)Je();var ft=function(wt){Te[wt].forEach(function(Ht){var lt=Ht.feature,Ft=se[$[wt].source].getFeatureState(lt.layer["source-layer"],lt.id);lt.source=lt.layer.source,lt.layer["source-layer"]&&(lt.sourceLayer=lt.layer["source-layer"]),lt.state=Ft})};for(var Mt in Te)ft(Mt);return Te}(this._layers,this._serializedLayers,this.sourceCaches,h,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(V)},f.prototype.querySourceFeatures=function(h,m){m&&m.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",m.filter,null,m);var _=this.sourceCaches[h];return _?function(w,S){for(var C=w.getRenderableIds().map(function(ae){return w.getTileByID(ae)}),k=[],N={},V=0;V<C.length;V++){var K=C[V],$=K.tileID.canonical.key;N[$]||(N[$]=!0,K.querySourceFeatures(k,S))}return k}(_,m):[]},f.prototype.addSourceType=function(h,m,_){return f.getSourceType(h)?_(new Error('A source type called "'+h+'" already exists.')):(f.setSourceType(h,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:m.workerSourceURL},_):_(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(h,m){m===void 0&&(m={}),this._checkLoaded();var _=this.light.getLight(),w=!1;for(var S in h)if(!a.deepEqual(h[S],_[S])){w=!0;break}if(w){var C={now:a.browser.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,m),this.light.updateTransitions(C)}},f.prototype._validate=function(h,m,_,w,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&wo(this,h.call(a.validateStyle,a.extend({key:m,style:this.serialize(),value:_,styleSpec:a.styleSpec},w)))},f.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var m in this.sourceCaches)this.sourceCaches[m].clearTiles(),this.sourceCaches[m].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},f.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},f.prototype._updateSources=function(h){for(var m in this.sourceCaches)this.sourceCaches[m].update(h)},f.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},f.prototype._updatePlacement=function(h,m,_,w,S){S===void 0&&(S=!1);for(var C=!1,k=!1,N={},V=0,K=this._order;V<K.length;V+=1){var $=this._layers[K[V]];if($.type==="symbol"){if(!N[$.source]){var ae=this.sourceCaches[$.source];N[$.source]=ae.getRenderableIds(!0).map(function(ve){return ae.getTileByID(ve)}).sort(function(ve,Te){return Te.tileID.overscaledZ-ve.tileID.overscaledZ||(ve.tileID.isLessThan(Te.tileID)?-1:1)})}var se=this.crossTileSymbolIndex.addLayer($,N[$.source],h.center.lng);C=C||se}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.browser.now(),h.zoom))&&(this.pauseablePlacement=new lu(h,this._order,S,m,_,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.browser.now()),k=!0),C&&this.pauseablePlacement.placement.setStale()),k||C)for(var fe=0,ie=this._order;fe<ie.length;fe+=1){var he=this._layers[ie[fe]];he.type==="symbol"&&this.placement.updateLayerOpacities(he,N[he.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},f.prototype.getImages=function(h,m,_){this.imageManager.getImages(m.icons,_),this._updateTilesForChangedImages();var w=this.sourceCaches[m.source];w&&w.setDependencies(m.tileID.key,m.type,m.icons)},f.prototype.getGlyphs=function(h,m,_){this.glyphManager.getGlyphs(m.stacks,_)},f.prototype.getResource=function(h,m,_){return a.makeRequest(m,_)},f}(a.Evented);pa.getSourceType=function(c){return yt[c]},pa.setSourceType=function(c,f){yt[c]=f},pa.registerForPluginStateChange=a.registerForPluginStateChange;var yc=a.createLayout([{name:"a_pos",type:"Int16",components:2}]),uf=qn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),uv=qn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),cf=qn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),hf=qn(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),ff=qn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),pf=qn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Od=qn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),zd=qn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),cv=qn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),uu=qn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),cu=qn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Dd=qn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Kr=qn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),df=qn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Na=qn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Ba=qn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),bs=qn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform float u_maxzoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggeration=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/ pow(2.0,(u_zoom-u_maxzoom)*exaggeration+19.2562-u_zoom);gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ws=qn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Ua=qn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Es=qn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define MAX_LINE_DISTANCE 32767.0
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ts=qn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Va=qn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Fd=qn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Nd=qn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),cl=qn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),hv=qn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function qn(c,f){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=f.match(/attribute ([\w]+) ([\w]+)/g),_=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=w?w.concat(_):_,C={};return{fragmentSource:c=c.replace(h,function(k,N,V,K,$){return C[$]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_`+$+`
varying `+V+" "+K+" "+$+`;
#else
uniform `+V+" "+K+" u_"+$+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+$+`
    `+V+" "+K+" "+$+" = u_"+$+`;
#endif
`}),vertexSource:f=f.replace(h,function(k,N,V,K,$){var ae=K==="float"?"vec2":"vec4",se=$.match(/color/)?"color":ae;return C[$]?N==="define"?`
#ifndef HAS_UNIFORM_u_`+$+`
uniform lowp float u_`+$+`_t;
attribute `+V+" "+ae+" a_"+$+`;
varying `+V+" "+K+" "+$+`;
#else
uniform `+V+" "+K+" u_"+$+`;
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_`+$+`
    `+$+" = a_"+$+`;
#else
    `+V+" "+K+" "+$+" = u_"+$+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+$+`
    `+$+" = unpack_mix_"+se+"(a_"+$+", u_"+$+`_t);
#else
    `+V+" "+K+" "+$+" = u_"+$+`;
#endif
`:N==="define"?`
#ifndef HAS_UNIFORM_u_`+$+`
uniform lowp float u_`+$+`_t;
attribute `+V+" "+ae+" a_"+$+`;
#else
uniform `+V+" "+K+" u_"+$+`;
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_`+$+`
    `+V+" "+K+" "+$+" = a_"+$+`;
#else
    `+V+" "+K+" "+$+" = u_"+$+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+$+`
    `+V+" "+K+" "+$+" = unpack_mix_"+se+"(a_"+$+", u_"+$+`_t);
#else
    `+V+" "+K+" "+$+" = u_"+$+`;
#endif
`}),staticAttributes:m,staticUniforms:S}}var fv=Object.freeze({__proto__:null,prelude:uf,background:uv,backgroundPattern:cf,circle:hf,clippingMask:ff,heatmap:pf,heatmapTexture:Od,collisionBox:zd,collisionCircle:cv,debug:uu,fill:cu,fillOutline:Dd,fillOutlinePattern:Kr,fillPattern:df,fillExtrusion:Na,fillExtrusionPattern:Ba,hillshadePrepare:bs,hillshade:ws,line:Ua,lineGradient:Es,linePattern:Ts,lineSDF:Va,raster:Fd,symbolIcon:Nd,symbolSDF:cl,symbolTextAndIcon:hv}),vc=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Bd(c){for(var f=[],h=0;h<c.length;h++)if(c[h]!==null){var m=c[h].split(" ");f.push(m.pop())}return f}vc.prototype.bind=function(c,f,h,m,_,w,S,C){this.context=c;for(var k=this.boundPaintVertexBuffers.length!==m.length,N=0;!k&&N<m.length;N++)this.boundPaintVertexBuffers[N]!==m[N]&&(k=!0);c.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===h&&!k&&this.boundIndexBuffer===_&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===C?(c.bindVertexArrayOES.set(this.vao),S&&S.bind(),_&&_.dynamicDraw&&_.bind(),C&&C.bind()):this.freshBind(f,h,m,_,w,S,C)},vc.prototype.freshBind=function(c,f,h,m,_,w,S){var C,k=c.numAttributes,N=this.context,V=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=c,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S;else{C=N.currentNumAttributes||0;for(var K=k;K<C;K++)V.disableVertexAttribArray(K)}f.enableAttributes(V,c);for(var $=0,ae=h;$<ae.length;$+=1)ae[$].enableAttributes(V,c);w&&w.enableAttributes(V,c),S&&S.enableAttributes(V,c),f.bind(),f.setVertexAttribPointers(V,c,_);for(var se=0,fe=h;se<fe.length;se+=1){var ie=fe[se];ie.bind(),ie.setVertexAttribPointers(V,c,_)}w&&(w.bind(),w.setVertexAttribPointers(V,c,_)),m&&m.bind(),S&&(S.bind(),S.setVertexAttribPointers(V,c,_)),N.currentNumAttributes=k},vc.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Ud=function(c,f,h,m,_,w){var S=c.gl;this.program=S.createProgram();for(var C=Bd(h.staticAttributes),k=m?m.getBinderAttributes():[],N=C.concat(k),V=h.staticUniforms?Bd(h.staticUniforms):[],K=m?m.getBinderUniforms():[],$=[],ae=0,se=V.concat(K);ae<se.length;ae+=1){var fe=se[ae];$.indexOf(fe)<0&&$.push(fe)}var ie=m?m.defines():[];w&&ie.push("#define OVERDRAW_INSPECTOR;");var he=ie.concat(uf.fragmentSource,h.fragmentSource).join(`
`),ve=ie.concat(uf.vertexSource,h.vertexSource).join(`
`),Te=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Te,he),S.compileShader(Te),S.attachShader(this.program,Te);var Le=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Le,ve),S.compileShader(Le),S.attachShader(this.program,Le),this.attributes={};var Ae={};this.numAttributes=N.length;for(var Re=0;Re<this.numAttributes;Re++)N[Re]&&(S.bindAttribLocation(this.program,Re,N[Re]),this.attributes[N[Re]]=Re);S.linkProgram(this.program),S.deleteShader(Le),S.deleteShader(Te);for(var je=0;je<$.length;je++){var Je=$[je];if(Je&&!Ae[Je]){var Ze=S.getUniformLocation(this.program,Je);Ze&&(Ae[Je]=Ze)}}this.fixedUniforms=_(c,Ae),this.binderUniforms=m?m.getUniforms(c,Ae):[]}}};function ja(c,f,h){var m=1/cr(h,1,f.transform.tileZoom),_=Math.pow(2,h.tileID.overscaledZ),w=h.tileSize*Math.pow(2,f.transform.tileZoom)/_,S=w*(h.tileID.canonical.x+h.tileID.wrap*_),C=w*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[m,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[S>>16,C>>16],u_pixel_coord_lower:[65535&S,65535&C]}}Ud.prototype.draw=function(c,f,h,m,_,w,S,C,k,N,V,K,$,ae,se,fe){var ie,he=c.gl;if(!this.failedToCreate){for(var ve in c.program.set(this.program),c.setDepthMode(h),c.setStencilMode(m),c.setColorMode(_),c.setCullFace(w),this.fixedUniforms)this.fixedUniforms[ve].set(S[ve]);ae&&ae.setUniforms(c,this.binderUniforms,K,{zoom:$});for(var Te=(ie={},ie[he.LINES]=2,ie[he.TRIANGLES]=3,ie[he.LINE_STRIP]=1,ie)[f],Le=0,Ae=V.get();Le<Ae.length;Le+=1){var Re=Ae[Le],je=Re.vaos||(Re.vaos={});(je[C]||(je[C]=new vc)).bind(c,this,k,ae?ae.getPaintVertexBuffers():[],N,Re.vertexOffset,se,fe),he.drawElements(f,Re.primitiveLength*Te,he.UNSIGNED_SHORT,Re.primitiveOffset*Te*2)}}};var Ga=function(c,f,h,m){var _=f.style.light,w=_.properties.get("position"),S=[w.x,w.y,w.z],C=a.create$1();_.properties.get("anchor")==="viewport"&&a.fromRotation(C,-f.transform.angle),a.transformMat3(S,S,C);var k=_.properties.get("color");return{u_matrix:c,u_lightpos:S,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+h,u_opacity:m}},hl=function(c,f,h,m,_,w,S){return a.extend(Ga(c,f,h,m),ja(w,f,S),{u_height_factor:-Math.pow(2,_.overscaledZ)/S.tileSize/8})},mf=function(c){return{u_matrix:c}},gf=function(c,f,h,m){return a.extend(mf(c),ja(h,f,m))},yf=function(c,f){return{u_matrix:c,u_world:f}},Ss=function(c,f,h,m,_){return a.extend(gf(c,f,h,m),{u_world:_})},Vd=function(c,f,h,m){var _,w,S=c.transform;if(m.paint.get("circle-pitch-alignment")==="map"){var C=cr(h,1,S.zoom);_=!0,w=[C,C]}else _=!1,w=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(f.posMatrix,h,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:a.browser.devicePixelRatio,u_extrude_scale:w}},fl=function(c,f,h){var m=cr(h,1,f.zoom),_=Math.pow(2,f.zoom-h.tileID.overscaledZ),w=h.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[f.pixelsToGLUnits[0]/(m*_),f.pixelsToGLUnits[1]/(m*_)],u_overscale_factor:w}},pl=function(c,f,h){return{u_matrix:c,u_inv_matrix:f,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},vf=function(c,f,h){return h===void 0&&(h=1),{u_matrix:c,u_color:f,u_overlay:0,u_overlay_scale:h}},_c=function(c){return{u_matrix:c}},Cn=function(c,f,h,m){return{u_matrix:c,u_extrude_scale:cr(f,1,h),u_intensity:m}},dl=function(c,f,h){var m=c.transform;return{u_matrix:_f(c,f,h),u_ratio:1/cr(f,1,m.zoom),u_device_pixel_ratio:a.browser.devicePixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},pv=function(c,f,h){return a.extend(dl(c,f,h),{u_image:0})},hu=function(c,f,h,m){var _=c.transform,w=jd(f,_);return{u_matrix:_f(c,f,h),u_texsize:f.imageAtlasTexture.size,u_ratio:1/cr(f,1,_.zoom),u_device_pixel_ratio:a.browser.devicePixelRatio,u_image:0,u_scale:[w,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},dv=function(c,f,h,m,_){var w=c.lineAtlas,S=jd(f,c.transform),C=h.layout.get("line-cap")==="round",k=w.getDash(m.from,C),N=w.getDash(m.to,C),V=k.width*_.fromScale,K=N.width*_.toScale;return a.extend(dl(c,f,h),{u_patternscale_a:[S/V,-k.height/2],u_patternscale_b:[S/K,-N.height/2],u_sdfgamma:w.width/(256*Math.min(V,K)*a.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:N.y,u_mix:_.t})};function jd(c,f){return 1/cr(c,1,f.tileZoom)}function _f(c,f,h){return c.translatePosMatrix(f.tileID.posMatrix,f,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var mv=function(c,f,h,m,_){return{u_matrix:c,u_tl_parent:f,u_scale_parent:h,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(S=_.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(w=_.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:fu(_.paint.get("raster-hue-rotate"))};var w,S};function fu(c){c*=Math.PI/180;var f=Math.sin(c),h=Math.cos(c);return[(2*h+1)/3,(-Math.sqrt(3)*f-h+1)/3,(Math.sqrt(3)*f-h+1)/3]}var Ps,pu=function(c,f,h,m,_,w,S,C,k,N){var V=_.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:V.width/V.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:C,u_is_text:+k,u_pitch_with_map:+m,u_texsize:N,u_texture:0}},ml=function(c,f,h,m,_,w,S,C,k,N,V){var K=_.transform;return a.extend(pu(c,f,h,m,_,w,S,C,k,N),{u_gamma_scale:m?Math.cos(K._pitch)*K.cameraToCenterDistance:1,u_device_pixel_ratio:a.browser.devicePixelRatio,u_is_halo:+V})},gl=function(c,f,h,m,_,w,S,C,k,N){return a.extend(ml(c,f,h,m,_,w,S,C,!0,k,!0),{u_texsize_icon:N,u_texture_icon:1})},Gd=function(c,f,h){return{u_matrix:c,u_opacity:f,u_color:h}},du=function(c,f,h,m,_,w){return a.extend(function(S,C,k,N){var V=k.imageManager.getPattern(S.from.toString()),K=k.imageManager.getPattern(S.to.toString()),$=k.imageManager.getPixelSize(),ae=$.width,se=$.height,fe=Math.pow(2,N.tileID.overscaledZ),ie=N.tileSize*Math.pow(2,k.transform.tileZoom)/fe,he=ie*(N.tileID.canonical.x+N.tileID.wrap*fe),ve=ie*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:K.tl,u_pattern_br_b:K.br,u_texsize:[ae,se],u_mix:C.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:K.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/cr(N,1,k.transform.tileZoom),u_pixel_coord_upper:[he>>16,ve>>16],u_pixel_coord_lower:[65535&he,65535&ve]}}(m,w,h,_),{u_matrix:c,u_opacity:f})},Eo={fillExtrusion:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_lightpos:new a.Uniform3f(c,f.u_lightpos),u_lightintensity:new a.Uniform1f(c,f.u_lightintensity),u_lightcolor:new a.Uniform3f(c,f.u_lightcolor),u_vertical_gradient:new a.Uniform1f(c,f.u_vertical_gradient),u_opacity:new a.Uniform1f(c,f.u_opacity)}},fillExtrusionPattern:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_lightpos:new a.Uniform3f(c,f.u_lightpos),u_lightintensity:new a.Uniform1f(c,f.u_lightintensity),u_lightcolor:new a.Uniform3f(c,f.u_lightcolor),u_vertical_gradient:new a.Uniform1f(c,f.u_vertical_gradient),u_height_factor:new a.Uniform1f(c,f.u_height_factor),u_image:new a.Uniform1i(c,f.u_image),u_texsize:new a.Uniform2f(c,f.u_texsize),u_pixel_coord_upper:new a.Uniform2f(c,f.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(c,f.u_pixel_coord_lower),u_scale:new a.Uniform3f(c,f.u_scale),u_fade:new a.Uniform1f(c,f.u_fade),u_opacity:new a.Uniform1f(c,f.u_opacity)}},fill:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix)}},fillPattern:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_image:new a.Uniform1i(c,f.u_image),u_texsize:new a.Uniform2f(c,f.u_texsize),u_pixel_coord_upper:new a.Uniform2f(c,f.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(c,f.u_pixel_coord_lower),u_scale:new a.Uniform3f(c,f.u_scale),u_fade:new a.Uniform1f(c,f.u_fade)}},fillOutline:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_world:new a.Uniform2f(c,f.u_world)}},fillOutlinePattern:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_world:new a.Uniform2f(c,f.u_world),u_image:new a.Uniform1i(c,f.u_image),u_texsize:new a.Uniform2f(c,f.u_texsize),u_pixel_coord_upper:new a.Uniform2f(c,f.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(c,f.u_pixel_coord_lower),u_scale:new a.Uniform3f(c,f.u_scale),u_fade:new a.Uniform1f(c,f.u_fade)}},circle:function(c,f){return{u_camera_to_center_distance:new a.Uniform1f(c,f.u_camera_to_center_distance),u_scale_with_map:new a.Uniform1i(c,f.u_scale_with_map),u_pitch_with_map:new a.Uniform1i(c,f.u_pitch_with_map),u_extrude_scale:new a.Uniform2f(c,f.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(c,f.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(c,f.u_matrix)}},collisionBox:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_camera_to_center_distance:new a.Uniform1f(c,f.u_camera_to_center_distance),u_pixels_to_tile_units:new a.Uniform1f(c,f.u_pixels_to_tile_units),u_extrude_scale:new a.Uniform2f(c,f.u_extrude_scale),u_overscale_factor:new a.Uniform1f(c,f.u_overscale_factor)}},collisionCircle:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_inv_matrix:new a.UniformMatrix4f(c,f.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(c,f.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(c,f.u_viewport_size)}},debug:function(c,f){return{u_color:new a.UniformColor(c,f.u_color),u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_overlay:new a.Uniform1i(c,f.u_overlay),u_overlay_scale:new a.Uniform1f(c,f.u_overlay_scale)}},clippingMask:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix)}},heatmap:function(c,f){return{u_extrude_scale:new a.Uniform1f(c,f.u_extrude_scale),u_intensity:new a.Uniform1f(c,f.u_intensity),u_matrix:new a.UniformMatrix4f(c,f.u_matrix)}},heatmapTexture:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_world:new a.Uniform2f(c,f.u_world),u_image:new a.Uniform1i(c,f.u_image),u_color_ramp:new a.Uniform1i(c,f.u_color_ramp),u_opacity:new a.Uniform1f(c,f.u_opacity)}},hillshade:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_image:new a.Uniform1i(c,f.u_image),u_latrange:new a.Uniform2f(c,f.u_latrange),u_light:new a.Uniform2f(c,f.u_light),u_shadow:new a.UniformColor(c,f.u_shadow),u_highlight:new a.UniformColor(c,f.u_highlight),u_accent:new a.UniformColor(c,f.u_accent)}},hillshadePrepare:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_image:new a.Uniform1i(c,f.u_image),u_dimension:new a.Uniform2f(c,f.u_dimension),u_zoom:new a.Uniform1f(c,f.u_zoom),u_maxzoom:new a.Uniform1f(c,f.u_maxzoom),u_unpack:new a.Uniform4f(c,f.u_unpack)}},line:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_ratio:new a.Uniform1f(c,f.u_ratio),u_device_pixel_ratio:new a.Uniform1f(c,f.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(c,f.u_units_to_pixels)}},lineGradient:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_ratio:new a.Uniform1f(c,f.u_ratio),u_device_pixel_ratio:new a.Uniform1f(c,f.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(c,f.u_units_to_pixels),u_image:new a.Uniform1i(c,f.u_image)}},linePattern:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_texsize:new a.Uniform2f(c,f.u_texsize),u_ratio:new a.Uniform1f(c,f.u_ratio),u_device_pixel_ratio:new a.Uniform1f(c,f.u_device_pixel_ratio),u_image:new a.Uniform1i(c,f.u_image),u_units_to_pixels:new a.Uniform2f(c,f.u_units_to_pixels),u_scale:new a.Uniform3f(c,f.u_scale),u_fade:new a.Uniform1f(c,f.u_fade)}},lineSDF:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_ratio:new a.Uniform1f(c,f.u_ratio),u_device_pixel_ratio:new a.Uniform1f(c,f.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(c,f.u_units_to_pixels),u_patternscale_a:new a.Uniform2f(c,f.u_patternscale_a),u_patternscale_b:new a.Uniform2f(c,f.u_patternscale_b),u_sdfgamma:new a.Uniform1f(c,f.u_sdfgamma),u_image:new a.Uniform1i(c,f.u_image),u_tex_y_a:new a.Uniform1f(c,f.u_tex_y_a),u_tex_y_b:new a.Uniform1f(c,f.u_tex_y_b),u_mix:new a.Uniform1f(c,f.u_mix)}},raster:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_tl_parent:new a.Uniform2f(c,f.u_tl_parent),u_scale_parent:new a.Uniform1f(c,f.u_scale_parent),u_buffer_scale:new a.Uniform1f(c,f.u_buffer_scale),u_fade_t:new a.Uniform1f(c,f.u_fade_t),u_opacity:new a.Uniform1f(c,f.u_opacity),u_image0:new a.Uniform1i(c,f.u_image0),u_image1:new a.Uniform1i(c,f.u_image1),u_brightness_low:new a.Uniform1f(c,f.u_brightness_low),u_brightness_high:new a.Uniform1f(c,f.u_brightness_high),u_saturation_factor:new a.Uniform1f(c,f.u_saturation_factor),u_contrast_factor:new a.Uniform1f(c,f.u_contrast_factor),u_spin_weights:new a.Uniform3f(c,f.u_spin_weights)}},symbolIcon:function(c,f){return{u_is_size_zoom_constant:new a.Uniform1i(c,f.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(c,f.u_is_size_feature_constant),u_size_t:new a.Uniform1f(c,f.u_size_t),u_size:new a.Uniform1f(c,f.u_size),u_camera_to_center_distance:new a.Uniform1f(c,f.u_camera_to_center_distance),u_pitch:new a.Uniform1f(c,f.u_pitch),u_rotate_symbol:new a.Uniform1i(c,f.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(c,f.u_aspect_ratio),u_fade_change:new a.Uniform1f(c,f.u_fade_change),u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(c,f.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(c,f.u_coord_matrix),u_is_text:new a.Uniform1i(c,f.u_is_text),u_pitch_with_map:new a.Uniform1i(c,f.u_pitch_with_map),u_texsize:new a.Uniform2f(c,f.u_texsize),u_texture:new a.Uniform1i(c,f.u_texture)}},symbolSDF:function(c,f){return{u_is_size_zoom_constant:new a.Uniform1i(c,f.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(c,f.u_is_size_feature_constant),u_size_t:new a.Uniform1f(c,f.u_size_t),u_size:new a.Uniform1f(c,f.u_size),u_camera_to_center_distance:new a.Uniform1f(c,f.u_camera_to_center_distance),u_pitch:new a.Uniform1f(c,f.u_pitch),u_rotate_symbol:new a.Uniform1i(c,f.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(c,f.u_aspect_ratio),u_fade_change:new a.Uniform1f(c,f.u_fade_change),u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(c,f.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(c,f.u_coord_matrix),u_is_text:new a.Uniform1i(c,f.u_is_text),u_pitch_with_map:new a.Uniform1i(c,f.u_pitch_with_map),u_texsize:new a.Uniform2f(c,f.u_texsize),u_texture:new a.Uniform1i(c,f.u_texture),u_gamma_scale:new a.Uniform1f(c,f.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(c,f.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(c,f.u_is_halo)}},symbolTextAndIcon:function(c,f){return{u_is_size_zoom_constant:new a.Uniform1i(c,f.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(c,f.u_is_size_feature_constant),u_size_t:new a.Uniform1f(c,f.u_size_t),u_size:new a.Uniform1f(c,f.u_size),u_camera_to_center_distance:new a.Uniform1f(c,f.u_camera_to_center_distance),u_pitch:new a.Uniform1f(c,f.u_pitch),u_rotate_symbol:new a.Uniform1i(c,f.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(c,f.u_aspect_ratio),u_fade_change:new a.Uniform1f(c,f.u_fade_change),u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(c,f.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(c,f.u_coord_matrix),u_is_text:new a.Uniform1i(c,f.u_is_text),u_pitch_with_map:new a.Uniform1i(c,f.u_pitch_with_map),u_texsize:new a.Uniform2f(c,f.u_texsize),u_texsize_icon:new a.Uniform2f(c,f.u_texsize_icon),u_texture:new a.Uniform1i(c,f.u_texture),u_texture_icon:new a.Uniform1i(c,f.u_texture_icon),u_gamma_scale:new a.Uniform1f(c,f.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(c,f.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(c,f.u_is_halo)}},background:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_opacity:new a.Uniform1f(c,f.u_opacity),u_color:new a.UniformColor(c,f.u_color)}},backgroundPattern:function(c,f){return{u_matrix:new a.UniformMatrix4f(c,f.u_matrix),u_opacity:new a.Uniform1f(c,f.u_opacity),u_image:new a.Uniform1i(c,f.u_image),u_pattern_tl_a:new a.Uniform2f(c,f.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(c,f.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(c,f.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(c,f.u_pattern_br_b),u_texsize:new a.Uniform2f(c,f.u_texsize),u_mix:new a.Uniform1f(c,f.u_mix),u_pattern_size_a:new a.Uniform2f(c,f.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(c,f.u_pattern_size_b),u_scale_a:new a.Uniform1f(c,f.u_scale_a),u_scale_b:new a.Uniform1f(c,f.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(c,f.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(c,f.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(c,f.u_tile_units_to_pixels)}}};function xf(c,f,h,m,_,w,S){for(var C=c.context,k=C.gl,N=c.useProgram("collisionBox"),V=[],K=0,$=0,ae=0;ae<m.length;ae++){var se=m[ae],fe=f.getTile(se),ie=fe.getBucket(h);if(ie){var he=se.posMatrix;_[0]===0&&_[1]===0||(he=c.translatePosMatrix(se.posMatrix,fe,_,w));var ve=S?ie.textCollisionBox:ie.iconCollisionBox,Te=ie.collisionCircleArray;if(Te.length>0){var Le=a.create(),Ae=he;a.mul(Le,ie.placementInvProjMatrix,c.transform.glCoordMatrix),a.mul(Le,Le,ie.placementViewportMatrix),V.push({circleArray:Te,circleOffset:$,transform:Ae,invTransform:Le}),$=K+=Te.length/4}ve&&N.draw(C,k.LINES,Y.disabled,ne.disabled,c.colorModeForRenderPass(),re.disabled,fl(he,c.transform,fe),h.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,null,c.transform.zoom,null,null,ve.collisionVertexBuffer)}}if(S&&V.length){var Re=c.useProgram("collisionCircle"),je=new a.StructArrayLayout2f1f2i16;je.resize(4*K),je._trim();for(var Je=0,Ze=0,rt=V;Ze<rt.length;Ze+=1)for(var ft=rt[Ze],Mt=0;Mt<ft.circleArray.length/4;Mt++){var wt=4*Mt,Ht=ft.circleArray[wt+0],lt=ft.circleArray[wt+1],Ft=ft.circleArray[wt+2],Bt=ft.circleArray[wt+3];je.emplace(Je++,Ht,lt,Ft,Bt,0),je.emplace(Je++,Ht,lt,Ft,Bt,1),je.emplace(Je++,Ht,lt,Ft,Bt,2),je.emplace(Je++,Ht,lt,Ft,Bt,3)}(!Ps||Ps.length<2*K)&&(Ps=function(Xn){var xi=2*Xn,Pn=new a.StructArrayLayout3ui6;Pn.resize(xi),Pn._trim();for(var fr=0;fr<xi;fr++){var Zn=6*fr;Pn.uint16[Zn+0]=4*fr+0,Pn.uint16[Zn+1]=4*fr+1,Pn.uint16[Zn+2]=4*fr+2,Pn.uint16[Zn+3]=4*fr+2,Pn.uint16[Zn+4]=4*fr+3,Pn.uint16[Zn+5]=4*fr+0}return Pn}(K));for(var Et=C.createIndexBuffer(Ps,!0),Ot=C.createVertexBuffer(je,a.collisionCircleLayout.members,!0),jt=0,It=V;jt<It.length;jt+=1){var Ut=It[jt],Mr=pl(Ut.transform,Ut.invTransform,c.transform);Re.draw(C,k.TRIANGLES,Y.disabled,ne.disabled,c.colorModeForRenderPass(),re.disabled,Mr,h.id,Ot,Et,a.SegmentVector.simpleSegment(0,2*Ut.circleOffset,Ut.circleArray.length,Ut.circleArray.length/2),null,c.transform.zoom,null,null,null)}Ot.destroy(),Et.destroy()}}var Wd=a.identity(new Float32Array(16));function Hd(c,f,h,m,_,w){var S=a.getAnchorAlignment(c),C=-(S.horizontalAlign-.5)*f,k=-(S.verticalAlign-.5)*h,N=a.evaluateVariableOffset(c,m);return new a.Point((C/_+N[0])*w,(k/_+N[1])*w)}function yl(c,f,h,m,_,w,S,C,k,N,V){var K=c.text.placedSymbolArray,$=c.text.dynamicLayoutVertexArray,ae=c.icon.dynamicLayoutVertexArray,se={};$.clear();for(var fe=0;fe<K.length;fe++){var ie=K.get(fe),he=ie.hidden||!ie.crossTileID||c.allowVerticalPlacement&&!ie.placedOrientation?null:m[ie.crossTileID];if(he){var ve=new a.Point(ie.anchorX,ie.anchorY),Te=Vt(ve,h?C:S),Le=Qr(w.cameraToCenterDistance,Te.signedDistanceFromCamera),Ae=_.evaluateSizeForFeature(c.textSizeData,N,ie)*Le/a.ONE_EM;h&&(Ae*=c.tilePixelRatio/k);for(var Re=Hd(he.anchor,he.width,he.height,he.textOffset,he.textBoxScale,Ae),je=h?Vt(ve.add(Re),S).point:Te.point.add(f?Re.rotate(-w.angle):Re),Je=c.allowVerticalPlacement&&ie.placedOrientation===a.WritingMode.vertical?Math.PI/2:0,Ze=0;Ze<ie.numGlyphs;Ze++)a.addDynamicAttributes($,je,Je);V&&ie.associatedIconIndex>=0&&(se[ie.associatedIconIndex]={shiftedAnchor:je,angle:Je})}else io(ie.numGlyphs,$)}if(V){ae.clear();for(var rt=c.icon.placedSymbolArray,ft=0;ft<rt.length;ft++){var Mt=rt.get(ft);if(Mt.hidden)io(Mt.numGlyphs,ae);else{var wt=se[ft];if(wt)for(var Ht=0;Ht<Mt.numGlyphs;Ht++)a.addDynamicAttributes(ae,wt.shiftedAnchor,wt.angle);else io(Mt.numGlyphs,ae)}}c.icon.dynamicLayoutVertexBuffer.updateData(ae)}c.text.dynamicLayoutVertexBuffer.updateData($)}function xc(c,f,h){return h.iconsInText&&f?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function bc(c,f,h,m,_,w,S,C,k,N,V,K){for(var $=c.context,ae=$.gl,se=c.transform,fe=C==="map",ie=k==="map",he=fe&&h.layout.get("symbol-placement")!=="point",ve=fe&&!ie&&!he,Te=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Le=c.depthModeForSublayer(0,Y.ReadOnly),Ae=h.layout.get("text-variable-anchor"),Re=[],je=0,Je=m;je<Je.length;je+=1){var Ze=Je[je],rt=f.getTile(Ze),ft=rt.getBucket(h);if(ft){var Mt=_?ft.text:ft.icon;if(Mt&&Mt.segments.get().length){var wt=Mt.programConfigurations.get(h.id),Ht=_||ft.sdfIcons,lt=_?ft.textSizeData:ft.iconSizeData,Ft=ie||se.pitch!==0,Bt=c.useProgram(xc(Ht,_,ft),wt),Et=a.evaluateSizeForZoom(lt,se.zoom),Ot=void 0,jt=[0,0],It=void 0,Ut=void 0,Mr=null,Xn=void 0;if(_)It=rt.glyphAtlasTexture,Ut=ae.LINEAR,Ot=rt.glyphAtlasTexture.size,ft.iconsInText&&(jt=rt.imageAtlasTexture.size,Mr=rt.imageAtlasTexture,Xn=Ft||c.options.rotating||c.options.zooming||lt.kind==="composite"||lt.kind==="camera"?ae.LINEAR:ae.NEAREST);else{var xi=h.layout.get("icon-size").constantOr(0)!==1||ft.iconsNeedLinear;It=rt.imageAtlasTexture,Ut=Ht||c.options.rotating||c.options.zooming||xi||Ft?ae.LINEAR:ae.NEAREST,Ot=rt.imageAtlasTexture.size}var Pn=cr(rt,1,c.transform.zoom),fr=xn(Ze.posMatrix,ie,fe,c.transform,Pn),Zn=At(Ze.posMatrix,ie,fe,c.transform,Pn),Ao=Ae&&ft.hasTextData(),Ls=h.layout.get("icon-text-fit")!=="none"&&Ao&&ft.hasIconData();he&&Nr(ft,Ze.posMatrix,c,_,fr,Zn,ie,N);var Yo=c.translatePosMatrix(Ze.posMatrix,rt,w,S),bi=he||_&&Ae||Ls?Wd:fr,uo=c.translatePosMatrix(Zn,rt,w,S,!0),Ko=Ht&&h.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0,xl={program:Bt,buffers:Mt,uniformValues:Ht?ft.iconsInText?gl(lt.kind,Et,ve,ie,c,Yo,bi,uo,Ot,jt):ml(lt.kind,Et,ve,ie,c,Yo,bi,uo,_,Ot,!0):pu(lt.kind,Et,ve,ie,c,Yo,bi,uo,_,Ot),atlasTexture:It,atlasTextureIcon:Mr,atlasInterpolation:Ut,atlasInterpolationIcon:Xn,isSDF:Ht,hasHalo:Ko};if(Te)for(var Za=0,bl=Mt.segments.get();Za<bl.length;Za+=1){var Jo=bl[Za];Re.push({segments:new a.SegmentVector([Jo]),sortKey:Jo.sortKey,state:xl})}else Re.push({segments:Mt.segments,sortKey:0,state:xl})}}}Te&&Re.sort(function(Lc,xr){return Lc.sortKey-xr.sortKey});for(var Tu=0,$a=Re;Tu<$a.length;Tu+=1){var ba=$a[Tu],kr=ba.state;if($.activeTexture.set(ae.TEXTURE0),kr.atlasTexture.bind(kr.atlasInterpolation,ae.CLAMP_TO_EDGE),kr.atlasTextureIcon&&($.activeTexture.set(ae.TEXTURE1),kr.atlasTextureIcon&&kr.atlasTextureIcon.bind(kr.atlasInterpolationIcon,ae.CLAMP_TO_EDGE)),kr.isSDF){var wl=kr.uniformValues;kr.hasHalo&&(wl.u_is_halo=1,qd(kr.buffers,ba.segments,h,c,kr.program,Le,V,K,wl)),wl.u_is_halo=0}qd(kr.buffers,ba.segments,h,c,kr.program,Le,V,K,kr.uniformValues)}}function qd(c,f,h,m,_,w,S,C,k){var N=m.context;_.draw(N,N.gl.TRIANGLES,w,S,C,re.disabled,k,h.id,c.layoutVertexBuffer,c.indexBuffer,f,h.paint,m.transform.zoom,c.programConfigurations.get(h.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function mu(c,f,h,m,_,w,S){var C,k,N,V,K,$=c.context.gl,ae=h.paint.get("fill-pattern"),se=ae&&ae.constantOr(1),fe=h.getCrossfadeParameters();S?(k=se&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",C=$.LINES):(k=se?"fillPattern":"fill",C=$.TRIANGLES);for(var ie=0,he=m;ie<he.length;ie+=1){var ve=he[ie],Te=f.getTile(ve);if(!se||Te.patternsLoaded()){var Le=Te.getBucket(h);if(Le){var Ae=Le.programConfigurations.get(h.id),Re=c.useProgram(k,Ae);se&&(c.context.activeTexture.set($.TEXTURE0),Te.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),Ae.updatePaintBuffers(fe));var je=ae.constantOr(null);if(je&&Te.imageAtlas){var Je=Te.imageAtlas,Ze=Je.patternPositions[je.to.toString()],rt=Je.patternPositions[je.from.toString()];Ze&&rt&&Ae.setConstantPatternPositions(Ze,rt)}var ft=c.translatePosMatrix(ve.posMatrix,Te,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(S){V=Le.indexBuffer2,K=Le.segments2;var Mt=[$.drawingBufferWidth,$.drawingBufferHeight];N=k==="fillOutlinePattern"&&se?Ss(ft,c,fe,Te,Mt):yf(ft,Mt)}else V=Le.indexBuffer,K=Le.segments,N=se?gf(ft,c,fe,Te):mf(ft);Re.draw(c.context,C,_,c.stencilModeForClipping(ve),w,re.disabled,N,h.id,Le.layoutVertexBuffer,V,K,h.paint,c.transform.zoom,Ae)}}}}function bf(c,f,h,m,_,w,S){for(var C=c.context,k=C.gl,N=h.paint.get("fill-extrusion-pattern"),V=N.constantOr(1),K=h.getCrossfadeParameters(),$=h.paint.get("fill-extrusion-opacity"),ae=0,se=m;ae<se.length;ae+=1){var fe=se[ae],ie=f.getTile(fe),he=ie.getBucket(h);if(he){var ve=he.programConfigurations.get(h.id),Te=c.useProgram(V?"fillExtrusionPattern":"fillExtrusion",ve);V&&(c.context.activeTexture.set(k.TEXTURE0),ie.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ve.updatePaintBuffers(K));var Le=N.constantOr(null);if(Le&&ie.imageAtlas){var Ae=ie.imageAtlas,Re=Ae.patternPositions[Le.to.toString()],je=Ae.patternPositions[Le.from.toString()];Re&&je&&ve.setConstantPatternPositions(Re,je)}var Je=c.translatePosMatrix(fe.posMatrix,ie,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ze=h.paint.get("fill-extrusion-vertical-gradient"),rt=V?hl(Je,c,Ze,$,fe,K,ie):Ga(Je,c,Ze,$);Te.draw(C,C.gl.TRIANGLES,_,w,S,re.backCCW,rt,h.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,h.paint,c.transform.zoom,ve)}}}function wc(c,f,h,m,_,w){var S=c.context,C=S.gl,k=f.fbo;if(k){var N=c.useProgram("hillshade");S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get());var V=function(K,$,ae){var se=ae.paint.get("hillshade-shadow-color"),fe=ae.paint.get("hillshade-highlight-color"),ie=ae.paint.get("hillshade-accent-color"),he=ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);ae.paint.get("hillshade-illumination-anchor")==="viewport"&&(he-=K.transform.angle);var ve,Te,Le,Ae=!K.options.moving;return{u_matrix:K.transform.calculatePosMatrix($.tileID.toUnwrapped(),Ae),u_image:0,u_latrange:(ve=$.tileID,Te=Math.pow(2,ve.canonical.z),Le=ve.canonical.y,[new a.MercatorCoordinate(0,Le/Te).toLngLat().lat,new a.MercatorCoordinate(0,(Le+1)/Te).toLngLat().lat]),u_light:[ae.paint.get("hillshade-exaggeration"),he],u_shadow:se,u_highlight:fe,u_accent:ie}}(c,f,h);N.draw(S,C.TRIANGLES,m,_,w,re.disabled,V,h.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}}function wf(c,f,h,m,_,w,S){var C=c.context,k=C.gl,N=f.dem;if(N&&N.data){var V=N.dim,K=N.stride,$=N.getPixels();if(C.activeTexture.set(k.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||c.getTileTexture(K),f.demTexture){var ae=f.demTexture;ae.update($,{premultiply:!1}),ae.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else f.demTexture=new a.Texture(C,$,k.RGBA,{premultiply:!1}),f.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);C.activeTexture.set(k.TEXTURE0);var se=f.fbo;if(!se){var fe=new a.Texture(C,{width:V,height:V,data:null},k.RGBA);fe.bind(k.LINEAR,k.CLAMP_TO_EDGE),(se=f.fbo=C.createFramebuffer(V,V,!0)).colorAttachment.set(fe.texture)}C.bindFramebuffer.set(se.framebuffer),C.viewport.set([0,0,V,V]),c.useProgram("hillshadePrepare").draw(C,k.TRIANGLES,_,w,S,re.disabled,function(ie,he,ve){var Te=he.stride,Le=a.create();return a.ortho(Le,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(Le,Le,[0,-a.EXTENT,0]),{u_matrix:Le,u_image:1,u_dimension:[Te,Te],u_zoom:ie.overscaledZ,u_maxzoom:ve,u_unpack:he.getUnpackVector()}}(f.tileID,N,m),h.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function Zd(c,f,h,m,_){var w=m.paint.get("raster-fade-duration");if(w>0){var S=a.browser.now(),C=(S-c.timeAdded)/w,k=f?(S-f.timeAdded)/w:-1,N=h.getSource(),V=_.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),K=!f||Math.abs(f.tileID.overscaledZ-V)>Math.abs(c.tileID.overscaledZ-V),$=K&&c.refreshedUponExpiration?1:a.clamp(K?C:1-k,0,1);return c.refreshedUponExpiration&&C>=1&&(c.refreshedUponExpiration=!1),f?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}var $d=new a.Color(1,0,0,1),Ec=new a.Color(0,1,0,1),Ef=new a.Color(0,0,1,1),Xd=new a.Color(1,0,1,1),Yd=new a.Color(0,1,1,1);function Tf(c,f,h,m){da(c,0,f+h/2,c.transform.width,h,m)}function Sf(c,f,h,m){da(c,f-h/2,0,h,c.transform.height,m)}function da(c,f,h,m,_,w){var S=c.context,C=S.gl;C.enable(C.SCISSOR_TEST),C.scissor(f*a.browser.devicePixelRatio,h*a.browser.devicePixelRatio,m*a.browser.devicePixelRatio,_*a.browser.devicePixelRatio),S.clear({color:w}),C.disable(C.SCISSOR_TEST)}function Kd(c,f,h){var m=c.context,_=m.gl,w=h.posMatrix,S=c.useProgram("debug"),C=Y.disabled,k=ne.disabled,N=c.colorModeForRenderPass();m.activeTexture.set(_.TEXTURE0),c.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),S.draw(m,_.LINE_STRIP,C,k,N,re.disabled,vf(w,a.Color.red),"$debug",c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);var V=f.getTileByID(h.key).latestRawTileData,K=Math.floor((V&&V.byteLength||0)/1024),$=f.getTile(h).tileSize,ae=512/Math.min($,512)*(h.overscaledZ/c.transform.zoom)*.5,se=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(se+=" => "+h.overscaledZ),function(fe,ie){fe.initDebugOverlayCanvas();var he=fe.debugOverlayCanvas,ve=fe.context.gl,Te=fe.debugOverlayCanvas.getContext("2d");Te.clearRect(0,0,he.width,he.height),Te.shadowColor="white",Te.shadowBlur=2,Te.lineWidth=1.5,Te.strokeStyle="white",Te.textBaseline="top",Te.font="bold 36px Open Sans, sans-serif",Te.fillText(ie,5,5),Te.strokeText(ie,5,5),fe.debugOverlayTexture.update(he),fe.debugOverlayTexture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE)}(c,se+" "+K+"kb"),S.draw(m,_.TRIANGLES,C,k,Z.alphaBlended,re.disabled,vf(w,a.Color.transparent,ae),"$debug",c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}var Pf={symbol:function(c,f,h,m,_){if(c.renderPass==="translucent"){var w=ne.disabled,S=c.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(C,k,N,V,K,$,ae){for(var se=k.transform,fe=K==="map",ie=$==="map",he=0,ve=C;he<ve.length;he+=1){var Te=ve[he],Le=V.getTile(Te),Ae=Le.getBucket(N);if(Ae&&Ae.text&&Ae.text.segments.get().length){var Re=a.evaluateSizeForZoom(Ae.textSizeData,se.zoom),je=cr(Le,1,k.transform.zoom),Je=xn(Te.posMatrix,ie,fe,k.transform,je),Ze=N.layout.get("icon-text-fit")!=="none"&&Ae.hasIconData();if(Re){var rt=Math.pow(2,se.zoom-Le.tileID.overscaledZ);yl(Ae,fe,ie,ae,a.symbolSize,se,Je,Te.posMatrix,rt,Re,Ze)}}}}(m,c,h,f,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),_),h.paint.get("icon-opacity").constantOr(1)!==0&&bc(c,f,h,m,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),w,S),h.paint.get("text-opacity").constantOr(1)!==0&&bc(c,f,h,m,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),w,S),f.map.showCollisionBoxes&&(xf(c,f,h,m,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),xf(c,f,h,m,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(c,f,h,m){if(c.renderPass==="translucent"){var _=h.paint.get("circle-opacity"),w=h.paint.get("circle-stroke-width"),S=h.paint.get("circle-stroke-opacity"),C=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)!==0||w.constantOr(1)!==0&&S.constantOr(1)!==0){for(var k=c.context,N=k.gl,V=c.depthModeForSublayer(0,Y.ReadOnly),K=ne.disabled,$=c.colorModeForRenderPass(),ae=[],se=0;se<m.length;se++){var fe=m[se],ie=f.getTile(fe),he=ie.getBucket(h);if(he){var ve=he.programConfigurations.get(h.id),Te={programConfiguration:ve,program:c.useProgram("circle",ve),layoutVertexBuffer:he.layoutVertexBuffer,indexBuffer:he.indexBuffer,uniformValues:Vd(c,fe,ie,h)};if(C)for(var Le=0,Ae=he.segments.get();Le<Ae.length;Le+=1){var Re=Ae[Le];ae.push({segments:new a.SegmentVector([Re]),sortKey:Re.sortKey,state:Te})}else ae.push({segments:he.segments,sortKey:0,state:Te})}}C&&ae.sort(function(ft,Mt){return ft.sortKey-Mt.sortKey});for(var je=0,Je=ae;je<Je.length;je+=1){var Ze=Je[je],rt=Ze.state;rt.program.draw(k,N.TRIANGLES,V,K,$,re.disabled,rt.uniformValues,h.id,rt.layoutVertexBuffer,rt.indexBuffer,Ze.segments,h.paint,c.transform.zoom,rt.programConfiguration)}}}},heatmap:function(c,f,h,m){if(h.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){var _=c.context,w=_.gl,S=ne.disabled,C=new Z([w.ONE,w.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(ae,se,fe){var ie=ae.gl;ae.activeTexture.set(ie.TEXTURE1),ae.viewport.set([0,0,se.width/4,se.height/4]);var he=fe.heatmapFbo;if(he)ie.bindTexture(ie.TEXTURE_2D,he.colorAttachment.get()),ae.bindFramebuffer.set(he.framebuffer);else{var ve=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,ve),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),he=fe.heatmapFbo=ae.createFramebuffer(se.width/4,se.height/4,!1),function(Te,Le,Ae,Re){var je=Te.gl;je.texImage2D(je.TEXTURE_2D,0,je.RGBA,Le.width/4,Le.height/4,0,je.RGBA,Te.extRenderToTextureHalfFloat?Te.extTextureHalfFloat.HALF_FLOAT_OES:je.UNSIGNED_BYTE,null),Re.colorAttachment.set(Ae)}(ae,se,ve,he)}})(_,c,h),_.clear({color:a.Color.transparent});for(var k=0;k<m.length;k++){var N=m[k];if(!f.hasRenderableParent(N)){var V=f.getTile(N),K=V.getBucket(h);if(K){var $=K.programConfigurations.get(h.id);c.useProgram("heatmap",$).draw(_,w.TRIANGLES,Y.disabled,S,C,re.disabled,Cn(N.posMatrix,V,c.transform.zoom,h.paint.get("heatmap-intensity")),h.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,h.paint,c.transform.zoom,$)}}}_.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(ae,se){var fe=ae.context,ie=fe.gl,he=se.heatmapFbo;if(he){fe.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_2D,he.colorAttachment.get()),fe.activeTexture.set(ie.TEXTURE1);var ve=se.colorRampTexture;ve||(ve=se.colorRampTexture=new a.Texture(fe,se.colorRamp,ie.RGBA)),ve.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),ae.useProgram("heatmapTexture").draw(fe,ie.TRIANGLES,Y.disabled,ne.disabled,ae.colorModeForRenderPass(),re.disabled,function(Te,Le,Ae,Re){var je=a.create();a.ortho(je,0,Te.width,Te.height,0,0,1);var Je=Te.context.gl;return{u_matrix:je,u_world:[Je.drawingBufferWidth,Je.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Le.paint.get("heatmap-opacity")}}(ae,se),se.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments,se.paint,ae.transform.zoom)}}(c,h))},line:function(c,f,h,m){if(c.renderPass==="translucent"){var _=h.paint.get("line-opacity"),w=h.paint.get("line-width");if(_.constantOr(1)!==0&&w.constantOr(1)!==0){var S=c.depthModeForSublayer(0,Y.ReadOnly),C=c.colorModeForRenderPass(),k=h.paint.get("line-dasharray"),N=h.paint.get("line-pattern"),V=N.constantOr(1),K=h.paint.get("line-gradient"),$=h.getCrossfadeParameters(),ae=V?"linePattern":k?"lineSDF":K?"lineGradient":"line",se=c.context,fe=se.gl,ie=!0;if(K){se.activeTexture.set(fe.TEXTURE0);var he=h.gradientTexture;if(!h.gradient)return;he||(he=h.gradientTexture=new a.Texture(se,h.gradient,fe.RGBA)),he.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}for(var ve=0,Te=m;ve<Te.length;ve+=1){var Le=Te[ve],Ae=f.getTile(Le);if(!V||Ae.patternsLoaded()){var Re=Ae.getBucket(h);if(Re){var je=Re.programConfigurations.get(h.id),Je=c.context.program.get(),Ze=c.useProgram(ae,je),rt=ie||Ze.program!==Je,ft=N.constantOr(null);if(ft&&Ae.imageAtlas){var Mt=Ae.imageAtlas,wt=Mt.patternPositions[ft.to.toString()],Ht=Mt.patternPositions[ft.from.toString()];wt&&Ht&&je.setConstantPatternPositions(wt,Ht)}var lt=V?hu(c,Ae,h,$):k?dv(c,Ae,h,k,$):K?pv(c,Ae,h):dl(c,Ae,h);V?(se.activeTexture.set(fe.TEXTURE0),Ae.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),je.updatePaintBuffers($)):k&&(rt||c.lineAtlas.dirty)&&(se.activeTexture.set(fe.TEXTURE0),c.lineAtlas.bind(se)),Ze.draw(se,fe.TRIANGLES,S,c.stencilModeForClipping(Le),C,re.disabled,lt,h.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,h.paint,c.transform.zoom,je),ie=!1}}}}}},fill:function(c,f,h,m){var _=h.paint.get("fill-color"),w=h.paint.get("fill-opacity");if(w.constantOr(1)!==0){var S=c.colorModeForRenderPass(),C=h.paint.get("fill-pattern"),k=c.opaquePassEnabledForLayer()&&!C.constantOr(1)&&_.constantOr(a.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===k){var N=c.depthModeForSublayer(1,c.renderPass==="opaque"?Y.ReadWrite:Y.ReadOnly);mu(c,f,h,m,N,S,!1)}if(c.renderPass==="translucent"&&h.paint.get("fill-antialias")){var V=c.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,Y.ReadOnly);mu(c,f,h,m,V,S,!0)}}},"fill-extrusion":function(c,f,h,m){var _=h.paint.get("fill-extrusion-opacity");if(_!==0&&c.renderPass==="translucent"){var w=new Y(c.context.gl.LEQUAL,Y.ReadWrite,c.depthRangeFor3D);if(_!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))bf(c,f,h,m,w,ne.disabled,Z.disabled),bf(c,f,h,m,w,c.stencilModeFor3D(),c.colorModeForRenderPass());else{var S=c.colorModeForRenderPass();bf(c,f,h,m,w,ne.disabled,S)}}},hillshade:function(c,f,h,m){if(c.renderPass==="offscreen"||c.renderPass==="translucent"){for(var _=c.context,w=f.getSource().maxzoom,S=c.depthModeForSublayer(0,Y.ReadOnly),C=c.colorModeForRenderPass(),k=c.renderPass==="translucent"?c.stencilConfigForOverlap(m):[{},m],N=k[0],V=0,K=k[1];V<K.length;V+=1){var $=K[V],ae=f.getTile($);ae.needsHillshadePrepare&&c.renderPass==="offscreen"?wf(c,ae,h,w,S,ne.disabled,C):c.renderPass==="translucent"&&wc(c,ae,h,S,N[$.overscaledZ],C)}_.viewport.set([0,0,c.width,c.height])}},raster:function(c,f,h,m){if(c.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&m.length)for(var _=c.context,w=_.gl,S=f.getSource(),C=c.useProgram("raster"),k=c.colorModeForRenderPass(),N=S instanceof dn?[{},m]:c.stencilConfigForOverlap(m),V=N[0],K=N[1],$=K[K.length-1].overscaledZ,ae=!c.options.moving,se=0,fe=K;se<fe.length;se+=1){var ie=fe[se],he=c.depthModeForSublayer(ie.overscaledZ-$,h.paint.get("raster-opacity")===1?Y.ReadWrite:Y.ReadOnly,w.LESS),ve=f.getTile(ie),Te=c.transform.calculatePosMatrix(ie.toUnwrapped(),ae);ve.registerFadeDuration(h.paint.get("raster-fade-duration"));var Le=f.findLoadedParent(ie,0),Ae=Zd(ve,Le,f,h,c.transform),Re=void 0,je=void 0,Je=h.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;_.activeTexture.set(w.TEXTURE0),ve.texture.bind(Je,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(w.TEXTURE1),Le?(Le.texture.bind(Je,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Re=Math.pow(2,Le.tileID.overscaledZ-ve.tileID.overscaledZ),je=[ve.tileID.canonical.x*Re%1,ve.tileID.canonical.y*Re%1]):ve.texture.bind(Je,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Ze=mv(Te,je||[0,0],Re||1,Ae,h);S instanceof dn?C.draw(_,w.TRIANGLES,he,ne.disabled,k,re.disabled,Ze,h.id,S.boundsBuffer,c.quadTriangleIndexBuffer,S.boundsSegments):C.draw(_,w.TRIANGLES,he,V[ie.overscaledZ],k,re.disabled,Ze,h.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,f,h){var m=h.paint.get("background-color"),_=h.paint.get("background-opacity");if(_!==0){var w=c.context,S=w.gl,C=c.transform,k=C.tileSize,N=h.paint.get("background-pattern");if(!c.isPatternMissing(N)){var V=!N&&m.a===1&&_===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass===V){var K=ne.disabled,$=c.depthModeForSublayer(0,V==="opaque"?Y.ReadWrite:Y.ReadOnly),ae=c.colorModeForRenderPass(),se=c.useProgram(N?"backgroundPattern":"background"),fe=C.coveringTiles({tileSize:k});N&&(w.activeTexture.set(S.TEXTURE0),c.imageManager.bind(c.context));for(var ie=h.getCrossfadeParameters(),he=0,ve=fe;he<ve.length;he+=1){var Te=ve[he],Le=c.transform.calculatePosMatrix(Te.toUnwrapped()),Ae=N?du(Le,_,c,N,{tileID:Te,tileSize:k},ie):Gd(Le,_,m);se.draw(w,S.TRIANGLES,$,K,ae,re.disabled,Ae,h.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}}}},debug:function(c,f,h){for(var m=0;m<h.length;m++)Kd(c,f,h[m])},custom:function(c,f,h){var m=c.context,_=h.implementation;if(c.renderPass==="offscreen"){var w=_.prerender;w&&(c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),w.call(_,m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),m.setStencilMode(ne.disabled);var S=_.renderingMode==="3d"?new Y(c.context.gl.LEQUAL,Y.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Y.ReadOnly);m.setDepthMode(S),_.render(m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState(),m.bindFramebuffer.set(null)}}},Bn=function(c,f){this.context=new ge(c),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=xe.maxUnderzooming+xe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new bo,this.gpuTimers={}};Bn.prototype.resize=function(c,f){if(this.width=c*a.browser.devicePixelRatio,this.height=f*a.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,m=this.style._order;h<m.length;h+=1)this.style._layers[m[h]].resize()},Bn.prototype.setup=function(){var c=this.context,f=new a.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(a.EXTENT,0),f.emplaceBack(0,a.EXTENT),f.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(f,yc.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);var h=new a.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(a.EXTENT,0),h.emplaceBack(0,a.EXTENT),h.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=c.createVertexBuffer(h,yc.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);var m=new a.StructArrayLayout4i8;m.emplaceBack(0,0,0,0),m.emplaceBack(a.EXTENT,0,a.EXTENT,0),m.emplaceBack(0,a.EXTENT,0,a.EXTENT),m.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=c.createVertexBuffer(m,Jt.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);var _=new a.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(_,yc.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);var w=new a.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(w);var S=new a.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(S),this.emptyTexture=new a.Texture(c,{width:1,height:1,data:new Uint8Array([0,0,0,0])},c.gl.RGBA);var C=this.context.gl;this.stencilClearMode=new ne({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO)},Bn.prototype.clearStencil=function(){var c=this.context,f=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=a.create();a.ortho(h,0,this.width,this.height,0,0,1),a.scale(h,h,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,f.TRIANGLES,Y.disabled,this.stencilClearMode,Z.disabled,re.disabled,_c(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Bn.prototype._renderTileClippingMasks=function(c,f){if(this.currentStencilSource!==c.source&&c.isTileClipped()&&f&&f.length){this.currentStencilSource=c.source;var h=this.context,m=h.gl;this.nextStencilID+f.length>256&&this.clearStencil(),h.setColorMode(Z.disabled),h.setDepthMode(Y.disabled);var _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,S=f;w<S.length;w+=1){var C=S[w],k=this._tileClippingMaskIDs[C.key]=this.nextStencilID++;_.draw(h,m.TRIANGLES,Y.disabled,new ne({func:m.ALWAYS,mask:0},k,255,m.KEEP,m.KEEP,m.REPLACE),Z.disabled,re.disabled,_c(C.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Bn.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var c=this.nextStencilID++,f=this.context.gl;return new ne({func:f.NOTEQUAL,mask:255},c,255,f.KEEP,f.KEEP,f.REPLACE)},Bn.prototype.stencilModeForClipping=function(c){var f=this.context.gl;return new ne({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,f.KEEP,f.KEEP,f.REPLACE)},Bn.prototype.stencilConfigForOverlap=function(c){var f,h=this.context.gl,m=c.sort(function(k,N){return N.overscaledZ-k.overscaledZ}),_=m[m.length-1].overscaledZ,w=m[0].overscaledZ-_+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var S={},C=0;C<w;C++)S[C+_]=new ne({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[S,m]}return[(f={},f[_]=ne.disabled,f),m]},Bn.prototype.colorModeForRenderPass=function(){var c=this.context.gl;return this._showOverdrawInspector?new Z([c.CONSTANT_COLOR,c.ONE],new a.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Z.unblended:Z.alphaBlended},Bn.prototype.depthModeForSublayer=function(c,f,h){if(!this.opaquePassEnabledForLayer())return Y.disabled;var m=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new Y(h||this.context.gl.LEQUAL,f,[m,m])},Bn.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Bn.prototype.render=function(c,f){var h=this;this.style=c,this.options=f,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(a.browser.now()),this.imageManager.beginFrame();var m=this.style._order,_=this.style.sourceCaches;for(var w in _){var S=_[w];S.used&&S.prepare(this.context)}var C,k,N={},V={},K={};for(var $ in _){var ae=_[$];N[$]=ae.getVisibleCoordinates(),V[$]=N[$].slice().reverse(),K[$]=ae.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var se=0;se<m.length;se++)if(this.style._layers[m[se]].is3D()){this.opaquePassCutoff=se;break}this.renderPass="offscreen";for(var fe=0,ie=m;fe<ie.length;fe+=1){var he=this.style._layers[ie[fe]];if(he.hasOffscreenPass()&&!he.isHidden(this.transform.zoom)){var ve=V[he.source];(he.type==="custom"||ve.length)&&this.renderLayer(this,_[he.source],he,ve)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){var Te=this.style._layers[m[this.currentLayer]],Le=_[Te.source],Ae=N[Te.source];this._renderTileClippingMasks(Te,Ae),this.renderLayer(this,Le,Te,Ae)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){var Re=this.style._layers[m[this.currentLayer]],je=_[Re.source],Je=(Re.type==="symbol"?K:V)[Re.source];this._renderTileClippingMasks(Re,N[Re.source]),this.renderLayer(this,je,Re,Je)}this.options.showTileBoundaries&&(a.values(this.style._layers).forEach(function(Ze){Ze.source&&!Ze.isHidden(h.transform.zoom)&&(Ze.source!==(k&&k.id)&&(k=h.style.sourceCaches[Ze.source]),(!C||C.getSource().maxzoom<k.getSource().maxzoom)&&(C=k))}),C&&Pf.debug(this,C,C.getVisibleCoordinates())),this.options.showPadding&&function(Ze){var rt=Ze.transform.padding;Tf(Ze,Ze.transform.height-(rt.top||0),3,$d),Tf(Ze,rt.bottom||0,3,Ec),Sf(Ze,rt.left||0,3,Ef),Sf(Ze,Ze.transform.width-(rt.right||0),3,Xd);var ft=Ze.transform.centerPoint;(function(Mt,wt,Ht,lt){da(Mt,wt-1,Ht-10,2,20,lt),da(Mt,wt-10,Ht-1,20,2,lt)})(Ze,ft.x,Ze.transform.height-ft.y,Yd)}(this),this.context.setDefault()},Bn.prototype.renderLayer=function(c,f,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||m.length)&&(this.id=h.id,this.gpuTimingStart(h),Pf[h.type](c,f,h,m,this.style.placement.variableOffsets),this.gpuTimingEnd())},Bn.prototype.gpuTimingStart=function(c){if(this.options.gpuTiming){var f=this.context.extTimerQuery,h=this.gpuTimers[c.id];h||(h=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),h.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,h.query)}},Bn.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}},Bn.prototype.collectGpuTimers=function(){var c=this.gpuTimers;return this.gpuTimers={},c},Bn.prototype.queryGpuTimers=function(c){var f={};for(var h in c){var m=c[h],_=this.context.extTimerQuery,w=_.getQueryObjectEXT(m.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(m.query),f[h]=w}return f},Bn.prototype.translatePosMatrix=function(c,f,h,m,_){if(!h[0]&&!h[1])return c;var w=_?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(w){var S=Math.sin(w),C=Math.cos(w);h=[h[0]*C-h[1]*S,h[0]*S+h[1]*C]}var k=[_?h[0]:cr(f,h[0],this.transform.zoom),_?h[1]:cr(f,h[1],this.transform.zoom),0],N=new Float32Array(16);return a.translate(N,c,k),N},Bn.prototype.saveTileTexture=function(c){var f=this._tileTextures[c.size[0]];f?f.push(c):this._tileTextures[c.size[0]]=[c]},Bn.prototype.getTileTexture=function(c){var f=this._tileTextures[c];return f&&f.length>0?f.pop():null},Bn.prototype.isPatternMissing=function(c){if(!c)return!1;if(!c.from||!c.to)return!0;var f=this.imageManager.getPattern(c.from.toString()),h=this.imageManager.getPattern(c.to.toString());return!f||!h},Bn.prototype.useProgram=function(c,f){this.cache=this.cache||{};var h=""+c+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new Ud(this.context,c,fv[c],f,Eo[c],this._showOverdrawInspector)),this.cache[h]},Bn.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Bn.prototype.setBaseState=function(){var c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)},Bn.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Bn.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Tc=function(c,f){this.points=c,this.planes=f};Tc.fromInvProjectionMatrix=function(c,f,h){var m=Math.pow(2,h),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(S){return a.transformMat4([],S,c)}).map(function(S){return a.scale$1([],S,1/S[3]/f*m)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(S){var C=a.sub([],_[S[0]],_[S[1]]),k=a.sub([],_[S[2]],_[S[1]]),N=a.normalize([],a.cross([],C,k)),V=-a.dot(N,_[S[1]]);return N.concat(V)});return new Tc(_,w)};var si=function(c,f){this.min=c,this.max=f,this.center=a.scale$2([],a.add([],this.min,this.max),.5)};si.prototype.quadrant=function(c){for(var f=[c%2==0,c<2],h=a.clone$2(this.min),m=a.clone$2(this.max),_=0;_<f.length;_++)h[_]=f[_]?this.min[_]:this.center[_],m[_]=f[_]?this.center[_]:this.max[_];return m[2]=this.max[2],new si(h,m)},si.prototype.distanceX=function(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]},si.prototype.distanceY=function(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]},si.prototype.intersects=function(c){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,m=0;m<c.planes.length;m++){for(var _=c.planes[m],w=0,S=0;S<f.length;S++)w+=a.dot$1(_,f[S])>=0;if(w===0)return 0;w!==f.length&&(h=!1)}if(h)return 2;for(var C=0;C<3;C++){for(var k=Number.MAX_VALUE,N=-Number.MAX_VALUE,V=0;V<c.points.length;V++){var K=c.points[V][C]-this.min[C];k=Math.min(k,K),N=Math.max(N,K)}if(N<0||k>this.max[C]-this.min[C])return 0}return 1};var As=function(c,f,h,m){if(c===void 0&&(c=0),f===void 0&&(f=0),h===void 0&&(h=0),m===void 0&&(m=0),isNaN(c)||c<0||isNaN(f)||f<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=f,this.left=h,this.right=m};As.prototype.interpolate=function(c,f,h){return f.top!=null&&c.top!=null&&(this.top=a.number(c.top,f.top,h)),f.bottom!=null&&c.bottom!=null&&(this.bottom=a.number(c.bottom,f.bottom,h)),f.left!=null&&c.left!=null&&(this.left=a.number(c.left,f.left,h)),f.right!=null&&c.right!=null&&(this.right=a.number(c.right,f.right,h)),this},As.prototype.getCenter=function(c,f){var h=a.clamp((this.left+c-this.right)/2,0,c),m=a.clamp((this.top+f-this.bottom)/2,0,f);return new a.Point(h,m)},As.prototype.equals=function(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right},As.prototype.clone=function(){return new As(this.top,this.bottom,this.left,this.right)},As.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ln=function(c,f,h,m,_){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=_===void 0||_,this._minZoom=c||0,this._maxZoom=f||22,this._minPitch=h??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new As,this._posMatrixCache={},this._alignedPosMatrixCache={}},Sn={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ln.prototype.clone=function(){var c=new ln(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.tileSize=this.tileSize,c.latRange=this.latRange,c.width=this.width,c.height=this.height,c._center=this._center,c.zoom=this.zoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._calcMatrices(),c},Sn.minZoom.get=function(){return this._minZoom},Sn.minZoom.set=function(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))},Sn.maxZoom.get=function(){return this._maxZoom},Sn.maxZoom.set=function(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))},Sn.minPitch.get=function(){return this._minPitch},Sn.minPitch.set=function(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))},Sn.maxPitch.get=function(){return this._maxPitch},Sn.maxPitch.set=function(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))},Sn.renderWorldCopies.get=function(){return this._renderWorldCopies},Sn.renderWorldCopies.set=function(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c},Sn.worldSize.get=function(){return this.tileSize*this.scale},Sn.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Sn.size.get=function(){return new a.Point(this.width,this.height)},Sn.bearing.get=function(){return-this.angle/Math.PI*180},Sn.bearing.set=function(c){var f=-a.wrap(c,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=a.create$2(),a.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Sn.pitch.get=function(){return this._pitch/Math.PI*180},Sn.pitch.set=function(c){var f=a.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Sn.fov.get=function(){return this._fov/Math.PI*180},Sn.fov.set=function(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())},Sn.zoom.get=function(){return this._zoom},Sn.zoom.set=function(c){var f=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Sn.center.get=function(){return this._center},Sn.center.set=function(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())},Sn.padding.get=function(){return this._edgeInsets.toJSON()},Sn.padding.set=function(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())},Sn.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ln.prototype.isPaddingEqual=function(c){return this._edgeInsets.equals(c)},ln.prototype.interpolatePadding=function(c,f,h){this._unmodified=!1,this._edgeInsets.interpolate(c,f,h),this._constrain(),this._calcMatrices()},ln.prototype.coveringZoomLevel=function(c){var f=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,f)},ln.prototype.getVisibleUnwrappedCoordinates=function(c){var f=[new a.UnwrappedTileID(0,c)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new a.Point(0,0)),m=this.pointCoordinate(new a.Point(this.width,0)),_=this.pointCoordinate(new a.Point(this.width,this.height)),w=this.pointCoordinate(new a.Point(0,this.height)),S=Math.floor(Math.min(h.x,m.x,_.x,w.x)),C=Math.floor(Math.max(h.x,m.x,_.x,w.x)),k=S-1;k<=C+1;k++)k!==0&&f.push(new a.UnwrappedTileID(k,c));return f},ln.prototype.coveringTiles=function(c){var f=this.coveringZoomLevel(c),h=f;if(c.minzoom!==void 0&&f<c.minzoom)return[];c.maxzoom!==void 0&&f>c.maxzoom&&(f=c.maxzoom);var m=a.MercatorCoordinate.fromLngLat(this.center),_=Math.pow(2,f),w=[_*m.x,_*m.y,0],S=Tc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),C=c.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(C=f);var k=function(Ze){return{aabb:new si([Ze*_,0,0],[(Ze+1)*_,_,0]),zoom:0,x:0,y:0,wrap:Ze,fullyVisible:!1}},N=[],V=[],K=f,$=c.reparseOverscaled?h:f;if(this._renderWorldCopies)for(var ae=1;ae<=3;ae++)N.push(k(-ae)),N.push(k(ae));for(N.push(k(0));N.length>0;){var se=N.pop(),fe=se.x,ie=se.y,he=se.fullyVisible;if(!he){var ve=se.aabb.intersects(S);if(ve===0)continue;he=ve===2}var Te=se.aabb.distanceX(w),Le=se.aabb.distanceY(w),Ae=Math.max(Math.abs(Te),Math.abs(Le));if(se.zoom===K||Ae>3+(1<<K-se.zoom)-2&&se.zoom>=C)V.push({tileID:new a.OverscaledTileID(se.zoom===K?$:se.zoom,se.wrap,se.zoom,fe,ie),distanceSq:a.sqrLen([w[0]-.5-fe,w[1]-.5-ie])});else for(var Re=0;Re<4;Re++){var je=(fe<<1)+Re%2,Je=(ie<<1)+(Re>>1);N.push({aabb:se.aabb.quadrant(Re),zoom:se.zoom+1,x:je,y:Je,wrap:se.wrap,fullyVisible:he})}}return V.sort(function(Ze,rt){return Ze.distanceSq-rt.distanceSq}).map(function(Ze){return Ze.tileID})},ln.prototype.resize=function(c,f){this.width=c,this.height=f,this.pixelsToGLUnits=[2/c,-2/f],this._constrain(),this._calcMatrices()},Sn.unmodified.get=function(){return this._unmodified},ln.prototype.zoomScale=function(c){return Math.pow(2,c)},ln.prototype.scaleZoom=function(c){return Math.log(c)/Math.LN2},ln.prototype.project=function(c){var f=a.clamp(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.Point(a.mercatorXfromLng(c.lng)*this.worldSize,a.mercatorYfromLat(f)*this.worldSize)},ln.prototype.unproject=function(c){return new a.MercatorCoordinate(c.x/this.worldSize,c.y/this.worldSize).toLngLat()},Sn.point.get=function(){return this.project(this.center)},ln.prototype.setLocationAtPoint=function(c,f){var h=this.pointCoordinate(f),m=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(c),w=new a.MercatorCoordinate(_.x-(h.x-m.x),_.y-(h.y-m.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},ln.prototype.locationPoint=function(c){return this.coordinatePoint(this.locationCoordinate(c))},ln.prototype.pointLocation=function(c){return this.coordinateLocation(this.pointCoordinate(c))},ln.prototype.locationCoordinate=function(c){return a.MercatorCoordinate.fromLngLat(c)},ln.prototype.coordinateLocation=function(c){return c.toLngLat()},ln.prototype.pointCoordinate=function(c){var f=[c.x,c.y,0,1],h=[c.x,c.y,1,1];a.transformMat4(f,f,this.pixelMatrixInverse),a.transformMat4(h,h,this.pixelMatrixInverse);var m=f[3],_=h[3],w=f[1]/m,S=h[1]/_,C=f[2]/m,k=h[2]/_,N=C===k?0:(0-C)/(k-C);return new a.MercatorCoordinate(a.number(f[0]/m,h[0]/_,N)/this.worldSize,a.number(w,S,N)/this.worldSize)},ln.prototype.coordinatePoint=function(c){var f=[c.x*this.worldSize,c.y*this.worldSize,0,1];return a.transformMat4(f,f,this.pixelMatrix),new a.Point(f[0]/f[3],f[1]/f[3])},ln.prototype.getBounds=function(){return new a.LngLatBounds().extend(this.pointLocation(new a.Point(0,0))).extend(this.pointLocation(new a.Point(this.width,0))).extend(this.pointLocation(new a.Point(this.width,this.height))).extend(this.pointLocation(new a.Point(0,this.height)))},ln.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new a.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ln.prototype.setMaxBounds=function(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ln.prototype.calculatePosMatrix=function(c,f){f===void 0&&(f=!1);var h=c.key,m=f?this._alignedPosMatrixCache:this._posMatrixCache;if(m[h])return m[h];var _=c.canonical,w=this.worldSize/this.zoomScale(_.z),S=_.x+Math.pow(2,_.z)*c.wrap,C=a.identity(new Float64Array(16));return a.translate(C,C,[S*w,_.y*w,0]),a.scale(C,C,[w/a.EXTENT,w/a.EXTENT,1]),a.multiply(C,f?this.alignedProjMatrix:this.projMatrix,C),m[h]=new Float32Array(C),m[h]},ln.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ln.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var c,f,h,m,_=-90,w=90,S=-180,C=180,k=this.size,N=this._unmodified;if(this.latRange){var V=this.latRange;_=a.mercatorYfromLat(V[1])*this.worldSize,c=(w=a.mercatorYfromLat(V[0])*this.worldSize)-_<k.y?k.y/(w-_):0}if(this.lngRange){var K=this.lngRange;S=a.mercatorXfromLng(K[0])*this.worldSize,f=(C=a.mercatorXfromLng(K[1])*this.worldSize)-S<k.x?k.x/(C-S):0}var $=this.point,ae=Math.max(f||0,c||0);if(ae)return this.center=this.unproject(new a.Point(f?(C+S)/2:$.x,c?(w+_)/2:$.y)),this.zoom+=this.scaleZoom(ae),this._unmodified=N,void(this._constraining=!1);if(this.latRange){var se=$.y,fe=k.y/2;se-fe<_&&(m=_+fe),se+fe>w&&(m=w-fe)}if(this.lngRange){var ie=$.x,he=k.x/2;ie-he<S&&(h=S+he),ie+he>C&&(h=C-he)}h===void 0&&m===void 0||(this.center=this.unproject(new a.Point(h!==void 0?h:$.x,m!==void 0?m:$.y))),this._unmodified=N,this._constraining=!1}},ln.prototype._calcMatrices=function(){if(this.height){var c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,h=this._fov*(.5+c.y/this.height),m=Math.sin(h)*this.cameraToCenterDistance/Math.sin(a.clamp(Math.PI-f-h,.01,Math.PI-.01)),_=this.point,w=_.x,S=_.y,C=1.01*(Math.cos(Math.PI/2-this._pitch)*m+this.cameraToCenterDistance),k=this.height/50,N=new Float64Array(16);a.perspective(N,this._fov,this.width/this.height,k,C),N[8]=2*-c.x/this.width,N[9]=2*c.y/this.height,a.scale(N,N,[1,-1,1]),a.translate(N,N,[0,0,-this.cameraToCenterDistance]),a.rotateX(N,N,this._pitch),a.rotateZ(N,N,this.angle),a.translate(N,N,[-w,-S,0]),this.mercatorMatrix=a.scale([],N,[this.worldSize,this.worldSize,this.worldSize]),a.scale(N,N,[1,1,a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=N,this.invProjMatrix=a.invert([],this.projMatrix);var V=this.width%2/2,K=this.height%2/2,$=Math.cos(this.angle),ae=Math.sin(this.angle),se=w-Math.round(w)+$*V+ae*K,fe=S-Math.round(S)+$*K+ae*V,ie=new Float64Array(N);if(a.translate(ie,ie,[se>.5?se-1:se,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=ie,N=a.create(),a.scale(N,N,[this.width/2,-this.height/2,1]),a.translate(N,N,[1,-1,0]),this.labelPlaneMatrix=N,N=a.create(),a.scale(N,N,[1,-1,1]),a.translate(N,N,[-1,-1,0]),a.scale(N,N,[2/this.width,2/this.height,1]),this.glCoordMatrix=N,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(N=a.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=N,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ln.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var c=this.pointCoordinate(new a.Point(0,0)),f=[c.x*this.worldSize,c.y*this.worldSize,0,1];return a.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},ln.prototype.getCameraPoint=function(){var c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.Point(0,c))},ln.prototype.getCameraQueryGeometry=function(c){var f=this.getCameraPoint();if(c.length===1)return[c[0],f];for(var h=f.x,m=f.y,_=f.x,w=f.y,S=0,C=c;S<C.length;S+=1){var k=C[S];h=Math.min(h,k.x),m=Math.min(m,k.y),_=Math.max(_,k.x),w=Math.max(w,k.y)}return[new a.Point(h,m),new a.Point(_,m),new a.Point(_,w),new a.Point(h,w),new a.Point(h,m)]},Object.defineProperties(ln.prototype,Sn);var ao=function(c){var f,h,m,_;this._hashName=c&&encodeURIComponent(c),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),h=!1,m=null,_=function(){m=null,h&&(f(),m=setTimeout(_,300),h=!1)},function(){return h=!0,m||_(),m})};ao.prototype.addTo=function(c){return this._map=c,a.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ao.prototype.remove=function(){return a.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ao.prototype.getHashString=function(c){var f=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,m),w=Math.round(f.lng*_)/_,S=Math.round(f.lat*_)/_,C=this._map.getBearing(),k=this._map.getPitch(),N="";if(N+=c?"/"+w+"/"+S+"/"+h:h+"/"+S+"/"+w,(C||k)&&(N+="/"+Math.round(10*C)/10),k&&(N+="/"+Math.round(k)),this._hashName){var V=this._hashName,K=!1,$=a.window.location.hash.slice(1).split("&").map(function(ae){var se=ae.split("=")[0];return se===V?(K=!0,se+"="+N):ae}).filter(function(ae){return ae});return K||$.push(V+"="+N),"#"+$.join("&")}return"#"+N},ao.prototype._getCurrentHash=function(){var c,f=this,h=a.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(m){return m.split("=")}).forEach(function(m){m[0]===f._hashName&&(c=m)}),(c&&c[1]||"").split("/")):h.split("/")},ao.prototype._onHashChange=function(){var c=this._getCurrentHash();if(c.length>=3&&!c.some(function(h){return isNaN(h)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:f,pitch:+(c[4]||0)}),!0}return!1},ao.prototype._updateHashUnthrottled=function(){var c=this.getHashString();try{a.window.history.replaceState(a.window.history.state,"",c)}catch{}};var Wa={linearity:.3,easing:a.bezier(0,0,.3,1)},gv=a.extend({deceleration:2500,maxSpeed:1400},Wa),yv=a.extend({deceleration:20,maxSpeed:1400},Wa),vv=a.extend({deceleration:1e3,maxSpeed:360},Wa),Jd=a.extend({deceleration:1e3,maxSpeed:90},Wa),$o=function(c){this._map=c,this.clear()};function Zi(c,f){(!c.duration||c.duration<f.duration)&&(c.duration=f.duration,c.easing=f.easing)}function gu(c,f,h){var m=h.maxSpeed,_=h.linearity,w=h.deceleration,S=a.clamp(c*_/(f/1e3),-m,m),C=Math.abs(S)/(w*_);return{easing:h.easing,duration:1e3*C,amount:S*(C/2)}}$o.prototype.clear=function(){this._inertiaBuffer=[]},$o.prototype.record=function(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.browser.now(),settings:c})},$o.prototype._drainInertiaBuffer=function(){for(var c=this._inertiaBuffer,f=a.browser.now();c.length>0&&f-c[0].time>160;)c.shift()},$o.prototype._onMoveEnd=function(c){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new a.Point(0,0),pinchAround:void 0,around:void 0},h=0,m=this._inertiaBuffer;h<m.length;h+=1){var _=m[h].settings;f.zoom+=_.zoomDelta||0,f.bearing+=_.bearingDelta||0,f.pitch+=_.pitchDelta||0,_.panDelta&&f.pan._add(_.panDelta),_.around&&(f.around=_.around),_.pinchAround&&(f.pinchAround=_.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(f.pan.mag()){var C=gu(f.pan.mag(),w,a.extend({},gv,c||{}));S.offset=f.pan.mult(C.amount/f.pan.mag()),S.center=this._map.transform.center,Zi(S,C)}if(f.zoom){var k=gu(f.zoom,w,yv);S.zoom=this._map.transform.zoom+k.amount,Zi(S,k)}if(f.bearing){var N=gu(f.bearing,w,vv);S.bearing=this._map.transform.bearing+a.clamp(N.amount,-179,179),Zi(S,N)}if(f.pitch){var V=gu(f.pitch,w,Jd);S.pitch=this._map.transform.pitch+V.amount,Zi(S,V)}if(S.zoom||S.bearing){var K=f.pinchAround===void 0?f.around:f.pinchAround;S.around=K?this._map.unproject(K):this._map.getCenter()}return this.clear(),a.extend(S,{noMoveStart:!0})}};var $i=function(c){function f(m,_,w,S){S===void 0&&(S={});var C=g.mousePos(_.getCanvasContainer(),w),k=_.unproject(C);c.call(this,m,a.extend({point:C,lngLat:k,originalEvent:w},S)),this._defaultPrevented=!1,this.target=_}c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f;var h={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,h),f}(a.Event),Ha=function(c){function f(m,_,w){var S=m==="touchend"?w.changedTouches:w.touches,C=g.touchPos(_.getCanvasContainer(),S),k=C.map(function(K){return _.unproject(K)}),N=C.reduce(function(K,$,ae,se){return K.add($.div(se.length))},new a.Point(0,0)),V=_.unproject(N);c.call(this,m,{points:C,point:N,lngLats:k,lngLat:V,originalEvent:w}),this._defaultPrevented=!1}c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f;var h={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,h),f}(a.Event),ht=function(c){function f(m,_,w){c.call(this,m,{originalEvent:w}),this._defaultPrevented=!1}c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f;var h={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,h),f}(a.Event),Ir=function(c,f){this._map=c,this._clickTolerance=f.clickTolerance};Ir.prototype.reset=function(){delete this._mousedownPos},Ir.prototype.wheel=function(c){return this._firePreventable(new ht(c.type,this._map,c))},Ir.prototype.mousedown=function(c,f){return this._mousedownPos=f,this._firePreventable(new $i(c.type,this._map,c))},Ir.prototype.mouseup=function(c){this._map.fire(new $i(c.type,this._map,c))},Ir.prototype.click=function(c,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new $i(c.type,this._map,c))},Ir.prototype.dblclick=function(c){return this._firePreventable(new $i(c.type,this._map,c))},Ir.prototype.mouseover=function(c){this._map.fire(new $i(c.type,this._map,c))},Ir.prototype.mouseout=function(c){this._map.fire(new $i(c.type,this._map,c))},Ir.prototype.touchstart=function(c){return this._firePreventable(new Ha(c.type,this._map,c))},Ir.prototype.touchmove=function(c){this._map.fire(new Ha(c.type,this._map,c))},Ir.prototype.touchend=function(c){this._map.fire(new Ha(c.type,this._map,c))},Ir.prototype.touchcancel=function(c){this._map.fire(new Ha(c.type,this._map,c))},Ir.prototype._firePreventable=function(c){if(this._map.fire(c),c.defaultPrevented)return{}},Ir.prototype.isEnabled=function(){return!0},Ir.prototype.isActive=function(){return!1},Ir.prototype.enable=function(){},Ir.prototype.disable=function(){};var To=function(c){this._map=c};To.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},To.prototype.mousemove=function(c){this._map.fire(new $i(c.type,this._map,c))},To.prototype.mousedown=function(){this._delayContextMenu=!0},To.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $i("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},To.prototype.contextmenu=function(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new $i(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()},To.prototype.isEnabled=function(){return!0},To.prototype.isActive=function(){return!1},To.prototype.enable=function(){},To.prototype.disable=function(){};var so=function(c,f){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=f.clickTolerance||1};function Cs(c,f){for(var h={},m=0;m<c.length;m++)h[c[m].identifier]=f[m];return h}so.prototype.isEnabled=function(){return!!this._enabled},so.prototype.isActive=function(){return!!this._active},so.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},so.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},so.prototype.mousedown=function(c,f){this.isEnabled()&&c.shiftKey&&c.button===0&&(g.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},so.prototype.mousemoveWindow=function(c,f){if(this._active){var h=f;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var m=this._startPos;this._lastPos=h,this._box||(this._box=g.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));var _=Math.min(m.x,h.x),w=Math.max(m.x,h.x),S=Math.min(m.y,h.y),C=Math.max(m.y,h.y);g.setTransform(this._box,"translate("+_+"px,"+S+"px)"),this._box.style.width=w-_+"px",this._box.style.height=C-S+"px"}}},so.prototype.mouseupWindow=function(c,f){var h=this;if(this._active&&c.button===0){var m=this._startPos,_=f;if(this.reset(),g.suppressClick(),m.x!==_.x||m.y!==_.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:function(w){return w.fitScreenCoordinates(m,_,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",c)}},so.prototype.keydown=function(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))},so.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(g.remove(this._box),this._box=null),g.enableDrag(),delete this._startPos,delete this._lastPos},so.prototype._fireEvent=function(c,f){return this._map.fire(new a.Event(c,{originalEvent:f}))};var ma=function(c){this.reset(),this.numTouches=c.numTouches};ma.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ma.prototype.touchstart=function(c,f,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){for(var _=new a.Point(0,0),w=0,S=m;w<S.length;w+=1)_._add(S[w]);return _.div(m.length)}(f),this.touches=Cs(h,f)))},ma.prototype.touchmove=function(c,f,h){if(!this.aborted&&this.centroid){var m=Cs(h,f);for(var _ in this.touches){var w=m[_];(!w||w.dist(this.touches[_])>30)&&(this.aborted=!0)}}},ma.prototype.touchend=function(c,f,h){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var m=!this.aborted&&this.centroid;if(this.reset(),m)return m}};var ga=function(c){this.singleTap=new ma(c),this.numTaps=c.numTaps,this.reset()};ga.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},ga.prototype.touchstart=function(c,f,h){this.singleTap.touchstart(c,f,h)},ga.prototype.touchmove=function(c,f,h){this.singleTap.touchmove(c,f,h)},ga.prototype.touchend=function(c,f,h){var m=this.singleTap.touchend(c,f,h);if(m){var _=c.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(m)<30;if(_&&w||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}};var nt=function(){this._zoomIn=new ga({numTouches:1,numTaps:2}),this._zoomOut=new ga({numTouches:2,numTaps:1}),this.reset()};nt.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},nt.prototype.touchstart=function(c,f,h){this._zoomIn.touchstart(c,f,h),this._zoomOut.touchstart(c,f,h)},nt.prototype.touchmove=function(c,f,h){this._zoomIn.touchmove(c,f,h),this._zoomOut.touchmove(c,f,h)},nt.prototype.touchend=function(c,f,h){var m=this,_=this._zoomIn.touchend(c,f,h),w=this._zoomOut.touchend(c,f,h);return _?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(S){return S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(_)},{originalEvent:c})}}):w?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(S){return S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(w)},{originalEvent:c})}}):void 0},nt.prototype.touchcancel=function(){this.reset()},nt.prototype.enable=function(){this._enabled=!0},nt.prototype.disable=function(){this._enabled=!1,this.reset()},nt.prototype.isEnabled=function(){return this._enabled},nt.prototype.isActive=function(){return this._active};var Af={0:1,2:2},_i=function(c){this.reset(),this._clickTolerance=c.clickTolerance||1};_i.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},_i.prototype._correctButton=function(c,f){return!1},_i.prototype._move=function(c,f){return{}},_i.prototype.mousedown=function(c,f){if(!this._lastPoint){var h=g.mouseButton(c);this._correctButton(c,h)&&(this._lastPoint=f,this._eventButton=h)}},_i.prototype.mousemoveWindow=function(c,f){var h=this._lastPoint;if(h){if(c.preventDefault(),function(m,_){var w=Af[_];return m.buttons===void 0||(m.buttons&w)!==w}(c,this._eventButton))this.reset();else if(this._moved||!(f.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(h,f)}},_i.prototype.mouseupWindow=function(c){this._lastPoint&&g.mouseButton(c)===this._eventButton&&(this._moved&&g.suppressClick(),this.reset())},_i.prototype.enable=function(){this._enabled=!0},_i.prototype.disable=function(){this._enabled=!1,this.reset()},_i.prototype.isEnabled=function(){return this._enabled},_i.prototype.isActive=function(){return this._active};var Qd=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.mousedown=function(h,m){c.prototype.mousedown.call(this,h,m),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(h,m){return m===0&&!h.ctrlKey},f.prototype._move=function(h,m){return{around:m,panDelta:m.sub(h)}},f}(_i),Cf=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype._correctButton=function(h,m){return m===0&&h.ctrlKey||m===2},f.prototype._move=function(h,m){var _=.8*(m.x-h.x);if(_)return this._active=!0,{bearingDelta:_}},f.prototype.contextmenu=function(h){h.preventDefault()},f}(_i),em=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype._correctButton=function(h,m){return m===0&&h.ctrlKey||m===2},f.prototype._move=function(h,m){var _=-.5*(m.y-h.y);if(_)return this._active=!0,{pitchDelta:_}},f.prototype.contextmenu=function(h){h.preventDefault()},f}(_i),So=function(c){this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset()};So.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new a.Point(0,0)},So.prototype.touchstart=function(c,f,h){return this._calculateTransform(c,f,h)},So.prototype.touchmove=function(c,f,h){if(this._active)return c.preventDefault(),this._calculateTransform(c,f,h)},So.prototype.touchend=function(c,f,h){this._calculateTransform(c,f,h),this._active&&h.length<this._minTouches&&this.reset()},So.prototype.touchcancel=function(){this.reset()},So.prototype._calculateTransform=function(c,f,h){h.length>0&&(this._active=!0);var m=Cs(h,f),_=new a.Point(0,0),w=new a.Point(0,0),S=0;for(var C in m){var k=m[C],N=this._touches[C];N&&(_._add(k),w._add(k.sub(N)),S++,m[C]=k)}if(this._touches=m,!(S<this._minTouches)&&w.mag()){var V=w.div(S);if(this._sum._add(V),!(this._sum.mag()<this._clickTolerance))return{around:_.div(S),panDelta:V}}},So.prototype.enable=function(){this._enabled=!0},So.prototype.disable=function(){this._enabled=!1,this.reset()},So.prototype.isEnabled=function(){return this._enabled},So.prototype.isActive=function(){return this._active};var li=function(){this.reset()};function ti(c,f,h){for(var m=0;m<c.length;m++)if(c[m].identifier===h)return f[m]}function ya(c,f){return Math.log(c/f)/Math.LN2}li.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},li.prototype._start=function(c){},li.prototype._move=function(c,f,h){return{}},li.prototype.touchstart=function(c,f,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([f[0],f[1]]))},li.prototype.touchmove=function(c,f,h){if(this._firstTwoTouches){c.preventDefault();var m=this._firstTwoTouches,_=m[1],w=ti(h,f,m[0]),S=ti(h,f,_);if(w&&S){var C=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],C,c)}}},li.prototype.touchend=function(c,f,h){if(this._firstTwoTouches){var m=this._firstTwoTouches,_=m[1],w=ti(h,f,m[0]),S=ti(h,f,_);w&&S||(this._active&&g.suppressClick(),this.reset())}},li.prototype.touchcancel=function(){this.reset()},li.prototype.enable=function(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"},li.prototype.disable=function(){this._enabled=!1,this.reset()},li.prototype.isEnabled=function(){return this._enabled},li.prototype.isActive=function(){return this._active};var tm=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.reset=function(){c.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},f.prototype._move=function(h,m){var _=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(ya(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ya(this._distance,_),pinchAround:m}},f}(li);function Sc(c,f){return 180*c.angleWith(f)/Math.PI}var If=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.reset=function(){c.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},f.prototype._move=function(h,m){var _=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Sc(this._vector,_),pinchAround:m}},f.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var m=25/(Math.PI*this._minDiameter)*360,_=Sc(h,this._startVector);return Math.abs(_)<m},f}(li);function yu(c){return Math.abs(c.y)>Math.abs(c.x)}var nm=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.reset=function(){c.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(h){this._lastPoints=h,yu(h[0].sub(h[1]))&&(this._valid=!1)},f.prototype._move=function(h,m,_){var w=h[0].sub(this._lastPoints[0]),S=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,S,_.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(w.y+S.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(h,m,_){if(this._valid!==void 0)return this._valid;var w=h.mag()>=2,S=m.mag()>=2;if(w||S){if(!w||!S)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;var C=h.y>0==m.y>0;return yu(h)&&yu(m)&&C}},f}(li),Xi={panStep:100,bearingStep:15,pitchStep:10},hn=function(){var c=Xi;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep};function vl(c){return c*(2-c)}hn.prototype.reset=function(){this._active=!1},hn.prototype.keydown=function(c){var f=this;if(!(c.altKey||c.ctrlKey||c.metaKey)){var h=0,m=0,_=0,w=0,S=0;switch(c.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:c.shiftKey?m=-1:(c.preventDefault(),w=-1);break;case 39:c.shiftKey?m=1:(c.preventDefault(),w=1);break;case 38:c.shiftKey?_=1:(c.preventDefault(),S=-1);break;case 40:c.shiftKey?_=-1:(c.preventDefault(),S=1);break;default:return}return{cameraAnimation:function(C){var k=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:vl,zoom:h?Math.round(k)+h*(c.shiftKey?2:1):k,bearing:C.getBearing()+m*f._bearingStep,pitch:C.getPitch()+_*f._pitchStep,offset:[-w*f._panStep,-S*f._panStep],center:C.getCenter()},{originalEvent:c})}}}},hn.prototype.enable=function(){this._enabled=!0},hn.prototype.disable=function(){this._enabled=!1,this.reset()},hn.prototype.isEnabled=function(){return this._enabled},hn.prototype.isActive=function(){return this._active};var Vr=function(c,f){this._map=c,this._el=c.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,a.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)};Vr.prototype.setZoomRate=function(c){this._defaultZoomRate=c},Vr.prototype.setWheelZoomRate=function(c){this._wheelZoomRate=c},Vr.prototype.isEnabled=function(){return!!this._enabled},Vr.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Vr.prototype.isZooming=function(){return!!this._zooming},Vr.prototype.enable=function(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=c&&c.around==="center")},Vr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Vr.prototype.wheel=function(c){if(this.isEnabled()){var f=c.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,h=a.browser.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(m*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),c.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=c,this._delta-=f,this._active||this._start(c)),c.preventDefault()}},Vr.prototype._onTimeout=function(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},Vr.prototype._start=function(c){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=g.mousePos(this._el,c);this._around=a.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Vr.prototype.renderFrame=function(){return this._onScrollFrame()},Vr.prototype._onScrollFrame=function(){var c=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,m=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&m!==0&&(m=1/m);var _=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(_*m))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,S=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,C=this._startZoom,k=this._easing,N=!1;if(this._type==="wheel"&&C&&k){var V=Math.min((a.browser.now()-this._lastWheelEventTime)/200,1),K=k(V);w=a.number(C,S,K),V<1?this._frameId||(this._frameId=!0):N=!0}else w=S,N=!0;return this._active=!0,N&&(this._active=!1,this._finishTimeout=setTimeout(function(){c._zooming=!1,c._handler._triggerRenderFrame(),delete c._targetZoom,delete c._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!N,zoomDelta:w-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Vr.prototype._smoothOutEasing=function(c){var f=a.ease;if(this._prevEase){var h=this._prevEase,m=(a.browser.now()-h.start)/h.duration,_=h.easing(m+.01)-h.easing(m),w=.27/Math.sqrt(_*_+1e-4)*.01,S=Math.sqrt(.0729-w*w);f=a.bezier(w,S,.25,1)}return this._prevEase={start:a.browser.now(),duration:c,easing:f},f},Vr.prototype.reset=function(){this._active=!1};var Yi=function(c,f){this._clickZoom=c,this._tapZoom=f};Yi.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Yi.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Yi.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Yi.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var va=function(){this.reset()};va.prototype.reset=function(){this._active=!1},va.prototype.dblclick=function(c,f){return c.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(c.shiftKey?-1:1),around:h.unproject(f)},{originalEvent:c})}}},va.prototype.enable=function(){this._enabled=!0},va.prototype.disable=function(){this._enabled=!1,this.reset()},va.prototype.isEnabled=function(){return this._enabled},va.prototype.isActive=function(){return this._active};var Ki=function(){this._tap=new ga({numTouches:1,numTaps:1}),this.reset()};Ki.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ki.prototype.touchstart=function(c,f,h){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=f[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(c,f,h))},Ki.prototype.touchmove=function(c,f,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var m=f[0],_=m.y-this._swipePoint.y;return this._swipePoint=m,c.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(c,f,h)},Ki.prototype.touchend=function(c,f,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(c,f,h)&&(this._tapTime=c.timeStamp)},Ki.prototype.touchcancel=function(){this.reset()},Ki.prototype.enable=function(){this._enabled=!0},Ki.prototype.disable=function(){this._enabled=!1,this.reset()},Ki.prototype.isEnabled=function(){return this._enabled},Ki.prototype.isActive=function(){return this._active};var _a=function(c,f,h){this._el=c,this._mousePan=f,this._touchPan=h};_a.prototype.enable=function(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},_a.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},_a.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},_a.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ni=function(c,f,h){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=f,this._mousePitch=h};ni.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ni.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ni.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ni.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Po=function(c,f,h,m){this._el=c,this._touchZoom=f,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0};Po.prototype.enable=function(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Po.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Po.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Po.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Po.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Po.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var gt=function(c){return c.zoom||c.drag||c.pitch||c.rotate},Ct=function(c){function f(){c.apply(this,arguments)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f}(a.Event);function _l(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}var Qn=function(c,f){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $o(c),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),a.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[a.window,"blur",void 0]];for(var m=0,_=this._listeners;m<_.length;m+=1){var w=_[m],S=w[0];g.addEventListener(S,w[1],S===a.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};Qn.prototype.destroy=function(){for(var c=0,f=this._listeners;c<f.length;c+=1){var h=f[c],m=h[0];g.removeEventListener(m,h[1],m===a.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},Qn.prototype._addDefaultHandlers=function(c){var f=this._map,h=f.getCanvasContainer();this._add("mapEvent",new Ir(f,c));var m=f.boxZoom=new so(f,c);this._add("boxZoom",m);var _=new nt,w=new va;f.doubleClickZoom=new Yi(w,_),this._add("tapZoom",_),this._add("clickZoom",w);var S=new Ki;this._add("tapDragZoom",S);var C=f.touchPitch=new nm;this._add("touchPitch",C);var k=new Cf(c),N=new em(c);f.dragRotate=new ni(c,k,N),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);var V=new Qd(c),K=new So(c);f.dragPan=new _a(h,V,K),this._add("mousePan",V),this._add("touchPan",K,["touchZoom","touchRotate"]);var $=new If,ae=new tm;f.touchZoomRotate=new Po(h,ae,$,S),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]);var se=f.scrollZoom=new Vr(f,this);this._add("scrollZoom",se,["mousePan"]);var fe=f.keyboard=new hn;this._add("keyboard",fe),this._add("blockableMapEvent",new To(f));for(var ie=0,he=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ie<he.length;ie+=1){var ve=he[ie];c.interactive&&c[ve]&&f[ve].enable(c[ve])}},Qn.prototype._add=function(c,f,h){this._handlers.push({handlerName:c,handler:f,allowed:h}),this._handlersById[c]=f},Qn.prototype.stop=function(){if(!this._updatingCamera){for(var c=0,f=this._handlers;c<f.length;c+=1)f[c].handler.reset();this._inertia.clear(),this._fireEvents({},{}),this._changes=[]}},Qn.prototype.isActive=function(){for(var c=0,f=this._handlers;c<f.length;c+=1)if(f[c].handler.isActive())return!0;return!1},Qn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Qn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Qn.prototype.isMoving=function(){return Boolean(gt(this._eventsInProgress))||this.isZooming()},Qn.prototype._blockedByActive=function(c,f,h){for(var m in c)if(m!==h&&(!f||f.indexOf(m)<0))return!0;return!1},Qn.prototype.handleWindowEvent=function(c){this.handleEvent(c,c.type+"Window")},Qn.prototype._getMapTouches=function(c){for(var f=[],h=0,m=c;h<m.length;h+=1){var _=m[h];this._el.contains(_.target)&&f.push(_)}return f},Qn.prototype.handleEvent=function(c,f){if(c.type!=="blur"){this._updatingCamera=!0;for(var h=c.type==="renderFrame"?void 0:c,m={needsRenderFrame:!1},_={},w={},S=c.touches?this._getMapTouches(c.touches):void 0,C=S?g.touchPos(this._el,S):g.mousePos(this._el,c),k=0,N=this._handlers;k<N.length;k+=1){var V=N[k],K=V.handlerName,$=V.handler,ae=V.allowed;if($.isEnabled()){var se=void 0;this._blockedByActive(w,ae,K)?$.reset():$[f||c.type]&&(se=$[f||c.type](c,C,S),this.mergeHandlerResult(m,_,se,K,h),se&&se.needsRenderFrame&&this._triggerRenderFrame()),(se||$.isActive())&&(w[K]=$)}}var fe={};for(var ie in this._previousActiveHandlers)w[ie]||(fe[ie]=h);this._previousActiveHandlers=w,(Object.keys(fe).length||_l(m))&&(this._changes.push([m,_,fe]),this._triggerRenderFrame()),(Object.keys(w).length||_l(m))&&this._map._stop(!0),this._updatingCamera=!1;var he=m.cameraAnimation;he&&(this._inertia.clear(),this._fireEvents({},{}),this._changes=[],he(this._map))}else this.stop()},Qn.prototype.mergeHandlerResult=function(c,f,h,m,_){if(h){a.extend(c,h);var w={handlerName:m,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(f.zoom=w),h.panDelta!==void 0&&(f.drag=w),h.pitchDelta!==void 0&&(f.pitch=w),h.bearingDelta!==void 0&&(f.rotate=w)}},Qn.prototype._applyChanges=function(){for(var c={},f={},h={},m=0,_=this._changes;m<_.length;m+=1){var w=_[m],S=w[0],C=w[1],k=w[2];S.panDelta&&(c.panDelta=(c.panDelta||new a.Point(0,0))._add(S.panDelta)),S.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(c.around=S.around),S.pinchAround!==void 0&&(c.pinchAround=S.pinchAround),S.noInertia&&(c.noInertia=S.noInertia),a.extend(f,C),a.extend(h,k)}this._updateMapTransform(c,f,h),this._changes=[]},Qn.prototype._updateMapTransform=function(c,f,h){var m=this._map,_=m.transform;if(!_l(c))return this._fireEvents(f,h);var w=c.panDelta,S=c.zoomDelta,C=c.bearingDelta,k=c.pitchDelta,N=c.around,V=c.pinchAround;V!==void 0&&(N=V),m._stop(!0),N=N||m.transform.centerPoint;var K=_.pointLocation(w?N.sub(w):N);C&&(_.bearing+=C),k&&(_.pitch+=k),S&&(_.zoom+=S),_.setLocationAtPoint(K,N),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(f,h)},Qn.prototype._fireEvents=function(c,f){var h=this,m=gt(this._eventsInProgress),_=gt(c),w={};for(var S in c)this._eventsInProgress[S]||(w[S+"start"]=c[S].originalEvent),this._eventsInProgress[S]=c[S];for(var C in!m&&_&&this._fireEvent("movestart",_.originalEvent),w)this._fireEvent(C,w[C]);for(var k in c.rotate&&(this._bearingChanged=!0),_&&this._fireEvent("move",_.originalEvent),c)this._fireEvent(k,c[k].originalEvent);var N,V={};for(var K in this._eventsInProgress){var $=this._eventsInProgress[K],ae=$.handlerName,se=$.originalEvent;this._handlersById[ae].isActive()||(delete this._eventsInProgress[K],V[K+"end"]=N=f[ae]||se)}for(var fe in V)this._fireEvent(fe,V[fe]);var ie=gt(this._eventsInProgress);if((m||_)&&!ie){this._updatingCamera=!0;var he=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ve=function(Te){return Te!==0&&-h._bearingSnap<Te&&Te<h._bearingSnap};he?(ve(he.bearing||this._map.getBearing())&&(he.bearing=0),this._map.easeTo(he,{originalEvent:N})):(this._map.fire(new a.Event("moveend",{originalEvent:N})),ve(this._map.getBearing())&&this._map.resetNorth()),this._bearingChanged=!1,this._updatingCamera=!1}},Qn.prototype._fireEvent=function(c,f){this._map.fire(new a.Event(c,f?{originalEvent:f}:{}))},Qn.prototype._triggerRenderFrame=function(){var c=this;this._frameId===void 0&&(this._frameId=this._map._requestRenderFrame(function(f){delete c._frameId,c.handleEvent(new Ct("renderFrame",{timeStamp:f})),c._applyChanges()}))};var vu=function(c){function f(h,m){c.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=m.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.getCenter=function(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(h,m){return this.jumpTo({center:h},m)},f.prototype.panBy=function(h,m,_){return h=a.Point.convert(h).mult(-1),this.panTo(this.transform.center,a.extend({offset:h},m),_)},f.prototype.panTo=function(h,m,_){return this.easeTo(a.extend({center:h},m),_)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(h,m){return this.jumpTo({zoom:h},m),this},f.prototype.zoomTo=function(h,m,_){return this.easeTo(a.extend({zoom:h},m),_)},f.prototype.zoomIn=function(h,m){return this.zoomTo(this.getZoom()+1,h,m),this},f.prototype.zoomOut=function(h,m){return this.zoomTo(this.getZoom()-1,h,m),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(h,m){return this.jumpTo({bearing:h},m),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(h,m){return this.jumpTo({padding:h},m),this},f.prototype.rotateTo=function(h,m,_){return this.easeTo(a.extend({bearing:h},m),_)},f.prototype.resetNorth=function(h,m){return this.rotateTo(0,a.extend({duration:1e3},h),m),this},f.prototype.resetNorthPitch=function(h,m){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},h),m),this},f.prototype.snapToNorth=function(h,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,m):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(h,m){return this.jumpTo({pitch:h},m),this},f.prototype.cameraForBounds=function(h,m){return h=a.LngLatBounds.convert(h),this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),0,m)},f.prototype._cameraForBoxAndBearing=function(h,m,_,w){var S={top:0,bottom:0,right:0,left:0};if(typeof(w=a.extend({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var C=w.padding;w.padding={top:C,bottom:C,right:C,left:C}}w.padding=a.extend(S,w.padding);var k=this.transform,N=k.padding,V=k.project(a.LngLat.convert(h)),K=k.project(a.LngLat.convert(m)),$=V.rotate(-_*Math.PI/180),ae=K.rotate(-_*Math.PI/180),se=new a.Point(Math.max($.x,ae.x),Math.max($.y,ae.y)),fe=new a.Point(Math.min($.x,ae.x),Math.min($.y,ae.y)),ie=se.sub(fe),he=(k.width-(N.left+N.right+w.padding.left+w.padding.right))/ie.x,ve=(k.height-(N.top+N.bottom+w.padding.top+w.padding.bottom))/ie.y;if(!(ve<0||he<0)){var Te=Math.min(k.scaleZoom(k.scale*Math.min(he,ve)),w.maxZoom),Le=a.Point.convert(w.offset),Ae=new a.Point(Le.x+(w.padding.left-w.padding.right)/2,Le.y+(w.padding.top-w.padding.bottom)/2).mult(k.scale/k.zoomScale(Te));return{center:k.unproject(V.add(K).div(2).sub(Ae)),zoom:Te,bearing:_}}a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(h,m,_){return this._fitInternal(this.cameraForBounds(h,m),m,_)},f.prototype.fitScreenCoordinates=function(h,m,_,w,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.Point.convert(h)),this.transform.pointLocation(a.Point.convert(m)),_,w),w,S)},f.prototype._fitInternal=function(h,m,_){return h?(delete(m=a.extend(h,m)).padding,m.linear?this.easeTo(m,_):this.flyTo(m,_)):this},f.prototype.jumpTo=function(h,m){this.stop();var _=this.transform,w=!1,S=!1,C=!1;return"zoom"in h&&_.zoom!==+h.zoom&&(w=!0,_.zoom=+h.zoom),h.center!==void 0&&(_.center=a.LngLat.convert(h.center)),"bearing"in h&&_.bearing!==+h.bearing&&(S=!0,_.bearing=+h.bearing),"pitch"in h&&_.pitch!==+h.pitch&&(C=!0,_.pitch=+h.pitch),h.padding==null||_.isPaddingEqual(h.padding)||(_.padding=h.padding),this.fire(new a.Event("movestart",m)).fire(new a.Event("move",m)),w&&this.fire(new a.Event("zoomstart",m)).fire(new a.Event("zoom",m)).fire(new a.Event("zoomend",m)),S&&this.fire(new a.Event("rotatestart",m)).fire(new a.Event("rotate",m)).fire(new a.Event("rotateend",m)),C&&this.fire(new a.Event("pitchstart",m)).fire(new a.Event("pitch",m)).fire(new a.Event("pitchend",m)),this.fire(new a.Event("moveend",m))},f.prototype.easeTo=function(h,m){var _=this;this._stop(!1,h.easeId),((h=a.extend({offset:[0,0],duration:500,easing:a.ease},h)).animate===!1||!h.essential&&a.browser.prefersReducedMotion)&&(h.duration=0);var w=this.transform,S=this.getZoom(),C=this.getBearing(),k=this.getPitch(),N=this.getPadding(),V="zoom"in h?+h.zoom:S,K="bearing"in h?this._normalizeBearing(h.bearing,C):C,$="pitch"in h?+h.pitch:k,ae="padding"in h?h.padding:w.padding,se=a.Point.convert(h.offset),fe=w.centerPoint.add(se),ie=w.pointLocation(fe),he=a.LngLat.convert(h.center||ie);this._normalizeCenter(he);var ve,Te,Le=w.project(ie),Ae=w.project(he).sub(Le),Re=w.zoomScale(V-S);h.around&&(ve=a.LngLat.convert(h.around),Te=w.locationPoint(ve));var je={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||V!==S,this._rotating=this._rotating||C!==K,this._pitching=this._pitching||$!==k,this._padding=!w.isPaddingEqual(ae),this._easeId=h.easeId,this._prepareEase(m,h.noMoveStart,je),clearTimeout(this._easeEndTimeoutID),this._ease(function(Je){if(_._zooming&&(w.zoom=a.number(S,V,Je)),_._rotating&&(w.bearing=a.number(C,K,Je)),_._pitching&&(w.pitch=a.number(k,$,Je)),_._padding&&(w.interpolatePadding(N,ae,Je),fe=w.centerPoint.add(se)),ve)w.setLocationAtPoint(ve,Te);else{var Ze=w.zoomScale(w.zoom-S),rt=V>S?Math.min(2,Re):Math.max(.5,Re),ft=Math.pow(rt,1-Je),Mt=w.unproject(Le.add(Ae.mult(Je*ft)).mult(Ze));w.setLocationAtPoint(w.renderWorldCopies?Mt.wrap():Mt,fe)}_._fireMoveEvents(m)},function(Je){_._afterEase(m,Je)},h),this},f.prototype._prepareEase=function(h,m,_){_===void 0&&(_={}),this._moving=!0,m||_.moving||this.fire(new a.Event("movestart",h)),this._zooming&&!_.zooming&&this.fire(new a.Event("zoomstart",h)),this._rotating&&!_.rotating&&this.fire(new a.Event("rotatestart",h)),this._pitching&&!_.pitching&&this.fire(new a.Event("pitchstart",h))},f.prototype._fireMoveEvents=function(h){this.fire(new a.Event("move",h)),this._zooming&&this.fire(new a.Event("zoom",h)),this._rotating&&this.fire(new a.Event("rotate",h)),this._pitching&&this.fire(new a.Event("pitch",h))},f.prototype._afterEase=function(h,m){if(!this._easeId||!m||this._easeId!==m){delete this._easeId;var _=this._zooming,w=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new a.Event("zoomend",h)),w&&this.fire(new a.Event("rotateend",h)),S&&this.fire(new a.Event("pitchend",h)),this.fire(new a.Event("moveend",h))}},f.prototype.flyTo=function(h,m){var _=this;if(!h.essential&&a.browser.prefersReducedMotion){var w=a.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,m)}this.stop(),h=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},h);var S=this.transform,C=this.getZoom(),k=this.getBearing(),N=this.getPitch(),V=this.getPadding(),K="zoom"in h?a.clamp(+h.zoom,S.minZoom,S.maxZoom):C,$="bearing"in h?this._normalizeBearing(h.bearing,k):k,ae="pitch"in h?+h.pitch:N,se="padding"in h?h.padding:S.padding,fe=S.zoomScale(K-C),ie=a.Point.convert(h.offset),he=S.centerPoint.add(ie),ve=S.pointLocation(he),Te=a.LngLat.convert(h.center||ve);this._normalizeCenter(Te);var Le=S.project(ve),Ae=S.project(Te).sub(Le),Re=h.curve,je=Math.max(S.width,S.height),Je=je/fe,Ze=Ae.mag();if("minZoom"in h){var rt=a.clamp(Math.min(h.minZoom,C,K),S.minZoom,S.maxZoom),ft=je/S.zoomScale(rt-C);Re=Math.sqrt(ft/Ze*2)}var Mt=Re*Re;function wt(It){var Ut=(Je*Je-je*je+(It?-1:1)*Mt*Mt*Ze*Ze)/(2*(It?Je:je)*Mt*Ze);return Math.log(Math.sqrt(Ut*Ut+1)-Ut)}function Ht(It){return(Math.exp(It)-Math.exp(-It))/2}function lt(It){return(Math.exp(It)+Math.exp(-It))/2}var Ft=wt(0),Bt=function(It){return lt(Ft)/lt(Ft+Re*It)},Et=function(It){return je*((lt(Ft)*(Ht(Ut=Ft+Re*It)/lt(Ut))-Ht(Ft))/Mt)/Ze;var Ut},Ot=(wt(1)-Ft)/Re;if(Math.abs(Ze)<1e-6||!isFinite(Ot)){if(Math.abs(je-Je)<1e-6)return this.easeTo(h,m);var jt=Je<je?-1:1;Ot=Math.abs(Math.log(Je/je))/Re,Et=function(){return 0},Bt=function(It){return Math.exp(jt*Re*It)}}return h.duration="duration"in h?+h.duration:1e3*Ot/("screenSpeed"in h?+h.screenSpeed/Re:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=k!==$,this._pitching=ae!==N,this._padding=!S.isPaddingEqual(se),this._prepareEase(m,!1),this._ease(function(It){var Ut=It*Ot,Mr=1/Bt(Ut);S.zoom=It===1?K:C+S.scaleZoom(Mr),_._rotating&&(S.bearing=a.number(k,$,It)),_._pitching&&(S.pitch=a.number(N,ae,It)),_._padding&&(S.interpolatePadding(V,se,It),he=S.centerPoint.add(ie));var Xn=It===1?Te:S.unproject(Le.add(Ae.mult(Et(Ut))).mult(Mr));S.setLocationAtPoint(S.renderWorldCopies?Xn.wrap():Xn,he),_._fireMoveEvents(m)},function(){return _._afterEase(m)},h),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(h,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,m)}if(!h){var w=this.handlers;w&&w.stop()}return this},f.prototype._ease=function(h,m,_){_.animate===!1||_.duration===0?(h(1),m()):(this._easeStart=a.browser.now(),this._easeOptions=_,this._onEaseFrame=h,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var h=Math.min((a.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(h,m){h=a.wrap(h,-180,180);var _=Math.abs(h-m);return Math.abs(h-360-m)<_&&(h-=360),Math.abs(h+360-m)<_&&(h+=360),h},f.prototype._normalizeCenter=function(h){var m=this.transform;if(m.renderWorldCopies&&!m.lngRange){var _=h.lng-m.center.lng;h.lng+=_>180?-360:_<-180?360:0}},f}(a.Evented),hr=function(c){c===void 0&&(c={}),this.options=c,a.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};hr.prototype.getDefaultPosition=function(){return"bottom-right"},hr.prototype.onAdd=function(c){var f=this.options&&this.options.compact;return this._map=c,this._container=g.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._innerContainer=g.create("div","mapboxgl-ctrl-attrib-inner",this._container),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},hr.prototype.onRemove=function(){g.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},hr.prototype._updateEditLink=function(){var c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(c){var h=f.reduce(function(m,_,w){return _.value&&(m+=_.key+"="+_.value+(w<f.length-1?"&":"")),m},"?");c.href=a.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),c.rel="noopener nofollow"}},hr.prototype._updateData=function(c){!c||c.sourceDataType!=="metadata"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},hr.prototype._updateAttributions=function(){if(this._map.style){var c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(function(C){return typeof C!="string"?"":C})):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var h=this._map.style.sourceCaches;for(var m in h){var _=h[m];if(_.used){var w=_.getSource();w.attribution&&c.indexOf(w.attribution)<0&&c.push(w.attribution)}}c.sort(function(C,k){return C.length-k.length});var S=(c=c.filter(function(C,k){for(var N=k+1;N<c.length;N++)if(c[N].indexOf(C)>=0)return!1;return!0})).join(" | ");S!==this._attribHTML&&(this._attribHTML=S,c.length?(this._innerContainer.innerHTML=S,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},hr.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")};var ui=function(){a.bindAll(["_updateLogo"],this),a.bindAll(["_updateCompact"],this)};ui.prototype.onAdd=function(c){this._map=c,this._container=g.create("div","mapboxgl-ctrl");var f=g.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},ui.prototype.onRemove=function(){g.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},ui.prototype.getDefaultPosition=function(){return"bottom-left"},ui.prototype._updateLogo=function(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},ui.prototype._logoRequired=function(){if(this._map.style){var c=this._map.style.sourceCaches;for(var f in c)if(c[f].getSource().mapbox_logo)return!0;return!1}},ui.prototype._updateCompact=function(){var c=this._container.children;if(c.length){var f=c[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var _u=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};_u.prototype.add=function(c){var f=++this._id;return this._queue.push({callback:c,id:f,cancelled:!1}),f},_u.prototype.remove=function(c){for(var f=this._currentlyRunning,h=0,m=f?this._queue.concat(f):this._queue;h<m.length;h+=1){var _=m[h];if(_.id===c)return void(_.cancelled=!0)}},_u.prototype.run=function(c){c===void 0&&(c=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,m=f;h<m.length;h+=1){var _=m[h];if(!_.cancelled&&(_.callback(c),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},_u.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Pc={"FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},wn=a.window.HTMLImageElement,Jr=a.window.HTMLElement,Is=a.window.ImageBitmap,xu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Mf=function(c){function f(m){var _=this;if((m=a.extend({},xu,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new ln(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies);if(c.call(this,w,m),this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new _u,this._controls=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Pc,m.locale),this._requestManager=new a.RequestManager(m.transformRequest,m.accessToken),typeof m.container=="string"){if(this._container=a.window.document.getElementById(m.container),!this._container)throw new Error("Container '"+m.container+"' not found.")}else{if(!(m.container instanceof Jr))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return _._update(!1)}),this.on("moveend",function(){return _._update(!1)}),this.on("zoom",function(){return _._update(!0)}),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1)),this.handlers=new Qn(this,m),this._hash=m.hash&&new ao(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,a.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new hr({customAttribution:m.customAttribution})),this.addControl(new ui,m.logoPosition),this.on("style.load",function(){_.transform.unmodified&&_.jumpTo(_.style.stylesheet)}),this.on("data",function(S){_._update(S.dataType==="style"),_.fire(new a.Event(S.dataType+"data",S))}),this.on("dataloading",function(S){_.fire(new a.Event(S.dataType+"dataloading",S))})}c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(m,_){if(_===void 0&&m.getDefaultPosition&&(_=m.getDefaultPosition()),_===void 0&&(_="top-right"),!m||!m.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=m.onAdd(this);this._controls.push(m);var S=this._controlPositions[_];return _.indexOf("bottom")!==-1?S.insertBefore(w,S.firstChild):S.appendChild(w),this},f.prototype.removeControl=function(m){if(!m||!m.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var _=this._controls.indexOf(m);return _>-1&&this._controls.splice(_,1),m.onRemove(this),this},f.prototype.resize=function(m){var _=this._containerDimensions(),w=_[0],S=_[1];this._resizeCanvas(w,S),this.transform.resize(w,S),this.painter.resize(w,S);var C=!this._moving;return C&&(this.stop(),this.fire(new a.Event("movestart",m)).fire(new a.Event("move",m))),this.fire(new a.Event("resize",m)),C&&this.fire(new a.Event("moveend",m)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(m){return this.transform.setMaxBounds(a.LngLatBounds.convert(m)),this._update()},f.prototype.setMinZoom=function(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(m){if((m=m??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(m){return this.transform.renderWorldCopies=m,this._update()},f.prototype.project=function(m){return this.transform.locationPoint(a.LngLat.convert(m))},f.prototype.unproject=function(m){return this.transform.pointLocation(a.Point.convert(m))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(m,_,w){var S,C=this;if(m==="mouseenter"||m==="mouseover"){var k=!1;return{layer:_,listener:w,delegates:{mousemove:function(V){var K=C.getLayer(_)?C.queryRenderedFeatures(V.point,{layers:[_]}):[];K.length?k||(k=!0,w.call(C,new $i(m,C,V.originalEvent,{features:K}))):k=!1},mouseout:function(){k=!1}}}}if(m==="mouseleave"||m==="mouseout"){var N=!1;return{layer:_,listener:w,delegates:{mousemove:function(V){(C.getLayer(_)?C.queryRenderedFeatures(V.point,{layers:[_]}):[]).length?N=!0:N&&(N=!1,w.call(C,new $i(m,C,V.originalEvent)))},mouseout:function(V){N&&(N=!1,w.call(C,new $i(m,C,V.originalEvent)))}}}}return{layer:_,listener:w,delegates:(S={},S[m]=function(V){var K=C.getLayer(_)?C.queryRenderedFeatures(V.point,{layers:[_]}):[];K.length&&(V.features=K,w.call(C,V),delete V.features)},S)}},f.prototype.on=function(m,_,w){if(w===void 0)return c.prototype.on.call(this,m,_);var S=this._createDelegatedListener(m,_,w);for(var C in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(S),S.delegates)this.on(C,S.delegates[C]);return this},f.prototype.once=function(m,_,w){if(w===void 0)return c.prototype.once.call(this,m,_);var S=this._createDelegatedListener(m,_,w);for(var C in S.delegates)this.once(C,S.delegates[C]);return this},f.prototype.off=function(m,_,w){var S=this;return w===void 0?c.prototype.off.call(this,m,_):(this._delegatedListeners&&this._delegatedListeners[m]&&function(C){for(var k=C[m],N=0;N<k.length;N++){var V=k[N];if(V.layer===_&&V.listener===w){for(var K in V.delegates)S.off(K,V.delegates[K]);return k.splice(N,1),S}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(m,_){if(!this.style)return[];var w;if(_!==void 0||m===void 0||m instanceof a.Point||Array.isArray(m)||(_=m,m=void 0),_=_||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof a.Point||typeof m[0]=="number")w=[a.Point.convert(m)];else{var S=a.Point.convert(m[0]),C=a.Point.convert(m[1]);w=[S,new a.Point(C.x,S.y),C,new a.Point(S.x,C.y),S]}return this.style.queryRenderedFeatures(w,_,this.transform)},f.prototype.querySourceFeatures=function(m,_){return this.style.querySourceFeatures(m,_)},f.prototype.setStyle=function(m,_){return(_=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},_)).diff!==!1&&_.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,_),this):(this._localIdeographFontFamily=_.localIdeographFontFamily,this._updateStyle(m,_))},f.prototype._getUIString=function(m){var _=this._locale[m];if(_==null)throw new Error("Missing UI string '"+m+"'");return _},f.prototype._updateStyle=function(m,_){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new pa(this,_||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new pa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(m,_){var w=this;if(typeof m=="string"){var S=this._requestManager.normalizeStyleURL(m),C=this._requestManager.transformRequest(S,a.ResourceType.Style);a.getJSON(C,function(k,N){k?w.fire(new a.ErrorEvent(k)):N&&w._updateDiff(N,_)})}else typeof m=="object"&&this._updateDiff(m,_)},f.prototype._updateDiff=function(m,_){try{this.style.setState(m)&&this._update(!0)}catch(w){a.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(m,_)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(m,_){return this._lazyInitEmptyStyle(),this.style.addSource(m,_),this._update(!0)},f.prototype.isSourceLoaded=function(m){var _=this.style&&this.style.sourceCaches[m];if(_!==void 0)return _.loaded();this.fire(new a.ErrorEvent(new Error("There is no source with ID '"+m+"'")))},f.prototype.areTilesLoaded=function(){var m=this.style&&this.style.sourceCaches;for(var _ in m){var w=m[_]._tiles;for(var S in w){var C=w[S];if(C.state!=="loaded"&&C.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(m,_,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,_,w)},f.prototype.removeSource=function(m){return this.style.removeSource(m),this._update(!0)},f.prototype.getSource=function(m){return this.style.getSource(m)},f.prototype.addImage=function(m,_,w){w===void 0&&(w={});var S=w.pixelRatio;S===void 0&&(S=1);var C=w.sdf;C===void 0&&(C=!1);var k=w.stretchX,N=w.stretchY,V=w.content;if(this._lazyInitEmptyStyle(),_ instanceof wn||Is&&_ instanceof Is){var K=a.browser.getImageData(_);this.style.addImage(m,{data:new a.RGBAImage({width:K.width,height:K.height},K.data),pixelRatio:S,stretchX:k,stretchY:N,content:V,sdf:C,version:0})}else{if(_.width===void 0||_.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var $=_;this.style.addImage(m,{data:new a.RGBAImage({width:_.width,height:_.height},new Uint8Array(_.data)),pixelRatio:S,stretchX:k,stretchY:N,content:V,sdf:C,version:0,userImage:$}),$.onAdd&&$.onAdd(this,m)}},f.prototype.updateImage=function(m,_){var w=this.style.getImage(m);if(!w)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var S=_ instanceof wn||Is&&_ instanceof Is?a.browser.getImageData(_):_,C=S.width,k=S.height,N=S.data;return C===void 0||k===void 0?this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):C!==w.data.width||k!==w.data.height?this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(N,!(_ instanceof wn||Is&&_ instanceof Is)),void this.style.updateImage(m,w))},f.prototype.hasImage=function(m){return m?!!this.style.getImage(m):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(m){this.style.removeImage(m)},f.prototype.loadImage=function(m,_){a.getImage(this._requestManager.transformRequest(m,a.ResourceType.Image),_)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(m,_){return this._lazyInitEmptyStyle(),this.style.addLayer(m,_),this._update(!0)},f.prototype.moveLayer=function(m,_){return this.style.moveLayer(m,_),this._update(!0)},f.prototype.removeLayer=function(m){return this.style.removeLayer(m),this._update(!0)},f.prototype.getLayer=function(m){return this.style.getLayer(m)},f.prototype.setLayerZoomRange=function(m,_,w){return this.style.setLayerZoomRange(m,_,w),this._update(!0)},f.prototype.setFilter=function(m,_,w){return w===void 0&&(w={}),this.style.setFilter(m,_,w),this._update(!0)},f.prototype.getFilter=function(m){return this.style.getFilter(m)},f.prototype.setPaintProperty=function(m,_,w,S){return S===void 0&&(S={}),this.style.setPaintProperty(m,_,w,S),this._update(!0)},f.prototype.getPaintProperty=function(m,_){return this.style.getPaintProperty(m,_)},f.prototype.setLayoutProperty=function(m,_,w,S){return S===void 0&&(S={}),this.style.setLayoutProperty(m,_,w,S),this._update(!0)},f.prototype.getLayoutProperty=function(m,_){return this.style.getLayoutProperty(m,_)},f.prototype.setLight=function(m,_){return _===void 0&&(_={}),this._lazyInitEmptyStyle(),this.style.setLight(m,_),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(m,_){return this.style.setFeatureState(m,_),this._update()},f.prototype.removeFeatureState=function(m,_){return this.style.removeFeatureState(m,_),this._update()},f.prototype.getFeatureState=function(m){return this.style.getFeatureState(m)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var m=0,_=0;return this._container&&(m=this._container.clientWidth||400,_=this._container.clientHeight||300),[m,_]},f.prototype._detectMissingCSS=function(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=g.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();var _=this._canvasContainer=g.create("div","mapboxgl-canvas-container",m);this._interactive&&_.classList.add("mapboxgl-interactive"),this._canvas=g.create("canvas","mapboxgl-canvas",_),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var S=this._controlContainer=g.create("div","mapboxgl-control-container",m),C=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(k){C[k]=g.create("div","mapboxgl-ctrl-"+k,S)})},f.prototype._resizeCanvas=function(m,_){var w=a.browser.devicePixelRatio||1;this._canvas.width=w*m,this._canvas.height=w*_,this._canvas.style.width=m+"px",this._canvas.style.height=_+"px"},f.prototype._setupPainter=function(){var m=a.extend({},d.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),_=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);_?(this.painter=new Bn(_,this.transform),a.webpSupported.testSupport(_)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:m}))},f.prototype._contextRestored=function(m){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:m}))},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(m){return this._update(),this._renderTaskQueue.add(m)},f.prototype._cancelRenderFrame=function(m){this._renderTaskQueue.remove(m)},f.prototype._render=function(m){var _,w=this,S=0,C=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(_=C.createQueryEXT(),C.beginQueryEXT(C.TIME_ELAPSED_EXT,_),S=a.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),!this._removed){var k=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var N=this.transform.zoom,V=a.browser.now();this.style.zoomHistory.update(N,V);var K=new a.EvaluationParameters(N,{now:V,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),$=K.crossFadingFactor();$===1&&$===this._crossFadingFactor||(k=!0,this._crossFadingFactor=$),this.style.update(K)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||k)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var ae=a.browser.now()-S;C.endQueryEXT(C.TIME_ELAPSED_EXT,_),setTimeout(function(){var ie=C.getQueryObjectEXT(_,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(_),w.fire(new a.Event("gpu-timing-frame",{cpuTime:ae,gpuTime:ie}))},50)}if(this.listens("gpu-timing-layer")){var se=this.painter.collectGpuTimers();setTimeout(function(){var ie=w.painter.queryGpuTimers(se);w.fire(new a.Event("gpu-timing-layer",{layerTimes:ie}))},50)}var fe=this._sourcesDirty||this._styleDirty||this._placementDirty;return fe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.Event("idle")),!this._loaded||this._fullyLoaded||fe||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var m=0,_=this._controls;m<_.length;m+=1)_[m].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),bu(this._canvasContainer),bu(this._controlContainer),bu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new a.Event("remove"))},f.prototype.triggerRepaint=function(){var m=this;this.style&&!this._frame&&(this._frame=a.browser.frame(function(_){m._frame=null,m._render(_)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(m){this._trackResize&&this.resize({originalEvent:m})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(m){this._showPadding!==m&&(this._showPadding=m,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(m){this._vertices=m,this._update()},f.prototype._setCacheLimits=function(m,_){a.setCacheLimits(m,_)},h.version.get=function(){return a.version},Object.defineProperties(f.prototype,h),f}(vu);function bu(c){c.parentNode&&c.parentNode.removeChild(c)}var kf={showCompass:!0,showZoom:!0,visualizePitch:!1},Li=function(c){var f=this;this.options=a.extend({},kf,c),this._container=g.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return f._map.zoomIn({},{originalEvent:h})}),g.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return f._map.zoomOut({},{originalEvent:h})}),g.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:h}):f._map.resetNorth({},{originalEvent:h})}),this._compassIcon=g.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Li.prototype._updateZoomButtons=function(){var c=this._map.getZoom();this._zoomInButton.disabled=c===this._map.getMaxZoom(),this._zoomOutButton.disabled=c===this._map.getMinZoom()},Li.prototype._rotateCompassArrow=function(){var c=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=c},Li.prototype.onAdd=function(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ri(this._map,this._compass,this.options.visualizePitch)),this._container},Li.prototype.onRemove=function(){g.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Li.prototype._createButton=function(c,f){var h=g.create("button",c,this._container);return h.type="button",h.addEventListener("click",f),h},Li.prototype._setButtonTitle=function(c,f){var h=this._map._getUIString("NavigationControl."+f);c.title=h,c.setAttribute("aria-label",h)};var Ri=function(c,f,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new Cf({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,h&&(this.mousePitch=new em({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),g.addEventListener(f,"mousedown",this.mousedown),g.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),g.addEventListener(f,"touchmove",this.touchmove),g.addEventListener(f,"touchend",this.touchend),g.addEventListener(f,"touchcancel",this.reset)};function Ac(c,f,h){if(c=new a.LngLat(c.lng,c.lat),f){var m=new a.LngLat(c.lng-360,c.lat),_=new a.LngLat(c.lng+360,c.lat),w=h.locationPoint(c).distSqr(f);h.locationPoint(m).distSqr(f)<w?c=m:h.locationPoint(_).distSqr(f)<w&&(c=_)}for(;Math.abs(c.lng-h.center.lng)>180;){var S=h.locationPoint(c);if(S.x>=0&&S.y>=0&&S.x<=h.width&&S.y<=h.height)break;c.lng>h.center.lng?c.lng-=360:c.lng+=360}return c}Ri.prototype.down=function(c,f){this.mouseRotate.mousedown(c,f),this.mousePitch&&this.mousePitch.mousedown(c,f),g.disableDrag()},Ri.prototype.move=function(c,f){var h=this.map,m=this.mouseRotate.mousemoveWindow(c,f);if(m&&m.bearingDelta&&h.setBearing(h.getBearing()+m.bearingDelta),this.mousePitch){var _=this.mousePitch.mousemoveWindow(c,f);_&&_.pitchDelta&&h.setPitch(h.getPitch()+_.pitchDelta)}},Ri.prototype.off=function(){var c=this.element;g.removeEventListener(c,"mousedown",this.mousedown),g.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),g.removeEventListener(c,"touchmove",this.touchmove),g.removeEventListener(c,"touchend",this.touchend),g.removeEventListener(c,"touchcancel",this.reset),this.offTemp()},Ri.prototype.offTemp=function(){g.enableDrag(),g.removeEventListener(a.window,"mousemove",this.mousemove),g.removeEventListener(a.window,"mouseup",this.mouseup)},Ri.prototype.mousedown=function(c){this.down(a.extend({},c,{ctrlKey:!0,preventDefault:function(){return c.preventDefault()}}),g.mousePos(this.element,c)),g.addEventListener(a.window,"mousemove",this.mousemove),g.addEventListener(a.window,"mouseup",this.mouseup)},Ri.prototype.mousemove=function(c){this.move(c,g.mousePos(this.element,c))},Ri.prototype.mouseup=function(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()},Ri.prototype.touchstart=function(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=g.touchPos(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return c.preventDefault()}},this._startPos))},Ri.prototype.touchmove=function(c){c.targetTouches.length!==1?this.reset():(this._lastPos=g.touchPos(this.element,c.targetTouches)[0],this.move({preventDefault:function(){return c.preventDefault()}},this._lastPos))},Ri.prototype.touchend=function(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ri.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var wu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Cc(c,f,h){var m=c.classList;for(var _ in wu)m.remove("mapboxgl-"+h+"-anchor-"+_);m.add("mapboxgl-"+h+"-anchor-"+f)}var Ms,Eu=function(c){function f(h,m){var _=this;if(c.call(this),(h instanceof a.window.HTMLElement||m)&&(h=a.extend({element:h},m)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=a.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=g.create("div"),this._element.setAttribute("aria-label","Map marker");var w=g.createNS("http://www.w3.org/2000/svg","svg");w.setAttributeNS(null,"display","block"),w.setAttributeNS(null,"height","41px"),w.setAttributeNS(null,"width","27px"),w.setAttributeNS(null,"viewBox","0 0 27 41");var S=g.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");var C=g.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");var k=g.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");for(var N=0,V=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];N<V.length;N+=1){var K=V[N],$=g.createNS("http://www.w3.org/2000/svg","ellipse");$.setAttributeNS(null,"opacity","0.04"),$.setAttributeNS(null,"cx","10.5"),$.setAttributeNS(null,"cy","5.80029008"),$.setAttributeNS(null,"rx",K.rx),$.setAttributeNS(null,"ry",K.ry),k.appendChild($)}var ae=g.createNS("http://www.w3.org/2000/svg","g");ae.setAttributeNS(null,"fill",this._color);var se=g.createNS("http://www.w3.org/2000/svg","path");se.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ae.appendChild(se);var fe=g.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"opacity","0.25"),fe.setAttributeNS(null,"fill","#000000");var ie=g.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),fe.appendChild(ie);var he=g.createNS("http://www.w3.org/2000/svg","g");he.setAttributeNS(null,"transform","translate(6.0, 7.0)"),he.setAttributeNS(null,"fill","#FFFFFF");var ve=g.createNS("http://www.w3.org/2000/svg","g");ve.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Te=g.createNS("http://www.w3.org/2000/svg","circle");Te.setAttributeNS(null,"fill","#000000"),Te.setAttributeNS(null,"opacity","0.25"),Te.setAttributeNS(null,"cx","5.5"),Te.setAttributeNS(null,"cy","5.5"),Te.setAttributeNS(null,"r","5.4999962");var Le=g.createNS("http://www.w3.org/2000/svg","circle");Le.setAttributeNS(null,"fill","#FFFFFF"),Le.setAttributeNS(null,"cx","5.5"),Le.setAttributeNS(null,"cy","5.5"),Le.setAttributeNS(null,"r","5.4999962"),ve.appendChild(Te),ve.appendChild(Le),C.appendChild(k),C.appendChild(ae),C.appendChild(fe),C.appendChild(he),C.appendChild(ve),w.appendChild(C),w.setAttributeNS(null,"height",41*this._scale+"px"),w.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(w),this._offset=a.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ae){Ae.preventDefault()}),this._element.addEventListener("mousedown",function(Ae){Ae.preventDefault()}),this._element.addEventListener("focus",function(){var Ae=_._map.getContainer();Ae.scrollTop=0,Ae.scrollLeft=0}),Cc(this._element,this._anchor,"marker"),this._popup=null}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),g.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(h){return this._lngLat=a.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var m=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(h){var m=h.code,_=h.charCode||h.keyCode;m!=="Space"&&m!=="Enter"&&_!==32&&_!==13||this.togglePopup()},f.prototype._onMapClick=function(h){var m=h.originalEvent.target,_=this._element;this._popup&&(m===_||_.contains(m))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},f.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ac(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(m="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),g.setTransform(this._element,wu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+_+" "+m)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(h){return this._offset=a.Point.convert(h),this._update(),this},f.prototype._onMove=function(h){this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(a.Evented),Lf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Xo=0,ks=!1,Rf=function(c){function f(h){c.call(this),this.options=a.extend({},Lf,h),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.onAdd=function(h){var m;return this._map=h,this._container=g.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),m=this._setupUI,Ms!==void 0?m(Ms):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(function(_){m(Ms=_.state!=="denied")}):m(Ms=!!a.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),g.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Xo=0,ks=!1},f.prototype._isOutOfMapMaxBounds=function(h){var m=this._map.getMaxBounds(),_=h.coords;return m&&(_.longitude<m.getWest()||_.longitude>m.getEast()||_.latitude<m.getSouth()||_.latitude>m.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",h)),this._finish()}},f.prototype._updateCamera=function(h){var m=new a.LngLat(h.coords.longitude,h.coords.latitude),_=h.coords.accuracy,w=this._map.getBearing(),S=a.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(m.toBounds(_),S,{geolocateSource:!0})},f.prototype._updateMarker=function(h){if(h){var m=new a.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,m=this._map.unproject([0,h]),_=this._map.unproject([1,h]),w=m.distanceTo(_),S=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=S+"px",this._circleElement.style.height=S+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&ks)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",h)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(h){var m=this;if(this._container.addEventListener("contextmenu",function(S){return S.preventDefault()}),this._geolocateButton=g.create("button","mapboxgl-ctrl-geolocate",this._container),g.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var _=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=_,this._geolocateButton.setAttribute("aria-label",_)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=g.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Eu(this._dotElement),this._circleElement=g.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Eu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(S){S.geolocateSource||m._watchState!=="ACTIVE_LOCK"||S.originalEvent&&S.originalEvent.type==="resize"||(m._watchState="BACKGROUND",m._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),m._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),m.fire(new a.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Xo--,ks=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Xo>1?(h={maximumAge:6e5,timeout:0},ks=!0):(h=this.options.positionOptions,ks=!1),this._geolocationWatchID=a.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else a.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(a.Evented),Ic={maxWidth:100,unit:"metric"},qa=function(c){this.options=a.extend({},Ic,c),a.bindAll(["_onMove","setUnit"],this)};function Mc(c,f,h){var m=h&&h.maxWidth||100,_=c._container.clientHeight/2,w=c.unproject([0,_]),S=c.unproject([m,_]),C=w.distanceTo(S);if(h&&h.unit==="imperial"){var k=3.2808*C;k>5280?xa(f,m,k/5280,c._getUIString("ScaleControl.Miles")):xa(f,m,k,c._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?xa(f,m,C/1852,c._getUIString("ScaleControl.NauticalMiles")):C>=1e3?xa(f,m,C/1e3,c._getUIString("ScaleControl.Kilometers")):xa(f,m,C,c._getUIString("ScaleControl.Meters"))}function xa(c,f,h,m){var _,w,S,C=(_=h,(w=Math.pow(10,(""+Math.floor(_)).length-1))*(S=(S=_/w)>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(k){var N=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*N)/N}(S)));c.style.width=f*(C/h)+"px",c.innerHTML=C+"&nbsp;"+m}qa.prototype.getDefaultPosition=function(){return"bottom-left"},qa.prototype._onMove=function(){Mc(this._map,this._container,this.options)},qa.prototype.onAdd=function(c){return this._map=c,this._container=g.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},qa.prototype.onRemove=function(){g.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},qa.prototype.setUnit=function(c){this.options.unit=c,Mc(this._map,this._container,this.options)};var lo=function(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof a.window.HTMLElement?this._container=c.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in a.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in a.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in a.window.document&&(this._fullscreenchange="MSFullscreenChange")};lo.prototype.onAdd=function(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=g.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},lo.prototype.onRemove=function(){g.remove(this._controlContainer),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},lo.prototype._checkFullscreenSupport=function(){return!!(a.window.document.fullscreenEnabled||a.window.document.mozFullScreenEnabled||a.window.document.msFullscreenEnabled||a.window.document.webkitFullscreenEnabled)},lo.prototype._setupUI=function(){var c=this._fullscreenButton=g.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);g.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},lo.prototype._updateTitle=function(){var c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c},lo.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},lo.prototype._isFullscreen=function(){return this._fullscreen},lo.prototype._changeIcon=function(){(a.window.document.fullscreenElement||a.window.document.mozFullScreenElement||a.window.document.webkitFullscreenElement||a.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},lo.prototype._onClickFullscreen=function(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.mozCancelFullScreen?a.window.document.mozCancelFullScreen():a.window.document.msExitFullscreen?a.window.document.msExitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var kc={closeButton:!0,closeOnClick:!0,className:"",maxWidth:"240px"},Of=function(c){function f(h){c.call(this),this.options=a.extend(Object.create(kc),h),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return c&&(f.__proto__=c),(f.prototype=Object.create(c&&c.prototype)).constructor=f,f.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&g.remove(this._content),this._container&&(g.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(h){return this._lngLat=a.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(h){return this.setDOMContent(a.window.document.createTextNode(h))},f.prototype.setHTML=function(h){var m,_=a.window.document.createDocumentFragment(),w=a.window.document.createElement("body");for(w.innerHTML=h;m=w.firstChild;)_.appendChild(m);return this.setDOMContent(_)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},f.prototype.setDOMContent=function(h){return this._createContent(),this._content.appendChild(h),this._update(),this},f.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},f.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},f.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},f.prototype._createContent=function(){this._content&&g.remove(this._content),this._content=g.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=g.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(h){this._update(h.point)},f.prototype._onMouseMove=function(h){this._update(h.point)},f.prototype._onDrag=function(h){this._update(h.point)},f.prototype._update=function(h){var m=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=g.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=g.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(K){return m._container.classList.add(K)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ac(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var _=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),w=this.options.anchor,S=function K($){if($){if(typeof $=="number"){var ae=Math.round(Math.sqrt(.5*Math.pow($,2)));return{center:new a.Point(0,0),top:new a.Point(0,$),"top-left":new a.Point(ae,ae),"top-right":new a.Point(-ae,ae),bottom:new a.Point(0,-$),"bottom-left":new a.Point(ae,-ae),"bottom-right":new a.Point(-ae,-ae),left:new a.Point($,0),right:new a.Point(-$,0)}}if($ instanceof a.Point||Array.isArray($)){var se=a.Point.convert($);return{center:se,top:se,"top-left":se,"top-right":se,bottom:se,"bottom-left":se,"bottom-right":se,left:se,right:se}}return{center:a.Point.convert($.center||[0,0]),top:a.Point.convert($.top||[0,0]),"top-left":a.Point.convert($["top-left"]||[0,0]),"top-right":a.Point.convert($["top-right"]||[0,0]),bottom:a.Point.convert($.bottom||[0,0]),"bottom-left":a.Point.convert($["bottom-left"]||[0,0]),"bottom-right":a.Point.convert($["bottom-right"]||[0,0]),left:a.Point.convert($.left||[0,0]),right:a.Point.convert($.right||[0,0])}}return K(new a.Point(0,0))}(this.options.offset);if(!w){var C,k=this._container.offsetWidth,N=this._container.offsetHeight;C=_.y+S.bottom.y<N?["top"]:_.y>this._map.transform.height-N?["bottom"]:[],_.x<k/2?C.push("left"):_.x>this._map.transform.width-k/2&&C.push("right"),w=C.length===0?"bottom":C.join("-")}var V=_.add(S[w]).round();g.setTransform(this._container,wu[w]+" translate("+V.x+"px,"+V.y+"px)"),Cc(this._container,w,"popup")}},f.prototype._onClose=function(){this.remove()},f}(a.Evented),zf={version:a.version,supported:d,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:Mf,NavigationControl:Li,GeolocateControl:Rf,AttributionControl:hr,ScaleControl:qa,FullscreenControl:lo,Popup:Of,Marker:Eu,Style:pa,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.Point,MercatorCoordinate:a.MercatorCoordinate,Evented:a.Evented,config:a.config,prewarm:function(){Ye().acquire(Oe)},clearPrewarmedResources:function(){var c=ke;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(Oe),ke=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(c){a.config.ACCESS_TOKEN=c},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(c){a.config.API_URL=c},get workerCount(){return qe.workerCount},set workerCount(c){qe.workerCount=c},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){a.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage:function(c){a.clearTileCache(c)},workerUrl:""};return zf}),o})})(N3);const Ks=$0;var B3=1e-7;function X0(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function wC(t,e){if(t===e)return!0;if(X0(t)&&X0(e)){if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!wC(t[n],e[n]))return!1;return!0}return Math.abs(t-e)<=B3}function Ym(t,e,n){return Math.max(e,Math.min(n,t))}function uy(t,e,n){return X0(t)?t.map(function(r,o){return uy(r,e[o],n)}):n*e+(1-n)*t}function Qi(t,e){if(!t)throw new Error(e||"react-map-gl: assertion failed.")}function U3(t){if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(t=V3(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(g){throw g},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,o=!0,l=!1,a;return{s:function(){r=t[Symbol.iterator]()},n:function(){var g=r.next();return o=g.done,g},e:function(g){l=!0,a=g},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw a}}}}function V3(t,e){if(t){if(typeof t=="string")return uT(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return uT(t,e)}}function uT(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var EC=function(){function t(){Gn(this,t),me(this,"propNames",[])}return Nn(t,[{key:"arePropsEqual",value:function(n,r){var o=U3(this.propNames||[]),l;try{for(o.s();!(l=o.n()).done;){var a=l.value;if(!wC(n[a],r[a]))return!1}}catch(d){o.e(d)}finally{o.f()}return!0}},{key:"initializeProps",value:function(n,r){return{start:n,end:r}}},{key:"interpolateProps",value:function(n,r,o){Qi(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(n,r){return r.transitionDuration}}]),t}(),j3={longitude:1,bearing:1};function cy(t){return Number.isFinite(t)||Array.isArray(t)}function G3(t){return t in j3}function Y0(t,e,n){return G3(t)&&Math.abs(n-e)>180&&(n=n<0?n+360:n-360),n}function h_(t){if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(t=W3(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(g){throw g},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,o=!0,l=!1,a;return{s:function(){r=t[Symbol.iterator]()},n:function(){var g=r.next();return o=g.done,g},e:function(g){l=!0,a=g},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw a}}}}function W3(t,e){if(t){if(typeof t=="string")return cT(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cT(t,e)}}function cT(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function H3(t){var e=q3();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function q3(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Z3=["longitude","latitude","zoom","bearing","pitch"],$3=["latitude","longitude","zoom","width","height"],hT=["bearing","pitch"],X3={speed:1.2,curve:1.414};(function(t){Ci(n,t);var e=H3(n);function n(){var r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Gn(this,n),r=e.call(this),me(ot(r),"speed",void 0),me(ot(r),"propNames",Z3),me(ot(r),"props",void 0),r.props=Object.assign({},X3,o),r}return Nn(n,[{key:"initializeProps",value:function(o,l){var a={},d={},g=h_($3),x;try{for(g.s();!(x=g.n()).done;){var E=x.value,P=o[E],A=l[E];Qi(cy(P)&&cy(A),"".concat(E," must be supplied for transition")),a[E]=P,d[E]=Y0(E,P,A)}}catch(W){g.e(W)}finally{g.f()}var R=h_(hT),j;try{for(R.s();!(j=R.n()).done;){var X=j.value,D=o[X]||0,F=l[X]||0;a[X]=D,d[X]=Y0(X,D,F)}}catch(W){R.e(W)}finally{R.f()}return{start:a,end:d}}},{key:"interpolateProps",value:function(o,l,a){var d=C3(o,l,a,this.props),g=h_(hT),x;try{for(g.s();!(x=g.n()).done;){var E=x.value;d[E]=uy(o[E],l[E],a)}}catch(P){g.e(P)}finally{g.f()}return d}},{key:"getDuration",value:function(o,l){var a=l.transitionDuration;return a==="auto"&&(a=I3(o,l,this.props)),a}}]),n})(EC);function fT(t){if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(t=Y3(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(g){throw g},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,o=!0,l=!1,a;return{s:function(){r=t[Symbol.iterator]()},n:function(){var g=r.next();return o=g.done,g},e:function(g){l=!0,a=g},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(l)throw a}}}}function Y3(t,e){if(t){if(typeof t=="string")return pT(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pT(t,e)}}function pT(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function K3(t){var e=J3();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function J3(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Q3=["longitude","latitude","zoom","bearing","pitch"],Rx=function(t){Ci(n,t);var e=K3(n);function n(){var r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Gn(this,n),r=e.call(this),me(ot(r),"around",void 0),Array.isArray(o)&&(o={transitionProps:o}),r.propNames=o.transitionProps||Q3,o.around&&(r.around=o.around),r}return Nn(n,[{key:"initializeProps",value:function(o,l){var a={},d={};if(this.around){a.around=this.around;var g=new ia(o).unproject(this.around);Object.assign(d,l,{around:new ia(l).project(g),aroundLngLat:g})}var x=fT(this.propNames),E;try{for(x.s();!(E=x.n()).done;){var P=E.value,A=o[P],R=l[P];Qi(cy(A)&&cy(R),"".concat(P," must be supplied for transition")),a[P]=A,d[P]=Y0(P,A,R)}}catch(j){x.e(j)}finally{x.f()}return{start:a,end:d}}},{key:"interpolateProps",value:function(o,l,a){var d={},g=fT(this.propNames),x;try{for(g.s();!(x=g.n()).done;){var E=x.value;d[E]=uy(o[E],l[E],a)}}catch(X){g.e(X)}finally{g.f()}if(l.around){var P=new ia(Object.assign({},l,d)).getMapCenterByLngLatPosition({lngLat:l.aroundLngLat,pos:uy(o.around,l.around,a)}),A=Hr(P,2),R=A[0],j=A[1];d.longitude=R,d.latitude=j}return d}}]),n}(EC),Gu={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},f_={pitch:0,bearing:0,altitude:1.5},ed=function(){function t(e){var n=e.width,r=e.height,o=e.latitude,l=e.longitude,a=e.zoom,d=e.bearing,g=d===void 0?f_.bearing:d,x=e.pitch,E=x===void 0?f_.pitch:x,P=e.altitude,A=P===void 0?f_.altitude:P,R=e.maxZoom,j=R===void 0?Gu.maxZoom:R,X=e.minZoom,D=X===void 0?Gu.minZoom:X,F=e.maxPitch,W=F===void 0?Gu.maxPitch:F,J=e.minPitch,le=J===void 0?Gu.minPitch:J,ue=e.transitionDuration,ye=e.transitionEasing,Ee=e.transitionInterpolator,Pe=e.transitionInterruption,we=e.startPanLngLat,ze=e.startZoomLngLat,Fe=e.startBearing,Be=e.startPitch,He=e.startZoom;Gn(this,t),me(this,"_viewportProps",void 0),me(this,"_interactiveState",void 0),Qi(Number.isFinite(n),"`width` must be supplied"),Qi(Number.isFinite(r),"`height` must be supplied"),Qi(Number.isFinite(l),"`longitude` must be supplied"),Qi(Number.isFinite(o),"`latitude` must be supplied"),Qi(Number.isFinite(a),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:n,height:r,latitude:o,longitude:l,zoom:a,bearing:g,pitch:E,altitude:A,maxZoom:j,minZoom:D,maxPitch:W,minPitch:le,transitionDuration:ue,transitionEasing:ye,transitionInterpolator:Ee,transitionInterruption:Pe}),this._interactiveState={startPanLngLat:we,startZoomLngLat:ze,startBearing:Fe,startPitch:Be,startZoom:He}}return Nn(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(n){var r=n.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(r)})}},{key:"pan",value:function(n){var r=n.pos,o=n.startPos,l=this._interactiveState.startPanLngLat||this._unproject(o);if(!l)return this;var a=this._calculateNewLngLat({startPanLngLat:l,pos:r}),d=Hr(a,2),g=d[0],x=d[1];return this._getUpdatedMapState({longitude:g,latitude:x})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(n){return n.pos,this._getUpdatedMapState({startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(n){var r=n.deltaScaleX,o=r===void 0?0:r,l=n.deltaScaleY,a=l===void 0?0:l,d=this._interactiveState,g=d.startBearing,x=d.startPitch;if(!Number.isFinite(g)||!Number.isFinite(x))return this;var E=this._calculateNewPitchAndBearing({deltaScaleX:o,deltaScaleY:a,startBearing:g||0,startPitch:x||0}),P=E.pitch,A=E.bearing;return this._getUpdatedMapState({bearing:A,pitch:P})}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(n){var r=n.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(r),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(n){var r=n.pos,o=n.startPos,l=n.scale;Qi(l>0,"`scale` must be a positive number");var a=this._interactiveState,d=a.startZoom,g=a.startZoomLngLat;Number.isFinite(d)||(d=this._viewportProps.zoom,g=this._unproject(o)||this._unproject(r)),Qi(g,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var x=this._calculateNewZoom({scale:l,startZoom:d||0}),E=new ia(Object.assign({},this._viewportProps,{zoom:x})),P=E.getMapCenterByLngLatPosition({lngLat:g,pos:r}),A=Hr(P,2),R=A[0],j=A[1];return this._getUpdatedMapState({zoom:x,longitude:R,latitude:j})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(n){return new t(Object.assign({},this._viewportProps,this._interactiveState,n))}},{key:"_applyConstraints",value:function(n){var r=n.maxZoom,o=n.minZoom,l=n.zoom;n.zoom=Ym(l,o,r);var a=n.maxPitch,d=n.minPitch,g=n.pitch;return n.pitch=Ym(g,d,a),Object.assign(n,P3(n)),n}},{key:"_unproject",value:function(n){var r=new ia(this._viewportProps);return n&&r.unproject(n)}},{key:"_calculateNewLngLat",value:function(n){var r=n.startPanLngLat,o=n.pos,l=new ia(this._viewportProps);return l.getMapCenterByLngLatPosition({lngLat:r,pos:o})}},{key:"_calculateNewZoom",value:function(n){var r=n.scale,o=n.startZoom,l=this._viewportProps,a=l.maxZoom,d=l.minZoom,g=o+Math.log2(r);return Ym(g,d,a)}},{key:"_calculateNewPitchAndBearing",value:function(n){var r=n.deltaScaleX,o=n.deltaScaleY,l=n.startBearing,a=n.startPitch;o=Ym(o,-1,1);var d=this._viewportProps,g=d.minPitch,x=d.maxPitch,E=l+180*r,P=a;return o>0?P=a+o*(x-a):o<0&&(P=a-o*(g-a)),{pitch:P,bearing:E}}}]),t}();function ez(t){return t[0].toLowerCase()+t.slice(1)}function tz(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gu;for(var n in e){var r=n.slice(0,3),o=ez(n.slice(3));if(r==="min"&&t[o]<e[n]||r==="max"&&t[o]>e[n])return!1}return!0}const Gh=st.createContext({viewport:null,map:null,mapContainer:null,onViewportChange:null,onViewStateChange:null,eventManager:null,isDragging:!1});function dT(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function dp(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?dT(Object(n),!0).forEach(function(r){me(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dT(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function nz(t){var e=rz();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function rz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var iz="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",oz="A valid API access token is required to use Mapbox data";function az(){}var sz=401,mT={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},lz=Object.assign({},fc.propTypes,{width:De.oneOfType([De.number,De.string]),height:De.oneOfType([De.number,De.string]),onResize:De.func,preventStyleDiffing:De.bool,disableTokenWarning:De.bool,visible:De.bool,className:De.string,style:De.object,visibilityConstraints:De.object}),uz=Object.assign({},fc.defaultProps,{preventStyleDiffing:!1,disableTokenWarning:!1,visible:!0,onResize:az,className:"",style:null,visibilityConstraints:Gu}),ic=function(t){Ci(n,t);var e=nz(n);function n(){var r;Gn(this,n);for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return r=e.call.apply(e,[this].concat(l)),me(ot(r),"state",{accessTokenInvalid:!1}),me(ot(r),"_mapbox",null),me(ot(r),"_map",null),me(ot(r),"_mapboxMapRef",st.createRef()),me(ot(r),"_mapContainerRef",st.createRef()),me(ot(r),"_queryParams",{}),me(ot(r),"_width",0),me(ot(r),"_height",0),me(ot(r),"getMap",function(){return r._map}),me(ot(r),"queryRenderedFeatures",function(d){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r._map.queryRenderedFeatures(d,g)}),me(ot(r),"_mapboxMapError",function(d){var g=d.error&&d.error.status||d.status;g===sz&&!r.state.accessTokenInvalid&&(console.error(oz),r.setState({accessTokenInvalid:!0})),r.props.onError(d)}),r}return Nn(n,[{key:"componentDidMount",value:function(){if(n.supported()){var o=this.props.mapStyle;this._mapbox=new fc(Object.assign({},this.props,{mapboxgl:Ks,width:this._width,height:this._height,container:this._mapboxMapRef.current,onError:this._mapboxMapError,mapStyle:KE(o)})),this._map=this._mapbox.getMap()}}},{key:"componentDidUpdate",value:function(o){this._mapbox&&(this._updateMapStyle(o,this.props),this._updateMapProps(this.props))}},{key:"componentWillUnmount",value:function(){this._mapbox&&(this._mapbox.finalize(),this._mapbox=null,this._map=null)}},{key:"_updateMapSize",value:function(o,l){(this._width!==o||this._height!==l)&&(this._width=o,this._height=l,this._updateMapProps(this.props))}},{key:"_updateMapStyle",value:function(o,l){var a=l.mapStyle,d=o.mapStyle;a!==d&&a&&this._map.setStyle(KE(a),{diff:!this.props.preventStyleDiffing})}},{key:"_updateMapProps",value:function(o){this._mapbox&&this._mapbox.setProps(Object.assign({},o,{width:this._width,height:this._height}))}},{key:"_renderNoTokenWarning",value:function(){if(this.state.accessTokenInvalid&&!this.props.disableTokenWarning){var o={position:"absolute",left:0,top:0};return st.createElement("div",{key:"warning",id:"no-token-warning",style:o},st.createElement("h3",{key:"header"},"NO_TOKEN_WARNING"),st.createElement("div",{key:"text"},"For information on setting up your basemap, read"),st.createElement("a",{key:"link",href:iz},"Note on Map Tokens"))}return null}},{key:"_renderOverlays",value:function(o){var l=this,a=o.width,d=a===void 0?Number(this.props.width):a,g=o.height,x=g===void 0?Number(this.props.height):g;return this._updateMapSize(d,x),st.createElement(Gh.Consumer,null,function(E){var P=dp(dp({},E),{},{viewport:new ia(dp(dp(dp({},l.props),l.props.viewState),{},{width:d,height:x})),map:l._map,mapContainer:E.mapContainer||l._mapContainerRef.current});return st.createElement(Gh.Provider,{value:P},st.createElement("div",{key:"map-overlays",className:"overlays",style:mT},l.props.children))})}},{key:"render",value:function(){var o=this.props,l=o.className,a=o.width,d=o.height,g=o.style,x=o.visibilityConstraints,E=Object.assign({position:"relative"},g,{width:a,height:d}),P=this.props.visible&&tz(this.props.viewState||this.props,x),A=Object.assign({},mT,{visibility:P?"inherit":"hidden"});return st.createElement("div",{key:"map-container",style:E,ref:this._mapContainerRef},st.createElement("div",{key:"map-mapbox",ref:this._mapboxMapRef,style:A,className:l}),st.createElement(xC,{key:"autosizer",disableWidth:Number.isFinite(a),disableHeight:Number.isFinite(d),onResize:this.props.onResize},this._renderOverlays.bind(this)),this._renderNoTokenWarning())}}],[{key:"supported",value:function(){return Ks&&Ks.supported()}}]),n}(st.PureComponent);me(ic,"propTypes",lz);me(ic,"defaultProps",uz);var mp=function(){};function cz(t,e){var n=t(e);return function(r){return 1/(1-n)*(t(r*(1-e)+e)-n)}}var Fp={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},hz={transitionDuration:0,transitionEasing:function(e){return e},transitionInterpolator:new Rx,transitionInterruption:Fp.BREAK,onTransitionStart:mp,onTransitionInterrupt:mp,onTransitionEnd:mp,onViewportChange:mp,onStateChange:mp},Ky=function(){function t(e,n){var r=this;Gn(this,t),me(this,"props",void 0),me(this,"state",void 0),me(this,"time",void 0),me(this,"_animationFrame",null),me(this,"_onTransitionFrame",function(){r._animationFrame=requestAnimationFrame(r._onTransitionFrame),r._updateViewport()}),e&&(this.props=e),this.time=n||Date.now}return Nn(t,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(n){var r=this.props;if(this.props=n,this._shouldIgnoreViewportChange(r,n))return!1;if(this._isTransitionEnabled(n)){var o=Object.assign({},r),l=Object.assign({},n);if(this._isTransitionInProgress()&&(r.onTransitionInterrupt(),this.state.interruption===Fp.SNAP_TO_END?Object.assign(o,this.state.endProps):Object.assign(o,this.state.propsInTransition),this.state.interruption===Fp.UPDATE)){var a=this.time(),d=(a-this.state.startTime)/this.state.duration;l.transitionDuration=this.state.duration-(a-this.state.startTime),l.transitionEasing=cz(this.state.easing,d),l.transitionInterpolator=o.transitionInterpolator}return l.onTransitionStart(),this._triggerTransition(o,l),!0}return this._isTransitionInProgress()&&(r.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return Boolean(this._animationFrame)}},{key:"_isTransitionEnabled",value:function(n){var r=n.transitionDuration,o=n.transitionInterpolator;return(r>0||r==="auto")&&Boolean(o)}},{key:"_isUpdateDueToCurrentTransition",value:function(n){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(n,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(n,r){return n?this._isTransitionInProgress()?this.state.interruption===Fp.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(n,r):!0:!0}},{key:"_triggerTransition",value:function(n,r){Qi(this._isTransitionEnabled(r)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var o=r.transitionInterpolator,l=o.getDuration?o.getDuration(n,r):r.transitionDuration;if(l!==0){var a=r.transitionInterpolator.initializeProps(n,r),d={inTransition:!0,isZooming:n.zoom!==r.zoom,isPanning:n.longitude!==r.longitude||n.latitude!==r.latitude,isRotating:n.bearing!==r.bearing||n.pitch!==r.pitch};this.state={duration:l,easing:r.transitionEasing,interpolator:r.transitionInterpolator,interruption:r.transitionInterruption,startTime:this.time(),startProps:a.start,endProps:a.end,animation:null,propsInTransition:{},interactionState:d},this._onTransitionFrame(),this.props.onStateChange(d)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.props.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var n=this.time(),r=this.state,o=r.startTime,l=r.duration,a=r.easing,d=r.interpolator,g=r.startProps,x=r.endProps,E=!1,P=(n-o)/l;P>=1&&(P=1,E=!0),P=a(P);var A=d.interpolateProps(g,x,P),R=new ed(Object.assign({},this.props,A));this.state.propsInTransition=R.getViewportProps(),this.props.onViewportChange(this.state.propsInTransition,this.state.interactionState,this.props),E&&(this._endTransition(),this.props.onTransitionEnd())}}]),t}();me(Ky,"defaultProps",hz);var oc={},fz={get exports(){return oc},set exports(t){oc=t}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,o){var l=["","webkit","Moz","MS","ms","o"],a=n.createElement("div"),d="function",g=Math.round,x=Math.abs,E=Date.now;function P(q,Q,de){return setTimeout(J(q,de),Q)}function A(q,Q,de){return Array.isArray(q)?(R(q,de[Q],de),!0):!1}function R(q,Q,de){var Ce;if(q)if(q.forEach)q.forEach(Q,de);else if(q.length!==o)for(Ce=0;Ce<q.length;)Q.call(de,q[Ce],Ce,q),Ce++;else for(Ce in q)q.hasOwnProperty(Ce)&&Q.call(de,q[Ce],Ce,q)}function j(q,Q,de){var Ce="DEPRECATED METHOD: "+Q+`
`+de+` AT 
`;return function(){var Ke=new Error("get-stack-trace"),ct=Ke&&Ke.stack?Ke.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",tn=e.console&&(e.console.warn||e.console.log);return tn&&tn.call(e.console,Ce,ct),q.apply(this,arguments)}}var X;typeof Object.assign!="function"?X=function(Q){if(Q===o||Q===null)throw new TypeError("Cannot convert undefined or null to object");for(var de=Object(Q),Ce=1;Ce<arguments.length;Ce++){var Ke=arguments[Ce];if(Ke!==o&&Ke!==null)for(var ct in Ke)Ke.hasOwnProperty(ct)&&(de[ct]=Ke[ct])}return de}:X=Object.assign;var D=j(function(Q,de,Ce){for(var Ke=Object.keys(de),ct=0;ct<Ke.length;)(!Ce||Ce&&Q[Ke[ct]]===o)&&(Q[Ke[ct]]=de[Ke[ct]]),ct++;return Q},"extend","Use `assign`."),F=j(function(Q,de){return D(Q,de,!0)},"merge","Use `assign`.");function W(q,Q,de){var Ce=Q.prototype,Ke;Ke=q.prototype=Object.create(Ce),Ke.constructor=q,Ke._super=Ce,de&&X(Ke,de)}function J(q,Q){return function(){return q.apply(Q,arguments)}}function le(q,Q){return typeof q==d?q.apply(Q&&Q[0]||o,Q):q}function ue(q,Q){return q===o?Q:q}function ye(q,Q,de){R(ze(Q),function(Ce){q.addEventListener(Ce,de,!1)})}function Ee(q,Q,de){R(ze(Q),function(Ce){q.removeEventListener(Ce,de,!1)})}function Pe(q,Q){for(;q;){if(q==Q)return!0;q=q.parentNode}return!1}function we(q,Q){return q.indexOf(Q)>-1}function ze(q){return q.trim().split(/\s+/g)}function Fe(q,Q,de){if(q.indexOf&&!de)return q.indexOf(Q);for(var Ce=0;Ce<q.length;){if(de&&q[Ce][de]==Q||!de&&q[Ce]===Q)return Ce;Ce++}return-1}function Be(q){return Array.prototype.slice.call(q,0)}function He(q,Q,de){for(var Ce=[],Ke=[],ct=0;ct<q.length;){var tn=Q?q[ct][Q]:q[ct];Fe(Ke,tn)<0&&Ce.push(q[ct]),Ke[ct]=tn,ct++}return de&&(Q?Ce=Ce.sort(function(Ur,Yr){return Ur[Q]>Yr[Q]}):Ce=Ce.sort()),Ce}function We(q,Q){for(var de,Ce,Ke=Q[0].toUpperCase()+Q.slice(1),ct=0;ct<l.length;){if(de=l[ct],Ce=de?de+Ke:Q,Ce in q)return Ce;ct++}return o}var _t=1;function gn(){return _t++}function pn(q){var Q=q.ownerDocument||q;return Q.defaultView||Q.parentWindow||e}var $n=/mobile|tablet|ip(ad|hone|od)|android/i,Tn="ontouchstart"in e,lr=We(e,"PointerEvent")!==o,Jt=Tn&&$n.test(navigator.userAgent),dn="touch",An="pen",et="mouse",yt="kinect",Qt=25,Pt=1,Nt=2,qt=4,yn=8,ai=1,Kn=2,Wt=4,Jn=8,Zr=16,mi=Kn|Wt,gi=Jn|Zr,Go=mi|gi,yi=["x","y"],Hi=["clientX","clientY"];function $r(q,Q){var de=this;this.manager=q,this.callback=Q,this.element=q.element,this.target=q.options.inputTarget,this.domHandler=function(Ce){le(q.options.enable,[q])&&de.handler(Ce)},this.init()}$r.prototype={handler:function(){},init:function(){this.evEl&&ye(this.element,this.evEl,this.domHandler),this.evTarget&&ye(this.target,this.evTarget,this.domHandler),this.evWin&&ye(pn(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ee(this.element,this.evEl,this.domHandler),this.evTarget&&Ee(this.target,this.evTarget,this.domHandler),this.evWin&&Ee(pn(this.element),this.evWin,this.domHandler)}};function Mi(q){var Q,de=q.options.inputClass;return de?Q=de:lr?Q=fa:Jt?Q=Z:Tn?Q=_e:Q=ha,new Q(q,vi)}function vi(q,Q,de){var Ce=de.pointers.length,Ke=de.changedPointers.length,ct=Q&Pt&&Ce-Ke===0,tn=Q&(qt|yn)&&Ce-Ke===0;de.isFirst=!!ct,de.isFinal=!!tn,ct&&(q.session={}),de.eventType=Q,ua(q,de),q.emit("hammer.input",de),q.recognize(de),q.session.prevInput=de}function ua(q,Q){var de=q.session,Ce=Q.pointers,Ke=Ce.length;de.firstInput||(de.firstInput=ol(Q)),Ke>1&&!de.firstMultiple?de.firstMultiple=ol(Q):Ke===1&&(de.firstMultiple=!1);var ct=de.firstInput,tn=de.firstMultiple,_r=tn?tn.center:ct.center,Ur=Q.center=La(Ce);Q.timeStamp=E(),Q.deltaTime=Q.timeStamp-ct.timeStamp,Q.angle=Wo(_r,Ur),Q.distance=vo(_r,Ur),il(de,Q),Q.offsetDirection=ca(Q.deltaX,Q.deltaY);var Yr=ys(Q.deltaTime,Q.deltaX,Q.deltaY);Q.overallVelocityX=Yr.x,Q.overallVelocityY=Yr.y,Q.overallVelocity=x(Yr.x)>x(Yr.y)?Yr.x:Yr.y,Q.scale=tn?Ra(tn.pointers,Ce):1,Q.rotation=tn?al(tn.pointers,Ce):0,Q.maxPointers=de.prevInput?Q.pointers.length>de.prevInput.maxPointers?Q.pointers.length:de.prevInput.maxPointers:Q.pointers.length,ki(de,Q);var oo=q.element;Pe(Q.srcEvent.target,oo)&&(oo=Q.srcEvent.target),Q.target=oo}function il(q,Q){var de=Q.center,Ce=q.offsetDelta||{},Ke=q.prevDelta||{},ct=q.prevInput||{};(Q.eventType===Pt||ct.eventType===qt)&&(Ke=q.prevDelta={x:ct.deltaX||0,y:ct.deltaY||0},Ce=q.offsetDelta={x:de.x,y:de.y}),Q.deltaX=Ke.x+(de.x-Ce.x),Q.deltaY=Ke.y+(de.y-Ce.y)}function ki(q,Q){var de=q.lastInterval||Q,Ce=Q.timeStamp-de.timeStamp,Ke,ct,tn,_r;if(Q.eventType!=yn&&(Ce>Qt||de.velocity===o)){var Ur=Q.deltaX-de.deltaX,Yr=Q.deltaY-de.deltaY,oo=ys(Ce,Ur,Yr);ct=oo.x,tn=oo.y,Ke=x(oo.x)>x(oo.y)?oo.x:oo.y,_r=ca(Ur,Yr),q.lastInterval=Q}else Ke=de.velocity,ct=de.velocityX,tn=de.velocityY,_r=de.direction;Q.velocity=Ke,Q.velocityX=ct,Q.velocityY=tn,Q.direction=_r}function ol(q){for(var Q=[],de=0;de<q.pointers.length;)Q[de]={clientX:g(q.pointers[de].clientX),clientY:g(q.pointers[de].clientY)},de++;return{timeStamp:E(),pointers:Q,center:La(Q),deltaX:q.deltaX,deltaY:q.deltaY}}function La(q){var Q=q.length;if(Q===1)return{x:g(q[0].clientX),y:g(q[0].clientY)};for(var de=0,Ce=0,Ke=0;Ke<Q;)de+=q[Ke].clientX,Ce+=q[Ke].clientY,Ke++;return{x:g(de/Q),y:g(Ce/Q)}}function ys(q,Q,de){return{x:Q/q||0,y:de/q||0}}function ca(q,Q){return q===Q?ai:x(q)>=x(Q)?q<0?Kn:Wt:Q<0?Jn:Zr}function vo(q,Q,de){de||(de=yi);var Ce=Q[de[0]]-q[de[0]],Ke=Q[de[1]]-q[de[1]];return Math.sqrt(Ce*Ce+Ke*Ke)}function Wo(q,Q,de){de||(de=yi);var Ce=Q[de[0]]-q[de[0]],Ke=Q[de[1]]-q[de[1]];return Math.atan2(Ke,Ce)*180/Math.PI}function al(q,Q){return Wo(Q[1],Q[0],Hi)+Wo(q[1],q[0],Hi)}function Ra(q,Q){return vo(Q[0],Q[1],Hi)/vo(q[0],q[1],Hi)}var Oa={mousedown:Pt,mousemove:Nt,mouseup:qt},vs="mousedown",_s="mousemove mouseup";function ha(){this.evEl=vs,this.evWin=_s,this.pressed=!1,$r.apply(this,arguments)}W(ha,$r,{handler:function(Q){var de=Oa[Q.type];de&Pt&&Q.button===0&&(this.pressed=!0),de&Nt&&Q.which!==1&&(de=qt),this.pressed&&(de&qt&&(this.pressed=!1),this.callback(this.manager,de,{pointers:[Q],changedPointers:[Q],pointerType:et,srcEvent:Q}))}});var xs={pointerdown:Pt,pointermove:Nt,pointerup:qt,pointercancel:yn,pointerout:yn},Ho={2:dn,3:An,4:et,5:yt},qi="pointerdown",_o="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(qi="MSPointerDown",_o="MSPointerMove MSPointerUp MSPointerCancel");function fa(){this.evEl=qi,this.evWin=_o,$r.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}W(fa,$r,{handler:function(Q){var de=this.store,Ce=!1,Ke=Q.type.toLowerCase().replace("ms",""),ct=xs[Ke],tn=Ho[Q.pointerType]||Q.pointerType,_r=tn==dn,Ur=Fe(de,Q.pointerId,"pointerId");ct&Pt&&(Q.button===0||_r)?Ur<0&&(de.push(Q),Ur=de.length-1):ct&(qt|yn)&&(Ce=!0),!(Ur<0)&&(de[Ur]=Q,this.callback(this.manager,ct,{pointers:de,changedPointers:[Q],pointerType:tn,srcEvent:Q}),Ce&&de.splice(Ur,1))}});var ou={touchstart:Pt,touchmove:Nt,touchend:qt,touchcancel:yn},Wn="touchstart",O="touchstart touchmove touchend touchcancel";function B(){this.evTarget=Wn,this.evWin=O,this.started=!1,$r.apply(this,arguments)}W(B,$r,{handler:function(Q){var de=ou[Q.type];if(de===Pt&&(this.started=!0),!!this.started){var Ce=G.call(this,Q,de);de&(qt|yn)&&Ce[0].length-Ce[1].length===0&&(this.started=!1),this.callback(this.manager,de,{pointers:Ce[0],changedPointers:Ce[1],pointerType:dn,srcEvent:Q})}}});function G(q,Q){var de=Be(q.touches),Ce=Be(q.changedTouches);return Q&(qt|yn)&&(de=He(de.concat(Ce),"identifier",!0)),[de,Ce]}var Y={touchstart:Pt,touchmove:Nt,touchend:qt,touchcancel:yn},ne="touchstart touchmove touchend touchcancel";function Z(){this.evTarget=ne,this.targetIds={},$r.apply(this,arguments)}W(Z,$r,{handler:function(Q){var de=Y[Q.type],Ce=re.call(this,Q,de);Ce&&this.callback(this.manager,de,{pointers:Ce[0],changedPointers:Ce[1],pointerType:dn,srcEvent:Q})}});function re(q,Q){var de=Be(q.touches),Ce=this.targetIds;if(Q&(Pt|Nt)&&de.length===1)return Ce[de[0].identifier]=!0,[de,de];var Ke,ct,tn=Be(q.changedTouches),_r=[],Ur=this.target;if(ct=de.filter(function(Yr){return Pe(Yr.target,Ur)}),Q===Pt)for(Ke=0;Ke<ct.length;)Ce[ct[Ke].identifier]=!0,Ke++;for(Ke=0;Ke<tn.length;)Ce[tn[Ke].identifier]&&_r.push(tn[Ke]),Q&(qt|yn)&&delete Ce[tn[Ke].identifier],Ke++;if(_r.length)return[He(ct.concat(_r),"identifier",!0),_r]}var ge=2500,xe=25;function _e(){$r.apply(this,arguments);var q=J(this.handler,this);this.touch=new Z(this.manager,q),this.mouse=new ha(this.manager,q),this.primaryTouch=null,this.lastTouches=[]}W(_e,$r,{handler:function(Q,de,Ce){var Ke=Ce.pointerType==dn,ct=Ce.pointerType==et;if(!(ct&&Ce.sourceCapabilities&&Ce.sourceCapabilities.firesTouchEvents)){if(Ke)Ue.call(this,de,Ce);else if(ct&&Oe.call(this,Ce))return;this.callback(Q,de,Ce)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ue(q,Q){q&Pt?(this.primaryTouch=Q.changedPointers[0].identifier,Ge.call(this,Q)):q&(qt|yn)&&Ge.call(this,Q)}function Ge(q){var Q=q.changedPointers[0];if(Q.identifier===this.primaryTouch){var de={x:Q.clientX,y:Q.clientY};this.lastTouches.push(de);var Ce=this.lastTouches,Ke=function(){var ct=Ce.indexOf(de);ct>-1&&Ce.splice(ct,1)};setTimeout(Ke,ge)}}function Oe(q){for(var Q=q.srcEvent.clientX,de=q.srcEvent.clientY,Ce=0;Ce<this.lastTouches.length;Ce++){var Ke=this.lastTouches[Ce],ct=Math.abs(Q-Ke.x),tn=Math.abs(de-Ke.y);if(ct<=xe&&tn<=xe)return!0}return!1}var qe=We(a.style,"touchAction"),ke=qe!==o,Xe="compute",Ye="auto",Tt="manipulation",xt="none",Ve="pan-x",zt="pan-y",Rt=bt();function Zt(q,Q){this.manager=q,this.set(Q)}Zt.prototype={set:function(q){q==Xe&&(q=this.compute()),ke&&this.manager.element.style&&Rt[q]&&(this.manager.element.style[qe]=q),this.actions=q.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var q=[];return R(this.manager.recognizers,function(Q){le(Q.options.enable,[Q])&&(q=q.concat(Q.getTouchAction()))}),en(q.join(" "))},preventDefaults:function(q){var Q=q.srcEvent,de=q.offsetDirection;if(this.manager.session.prevented){Q.preventDefault();return}var Ce=this.actions,Ke=we(Ce,xt)&&!Rt[xt],ct=we(Ce,zt)&&!Rt[zt],tn=we(Ce,Ve)&&!Rt[Ve];if(Ke){var _r=q.pointers.length===1,Ur=q.distance<2,Yr=q.deltaTime<250;if(_r&&Ur&&Yr)return}if(!(tn&&ct)&&(Ke||ct&&de&mi||tn&&de&gi))return this.preventSrc(Q)},preventSrc:function(q){this.manager.session.prevented=!0,q.preventDefault()}};function en(q){if(we(q,xt))return xt;var Q=we(q,Ve),de=we(q,zt);return Q&&de?xt:Q||de?Q?Ve:zt:we(q,Tt)?Tt:Ye}function bt(){if(!ke)return!1;var q={},Q=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(de){q[de]=Q?e.CSS.supports("touch-action",de):!0}),q}var mn=1,sn=2,kn=4,$t=8,xn=$t,At=16,Vt=32;function Qr(q){this.options=X({},this.defaults,q||{}),this.id=gn(),this.manager=null,this.options.enable=ue(this.options.enable,!0),this.state=mn,this.simultaneous={},this.requireFail=[]}Qr.prototype={defaults:{},set:function(q){return X(this.options,q),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(q){if(A(q,"recognizeWith",this))return this;var Q=this.simultaneous;return q=za(q,this),Q[q.id]||(Q[q.id]=q,q.recognizeWith(this)),this},dropRecognizeWith:function(q){return A(q,"dropRecognizeWith",this)?this:(q=za(q,this),delete this.simultaneous[q.id],this)},requireFailure:function(q){if(A(q,"requireFailure",this))return this;var Q=this.requireFail;return q=za(q,this),Fe(Q,q)===-1&&(Q.push(q),q.requireFailure(this)),this},dropRequireFailure:function(q){if(A(q,"dropRequireFailure",this))return this;q=za(q,this);var Q=Fe(this.requireFail,q);return Q>-1&&this.requireFail.splice(Q,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(q){return!!this.simultaneous[q.id]},emit:function(q){var Q=this,de=this.state;function Ce(Ke){Q.manager.emit(Ke,q)}de<$t&&Ce(Q.options.event+bn(de)),Ce(Q.options.event),q.additionalEvent&&Ce(q.additionalEvent),de>=$t&&Ce(Q.options.event+bn(de))},tryEmit:function(q){if(this.canEmit())return this.emit(q);this.state=Vt},canEmit:function(){for(var q=0;q<this.requireFail.length;){if(!(this.requireFail[q].state&(Vt|mn)))return!1;q++}return!0},recognize:function(q){var Q=X({},q);if(!le(this.options.enable,[this,Q])){this.reset(),this.state=Vt;return}this.state&(xn|At|Vt)&&(this.state=mn),this.state=this.process(Q),this.state&(sn|kn|$t|At)&&this.tryEmit(Q)},process:function(q){},getTouchAction:function(){},reset:function(){}};function bn(q){return q&At?"cancel":q&$t?"end":q&kn?"move":q&sn?"start":""}function Nr(q){return q==Zr?"down":q==Jn?"up":q==Kn?"left":q==Wt?"right":""}function za(q,Q){var de=Q.manager;return de?de.get(q):q}function ei(){Qr.apply(this,arguments)}W(ei,Qr,{defaults:{pointers:1},attrTest:function(q){var Q=this.options.pointers;return Q===0||q.pointers.length===Q},process:function(q){var Q=this.state,de=q.eventType,Ce=Q&(sn|kn),Ke=this.attrTest(q);return Ce&&(de&yn||!Ke)?Q|At:Ce||Ke?de&qt?Q|$t:Q&sn?Q|kn:sn:Vt}});function Hn(){ei.apply(this,arguments),this.pX=null,this.pY=null}W(Hn,ei,{defaults:{event:"pan",threshold:10,pointers:1,direction:Go},getTouchAction:function(){var q=this.options.direction,Q=[];return q&mi&&Q.push(zt),q&gi&&Q.push(Ve),Q},directionTest:function(q){var Q=this.options,de=!0,Ce=q.distance,Ke=q.direction,ct=q.deltaX,tn=q.deltaY;return Ke&Q.direction||(Q.direction&mi?(Ke=ct===0?ai:ct<0?Kn:Wt,de=ct!=this.pX,Ce=Math.abs(q.deltaX)):(Ke=tn===0?ai:tn<0?Jn:Zr,de=tn!=this.pY,Ce=Math.abs(q.deltaY))),q.direction=Ke,de&&Ce>Q.threshold&&Ke&Q.direction},attrTest:function(q){return ei.prototype.attrTest.call(this,q)&&(this.state&sn||!(this.state&sn)&&this.directionTest(q))},emit:function(q){this.pX=q.deltaX,this.pY=q.deltaY;var Q=Nr(q.direction);Q&&(q.additionalEvent=this.options.event+Q),this._super.emit.call(this,q)}});function qo(){ei.apply(this,arguments)}W(qo,ei,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[xt]},attrTest:function(q){return this._super.attrTest.call(this,q)&&(Math.abs(q.scale-1)>this.options.threshold||this.state&sn)},emit:function(q){if(q.scale!==1){var Q=q.scale<1?"in":"out";q.additionalEvent=this.options.event+Q}this._super.emit.call(this,q)}});function Xr(){Qr.apply(this,arguments),this._timer=null,this._input=null}W(Xr,Qr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ye]},process:function(q){var Q=this.options,de=q.pointers.length===Q.pointers,Ce=q.distance<Q.threshold,Ke=q.deltaTime>Q.time;if(this._input=q,!Ce||!de||q.eventType&(qt|yn)&&!Ke)this.reset();else if(q.eventType&Pt)this.reset(),this._timer=P(function(){this.state=xn,this.tryEmit()},Q.time,this);else if(q.eventType&qt)return xn;return Vt},reset:function(){clearTimeout(this._timer)},emit:function(q){this.state===xn&&(q&&q.eventType&qt?this.manager.emit(this.options.event+"up",q):(this._input.timeStamp=E(),this.manager.emit(this.options.event,this._input)))}});function ur(){ei.apply(this,arguments)}W(ur,ei,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[xt]},attrTest:function(q){return this._super.attrTest.call(this,q)&&(Math.abs(q.rotation)>this.options.threshold||this.state&sn)}});function io(){ei.apply(this,arguments)}W(io,ei,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:mi|gi,pointers:1},getTouchAction:function(){return Hn.prototype.getTouchAction.call(this)},attrTest:function(q){var Q=this.options.direction,de;return Q&(mi|gi)?de=q.overallVelocity:Q&mi?de=q.overallVelocityX:Q&gi&&(de=q.overallVelocityY),this._super.attrTest.call(this,q)&&Q&q.offsetDirection&&q.distance>this.options.threshold&&q.maxPointers==this.options.pointers&&x(de)>this.options.velocity&&q.eventType&qt},emit:function(q){var Q=Nr(q.offsetDirection);Q&&this.manager.emit(this.options.event+Q,q),this.manager.emit(this.options.event,q)}});function yr(){Qr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}W(yr,Qr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Tt]},process:function(q){var Q=this.options,de=q.pointers.length===Q.pointers,Ce=q.distance<Q.threshold,Ke=q.deltaTime<Q.time;if(this.reset(),q.eventType&Pt&&this.count===0)return this.failTimeout();if(Ce&&Ke&&de){if(q.eventType!=qt)return this.failTimeout();var ct=this.pTime?q.timeStamp-this.pTime<Q.interval:!0,tn=!this.pCenter||vo(this.pCenter,q.center)<Q.posThreshold;this.pTime=q.timeStamp,this.pCenter=q.center,!tn||!ct?this.count=1:this.count+=1,this._input=q;var _r=this.count%Q.taps;if(_r===0)return this.hasRequireFailures()?(this._timer=P(function(){this.state=xn,this.tryEmit()},Q.interval,this),sn):xn}return Vt},failTimeout:function(){return this._timer=P(function(){this.state=Vt},this.options.interval,this),Vt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==xn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ln(q,Q){return Q=Q||{},Q.recognizers=ue(Q.recognizers,Ln.defaults.preset),new vr(q,Q)}Ln.VERSION="2.0.7",Ln.defaults={domEvents:!1,touchAction:Xe,enable:!0,inputTarget:null,inputClass:null,preset:[[ur,{enable:!1}],[qo,{enable:!1},["rotate"]],[io,{direction:mi}],[Hn,{direction:mi},["swipe"]],[yr],[yr,{event:"doubletap",taps:2},["tap"]],[Xr]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var cr=1,sl=2;function vr(q,Q){this.options=X({},Ln.defaults,Q||{}),this.options.inputTarget=this.options.inputTarget||q,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=q,this.input=Mi(this),this.touchAction=new Zt(this,this.options.touchAction),au(this,!0),R(this.options.recognizers,function(de){var Ce=this.add(new de[0](de[1]));de[2]&&Ce.recognizeWith(de[2]),de[3]&&Ce.requireFailure(de[3])},this)}vr.prototype={set:function(q){return X(this.options,q),q.touchAction&&this.touchAction.update(),q.inputTarget&&(this.input.destroy(),this.input.target=q.inputTarget,this.input.init()),this},stop:function(q){this.session.stopped=q?sl:cr},recognize:function(q){var Q=this.session;if(!Q.stopped){this.touchAction.preventDefaults(q);var de,Ce=this.recognizers,Ke=Q.curRecognizer;(!Ke||Ke&&Ke.state&xn)&&(Ke=Q.curRecognizer=null);for(var ct=0;ct<Ce.length;)de=Ce[ct],Q.stopped!==sl&&(!Ke||de==Ke||de.canRecognizeWith(Ke))?de.recognize(q):de.reset(),!Ke&&de.state&(sn|kn|$t)&&(Ke=Q.curRecognizer=de),ct++}},get:function(q){if(q instanceof Qr)return q;for(var Q=this.recognizers,de=0;de<Q.length;de++)if(Q[de].options.event==q)return Q[de];return null},add:function(q){if(A(q,"add",this))return this;var Q=this.get(q.options.event);return Q&&this.remove(Q),this.recognizers.push(q),q.manager=this,this.touchAction.update(),q},remove:function(q){if(A(q,"remove",this))return this;if(q=this.get(q),q){var Q=this.recognizers,de=Fe(Q,q);de!==-1&&(Q.splice(de,1),this.touchAction.update())}return this},on:function(q,Q){if(q!==o&&Q!==o){var de=this.handlers;return R(ze(q),function(Ce){de[Ce]=de[Ce]||[],de[Ce].push(Q)}),this}},off:function(q,Q){if(q!==o){var de=this.handlers;return R(ze(q),function(Ce){Q?de[Ce]&&de[Ce].splice(Fe(de[Ce],Q),1):delete de[Ce]}),this}},emit:function(q,Q){this.options.domEvents&&Zo(q,Q);var de=this.handlers[q]&&this.handlers[q].slice();if(!(!de||!de.length)){Q.type=q,Q.preventDefault=function(){Q.srcEvent.preventDefault()};for(var Ce=0;Ce<de.length;)de[Ce](Q),Ce++}},destroy:function(){this.element&&au(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function au(q,Q){var de=q.element;if(de.style){var Ce;R(q.options.cssProps,function(Ke,ct){Ce=We(de.style,ct),Q?(q.oldCssProps[Ce]=de.style[Ce],de.style[Ce]=Ke):de.style[Ce]=q.oldCssProps[Ce]||""}),Q||(q.oldCssProps={})}}function Zo(q,Q){var de=n.createEvent("Event");de.initEvent(q,!0,!0),de.gesture=Q,Q.target.dispatchEvent(de)}X(Ln,{INPUT_START:Pt,INPUT_MOVE:Nt,INPUT_END:qt,INPUT_CANCEL:yn,STATE_POSSIBLE:mn,STATE_BEGAN:sn,STATE_CHANGED:kn,STATE_ENDED:$t,STATE_RECOGNIZED:xn,STATE_CANCELLED:At,STATE_FAILED:Vt,DIRECTION_NONE:ai,DIRECTION_LEFT:Kn,DIRECTION_RIGHT:Wt,DIRECTION_UP:Jn,DIRECTION_DOWN:Zr,DIRECTION_HORIZONTAL:mi,DIRECTION_VERTICAL:gi,DIRECTION_ALL:Go,Manager:vr,Input:$r,TouchAction:Zt,TouchInput:Z,MouseInput:ha,PointerEventInput:fa,TouchMouseInput:_e,SingleTouchInput:B,Recognizer:Qr,AttrRecognizer:ei,Tap:yr,Pan:Hn,Swipe:io,Pinch:qo,Rotate:ur,Press:Xr,on:ye,off:Ee,each:R,merge:F,extend:D,assign:X,inherit:W,bindFn:J,prefixed:We});var Br=typeof e<"u"?e:typeof self<"u"?self:{};Br.Hammer=Ln,typeof o=="function"&&o.amd?o(function(){return Ln}):t.exports?t.exports=Ln:e[r]=Ln})(window,document,"Hammer")})(fz);const Lo=oc,es=CL({__proto__:null,default:Lo},[oc]);var TC=1,SC=2,K0=4,pz={mousedown:TC,mousemove:SC,mouseup:K0};function dz(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function mz(t){var e=t.prototype.handler;t.prototype.handler=function(r){var o=this.store;r.button>0&&(dz(o,function(l){return l.pointerId===r.pointerId})||o.push(r)),e.call(this,r)}}function gz(t){t.prototype.handler=function(n){var r=pz[n.type];r&TC&&n.button>=0&&(this.pressed=!0),r&SC&&n.which===0&&(r=K0),this.pressed&&(r&K0&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}mz(Lo.PointerEventInput);gz(Lo.MouseInput);var yz=Lo.Manager,vz=Lo?[[Lo.Rotate,{enable:!1}],[Lo.Pinch,{enable:!1}],[Lo.Swipe,{enable:!1}],[Lo.Pan,{threshold:0,enable:!1}],[Lo.Press,{enable:!1}],[Lo.Tap,{event:"doubletap",taps:2,enable:!1}],[Lo.Tap,{event:"anytap",enable:!1}],[Lo.Tap,{enable:!1}]]:null,gT={rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},_z={doubletap:["tap"]},xz={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Ox={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel","DOMMouseScroll"]},bz={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},yT={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},wz=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",wh=typeof window<"u"?window:global,PC=!1;try{var Km={get passive(){return PC=!0,!0}};wh.addEventListener("test",Km,Km),wh.removeEventListener("test",Km,Km)}catch{}var Ez=wz.indexOf("firefox")!==-1,Tz=Ox.WHEEL_EVENTS,vT="wheel",_T=4.000244140625,Sz=40,Pz=.25,Az=function(){function t(e,n){var r=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Gn(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},o),this.events=Tz.concat(o.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(l){return e.addEventListener(l,r.handleEvent,PC?{passive:!1}:!1)})}return Nn(t,[{key:"destroy",value:function(){var n=this;this.events.forEach(function(r){return n.element.removeEventListener(r,n.handleEvent)})}},{key:"enableEventType",value:function(n,r){n===vT&&(this.options.enable=r)}},{key:"handleEvent",value:function(n){if(this.options.enable){var r=n.deltaY;wh.WheelEvent&&(Ez&&n.deltaMode===wh.WheelEvent.DOM_DELTA_PIXEL&&(r/=wh.devicePixelRatio),n.deltaMode===wh.WheelEvent.DOM_DELTA_LINE&&(r*=Sz));var o={x:n.clientX,y:n.clientY};r!==0&&r%_T===0&&(r=Math.floor(r/_T)),n.shiftKey&&r&&(r=r*Pz),this._onWheel(n,-r,o)}}},{key:"_onWheel",value:function(n,r,o){this.callback({type:vT,center:o,delta:r,srcEvent:n,pointerType:"mouse",target:n.target})}}]),t}(),Cz=Ox.MOUSE_EVENTS,xT="pointermove",bT="pointerover",wT="pointerout",ET="pointerleave",Iz=function(){function t(e,n){var r=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Gn(this,t),this.element=e,this.callback=n,this.pressed=!1,this.options=Object.assign({enable:!0},o),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=Cz.concat(o.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(l){return e.addEventListener(l,r.handleEvent)})}return Nn(t,[{key:"destroy",value:function(){var n=this;this.events.forEach(function(r){return n.element.removeEventListener(r,n.handleEvent)})}},{key:"enableEventType",value:function(n,r){n===xT&&(this.enableMoveEvent=r),n===bT&&(this.enableOverEvent=r),n===wT&&(this.enableOutEvent=r),n===ET&&(this.enableLeaveEvent=r)}},{key:"handleEvent",value:function(n){this.handleOverEvent(n),this.handleOutEvent(n),this.handleLeaveEvent(n),this.handleMoveEvent(n)}},{key:"handleOverEvent",value:function(n){this.enableOverEvent&&n.type==="mouseover"&&this.callback({type:bT,srcEvent:n,pointerType:"mouse",target:n.target})}},{key:"handleOutEvent",value:function(n){this.enableOutEvent&&n.type==="mouseout"&&this.callback({type:wT,srcEvent:n,pointerType:"mouse",target:n.target})}},{key:"handleLeaveEvent",value:function(n){this.enableLeaveEvent&&n.type==="mouseleave"&&this.callback({type:ET,srcEvent:n,pointerType:"mouse",target:n.target})}},{key:"handleMoveEvent",value:function(n){if(this.enableMoveEvent)switch(n.type){case"mousedown":n.button>=0&&(this.pressed=!0);break;case"mousemove":n.which===0&&(this.pressed=!1),this.pressed||this.callback({type:xT,srcEvent:n,pointerType:"mouse",target:n.target});break;case"mouseup":this.pressed=!1;break}}}]),t}(),Mz=Ox.KEY_EVENTS,TT="keydown",ST="keyup",kz=function(){function t(e,n){var r=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Gn(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},o),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=Mz.concat(o.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=o.tabIndex||0,e.style.outline="none",this.events.forEach(function(l){return e.addEventListener(l,r.handleEvent)})}return Nn(t,[{key:"destroy",value:function(){var n=this;this.events.forEach(function(r){return n.element.removeEventListener(r,n.handleEvent)})}},{key:"enableEventType",value:function(n,r){n===TT&&(this.enableDownEvent=r),n===ST&&(this.enableUpEvent=r)}},{key:"handleEvent",value:function(n){var r=n.target||n.srcElement;r.tagName==="INPUT"&&r.type==="text"||r.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:TT,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:ST,srcEvent:n,key:n.key,target:n.target}))}}]),t}(),PT="contextmenu",Lz=function(){function t(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Gn(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},r),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}return Nn(t,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(n,r){n===PT&&(this.options.enable=r)}},{key:"handleEvent",value:function(n){this.options.enable&&this.callback({type:PT,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}]),t}(),J0=1,hy=2,Q0=4,Rz={pointerdown:J0,pointermove:hy,pointerup:Q0,mousedown:J0,mousemove:hy,mouseup:Q0},Oz=1,zz=2,Dz=3,Fz=0,Nz=1,Bz=2,Uz=1,Vz=2,jz=4;function Gz(t){var e=Rz[t.srcEvent.type];if(!e)return null;var n=t.srcEvent,r=n.buttons,o=n.button,l=n.which,a=!1,d=!1,g=!1;return e===Q0||e===hy&&!Number.isFinite(r)?(a=l===Oz,d=l===zz,g=l===Dz):e===hy?(a=Boolean(r&Uz),d=Boolean(r&jz),g=Boolean(r&Vz)):e===J0&&(a=o===Fz,d=o===Nz,g=o===Bz),{leftButton:a,middleButton:d,rightButton:g}}function Wz(t,e){var n=t.srcEvent;if(!t.center&&!Number.isFinite(n.clientX))return null;var r=t.center||{x:n.clientX,y:n.clientY},o=e.getBoundingClientRect(),l=o.width/e.offsetWidth,a=o.height/e.offsetHeight,d={x:(r.x-o.left-e.clientLeft)/l,y:(r.y-o.top-e.clientTop)/a};return{center:r,offsetCenter:d}}var AT={srcElement:"root",priority:0},Hz=function(){function t(e){Gn(this,t),this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this),this._active=!1}return Nn(t,[{key:"isEmpty",value:function(){return!this._active}},{key:"add",value:function(n,r,o){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,d=this.handlers,g=this.handlersByElement;o&&(Ju(o)!=="object"||o.addEventListener)&&(o={srcElement:o}),o=o?Object.assign({},AT,o):AT;var x=g.get(o.srcElement);x||(x=[],g.set(o.srcElement,x));var E={type:n,handler:r,srcElement:o.srcElement,priority:o.priority};l&&(E.once=!0),a&&(E.passive=!0),d.push(E),this._active=this._active||!E.passive;for(var P=x.length-1;P>=0&&!(x[P].priority>=E.priority);)P--;x.splice(P+1,0,E)}},{key:"remove",value:function(n,r){for(var o=this.handlers,l=this.handlersByElement,a=o.length-1;a>=0;a--){var d=o[a];if(d.type===n&&d.handler===r){o.splice(a,1);var g=l.get(d.srcElement);g.splice(g.indexOf(d),1),g.length===0&&l.delete(d.srcElement)}}this._active=o.some(function(x){return!x.passive})}},{key:"handleEvent",value:function(n){if(!this.isEmpty()){for(var r=this._normalizeEvent(n),o=n.srcEvent.target;o&&o!==r.rootElement;){if(this._emit(r,o),r.handled)return;o=o.parentNode}this._emit(r,"root")}}},{key:"_emit",value:function(n,r){var o=this.handlersByElement.get(r);if(o){for(var l=!1,a=function(){n.handled=!0},d=function(){n.handled=!0,l=!0},g=[],x=0;x<o.length;x++){var E=o[x],P=E.type,A=E.handler,R=E.once;if(A(Object.assign({},n,{type:P,stopPropagation:a,stopImmediatePropagation:d})),R&&g.push(o[x]),l)break}for(var j=0;j<g.length;j++){var X=g[j],P=X.type,A=X.handler;this.remove(P,A)}}}},{key:"_normalizeEvent",value:function(n){var r=this.eventManager.element;return Object.assign({},n,Gz(n),Wz(n,r),{handled:!1,rootElement:r})}}]),t}(),qz={events:null,recognizers:null,recognizerOptions:{},Manager:yz,touchAction:"none",tabIndex:0},Zz=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Gn(this,t),this.options=Object.assign({},qz,n),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);var r=n.events;r&&this.on(r)}return Nn(t,[{key:"setElement",value:function(n){var r=this;if(this.element&&this.destroy(),this.element=n,!!n){var o=this.options,l=o.Manager;this.manager=new l(n,{touchAction:o.touchAction,recognizers:o.recognizers||vz}).on("hammer.input",this._onBasicInput),o.recognizers||Object.keys(gT).forEach(function(F){var W=r.manager.get(F);W&&gT[F].forEach(function(J){W.recognizeWith(J)})});for(var a in o.recognizerOptions){var d=this.manager.get(a);if(d){var g=o.recognizerOptions[a];delete g.enable,d.set(g)}}this.wheelInput=new Az(n,this._onOtherEvent,{enable:!1}),this.moveInput=new Iz(n,this._onOtherEvent,{enable:!1}),this.keyInput=new kz(n,this._onOtherEvent,{enable:!1,tabIndex:o.tabIndex}),this.contextmenuInput=new Lz(n,this._onOtherEvent,{enable:!1});var x=!0,E=!1,P=void 0;try{for(var A=this.events[Symbol.iterator](),R;!(x=(R=A.next()).done);x=!0){var j=Hr(R.value,2),X=j[0],D=j[1];D.isEmpty()||(this._toggleRecognizer(D.recognizerName,!0),this.manager.on(X,D.handleEvent))}}catch(F){E=!0,P=F}finally{try{!x&&A.return!=null&&A.return()}finally{if(E)throw P}}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(n,r,o){this._addEventHandler(n,r,o,!1)}},{key:"once",value:function(n,r,o){this._addEventHandler(n,r,o,!0)}},{key:"watch",value:function(n,r,o){this._addEventHandler(n,r,o,!1,!0)}},{key:"off",value:function(n,r){this._removeEventHandler(n,r)}},{key:"_toggleRecognizer",value:function(n,r){var o=this.manager;if(o){var l=o.get(n);if(l&&l.options.enable!==r){l.set({enable:r});var a=_z[n];a&&!this.options.recognizers&&a.forEach(function(d){var g=o.get(d);r?(g.requireFailure(n),l.dropRequireFailure(d)):g.dropRequireFailure(n)})}this.wheelInput.enableEventType(n,r),this.moveInput.enableEventType(n,r),this.keyInput.enableEventType(n,r),this.contextmenuInput.enableEventType(n,r)}}},{key:"_addEventHandler",value:function(n,r,o,l,a){if(typeof n!="string"){o=r;for(var d in n)this._addEventHandler(d,n[d],o,l,a);return}var g=this.manager,x=this.events,E=yT[n]||n,P=x.get(E);P||(P=new Hz(this),x.set(E,P),P.recognizerName=bz[E]||E,g&&g.on(E,P.handleEvent)),P.add(n,r,o,l,a),P.isEmpty()||this._toggleRecognizer(P.recognizerName,!0)}},{key:"_removeEventHandler",value:function(n,r){if(typeof n!="string"){for(var o in n)this._removeEventHandler(o,n[o]);return}var l=this.events,a=yT[n]||n,d=l.get(a);if(d&&(d.remove(n,r),d.isEmpty())){var g=d.recognizerName,x=!1,E=!0,P=!1,A=void 0;try{for(var R=l.values()[Symbol.iterator](),j;!(E=(j=R.next()).done);E=!0){var X=j.value;if(X.recognizerName===g&&!X.isEmpty()){x=!0;break}}}catch(D){P=!0,A=D}finally{try{!E&&R.return!=null&&R.return()}finally{if(P)throw A}}x||this._toggleRecognizer(g,!1)}}},{key:"_onBasicInput",value:function(n){var r=n.srcEvent,o=xz[r.type];o&&this.manager.emit(o,n)}},{key:"_onOtherEvent",value:function(n){this.manager.emit(n.type,n)}}]),t}();function $z(t,e){var n,r,o,l=function(){return o=null,t.apply(n,r)};return function(){n=this,r=arguments,o&&clearTimeout(o),o=setTimeout(l,e)}}var oh={transitionDuration:0},e1={transitionDuration:300,transitionEasing:function(e){return e},transitionInterpolator:new Rx,transitionInterruption:Fp.BREAK},CT=5,Xz=1.2,Yz=.01,gp={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend","pinchcancel"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},AC=function(){function t(){var e=this;Gn(this,t),me(this,"events",[]),me(this,"mapState",void 0),me(this,"onViewportChange",void 0),me(this,"onStateChange",void 0),me(this,"mapStateProps",void 0),me(this,"eventManager",void 0),me(this,"scrollZoom",!0),me(this,"dragPan",!0),me(this,"dragRotate",!0),me(this,"doubleClickZoom",!0),me(this,"touchZoom",!0),me(this,"touchRotate",!1),me(this,"keyboard",!0),me(this,"_state",{isDragging:!1}),me(this,"_events",{}),me(this,"_transitionManager",new Ky),me(this,"setState",function(n){Object.assign(e._state,n),e.onStateChange&&e.onStateChange(e._state)}),this.handleEvent=this.handleEvent.bind(this),this._onWheelEnd=$z(this._onWheelEnd,100)}return Nn(t,[{key:"handleEvent",value:function(n){switch(this.mapState=this.getMapState(),n.type){case"panstart":return this._onPanStart(n);case"panmove":return this._onPan(n);case"panend":return this._onPanEnd(n);case"pinchstart":return this._onPinchStart(n);case"pinchmove":return this._onPinch(n);case"pinchcancel":case"pinchend":return this._onPinchEnd(n);case"doubletap":return this._onDoubleTap(n);case"wheel":return this._onWheel(n);case"keydown":return this._onKeyDown(n);default:return!1}}},{key:"getCenter",value:function(n){var r=n.offsetCenter,o=r.x,l=r.y;return[o,l]}},{key:"isFunctionKeyPressed",value:function(n){var r=n.srcEvent;return Boolean(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}},{key:"updateViewport",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},l=this.mapState?this.mapState.getViewportProps():{},a=Object.assign({},n.getViewportProps(),r),d=Object.keys(a).some(function(g){return l[g]!==a[g]});d&&this.onViewportChange(a,o,l),this.setState(Object.assign({},n.getInteractiveState(),o))}},{key:"getMapState",value:function(n){return new ed(Object.assign({},this.mapStateProps,this._state,n))}},{key:"setOptions",value:function(n){var r=n.onViewportChange,o=n.onStateChange,l=n.eventManager,a=l===void 0?this.eventManager:l,d=n.isInteractive,g=d===void 0?!0:d,x=n.scrollZoom,E=x===void 0?this.scrollZoom:x,P=n.dragPan,A=P===void 0?this.dragPan:P,R=n.dragRotate,j=R===void 0?this.dragRotate:R,X=n.doubleClickZoom,D=X===void 0?this.doubleClickZoom:X,F=n.touchZoom,W=F===void 0?this.touchZoom:F,J=n.touchRotate,le=J===void 0?this.touchRotate:J,ue=n.keyboard,ye=ue===void 0?this.keyboard:ue;this.onViewportChange=r,this.onStateChange=o;var Ee=!this.mapStateProps||this.mapStateProps.height!==n.height;this.mapStateProps=n,Ee&&this.updateViewport(new ed(n)),this._transitionManager.processViewportChange(Object.assign({},n,{onStateChange:this.setState})),this.eventManager!==a&&(this.eventManager=a,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(gp.WHEEL,g&&E),this.toggleEvents(gp.PAN,g&&(A||j)),this.toggleEvents(gp.PINCH,g&&(W||le)),this.toggleEvents(gp.DOUBLE_TAP,g&&D),this.toggleEvents(gp.KEYBOARD,g&&ye),this.scrollZoom=E,this.dragPan=A,this.dragRotate=j,this.doubleClickZoom=D,this.touchZoom=W,this.touchRotate=le,this.keyboard=ye}},{key:"toggleEvents",value:function(n,r){var o=this;this.eventManager&&n.forEach(function(l){o._events[l]!==r&&(o._events[l]=r,r?o.eventManager.on(l,o.handleEvent):o.eventManager.off(l,o.handleEvent))})}},{key:"_onPanStart",value:function(n){var r=this.getCenter(n),o=this.mapState.panStart({pos:r}).rotateStart({pos:r});return this.updateViewport(o,oh,{isDragging:!0}),!0}},{key:"_onPan",value:function(n){return this.isFunctionKeyPressed(n)||n.rightButton?this._onPanRotate(n):this._onPanMove(n)}},{key:"_onPanEnd",value:function(n){var r=this.mapState.panEnd().rotateEnd();return this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isRotating:!1}),!0}},{key:"_onPanMove",value:function(n){if(!this.dragPan)return!1;var r=this.getCenter(n),o=this.mapState.pan({pos:r});return this.updateViewport(o,oh,{isPanning:!0}),!0}},{key:"_onPanRotate",value:function(n){if(!this.dragRotate)return!1;var r=n.deltaX,o=n.deltaY,l=this.getCenter(n),a=Hr(l,2),d=a[1],g=d-o,x=this.mapState.getViewportProps(),E=x.width,P=x.height,A=r/E,R=0;o>0?Math.abs(P-g)>CT&&(R=o/(g-P)*Xz):o<0&&g>CT&&(R=1-d/g),R=Math.min(1,Math.max(-1,R));var j=this.mapState.rotate({deltaScaleX:A,deltaScaleY:R});return this.updateViewport(j,oh,{isRotating:!0}),!0}},{key:"_onWheel",value:function(n){if(!this.scrollZoom)return!1;n.preventDefault();var r=this.getCenter(n),o=n.delta,l=2/(1+Math.exp(-Math.abs(o*Yz)));o<0&&l!==0&&(l=1/l);var a=this.mapState.zoom({pos:r,scale:l});return this.updateViewport(a,oh,{isZooming:!0}),this._onWheelEnd(),!0}},{key:"_onWheelEnd",value:function(){this.setState({isZooming:!1})}},{key:"_onPinchStart",value:function(n){var r=this.getCenter(n),o=this.mapState.zoomStart({pos:r}).rotateStart({pos:r});return this._state.startPinchRotation=n.rotation,this.updateViewport(o,oh,{isDragging:!0}),!0}},{key:"_onPinch",value:function(n){if(!this.touchZoom&&!this.touchRotate)return!1;var r=this.mapState;if(this.touchZoom){var o=n.scale,l=this.getCenter(n);r=r.zoom({pos:l,scale:o})}if(this.touchRotate){var a=n.rotation,d=this._state.startPinchRotation;r=r.rotate({deltaScaleX:-(a-d)/180})}return this.updateViewport(r,oh,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),!0}},{key:"_onPinchEnd",value:function(n){var r=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(n){if(!this.doubleClickZoom)return!1;var r=this.getCenter(n),o=this.isFunctionKeyPressed(n),l=this.mapState.zoom({pos:r,scale:o?.5:2});return this.updateViewport(l,Object.assign({},e1,{transitionInterpolator:new Rx({around:r})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(n){if(!this.keyboard)return!1;var r=this.isFunctionKeyPressed(n),o=this.mapStateProps,l;switch(n.srcEvent.keyCode){case 189:r?l=this.getMapState({zoom:o.zoom-2}):l=this.getMapState({zoom:o.zoom-1});break;case 187:r?l=this.getMapState({zoom:o.zoom+2}):l=this.getMapState({zoom:o.zoom+1});break;case 37:r?l=this.getMapState({bearing:o.bearing-15}):l=this.mapState.pan({pos:[100,0],startPos:[0,0]});break;case 39:r?l=this.getMapState({bearing:o.bearing+15}):l=this.mapState.pan({pos:[-100,0],startPos:[0,0]});break;case 38:r?l=this.getMapState({pitch:o.pitch+10}):l=this.mapState.pan({pos:[0,100],startPos:[0,0]});break;case 40:r?l=this.getMapState({pitch:o.pitch-10}):l=this.mapState.pan({pos:[0,-100],startPos:[0,0]});break;default:return!1}return this.updateViewport(l,e1)}}]),t}(),Kz=[{old:"onChangeViewport",new:"onViewportChange"},{old:"perspectiveEnabled",new:"dragRotate"},{old:"onHoverFeatures",new:"onHover"},{old:"onClickFeatures",new:"onClick"},{old:"touchZoomRotate",new:"touchZoom, touchRotate"},{old:"mapControls",new:"controller"}];function Jz(t){return"react-map-gl: `".concat(t,"` is removed.")}function Qz(t){return"Use `".concat(t,"` instead.")}function CC(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Kz.forEach(function(e){if(t.hasOwnProperty(e.old)){var n=Jz(e.old);e.new&&(n="".concat(n," ").concat(Qz(e.new))),console.warn(n)}})}function eD(t){var e=tD();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function tD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var nD=Object.assign({},ic.propTypes,{maxZoom:De.number,minZoom:De.number,maxPitch:De.number,minPitch:De.number,onViewStateChange:De.func,onViewportChange:De.func,onInteractionStateChange:De.func,transitionDuration:De.oneOfType([De.number,De.string]),transitionInterpolator:De.object,transitionInterruption:De.number,transitionEasing:De.func,onTransitionStart:De.func,onTransitionInterrupt:De.func,onTransitionEnd:De.func,scrollZoom:De.bool,dragPan:De.bool,dragRotate:De.bool,doubleClickZoom:De.bool,touchZoom:De.bool,touchRotate:De.bool,keyboard:De.bool,onHover:De.func,onClick:De.func,onDblClick:De.func,onContextMenu:De.func,onMouseDown:De.func,onMouseMove:De.func,onMouseUp:De.func,onTouchStart:De.func,onTouchMove:De.func,onTouchEnd:De.func,onMouseEnter:De.func,onMouseLeave:De.func,onMouseOut:De.func,onWheel:De.func,touchAction:De.string,clickRadius:De.number,interactiveLayerIds:De.array,getCursor:De.func,controller:De.instanceOf(AC)}),rD=function(e){var n=e.isDragging,r=e.isHovering;return n?"grabbing":r?"pointer":"grab"},iD=Object.assign({},ic.defaultProps,Gu,Ky.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(e){return e.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",clickRadius:0,getCursor:rD}),IC=function(t){Ci(n,t);var e=eD(n);Nn(n,null,[{key:"supported",value:function(){return ic.supported()}}]);function n(r){var o;return Gn(this,n),o=e.call(this,r),me(ot(o),"state",{isLoaded:!1,isDragging:!1,isHovering:!1}),me(ot(o),"_controller",void 0),me(ot(o),"_eventManager",void 0),me(ot(o),"_interactiveContext",void 0),me(ot(o),"_width",0),me(ot(o),"_height",0),me(ot(o),"_eventCanvasRef",st.createRef()),me(ot(o),"_staticMapRef",st.createRef()),me(ot(o),"getMap",function(){return o._staticMapRef.current?o._staticMapRef.current.getMap():null}),me(ot(o),"queryRenderedFeatures",function(l){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=o.getMap();return d&&d.queryRenderedFeatures(l,a)}),me(ot(o),"_onInteractionStateChange",function(l){var a=l.isDragging,d=a===void 0?!1:a;d!==o.state.isDragging&&(o._updateInteractiveContext({isDragging:d}),o.setState({isDragging:d}));var g=o.props.onInteractionStateChange;g&&g(l)}),me(ot(o),"_onResize",function(l){var a=l.width,d=l.height;o._width=a,o._height=d,o._setControllerProps(o.props),o.props.onResize({width:a,height:d})}),me(ot(o),"_onViewportChange",function(l,a,d){var g=o.props,x=g.onViewStateChange,E=g.onViewportChange;x&&x({viewState:l,interactionState:a,oldViewState:d}),E&&E(l,a,d)}),me(ot(o),"_onLoad",function(l){o.setState({isLoaded:!0}),o.props.onLoad(l)}),me(ot(o),"_onEvent",function(l,a){var d=o.props[l];d&&d(o._normalizeEvent(a))}),me(ot(o),"_onPointerDown",function(l){switch(l.pointerType){case"touch":o._onEvent("onTouchStart",l);break;default:o._onEvent("onMouseDown",l)}}),me(ot(o),"_onPointerUp",function(l){switch(l.pointerType){case"touch":o._onEvent("onTouchEnd",l);break;default:o._onEvent("onMouseUp",l)}}),me(ot(o),"_onPointerMove",function(l){switch(l.pointerType){case"touch":o._onEvent("onTouchMove",l);break;default:o._onEvent("onMouseMove",l)}if(!o.state.isDragging){var a=o.props,d=a.onHover,g=a.interactiveLayerIds,x;l=o._normalizeEvent(l),o.state.isLoaded&&(g||d)&&(x=o._getFeatures({pos:l.point,radius:o.props.clickRadius})),d&&(l.features=x,d(l));var E=Boolean(g&&x&&x.length>0),P=E&&!o.state.isHovering,A=!E&&o.state.isHovering;P&&o._onEvent("onMouseEnter",l),A&&o._onEvent("onMouseLeave",l),(P||A)&&o.setState({isHovering:E})}}),me(ot(o),"_onClick",function(l){var a=o.props,d=a.onClick,g=a.onNativeClick,x=a.onDblClick,E=a.doubleClickZoom,P=[],A=x||E;switch(l.type){case"anyclick":P.push(g),A||P.push(d);break;case"click":A&&P.push(d);break}P=P.filter(Boolean),P.length&&(l=o._normalizeEvent(l),l.features=o._getFeatures({pos:l.point,radius:o.props.clickRadius}),P.forEach(function(R){return R(l)}))}),CC(r),o._controller=r.controller||new AC,o._eventManager=new Zz(null,{touchAction:r.touchAction}),o._updateInteractiveContext({isDragging:!1,eventManager:o._eventManager}),o}return Nn(n,[{key:"componentDidMount",value:function(){var o=this._eventManager,l=this._eventCanvasRef.current;o.setElement(l),o.on({pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerup:this._onPointerUp,pointerleave:this._onEvent.bind(this,"onMouseOut"),click:this._onClick,anyclick:this._onClick,dblclick:this._onEvent.bind(this,"onDblClick"),wheel:this._onEvent.bind(this,"onWheel"),contextmenu:this._onEvent.bind(this,"onContextMenu")}),this._setControllerProps(this.props),this._updateInteractiveContext({mapContainer:l})}},{key:"componentDidUpdate",value:function(){this._setControllerProps(this.props)}},{key:"componentWillUnmount",value:function(){this._eventManager.destroy()}},{key:"_setControllerProps",value:function(o){o=Object.assign({},o,o.viewState,{isInteractive:Boolean(o.onViewStateChange||o.onViewportChange),onViewportChange:this._onViewportChange,onStateChange:this._onInteractionStateChange,eventManager:this._eventManager,width:this._width,height:this._height}),this._controller.setOptions(o);var l=this._interactiveContext;l.onViewportChange=o.onViewportChange,l.onViewStateChange=o.onViewStateChange}},{key:"_getFeatures",value:function(o){var l=o.pos,a=o.radius,d,g={},x=this.getMap();if(this.props.interactiveLayerIds&&(g.layers=this.props.interactiveLayerIds),a){var E=a,P=[[l[0]-E,l[1]+E],[l[0]+E,l[1]-E]];d=x&&x.queryRenderedFeatures(P,g)}else d=x&&x.queryRenderedFeatures(l,g);return d}},{key:"_updateInteractiveContext",value:function(o){this._interactiveContext=Object.assign({},this._interactiveContext,o)}},{key:"_normalizeEvent",value:function(o){if(o.lngLat)return o;var l=o.offsetCenter,a=l.x,d=l.y,g=[a,d],x=new ia(Object.assign({},this.props,{width:this._width,height:this._height}));return o.point=g,o.lngLat=x.unproject(g),o}},{key:"render",value:function(){var o=this.props,l=o.width,a=o.height,d=o.style,g=o.getCursor,x=Object.assign({position:"relative"},d,{width:l,height:a,cursor:g(this.state)});return st.createElement(Gh.Provider,{value:this._interactiveContext},st.createElement("div",{key:"event-canvas",ref:this._eventCanvasRef,style:x},st.createElement(ic,G0({},this.props,{width:"100%",height:"100%",style:null,onResize:this._onResize,onLoad:this._onLoad,ref:this._staticMapRef}),this.props.children)))}}]),n}(st.PureComponent);me(IC,"propTypes",nD);me(IC,"defaultProps",iD);function Wu(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!Wu(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(Ju(t)==="object"&&Ju(e)==="object"){var r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(var l=0,a=r;l<a.length;l++){var d=a[l];if(!e.hasOwnProperty(d)||!Wu(t[d],e[d]))return!1}return!0}return!1}function oD(t){var e=aD();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function aD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var sD={type:De.string.isRequired,id:De.string},lD=0,uD=function(t){Ci(n,t);var e=oD(n);function n(r){var o;return Gn(this,n),o=e.call(this,r),me(ot(o),"id",void 0),me(ot(o),"type",void 0),me(ot(o),"_map",null),me(ot(o),"_sourceOptions",{}),me(ot(o),"_updateSource",function(){var l=ot(o),a=l.type,d=l._map;if(d){var g=ot(o),x=g._sourceOptions,E=g.props;Qi(!E.id||E.id===o.id,"source id changed"),Qi(E.type===a,"source type changed");var P="",A=0;for(var R in E)R!=="children"&&R!=="id"&&!Wu(x[R],E[R])&&(x[R]=E[R],P=R,A++);var j=o.getSource();if(!j){o._createSource(x);return}A&&(a==="geojson"?j.setData(x.data):a==="image"?j.updateImage({url:x.url,coordinates:x.coordinates}):(a==="canvas"||a==="video")&&A===1&&P==="coordinates"?j.setCoordinates(x.coordinates):console.warn("Unable to update <Source> prop: ".concat(P)))}}),o.id=r.id||"jsx-source-".concat(lD++),o.type=r.type,o}return Nn(n,[{key:"componentWillUnmount",value:function(){var o=this,l=this._map;l&&(l.off("styledata",this._updateSource),requestAnimationFrame(function(){l.style&&l.style._loaded&&l.removeSource(o.id)}))}},{key:"getSource",value:function(){var o=this._map;return o&&o.style&&o.getSource(this.id)}},{key:"_createSource",value:function(o){var l=this._map;l.style&&l.style._loaded&&l.addSource(this.id,o)}},{key:"_render",value:function(o){var l=this;return!this._map&&o.map&&(this._map=o.map,this._map.on("styledata",this._updateSource)),this._updateSource(),st.Children.map(this.props.children,function(a){return st.cloneElement(a,{source:l.id})})}},{key:"render",value:function(){return st.createElement(Gh.Consumer,null,this._render.bind(this))}}]),n}(st.PureComponent);me(uD,"propTypes",sD);function cD(t,e){if(t==null)return{};var n={},r=Object.keys(t),o,l;for(l=0;l<r.length;l++)o=r[l],!(e.indexOf(o)>=0)&&(n[o]=t[o]);return n}function hD(t,e){if(t==null)return{};var n=cD(t,e),r,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(o=0;o<l.length;o++)r=l[o],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function fD(t){var e=pD();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function pD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var dD={type:De.string.isRequired,id:De.string,source:De.string,beforeId:De.string};function mD(t,e,n,r){var o=n.layout,l=o===void 0?{}:o,a=n.paint,d=a===void 0?{}:a,g=n.filter,x=n.minzoom,E=n.maxzoom,P=n.beforeId,A=hD(n,["layout","paint","filter","minzoom","maxzoom","beforeId"]);if(P!==r.beforeId&&t.moveLayer(e,P),l!==r.layout)for(var R in l)Wu(l[R],r.layout[R])||t.setLayoutProperty(e,R,l[R]);if(d!==r.paint)for(var j in d)Wu(d[j],r.paint[j])||t.setPaintProperty(e,j,d[j]);Wu(g,r.filter)||t.setFilter(e,g),(x!==r.minzoom||E!==r.maxzoom)&&t.setLayerZoomRange(e,x,E);for(var X in A)Wu(A[X],r[X])||t.setLayerProperty(e,X,A[X])}var gD=0,yD=function(t){Ci(n,t);var e=fD(n);function n(r){var o;return Gn(this,n),o=e.call(this,r),me(ot(o),"id",void 0),me(ot(o),"type",void 0),me(ot(o),"_map",null),me(ot(o),"_layerOptions",{}),me(ot(o),"_updateLayer",function(){var l=o._map;if(l){var a=ot(o),d=a.props,g=a._layerOptions;if(Qi(!d.id||d.id===o.id,"layer id changed"),Qi(d.type===o.type,"layer type changed"),!o.getLayer()){o._createLayer();return}try{mD(l,o.id,d,g),Object.assign(g,d)}catch(x){console.warn(x)}}}),o.id=r.id||"jsx-layer-".concat(gD++),o.type=r.type,o}return Nn(n,[{key:"componentDidMount",value:function(){this._updateLayer()}},{key:"componentDidUpdate",value:function(){this._updateLayer()}},{key:"componentWillUnmount",value:function(){var o=this._map;o&&(o.off("styledata",this._updateLayer),o.style&&o.style._loaded&&o.removeLayer(this.id))}},{key:"getLayer",value:function(){var o=this._map;return o&&o.style&&o.getLayer(this.id)}},{key:"_createLayer",value:function(){var o=this._map;if(o.style&&o.style._loaded){var l=Object.assign({},this.props);l.id=this.id,delete l.beforeId,o.addLayer(l,this.props.beforeId),this._layerOptions=l}}},{key:"_render",value:function(o){return!this._map&&o.map&&(this._map=o.map,this._map.on("styledata",this._updateLayer)),null}},{key:"render",value:function(){return st.createElement(Gh.Consumer,null,this._render.bind(this))}}]),n}(st.PureComponent);me(yD,"propTypes",dD);function vD(t){var e=_D();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function _D(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var xD={captureScroll:De.bool,captureDrag:De.bool,captureClick:De.bool,captureDoubleClick:De.bool},bD={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0},rr=function(t){Ci(n,t);var e=vD(n);function n(){var r;Gn(this,n);for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return r=e.call.apply(e,[this].concat(l)),me(ot(r),"_context",{}),me(ot(r),"_events",null),me(ot(r),"_containerRef",st.createRef()),me(ot(r),"_onScroll",function(d){r.props.captureScroll&&d.stopPropagation()}),me(ot(r),"_onDragStart",function(d){r.props.captureDrag&&d.stopPropagation()}),me(ot(r),"_onDblClick",function(d){r.props.captureDoubleClick&&d.stopPropagation()}),me(ot(r),"_onClick",function(d){r.props.captureClick&&d.stopPropagation()}),r}return Nn(n,[{key:"componentDidMount",value:function(){var o=this._containerRef.current;if(o){var l=this._context.eventManager;l&&(this._events={wheel:this._onScroll,panstart:this._onDragStart,anyclick:this._onClick,click:this._onClick,dblclick:this._onDblClick},l.watch(this._events,o))}}},{key:"componentWillUnmount",value:function(){var o=this._context.eventManager;o&&this._events&&o.off(this._events)}},{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){var o=this;return st.createElement(Gh.Consumer,null,function(l){return o._context=l,o._render()})}}]),n}(st.PureComponent);me(rr,"propTypes",xD);me(rr,"defaultProps",bD);function wD(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=an(t),t!==null););return t}function Lh(t,e,n){return typeof Reflect<"u"&&Reflect.get?Lh=Reflect.get:Lh=function(o,l,a){var d=wD(o,l);if(d){var g=Object.getOwnPropertyDescriptor(d,l);return g.get?g.get.call(a):g.value}},Lh(t,e,n||t)}function ED(t){var e=TD();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function TD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var SD=Object.assign({},rr.propTypes,{draggable:De.bool,onDrag:De.func,onDragEnd:De.func,onDragStart:De.func,offsetLeft:De.number,offsetTop:De.number}),PD=Object.assign({},rr.defaultProps,{draggable:!1,offsetLeft:0,offsetTop:0}),Td=function(t){Ci(n,t);var e=ED(n);function n(){var r;Gn(this,n);for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return r=e.call.apply(e,[this].concat(l)),me(ot(r),"state",{dragPos:null,dragOffset:null}),me(ot(r),"_dragEvents",null),me(ot(r),"_onDragStart",function(d){var g=r.props,x=g.draggable,E=g.captureDrag;if((x||E)&&d.stopPropagation(),!!x){var P=r._getDragEventPosition(d),A=r._getDragEventOffset(d);r.setState({dragPos:P,dragOffset:A}),r._setupDragEvents();var R=r.props.onDragStart;if(R&&A){var j=Object.assign({},d);j.lngLat=r._getDragLngLat(P,A),R(j)}}}),me(ot(r),"_onDrag",function(d){d.stopPropagation();var g=r._getDragEventPosition(d);r.setState({dragPos:g});var x=r.props.onDrag,E=r.state.dragOffset;if(x&&E){var P=Object.assign({},d);P.lngLat=r._getDragLngLat(g,E),x(P)}}),me(ot(r),"_onDragEnd",function(d){var g=r.state,x=g.dragPos,E=g.dragOffset;d.stopPropagation(),r.setState({dragPos:null,dragOffset:null}),r._removeDragEvents();var P=r.props.onDragEnd;if(P&&x&&E){var A=Object.assign({},d);A.lngLat=r._getDragLngLat(x,E),P(A)}}),me(ot(r),"_onDragCancel",function(d){d.stopPropagation(),r.setState({dragPos:null,dragOffset:null}),r._removeDragEvents()}),r}return Nn(n,[{key:"componentWillUnmount",value:function(){Lh(an(n.prototype),"componentWillUnmount",this).call(this),this._removeDragEvents()}},{key:"_setupDragEvents",value:function(){var o=this._context.eventManager;o&&(this._dragEvents={panmove:this._onDrag,panend:this._onDragEnd,pancancel:this._onDragCancel},o.on(this._dragEvents))}},{key:"_removeDragEvents",value:function(){var o=this._context.eventManager;!o||!this._dragEvents||(o.off(this._dragEvents),this._dragEvents=null)}},{key:"_getDragEventPosition",value:function(o){var l=o.offsetCenter,a=l.x,d=l.y;return[a,d]}},{key:"_getDragEventOffset",value:function(o){var l=o.center,a=l.x,d=l.y,g=this._containerRef.current;if(g){var x=g.getBoundingClientRect();return[x.left-a,x.top-d]}return null}},{key:"_getDraggedPosition",value:function(o,l){return[o[0]+l[0],o[1]+l[1]]}},{key:"_getDragLngLat",value:function(o,l){var a=this.props,d=a.offsetLeft,g=a.offsetTop,x=this._getDraggedPosition(o,l),E=Hr(x,2),P=E[0],A=E[1];return this._context.viewport.unproject([P-d,A-g])}}]),n}(rr);me(Td,"propTypes",SD);me(Td,"defaultProps",PD);var IT=typeof window<"u"&&window.devicePixelRatio||1,td=function(e){return Math.round(e*IT)/IT},MT=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(e===null)return n;var o=r==="x"?e.offsetWidth:e.offsetHeight;return td(n/100*o)/o*100};function AD(t){var e=CD();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function CD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var ID=Object.assign({},Td.propTypes,{className:De.string,longitude:De.number.isRequired,latitude:De.number.isRequired}),MD=Object.assign({},Td.defaultProps,{className:""}),zx=function(t){Ci(n,t);var e=AD(n);function n(){var r;Gn(this,n);for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return r=e.call.apply(e,[this].concat(l)),me(ot(r),"_control",null),r}return Nn(n,[{key:"_getPosition",value:function(){var o=this.props,l=o.longitude,a=o.latitude,d=o.offsetLeft,g=o.offsetTop,x=this.state,E=x.dragPos,P=x.dragOffset;if(E&&P)return this._getDraggedPosition(E,P);var A=this._context.viewport.project([l,a]),R=Hr(A,2),j=R[0],X=R[1];return j+=d,X+=g,[j,X]}},{key:"_render",value:function(){var o=this._getPosition(),l=Hr(o,2),a=l[0],d=l[1],g="translate(".concat(td(a),"px, ").concat(td(d),"px)"),x=this._containerRef.current;if(this._control&&x)x.style.transform=g;else{var E=this.props,P=E.className,A=E.draggable,R=this.state.dragPos,j={position:"absolute",left:0,top:0,transform:g,cursor:A?R?"grabbing":"grab":"auto"};this._control=st.createElement("div",{className:"mapboxgl-marker ".concat(P),ref:this._containerRef,style:j},this.props.children)}return this._control}},{key:"render",value:function(){return this._control=null,Lh(an(n.prototype),"render",this).call(this)}}]),n}(Td);me(zx,"propTypes",ID);me(zx,"defaultProps",MD);var nd={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},kD=Object.keys(nd);function LD(t){var e=t.x,n=t.y,r=t.width,o=t.height,l=t.selfWidth,a=t.selfHeight,d=t.anchor,g=t.padding,x=g===void 0?0:g,E=nd[d],P=E.x,A=E.y,R=n-A*a,j=R+a,X=.5;if(R<x)for(;R<x&&A>=X;)A-=X,R+=X*a;else if(j>o-x)for(;j>o-x&&A<=1-X;)A+=X,j-=X*a;var D=e-P*l,F=D+l,W=.5;if(A===.5&&(P=Math.floor(P),W=1),D<x)for(;D<x&&P>=W;)P-=W,D+=W*l;else if(F>r-x)for(;F>r-x&&P<=1-W;)P+=W,F-=W*l;return kD.find(function(J){var le=nd[J];return le.x===P&&le.y===A})||d}function RD(t){var e=OD();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function OD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var zD=Object.assign({},rr.propTypes,{className:De.string,longitude:De.number.isRequired,latitude:De.number.isRequired,altitude:De.number,offsetLeft:De.number,offsetTop:De.number,tipSize:De.number,closeButton:De.bool,closeOnClick:De.bool,anchor:De.oneOf(Object.keys(nd)),dynamicPosition:De.bool,sortByDepth:De.bool,onClose:De.func}),DD=Object.assign({},rr.defaultProps,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}}),MC=function(t){Ci(n,t);var e=RD(n);function n(){var r;Gn(this,n);for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return r=e.call.apply(e,[this].concat(l)),me(ot(r),"_closeOnClick",!1),me(ot(r),"_contentRef",st.createRef()),me(ot(r),"_onClick",function(d){if(r.props.captureClick&&d.stopPropagation(),r.props.closeOnClick||d.target.className==="mapboxgl-popup-close-button"){r.props.onClose();var g=r._context.eventManager;g&&g.once("click",function(x){return x.stopPropagation()},d.target)}}),r}return Nn(n,[{key:"componentDidMount",value:function(){Lh(an(n.prototype),"componentDidMount",this).call(this),this.forceUpdate()}},{key:"_getPosition",value:function(o,l){var a=this._context.viewport,d=this.props,g=d.anchor,x=d.dynamicPosition,E=d.tipSize,P=this._contentRef.current;return P&&x?LD({x:o,y:l,anchor:g,padding:E,width:a.width,height:a.height,selfWidth:P.clientWidth,selfHeight:P.clientHeight}):g}},{key:"_getContainerStyle",value:function(o,l,a,d){var g=this._context.viewport,x=this.props,E=x.offsetLeft,P=x.offsetTop,A=x.sortByDepth,R=nd[d],j=o+E,X=l+P,D=this._containerRef.current,F=MT(D,-R.x*100),W=MT(D,-R.y*100,"y"),J={position:"absolute",transform:`
        translate(`.concat(F,"%, ").concat(W,`%)
        translate(`).concat(td(j),"px, ").concat(td(X),`px)
      `),display:void 0,zIndex:void 0};return A&&(a>1||a<-1||o<0||o>g.width||l<0||l>g.height?J.display="none":J.zIndex=Math.floor((1-a)/2*1e5)),J}},{key:"_renderTip",value:function(o){var l=this.props.tipSize;return st.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:l}})}},{key:"_renderContent",value:function(){var o=this.props,l=o.closeButton,a=o.children,d=this._context.eventManager?null:this._onClick;return st.createElement("div",{key:"content",ref:this._contentRef,className:"mapboxgl-popup-content",onClick:d},l&&st.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button"},""),a)}},{key:"_render",value:function(){var o=this.props,l=o.className,a=o.longitude,d=o.latitude,g=o.altitude,x=this._context.viewport.project([a,d,g]),E=Hr(x,3),P=E[0],A=E[1],R=E[2],j=this._getPosition(P,A),X=this._getContainerStyle(P,A,R,j);return st.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(j," ").concat(l),style:X,ref:this._containerRef},this._renderTip(j),this._renderContent())}}]),n}(rr);me(MC,"propTypes",zD);me(MC,"defaultProps",DD);function FD(t){var e=ND();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function ND(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var BD=Object.assign({},rr.propTypes,{className:De.string,container:De.object}),UD=Object.assign({},rr.defaultProps,{className:"",container:null}),kC=function(t){Ci(n,t);var e=FD(n);function n(){var r;Gn(this,n);for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return r=e.call.apply(e,[this].concat(l)),me(ot(r),"state",{isFullscreen:!1,showButton:!1}),me(ot(r),"_mapboxFullscreenControl",null),me(ot(r),"_onFullscreenChange",function(){var d=!r._mapboxFullscreenControl._fullscreen;r._mapboxFullscreenControl._fullscreen=d,r.setState({isFullscreen:d})}),me(ot(r),"_onClickFullscreen",function(){r._mapboxFullscreenControl._onClickFullscreen()}),r}return Nn(n,[{key:"componentDidMount",value:function(){var o=this.props.container||this._context.mapContainer;this._mapboxFullscreenControl=new Ks.FullscreenControl({container:o}),this.setState({showButton:this._mapboxFullscreenControl._checkFullscreenSupport()}),zl.addEventListener(this._mapboxFullscreenControl._fullscreenchange,this._onFullscreenChange)}},{key:"componentWillUnmount",value:function(){zl.removeEventListener(this._mapboxFullscreenControl._fullscreenchange,this._onFullscreenChange)}},{key:"_renderButton",value:function(o,l,a){return st.createElement("button",{key:o,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(o),type:"button",title:l,onClick:a},st.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}},{key:"_render",value:function(){if(!this.state.showButton)return null;var o=this.props.className,l=this.state.isFullscreen,a=l?"shrink":"fullscreen";return st.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group ".concat(o),ref:this._containerRef},this._renderButton(a,"Toggle fullscreen",this._onClickFullscreen))}}]),n}(rr);me(kC,"propTypes",BD);me(kC,"defaultProps",UD);var ah;function VD(){return ah!==void 0?Promise.resolve(ah):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(t){return ah=t.state!=="denied",ah}):(ah=Boolean(window.navigator.geolocation),Promise.resolve(ah))}function jD(t){var e=GD();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function GD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var WD=Object.assign({},Ky.defaultProps,{transitionDuration:500}),kT=function(){},HD=Object.assign({},rr.propTypes,{className:De.string,style:De.object,label:De.string,auto:De.bool,positionOptions:De.object,fitBoundsOptions:De.object,trackUserLocation:De.bool,showUserLocation:De.bool,onViewStateChange:De.func,onViewportChange:De.func,onGeolocate:De.func}),qD=Object.assign({},rr.defaultProps,{className:"",style:{},label:"Geolocate",auto:!1,positionOptions:null,fitBoundsOptions:null,trackUserLocation:!1,showUserLocation:!0,onGeolocate:function(){}}),LC=function(t){Ci(n,t);var e=jD(n);function n(){var r;Gn(this,n);for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return r=e.call.apply(e,[this].concat(l)),me(ot(r),"state",{supportsGeolocation:!1,markerPosition:null}),me(ot(r),"_mapboxGeolocateControl",null),me(ot(r),"_geolocateButtonRef",st.createRef()),me(ot(r),"_setupMapboxGeolocateControl",function(d){if(!d){console.warn("Geolocation support is not available, the GeolocateControl will not be visible.");return}var g={showUserLocation:!1};["positionOptions","fitBoundsOptions","trackUserLocation"].forEach(function(P){P in r.props&&r.props[P]!==null&&(g[P]=r.props[P])});var x=new Ks.GeolocateControl(g);r._mapboxGeolocateControl=x,x._watchState="OFF",x._geolocateButton=r._geolocateButtonRef.current,x.options.trackUserLocation&&x._geolocateButton&&x._geolocateButton.setAttribute("aria-pressed","false"),x._updateMarker=r._updateMarker,x._updateCamera=r._updateCamera,x._setup=!0;var E=r._context.eventManager;x.options.trackUserLocation&&E&&E.on("panstart",function(){x._watchState==="ACTIVE_LOCK"&&(x._watchState="BACKGROUND",x._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),x._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"))}),x.on("geolocate",r.props.onGeolocate)}),me(ot(r),"_triggerGeolocate",function(){var d=r._mapboxGeolocateControl;return d._map=r._context.map,r.props.showUserLocation&&(d.on("geolocate",r._updateMarker),d.on("trackuserlocationend",r._updateMarker)),r._mapboxGeolocateControl.trigger()}),me(ot(r),"_updateMarker",function(d){d&&r.setState({markerPosition:d.coords})}),me(ot(r),"_getBounds",function(d){var g=new Ks.LngLat(d.coords.longitude,d.coords.latitude),x=d.coords.accuracy,E=g.toBounds(x);return[[E._ne.lng,E._ne.lat],[E._sw.lng,E._sw.lat]]}),me(ot(r),"_updateCamera",function(d){var g=r._context.viewport,x=r._getBounds(d),E=new ia(g).fitBounds(x),P=E.longitude,A=E.latitude,R=E.zoom,j=Object.assign({},g,{longitude:P,latitude:A,zoom:R}),X=new ed(j),D=Object.assign({},X.getViewportProps(),WD),F=r.props.onViewportChange||r._context.onViewportChange||kT,W=r.props.onViewStateChange||r._context.onViewStateChange||kT;W({viewState:D}),F(D)}),me(ot(r),"_renderButton",function(d,g,x){return st.createElement("button",{key:d,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(d),ref:r._geolocateButtonRef,type:"button",title:g,onClick:x},st.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}),me(ot(r),"_renderMarker",function(){var d=r.state.markerPosition,g=r.props.showUserLocation;return!d||!g?null:st.createElement(zx,{key:"location-maker",className:"mapboxgl-user-location-dot",longitude:d.longitude,latitude:d.latitude,onContextMenu:function(E){return E.preventDefault()},captureDrag:!1,captureDoubleClick:!1})}),r}return Nn(n,[{key:"componentDidMount",value:function(){var o=this;VD().then(function(l){o.setState({supportsGeolocation:l}),o._setupMapboxGeolocateControl(l),l&&o.props.auto&&o._triggerGeolocate()})}},{key:"componentDidUpdate",value:function(o){this.state.supportsGeolocation&&!o.auto&&this.props.auto&&this._triggerGeolocate()}},{key:"componentWillUnmount",value:function(){if(this._mapboxGeolocateControl){var o=this._mapboxGeolocateControl._geolocationWatchID;o!==void 0&&(window.navigator.geolocation.clearWatch(o),this._mapboxGeolocateControl._geolocationWatchID=void 0)}}},{key:"_render",value:function(){if(!this.state.supportsGeolocation)return null;var o=this.props,l=o.className,a=o.style,d=o.label;return st.createElement("div",null,this._renderMarker(),st.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group ".concat(l),ref:this._containerRef,style:a,onContextMenu:function(x){return x.preventDefault()}},this._renderButton("geolocate",d,this._triggerGeolocate)))}}]),n}(rr);me(LC,"propTypes",HD);me(LC,"defaultProps",qD);function ZD(t,e){for(var n=(t||"").split(".").map(Number),r=(e||"").split(".").map(Number),o=0;o<3;o++){var l=n[o]||0,a=r[o]||0;if(l<a)return-1;if(l>a)return 1}return 0}function $D(t){var e=XD();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function XD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var LT=function(){},YD=Object.assign({},rr.propTypes,{className:De.string,onViewStateChange:De.func,onViewportChange:De.func,showCompass:De.bool,showZoom:De.bool,zoomInLabel:De.string,zoomOutLabel:De.string,compassLabel:De.string}),KD=Object.assign({},rr.defaultProps,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),JD=1,t1=2;function QD(t){return ZD(t,"1.6.0")>=0?t1:JD}var RC=function(t){Ci(n,t);var e=$D(n);function n(r){var o;return Gn(this,n),o=e.call(this,r),me(ot(o),"_uiVersion",void 0),me(ot(o),"_onZoomIn",function(){o._updateViewport({zoom:o._context.viewport.zoom+1})}),me(ot(o),"_onZoomOut",function(){o._updateViewport({zoom:o._context.viewport.zoom-1})}),me(ot(o),"_onResetNorth",function(){o._updateViewport({bearing:0,pitch:0})}),CC(r),o}return Nn(n,[{key:"_updateViewport",value:function(o){var l=this._context.viewport,a=new ed(Object.assign({},l,o)),d=Object.assign({},a.getViewportProps(),e1),g=this.props.onViewportChange||this._context.onViewportChange||LT,x=this.props.onViewStateChange||this._context.onViewStateChange||LT;x({viewState:d}),g(d)}},{key:"_renderCompass",value:function(){var o=this._context.viewport.bearing,l={transform:"rotate(".concat(-o,"deg)")};return this._uiVersion===t1?st.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:l}):st.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:l})}},{key:"_renderButton",value:function(o,l,a,d){return st.createElement("button",{key:o,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(o),type:"button",title:l,onClick:a},d||st.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}},{key:"_render",value:function(){var o=this.props,l=o.className,a=o.showCompass,d=o.showZoom,g=o.zoomInLabel,x=o.zoomOutLabel,E=o.compassLabel;if(!this._uiVersion){var P=this._context.map;this._uiVersion=P?QD(P.version):t1}return st.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group ".concat(l),ref:this._containerRef},d&&this._renderButton("zoom-in",g,this._onZoomIn),d&&this._renderButton("zoom-out",x,this._onZoomOut),a&&this._renderButton("compass",E,this._onResetNorth,this._renderCompass()))}}]),n}(rr);me(RC,"propTypes",YD);me(RC,"defaultProps",KD);function eF(t){var e=tF();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function tF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var nF=Object.assign({},rr.propTypes,{maxWidth:De.number,unit:De.oneOf(["imperial","metric","nautical"])}),rF=Object.assign({},rr.defaultProps,{maxWidth:100,unit:"metric"}),OC=function(t){Ci(n,t);var e=eF(n);function n(){var r;Gn(this,n);for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return r=e.call.apply(e,[this].concat(l)),me(ot(r),"_control",null),me(ot(r),"_mapboxScaleControl",null),r}return Nn(n,[{key:"componentDidMount",value:function(){var o=new Ks.ScaleControl;o._map=this._context.map,o._container=this._containerRef.current,this._mapboxScaleControl=o,this._update()}},{key:"_update",value:function(){var o=this._mapboxScaleControl;o&&(o.options=this.props,o._onMove())}},{key:"_render",value:function(){return this._control=this._control||st.createElement("div",{ref:this._containerRef,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}),this._update(),this._control}}]),n}(rr);me(OC,"propTypes",nF);me(OC,"defaultProps",rF);function iF(t){var e=oF();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function oF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var aF=Object.assign({},rr.propTypes,{redraw:De.func.isRequired}),sF={captureScroll:!1,captureDrag:!1,captureClick:!1,captureDoubleClick:!1},zC=function(t){Ci(n,t);var e=iF(n);function n(){var r;Gn(this,n);for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return r=e.call.apply(e,[this].concat(l)),me(ot(r),"_canvas",void 0),me(ot(r),"_ctx",void 0),me(ot(r),"_redraw",function(){var d=r._ctx;if(d){var g=sT.devicePixelRatio||1;d.save(),d.scale(g,g);var x=r._context,E=x.viewport,P=x.isDragging;r.props.redraw({width:E.width,height:E.height,ctx:d,isDragging:P,project:E.project.bind(E),unproject:E.unproject.bind(E)}),d.restore()}}),r}return Nn(n,[{key:"componentDidMount",value:function(){var o=this._containerRef.current;o&&(this._canvas=o,this._ctx=o.getContext("2d")),this._redraw()}},{key:"_render",value:function(){var o=sT.devicePixelRatio||1,l=this._context.viewport,a=l.width,d=l.height;return this._redraw(),st.createElement("canvas",{ref:this._containerRef,width:a*o,height:d*o,style:{width:"".concat(a,"px"),height:"".concat(d,"px"),position:"absolute",left:0,top:0}})}}]),n}(rr);me(zC,"propTypes",aF);me(zC,"defaultProps",sF);function lF(t){var e=uF();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function uF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var cF=Object.assign({},rr.propTypes,{redraw:De.func.isRequired,style:De.object}),hF={captureScroll:!1,captureDrag:!1,captureClick:!1,captureDoubleClick:!1},DC=function(t){Ci(n,t);var e=lF(n);function n(){return Gn(this,n),e.apply(this,arguments)}return Nn(n,[{key:"_render",value:function(){var o=this._context,l=o.viewport,a=o.isDragging,d=Object.assign({position:"absolute",left:0,top:0,width:l.width,height:l.height},this.props.style);return st.createElement("div",{ref:this._containerRef,style:d},this.props.redraw({width:l.width,height:l.height,isDragging:a,project:l.project.bind(l),unproject:l.unproject.bind(l)}))}}]),n}(rr);me(DC,"propTypes",cF);me(DC,"defaultProps",hF);function fF(t){var e=pF();return function(){var n=an(t),r;if(e){var o=an(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ii(this,r)}}function pF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var dF=Object.assign({},rr.propTypes,{redraw:De.func.isRequired,style:De.object}),mF={captureScroll:!1,captureDrag:!1,captureClick:!1,captureDoubleClick:!1},FC=function(t){Ci(n,t);var e=fF(n);function n(){return Gn(this,n),e.apply(this,arguments)}return Nn(n,[{key:"_render",value:function(){var o=this._context,l=o.viewport,a=o.isDragging,d=Object.assign({position:"absolute",left:0,top:0},this.props.style);return st.createElement("svg",{width:l.width,height:l.height,ref:this._containerRef,style:d},this.props.redraw({width:l.width,height:l.height,isDragging:a,project:l.project.bind(l),unproject:l.unproject.bind(l)}))}}]),n}(rr);me(FC,"propTypes",dF);me(FC,"defaultProps",mF);Ks&&Ks.setRTLTextPlugin;function fy(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Dx=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),RT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);RT&&parseFloat(RT[1]);const gF="3.2.13";function Js(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Ag=typeof process!="object"||String(process)!=="[object process]"||process.browser,yF=typeof window<"u"&&typeof window.orientation<"u",OT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);OT&&parseFloat(OT[1]);class vF{constructor(e,n){me(this,"name",void 0),me(this,"workerThread",void 0),me(this,"isRunning",!0),me(this,"result",void 0),me(this,"_resolve",()=>{}),me(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((r,o)=>{this._resolve=r,this._reject=o})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Js(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Js(this.isRunning),this.isRunning=!1,this._reject(e)}}let p_=class{};const d_=new Map;function _F(t){Js(t.source&&!t.url||!t.source&&t.url);let e=d_.get(t.source||t.url);return e||(t.url&&(e=xF(t.url),d_.set(t.url,e)),t.source&&(e=NC(t.source),d_.set(t.source,e))),Js(e),e}function xF(t){if(!t.startsWith("http"))return t;const e=bF(t);return NC(e)}function NC(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function bF(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function BC(t,e=!0,n){const r=n||new Set;if(t){if(zT(t))r.add(t);else if(zT(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const o in t)BC(t[o],e,r)}}return n===void 0?Array.from(r):[]}function zT(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const m_=()=>{};class n1{static isSupported(){return typeof Worker<"u"&&Ag||typeof p_<"u"&&!Ag}constructor(e){me(this,"name",void 0),me(this,"source",void 0),me(this,"url",void 0),me(this,"terminated",!1),me(this,"worker",void 0),me(this,"onMessage",void 0),me(this,"onError",void 0),me(this,"_loadableURL","");const{name:n,source:r,url:o}=e;Js(r||o),this.name=n,this.source=r,this.url=o,this.onMessage=m_,this.onError=l=>console.log(l),this.worker=Ag?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=m_,this.onError=m_,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,n){n=n||BC(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=_F({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new p_(r,{eval:!1})}else if(this.source)e=new p_(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class wF{static isSupported(){return n1.isSupported()}constructor(e){me(this,"name","unnamed"),me(this,"source",void 0),me(this,"url",void 0),me(this,"maxConcurrency",1),me(this,"maxMobileConcurrency",1),me(this,"onDebug",()=>{}),me(this,"reuseWorkers",!0),me(this,"props",{}),me(this,"jobQueue",[]),me(this,"idleQueue",[]),me(this,"count",0),me(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(o,l,a)=>o.done(a),r=(o,l)=>o.error(l)){const o=new Promise(l=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:l}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new vF(n.name,e);e.onMessage=o=>n.onMessage(r,o.type,o.payload),e.onError=o=>n.onError(r,o),n.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new n1({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return yF?this.maxMobileConcurrency:this.maxConcurrency}}const EF={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Zs{static isSupported(){return n1.isSupported()}static getWorkerFarm(e={}){return Zs._workerFarm=Zs._workerFarm||new Zs({}),Zs._workerFarm.setProps(e),Zs._workerFarm}constructor(e){me(this,"props",void 0),me(this,"workerPools",new Map),this.props={...EF},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:o}=e;let l=this.workerPools.get(n);return l||(l=new wF({name:n,source:r,url:o}),l.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,l)),l}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}me(Zs,"_workerFarm",void 0);const TF="latest";function SF(t,e={}){const n=e[t.id]||{},r="".concat(t.id,"-worker.js");let o=n.workerUrl;if(!o&&t.id==="compression"&&(o=e.workerUrl),e._workerType==="test"&&(o="modules/".concat(t.module,"/dist/").concat(r)),!o){let l=t.version;l==="latest"&&(l=TF);const a=l?"@".concat(l):"";o="https://unpkg.com/@loaders.gl/".concat(t.module).concat(a,"/dist/").concat(r)}return Js(o),o}function PF(t,e=gF){Js(t,"no worker provided");const n=t.version;return!(!e||!n)}function AF(t,e){return!Zs.isSupported()||!Ag&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function CF(t,e,n,r,o){const l=t.id,a=SF(t,n),g=Zs.getWorkerFarm(n).getWorkerPool({name:l,url:a});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const x=await g.startJob("process-on-worker",IF.bind(null,o));return x.postMessage("process",{input:e,options:n,context:r}),await(await x.result).result}async function IF(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:o,input:l,options:a}=r;try{const d=await t(l,a);e.postMessage("done",{id:o,result:d})}catch(d){const g=d instanceof Error?d.message:"unknown error";e.postMessage("error",{id:o,error:g})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function UC(t){return t&&typeof t=="object"&&t.isBuffer}function MF(t){return UC(t)?new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer:t}function VC(t){if(UC(t))return MF(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function kF(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),o=new Uint8Array(e);for(let l=0;l<r.length;++l)if(r[l]!==o[l])return!1;return!0}function LF(...t){const e=t.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),n=e.reduce((l,a)=>l+a.byteLength,0),r=new Uint8Array(n);let o=0;for(const l of e)r.set(l,o),o+=l.byteLength;return r.buffer}async function RF(t){const e=[];for await(const n of t)e.push(n);return LF(...e)}function DT(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class FT{constructor(e,n){me(this,"name",void 0),me(this,"type",void 0),me(this,"sampleSize",1),me(this,"time",void 0),me(this,"count",void 0),me(this,"samples",void 0),me(this,"lastTiming",void 0),me(this,"lastSampleTime",void 0),me(this,"lastSampleCount",void 0),me(this,"_count",0),me(this,"_time",0),me(this,"_samples",0),me(this,"_startTime",0),me(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=DT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(DT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Fx{constructor(e){me(this,"id",void 0),me(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:r}=e;return this.stats[n]||(e instanceof FT?this.stats[n]=e:this.stats[n]=new FT(n,r)),this.stats[n]}}let OF="";const NT={};function zF(t){for(const e in NT)if(t.startsWith(e)){const n=NT[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(OF).concat(t)),t}function DF(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}const FF=t=>typeof t=="boolean",Np=t=>typeof t=="function",Sd=t=>t!==null&&typeof t=="object",BT=t=>Sd(t)&&t.constructor==={}.constructor,NF=t=>t&&typeof t[Symbol.iterator]=="function",BF=t=>t&&typeof t[Symbol.asyncIterator]=="function",nf=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,rf=t=>typeof Blob<"u"&&t instanceof Blob,UF=t=>t&&typeof t=="object"&&t.isBuffer,VF=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Sd(t)&&Np(t.tee)&&Np(t.cancel)&&Np(t.getReader),jF=t=>Sd(t)&&Np(t.read)&&Np(t.pipe)&&FF(t.readable),jC=t=>VF(t)||jF(t),GF=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,WF=/^([-\w.]+\/[-\w.+]+)/;function HF(t){const e=WF.exec(t);return e?e[1]:t}function UT(t){const e=GF.exec(t);return e?e[1]:""}const qF=/\?.*/;function Jy(t){if(nf(t)){const e=g_(t.url||""),n=t.headers.get("content-type")||"";return{url:e,type:HF(n)||UT(e)}}return rf(t)?{url:g_(t.name||""),type:t.type||""}:typeof t=="string"?{url:g_(t),type:UT(t)}:{url:"",type:""}}function ZF(t){return nf(t)?t.headers["content-length"]||-1:rf(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function g_(t){return t.replace(qF,"")}async function GC(t){if(nf(t))return t;const e={},n=ZF(t);n>=0&&(e["content-length"]=String(n));const{url:r,type:o}=Jy(t);o&&(e["content-type"]=o);const l=await YF(t);l&&(e["x-first-bytes"]=l),typeof t=="string"&&(t=new TextEncoder().encode(t));const a=new Response(t,{headers:e});return Object.defineProperty(a,"url",{value:r}),a}async function $F(t){if(!t.ok){const e=await XF(t);throw new Error(e)}}async function XF(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let r=t.statusText;n.includes("application/json")&&(r+=" ".concat(await t.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function YF(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const o=new FileReader;o.onload=l=>{var a;return r(l==null||(a=l.target)===null||a===void 0?void 0:a.result)},o.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),r=KF(n);return"data:base64,".concat(r)}return null}function KF(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}async function VT(t,e){if(typeof t=="string"){t=zF(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await GC(t)}function WC(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function nl(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||WC()}const Cg={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Jm=Cg.window||Cg.self||Cg.global,yp=Cg.process||{},HC=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";nl();const y_=globalThis;function qC(t){if(!t&&!nl())return"Node";if(WC(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const r=n.indexOf("MSIE ")!==-1,o=n.indexOf("Trident/")!==-1;return r||o?"IE":y_.chrome?"Chrome":y_.safari?"Safari":y_.mozInnerScreenX?"Firefox":"Unknown"}function JF(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class QF{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";me(this,"storage",void 0),me(this,"id",void 0),me(this,"config",{}),this.storage=JF(r),this.id=e,this.config={},Object.assign(this.config,n),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function eN(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function tN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function v_(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const o=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const l=t.width*n,a=t.height*n,d=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(l/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(o,");"),"background-size:".concat(l,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),d]}let py;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(py||(py={}));function jT(t){return typeof t=="string"?py[t.toUpperCase()]||py.WHITE:t}function nN(t,e,n){return!nl&&typeof t=="string"&&(e&&(e=jT(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=jT(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function rN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n);for(const o of r)typeof t[o]=="function"&&(e.find(l=>o===l)||(t[o]=t[o].bind(t)))}function dy(t,e){if(!t)throw new Error(e||"Assertion failed")}function sh(){let t;if(nl&&"performance"in Jm){var e,n;t=Jm==null||(e=Jm.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in yp){var r;const o=yp==null||(r=yp.hrtime)===null||r===void 0?void 0:r.call(yp);t=o[0]*1e3+o[1]/1e6}else t=Date.now();return t}const lh={debug:nl&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},iN={enabled:!0,level:0};function ta(){}const GT={},WT={once:!0};class Pd{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};me(this,"id",void 0),me(this,"VERSION",HC),me(this,"_startTs",sh()),me(this,"_deltaTs",sh()),me(this,"_storage",void 0),me(this,"userData",{}),me(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new QF("__probe-".concat(this.id,"__"),iN),this.userData={},this.timeStamp("".concat(this.id," started")),rN(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((sh()-this._startTs).toPrecision(10))}getDelta(){return Number((sh()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.updateConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){dy(e,n)}warn(e){return this._getLogFunction(0,e,lh.warn,arguments,WT)}error(e){return this._getLogFunction(0,e,lh.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,lh.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,lh.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var r=arguments.length,o=new Array(r>2?r-2:0),l=2;l<r;l++)o[l-2]=arguments[l];return this._getLogFunction(e,n,lh.debug||lh.info,arguments,WT)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||ta,r&&[r],{tag:lN(n)}):ta}image(e){let{logLevel:n,priority:r,image:o,message:l="",scale:a=1}=e;return this._shouldLog(n||r)?nl?sN({image:o,message:l,scale:a}):aN({image:o,message:l,scale:a}):ta}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||ta)}group(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const o=HT({logLevel:e,message:n,opts:r}),{collapsed:l}=r;return o.method=(l?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ta)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=ZC(e)}_getLogFunction(e,n,r,o,l){if(this._shouldLog(e)){l=HT({logLevel:e,message:n,args:o,opts:l}),r=r||l.method,dy(r),l.total=this.getTotal(),l.delta=this.getDelta(),this._deltaTs=sh();const a=l.tag||l.message;if(l.once)if(!GT[a])GT[a]=sh();else return ta;return n=oN(this.id,l.message,l),r.bind(console,n,...l.args)}return ta}}me(Pd,"VERSION",HC);function ZC(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return dy(Number.isFinite(e)&&e>=0),e}function HT(t){const{logLevel:e,message:n}=t;t.logLevel=ZC(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const o=typeof t.message;return dy(o==="string"||o==="object"),Object.assign(t,{args:r},t.opts)}function oN(t,e,n){if(typeof e=="string"){const r=n.time?tN(eN(n.total)):"";e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=nN(e,n.color,n.background)}return e}function aN(t){let{image:e,message:n="",scale:r=1}=t,o=null;try{o=XM.require("asciify-image")}catch{}return o?()=>o(e,{fit:"box",width:"".concat(Math.round(80*r),"%")}).then(l=>console.log(l)):ta}function sN(t){let{image:e,message:n="",scale:r=1}=t;if(typeof e=="string"){const l=new Image;return l.onload=()=>{const a=v_(l,n,r);console.log(...a)},l.src=e,ta}const o=e.nodeName||"";if(o.toLowerCase()==="img")return console.log(...v_(e,n,r)),ta;if(o.toLowerCase()==="canvas"){const l=new Image;return l.onload=()=>console.log(...v_(l,n,r)),l.src=e.toDataURL(),ta}return ta}function lN(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const qT=new Pd({id:"loaders.gl"});class uN{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class cN{constructor(){me(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const $C={fetch:null,mimeType:void 0,nothrow:!1,log:new cN,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Dx,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},hN={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function XC(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const YC=()=>{const t=XC();return t.globalOptions=t.globalOptions||{...$C},t.globalOptions};function fN(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],pN(t,n),mN(e,t,r)}function KC(t,e){const n=YC(),r=t||n;return typeof r.fetch=="function"?r.fetch:Sd(r.fetch)?o=>VT(o,r):e!=null&&e.fetch?e==null?void 0:e.fetch:VT}function pN(t,e){ZT(t,null,$C,hN,e);for(const n of e){const r=t&&t[n.id]||{},o=n.options&&n.options[n.id]||{},l=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};ZT(r,n.id,o,l,e)}}function ZT(t,e,n,r,o){const l=e||"Top level",a=e?"".concat(e,"."):"";for(const d in t){const g=!e&&Sd(t[d]),x=d==="baseUri"&&!e,E=d==="workerUrl"&&e;if(!(d in n)&&!x&&!E){if(d in r)qT.warn("".concat(l," loader option '").concat(a).concat(d,"' no longer supported, use '").concat(r[d],"'"))();else if(!g){const P=dN(d,o);qT.warn("".concat(l," loader option '").concat(a).concat(d,"' not recognized. ").concat(P))()}}}}function dN(t,e){const n=t.toLowerCase();let r="";for(const o of e)for(const l in o.options){if(t===l)return"Did you mean '".concat(o.id,".").concat(l,"'?");const a=l.toLowerCase();(n.startsWith(a)||a.startsWith(n))&&(r=r||"Did you mean '".concat(o.id,".").concat(l,"'?"))}return r}function mN(t,e,n){const o={...t.options||{}};return gN(o,n),o.log===null&&(o.log=new uN),$T(o,YC()),$T(o,e),o}function $T(t,e){for(const n in e)if(n in e){const r=e[n];BT(r)&&BT(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function gN(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Nx(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Bx(t){var e,n;fy(t,"null loader"),fy(Nx(t),"invalid loader");let r;return Array.isArray(t)&&(r=t[1],t=t[0],t={...t,options:{...t.options,...r}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const JC=()=>{const t=XC();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function yN(t){const e=JC();t=Array.isArray(t)?t:[t];for(const n of t){const r=Bx(n);e.find(o=>r===o)||e.unshift(r)}}function vN(){return JC()}const _N=new Pd({id:"loaders.gl"}),xN=/\.([^.]+)$/;async function bN(t,e=[],n,r){if(!QC(t))return null;let o=XT(t,e,{...n,nothrow:!0},r);if(o)return o;if(rf(t)&&(t=await t.slice(0,10).arrayBuffer(),o=XT(t,e,n,r)),!o&&!(n!=null&&n.nothrow))throw new Error(eI(t));return o}function XT(t,e=[],n,r){if(!QC(t))return null;if(e&&!Array.isArray(e))return Bx(e);let o=[];e&&(o=o.concat(e)),n!=null&&n.ignoreRegisteredLoaders||o.push(...vN()),EN(o);const l=wN(t,o,n,r);if(!l&&!(n!=null&&n.nothrow))throw new Error(eI(t));return l}function wN(t,e,n,r){const{url:o,type:l}=Jy(t),a=o||(r==null?void 0:r.url);let d=null,g="";if(n!=null&&n.mimeType&&(d=__(e,n==null?void 0:n.mimeType),g="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),d=d||TN(e,a),g=g||(d?"matched url ".concat(a):""),d=d||__(e,l),g=g||(d?"matched MIME type ".concat(l):""),d=d||PN(e,t),g=g||(d?"matched initial data ".concat(tI(t)):""),d=d||__(e,n==null?void 0:n.fallbackMimeType),g=g||(d?"matched fallback MIME type ".concat(l):""),g){var x;_N.log(1,"selectLoader selected ".concat((x=d)===null||x===void 0?void 0:x.name,": ").concat(g,"."))}return d}function QC(t){return!(t instanceof Response&&t.status===204)}function eI(t){const{url:e,type:n}=Jy(t);let r="No valid loader found (";r+=e?"".concat(DF(e),", "):"no url provided, ",r+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const o=t?tI(t):"";return r+=o?' first bytes: "'.concat(o,'"'):"first bytes: not available",r+=")",r}function EN(t){for(const e of t)Bx(e)}function TN(t,e){const n=e&&xN.exec(e),r=n&&n[1];return r?SN(t,r):null}function SN(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function __(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function PN(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(AN(e,n))return n}else if(ArrayBuffer.isView(e)){if(YT(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&YT(e,0,n))return n;return null}function AN(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function YT(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(o=>CN(t,e,n,o))}function CN(t,e,n,r){if(r instanceof ArrayBuffer)return kF(r,t,r.byteLength);switch(typeof r){case"function":return r(t,n);case"string":const o=r1(t,e,r.length);return r===o;default:return!1}}function tI(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?r1(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?r1(t,0,e):""}function r1(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let o="";for(let l=0;l<n;l++)o+=String.fromCharCode(r.getUint8(e+l));return o}const IN=256*1024;function*MN(t,e){const n=(e==null?void 0:e.chunkSize)||IN;let r=0;const o=new TextEncoder;for(;r<t.length;){const l=Math.min(t.length-r,n),a=t.slice(r,r+l);r+=l,yield o.encode(a)}}const kN=256*1024;function*LN(t,e={}){const{chunkSize:n=kN}=e;let r=0;for(;r<t.byteLength;){const o=Math.min(t.byteLength-r,n),l=new ArrayBuffer(o),a=new Uint8Array(t,r,o);new Uint8Array(l).set(a),r+=o,yield l}}const RN=1024*1024;async function*ON(t,e){const n=(e==null?void 0:e.chunkSize)||RN;let r=0;for(;r<t.size;){const o=r+n,l=await t.slice(r,o).arrayBuffer();r=o,yield l}}function KT(t,e){return Dx?zN(t,e):DN(t)}async function*zN(t,e){const n=t.getReader();let r;try{for(;;){const o=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:l,value:a}=await o;if(l)return;yield VC(a)}}catch{n.releaseLock()}}async function*DN(t,e){for await(const n of t)yield VC(n)}function FN(t,e){if(typeof t=="string")return MN(t,e);if(t instanceof ArrayBuffer)return LN(t,e);if(rf(t))return ON(t,e);if(jC(t))return KT(t,e);if(nf(t))return KT(t.body,e);throw new Error("makeIterator")}const nI="Cannot convert supplied data type";function NN(t,e,n){if(e.text&&typeof t=="string")return t;if(UF(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const o=t.byteLength||t.length;return(t.byteOffset!==0||o!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+o)),r}throw new Error(nI)}async function BN(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return NN(t,e);if(rf(t)&&(t=await GC(t)),nf(t)){const o=t;return await $F(o),e.binary?await o.arrayBuffer():await o.text()}if(jC(t)&&(t=FN(t,n)),NF(t)||BF(t))return RF(t);throw new Error(nI)}function UN(t,e,n=null){if(n)return n;const r={fetch:KC(e,t),...t};return Array.isArray(r.loaders)||(r.loaders=null),r}function VN(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:null}async function Ux(t,e,n,r){Js(!r||typeof r=="object"),e&&!Array.isArray(e)&&!Nx(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:o}=Jy(t),a=VN(e,r),d=await bN(t,a,n);return d?(n=fN(n,d,a,o),r=UN({url:o,parse:Ux,loaders:a},n,r),await jN(d,t,n,r)):null}async function jN(t,e,n,r){if(PF(t),nf(e)){const o=e,{ok:l,redirected:a,status:d,statusText:g,type:x,url:E}=o,P=Object.fromEntries(o.headers.entries());r.response={headers:P,ok:l,redirected:a,status:d,statusText:g,type:x,url:E}}if(e=await BN(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,r,t);if(AF(t,n))return await CF(t,e,n,r,Ux);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,r,t);if(t.parse)return await t.parse(e,n,r,t);throw Js(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function my(t,e,n,r){!Array.isArray(e)&&!Nx(e)&&(n=e,e=void 0);const o=KC(n);let l=t;return typeof t=="string"&&(l=await o(t)),rf(t)&&(l=await o(t)),await Ux(l,e,n)}const GN="3.2.13",{_parseImageNode:WN}=globalThis,i1=typeof Image<"u",o1=typeof ImageBitmap<"u",HN=Boolean(WN),a1=Dx?!0:HN;function qN(t){switch(t){case"auto":return o1||i1||a1;case"imagebitmap":return o1;case"image":return i1;case"data":return a1;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function ZN(){if(o1)return"imagebitmap";if(i1)return"image";if(a1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function $N(t){const e=YN(t);if(!e)throw new Error("Not an image");return e}function XN(t){switch($N(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function YN(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const KN=/^data:image\/svg\+xml/,JN=/\.svg((\?|#).*)?$/;function Vx(t){return t&&(KN.test(t)||JN.test(t))}function QN(t,e){if(Vx(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(l){throw new Error(l.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return rI(t,e)}function rI(t,e){if(Vx(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function iI(t,e,n){const r=QN(t,n),o=self.URL||self.webkitURL,l=typeof r!="string"&&o.createObjectURL(r);try{return await eB(l||r,e)}finally{l&&o.revokeObjectURL(l)}}async function eB(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,o)=>{try{n.onload=()=>r(n),n.onerror=l=>o(new Error("Could not load image ".concat(t,": ").concat(l)))}catch(l){o(l)}})}const tB={};let JT=!0;async function nB(t,e,n){let r;Vx(n)?r=await iI(t,e,n):r=rI(t,n);const o=e&&e.imagebitmap;return await rB(r,o)}async function rB(t,e=null){if((iB(e)||!JT)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),JT=!1}return await createImageBitmap(t)}function iB(t){for(const e in t||tB)return!1;return!0}const rs=!1,Bp=!0;function oI(t){const e=Ad(t);return oB(e)||lB(e)||aB(e)||sB(e)}function oB(t){const e=Ad(t);return e.byteLength>=24&&e.getUint32(0,rs)===2303741511?{mimeType:"image/png",width:e.getUint32(16,rs),height:e.getUint32(20,rs)}:null}function aB(t){const e=Ad(t);return e.byteLength>=10&&e.getUint32(0,rs)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Bp),height:e.getUint16(8,Bp)}:null}function sB(t){const e=Ad(t);return e.byteLength>=14&&e.getUint16(0,rs)===16973&&e.getUint32(2,Bp)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Bp),height:e.getUint32(22,Bp)}:null}function lB(t){const e=Ad(t);if(!(e.byteLength>=3&&e.getUint16(0,rs)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:o}=uB();let l=2;for(;l+9<e.byteLength;){const a=e.getUint16(l,rs);if(o.has(a))return{mimeType:"image/jpeg",height:e.getUint16(l+5,rs),width:e.getUint16(l+7,rs)};if(!r.has(a))return null;l+=2,l+=e.getUint16(l,rs)}return null}function uB(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Ad(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function cB(t,e){const{mimeType:n}=oI(t)||{},r=globalThis._parseImageNode;return fy(r),await r(t,n)}async function hB(t,e,n){e=e||{};const o=(e.image||{}).type||"auto",{url:l}=n||{},a=fB(o);let d;switch(a){case"imagebitmap":d=await nB(t,e,l);break;case"image":d=await iI(t,e,l);break;case"data":d=await cB(t);break;default:fy(!1)}return o==="data"&&(d=XN(d)),d}function fB(t){switch(t){case"auto":case"data":return ZN();default:return qN(t),t}}const pB=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],dB=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],mB={image:{type:"auto",decode:!0}},aI={id:"image",module:"images",name:"Images",version:GN,mimeTypes:dB,extensions:pB,parse:hB,tests:[t=>Boolean(oI(new DataView(t)))],options:mB},En=new Pd({id:"deck"});let s1={};function gB(t){s1=t}function ji(t,e,n,r){En.level>0&&s1[t]&&s1[t].call(null,e,n,r)}function yB(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const vB={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:yB,parseTextSync:JSON.parse};function _B(){const t="8.9.0-alpha.5",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(En.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:En,_registerLoggers:gB},yN([vB,[aI,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const xB=_B(),Vn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Vn,"IDENTITY",{get:()=>(En.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ls={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},gy={common:0,meters:1,pixels:2},QT={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}};function oe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const Lt=new Pd({id:"luma.gl"});function eo(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const bB="Invalid WebGLRenderingContext",wB="Requires WebGL2";function Qy(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function fn(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function EB(t){return fn(t)?t:null}function ev(t){return eo(Qy(t),bB),t}function Gi(t){return eo(fn(t),wB),t}const Pp={};function TB(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function SB(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function PB(t,e){Pp[t]=!0,e!==void 0&&TB(e)}function AB(t){const e=t.getError;t.getError=function(){let r;do r=e.apply(t),r!==0&&(Pp[r]=!0);while(r!==0);for(r in Pp)if(Pp[r])return delete Pp[r],parseInt(r,10);return 0}}const Cd=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const o=new t.VertexAttrib(n);this.attribs[r]=o}this.maxAttrib=0};Cd.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Cd.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const pc=function(e){const n=this;this.gl=e,AB(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(l){return l===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(l){const a=n.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,l);const d=a.attribs[l];return d.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(l){const a=n.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,l);const d=a.attribs[l];return d.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(l,a){switch(l){case 34962:n.currentArrayBuffer=a;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=a;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(l,a){const g=n.currentVertexArrayObject.attribs[l];switch(a){case 34975:return g.buffer;case 34338:return g.enabled;case 34339:return g.size;case 34340:return g.stride;case 34341:return g.type;case 34922:return g.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(l,a,d,g,x,E){const P=n.currentVertexArrayObject;P.maxAttrib=Math.max(P.maxAttrib,l);const A=P.attribs[l];return A.buffer=n.currentArrayBuffer,A.size=a,A.type=d,A.normalized=g,A.stride=x,A.offset=E,A.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{SB("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};pc.prototype.VERTEX_ARRAY_BINDING_OES=34229;pc.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new Cd(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};pc.prototype.createVertexArrayOES=function(){const e=new Cd(this);return this.vertexArrayObjects.push(e),e};pc.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};pc.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Cd&&e.hasBeenBound&&e.ext===this)};pc.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){PB(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,o=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const l=this.currentVertexArrayObject;if(o===l)return;(!o||l.elementArrayBuffer!==o.elementArrayBuffer)&&r.bindBuffer.call(n,34963,l.elementArrayBuffer);let a=this.currentArrayBuffer;const d=Math.max(o?o.maxAttrib:0,l.maxAttrib);for(let g=0;g<=d;g++){const x=l.attribs[g],E=o?o.attribs[g]:null;if((!o||x.enabled!==E.enabled)&&(x.enabled?r.enableVertexAttribArray.call(n,g):r.disableVertexAttribArray.call(n,g)),x.enabled){let P=!1;(!o||x.buffer!==E.buffer)&&(a!==x.buffer&&(r.bindBuffer.call(n,34962,x.buffer),a=x.buffer),P=!0),(P||x.cached!==E.cached)&&r.vertexAttribPointer.call(n,g,x.size,x.type,x.normalized,x.stride,x.offset)}}this.currentArrayBuffer!==a&&r.bindBuffer.call(n,34962,this.currentArrayBuffer)};function CB(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const o=e.call(this)||[];return o.indexOf("OES_vertex_array_object")<0&&o.push("OES_vertex_array_object"),o};const n=t.getExtension;t.getExtension=function(o){const l=n.call(this,o);return l||(o!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new pc(this)),this.__OESVertexArrayObject))}}const e2="OES_element_index",t2="WEBGL_draw_buffers",IB="EXT_disjoint_timer_query",MB="EXT_disjoint_timer_query_webgl2",kB="EXT_texture_filter_anisotropic",n2="WEBGL_debug_renderer_info",LB=35723,RB=4352,OB=36795,zB=34047,DB=37445,FB=37446,nr=t=>fn(t)?void 0:0,NB={[3074]:t=>fn(t)?void 0:36064,[LB]:t=>fn(t)?void 0:RB,[35977]:nr,[32937]:nr,[OB]:(t,e)=>{const n=fn(t)?t.getExtension(MB):t.getExtension(IB);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[DB]:(t,e)=>{const n=t.getExtension(n2);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[FB]:(t,e)=>{const n=t.getExtension(n2);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[zB]:(t,e)=>{const n=t.luma.extensions[kB];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:nr,[35071]:nr,[37447]:nr,[36063]:(t,e)=>{if(!fn(t)){const n=t.getExtension(t2);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:nr,[35374]:nr,[35377]:nr,[34852]:t=>{if(!fn(t)){const e=t.getExtension(t2);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(e2)?2147483647:65535,[33001]:t=>t.getExtension(e2)?16777216:65535,[33e3]:t=>16777216,[37157]:nr,[35373]:nr,[35657]:nr,[36183]:nr,[37137]:nr,[34045]:nr,[35978]:nr,[35979]:nr,[35968]:nr,[35376]:nr,[35375]:nr,[35659]:nr,[37154]:nr,[35371]:nr,[35658]:nr,[35076]:nr,[35077]:nr,[35380]:nr};function BB(t,e,n){const r=NB[n],o=typeof r=="function"?r(t,e,n):r;return o!==void 0?o:e(n)}const UB="OES_vertex_array_object",sI="ANGLE_instanced_arrays",VB="WEBGL_draw_buffers",jB="EXT_disjoint_timer_query",GB="EXT_texture_filter_anisotropic",WB="VertexArray requires WebGL2 or OES_vertex_array_object extension";function HB(t,e){return{webgl2:fn(t),ext:t.getExtension(e)}}const lI={[UB]:{meta:{suffix:"OES"},createVertexArray:()=>{eo(!1,WB)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[sI]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){eo(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[VB]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{eo(!1)}},[jB]:{meta:{suffix:"EXT"},createQuery:()=>{eo(!1)},deleteQuery:()=>{eo(!1)},beginQuery:()=>{eo(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},x_={readBuffer:(t,e,n)=>{fn(t)&&e(n)},getVertexAttrib:(t,e,n,r)=>{const{webgl2:o,ext:l}=HB(t,sI);let a;switch(r){case 35069:a=o?void 0:!1;break;case 35070:a=!o&&!l?0:void 0;break}return a!==void 0?a:e(n,r)},getProgramParameter:(t,e,n,r)=>{if(!fn(t))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,r)},getInternalformatParameter:(t,e,n,r,o)=>{if(!fn(t))switch(o){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,r,o)},getTexParameter(t,e,n,r){switch(r){case 34046:const{extensions:o}=t.luma,l=o[GB];r=l&&l.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,r)},getParameter:BB,hint(t,e,n,r){return e(n,r)}};function qB(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(CB(t),ZB(t),XB(t,lI),$B(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=qB;function ZB(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function $B(t,e){let{target:n,target2:r}=e;Object.keys(x_).forEach(o=>{if(typeof x_[o]=="function"){const l=t[o]?t[o].bind(t):()=>{},a=x_[o].bind(null,t,l);n[o]=a,r[o]=a}})}function XB(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&YB(t,{extension:n,target:t.luma,target2:t})}function YB(t,e){let{extension:n,target:r,target2:o}=e;const l=lI[n];eo(l);const{meta:a={}}=l,{suffix:d=""}=a,g=t.getExtension(n);for(const x of Object.keys(l)){const E="".concat(x).concat(d);let P=null;x==="meta"||typeof t[x]=="function"||(g&&typeof g[E]=="function"?P=function(){return g[E](...arguments)}:typeof l[x]=="function"&&(P=l[x].bind(r))),P&&(r[x]=P,o[x]=P)}}const jx={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},Il=(t,e,n)=>e?t.enable(n):t.disable(n),r2=(t,e,n)=>t.hint(n,e),Io=(t,e,n)=>t.pixelStorei(n,e),KB=(t,e)=>{const n=fn(t)?36009:36160;return t.bindFramebuffer(n,e)},JB=(t,e)=>t.bindFramebuffer(36008,e);function vp(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const QB={[3042]:Il,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:Il,[2885]:(t,e)=>t.cullFace(e),[2929]:Il,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:Il,[35723]:r2,[36006]:KB,[2886]:(t,e)=>t.frontFace(e),[33170]:r2,[2849]:(t,e)=>t.lineWidth(e),[32823]:Il,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:Il,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:Il,[3088]:(t,e)=>t.scissor(...e),[2960]:Il,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:Io,[3317]:Io,[37440]:Io,[37441]:Io,[37443]:Io,[3330]:Io,[3332]:Io,[3331]:Io,[36010]:JB,[3314]:Io,[32878]:Io,[3316]:Io,[3315]:Io,[32877]:Io,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=vp(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=vp(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=vp(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=vp(e)&&e.length===3?[...e,...e]:e;const[n,r,o,l,a,d]=e;t.stencilFuncSeparate(1028,n,r,o),t.stencilFuncSeparate(1029,l,a,d)},stencilOp:(t,e)=>{e=vp(e)&&e.length===3?[...e,...e]:e;const[n,r,o,l,a,d]=e;t.stencilOpSeparate(1028,n,r,o),t.stencilOpSeparate(1029,l,a,d)},viewport:(t,e)=>t.viewport(...e)};function Dr(t,e,n){return e[t]!==void 0?e[t]:n[t]}const e4={blendEquation:(t,e,n)=>t.blendEquationSeparate(Dr(32777,e,n),Dr(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Dr(32969,e,n),Dr(32968,e,n),Dr(32971,e,n),Dr(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Dr(32824,e,n),Dr(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Dr(32938,e,n),Dr(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Dr(2962,e,n),Dr(2967,e,n),Dr(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Dr(34816,e,n),Dr(36003,e,n),Dr(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Dr(2964,e,n),Dr(2965,e,n),Dr(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Dr(34817,e,n),Dr(34818,e,n),Dr(34819,e,n))},i2={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,r,o)=>t({[32773]:new Float32Array([e,n,r,o])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,r,o)=>t({[32969]:e,[32968]:n,[32971]:r,[32970]:o}),clearColor:(t,e,n,r,o)=>t({[3106]:new Float32Array([e,n,r,o])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,r,o)=>t({[3107]:[e,n,r,o]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,r,o)=>t({[3088]:new Int32Array([e,n,r,o])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({[2962]:e,[2967]:n,[2963]:r,[34816]:e,[36003]:n,[36004]:r}),stencilFuncSeparate:(t,e,n,r,o)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:o}),stencilOp:(t,e,n,r)=>t({[2964]:e,[2965]:n,[2966]:r,[34817]:e,[34818]:n,[34819]:r}),stencilOpSeparate:(t,e,n,r,o)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:o}),viewport:(t,e,n,r,o)=>t({[2978]:[e,n,r,o]})},ts=(t,e)=>t.isEnabled(e),o2={[3042]:ts,[2884]:ts,[2929]:ts,[3024]:ts,[32823]:ts,[32926]:ts,[32928]:ts,[3089]:ts,[2960]:ts,[35977]:ts};function uI(t){for(const e in t)return!1;return!0}function t4(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let o=0;o<t.length;++o)if(t[o]!==e[o])return!1;return!0}return!1}function a2(t,e){const n=t[e].bind(t);t[e]=function(){const o=arguments.length<=0?void 0:arguments[0];return o in t.state.cache?t.state.enable?t.state.cache[o]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function n4(t,e,n){const r=t[e].bind(t);t[e]=function(){for(var l=arguments.length,a=new Array(l),d=0;d<l;d++)a[d]=arguments[d];const{valueChanged:g,oldValue:x}=n(t.state._updateCache,...a);return g&&r(...a),x},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function r4(t){const e=t.useProgram.bind(t);t.useProgram=function(r){t.state.program!==r&&(e(r),t.state.program=r)}}class i4{constructor(e){let{copyState:n=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?a4(e):Object.assign({},jx),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){eo(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Qs(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const o=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const l in e){eo(l!==void 0);const a=e[l],d=this.cache[l];t4(a,d)||(n=!0,r=d,o&&!(l in o)&&(o[l]=d),this.cache[l]=a)}return{valueChanged:n,oldValue:r}}}function cI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:r}=e;if(eo(r!==void 0),!t.state){const{polyfillContext:o}=globalThis;o&&o(t),t.state=new i4(t,{copyState:r}),r4(t);for(const l in i2){const a=i2[l];n4(t,l,a)}a2(t,"getParameter"),a2(t,"isEnabled")}return t.state.enable=n,t}function o4(t){t.state||cI(t,{copyState:!1}),t.state.push()}function s2(t){eo(t.state),t.state.pop()}function Qs(t,e){if(eo(Qy(t),"setParameters requires a WebGL context"),uI(e))return;const n={};for(const o in e){const l=Number(o),a=QB[o];a&&(typeof a=="string"?n[a]=!0:a(t,e[o],l))}const r=t.state&&t.state.cache;if(r)for(const o in n){const l=e4[o];l(t,e,r)}}function a4(t,e){if(e=e||jx,typeof e=="number"){const o=e,l=o2[o];return l?l(t,o):t.getParameter(o)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const o of n){const l=o2[o];r[o]=l?l(t,Number(o)):t.getParameter(Number(o))}return r}function s4(t){Qs(t,jx)}function Uo(t,e,n){if(uI(e))return n(t);const{nocatch:r=!0}=e;o4(t),Qs(t,e);let o;if(r)o=n(t),s2(t);else try{o=n(t)}finally{s2(t)}return o}function ac(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function b_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=ac(t),o=t.drawingBufferWidth,l=t.drawingBufferHeight;return u4(e,r,o,l,n)}function l4(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function u4(t,e,n,r,o){const l=l2(t[0],e,n);let a=u2(t[1],e,r,o),d=l2(t[0]+1,e,n);const g=d===n-1?d:d-1;d=u2(t[1]+1,e,r,o);let x;return o?(d=d===0?d:d+1,x=a,a=d):x=d===r-1?d:d-1,{x:l,y:a,width:Math.max(g-l+1,1),height:Math.max(x-a+1,1)}}function l2(t,e,n){return Math.min(Math.round(t*e),n-1)}function u2(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Gx=nl(),c4=Gx&&typeof document<"u",hI={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function fI(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};eo(Gx,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},hI,t);const{width:e,height:n}=t;function r(d){if(t.throwOnError)throw new Error(d);return console.error(d),null}t.onError=r;let o;const{canvas:l}=t,a=d4({canvas:l,width:e,height:n,onError:r});return o=p4(a,t),o?(o=Wx(o,t),m4(o),o):null}function Wx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||g4(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},hI,e);const{manageState:n,debug:r}=e;return n&&cI(t,{copyState:!1,log:function(){for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return Lt.log(1,...l)()}}),Gx&&r&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Lt.level=Math.max(Lt.level,1)):Lt.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function h4(t){const e=t.getParameter(7936),n=t.getParameter(7937),r=t.getExtension("WEBGL_debug_renderer_info"),o=r&&t.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),l=r&&t.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:o||e,renderer:l||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function f4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const r=l4(e.useDevicePixels);y4(t,r,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function p4(t,e){const{onError:n}=e;let r=null;const o=g=>r=g.statusMessage||r;t.addEventListener("webglcontextcreationerror",o,!1);const{webgl1:l=!0,webgl2:a=!0}=e;let d=null;return a&&(d=d||t.getContext("webgl2",e),d=d||t.getContext("experimental-webgl2",e)),l&&(d=d||t.getContext("webgl",e),d=d||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",o,!1),d?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),d):n("Failed to create ".concat(a&&!l?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function d4(t){let{canvas:e,width:n=800,height:r=600,onError:o}=t,l;return typeof e=="string"?(c4&&document.readyState==="complete"||o("createGLContext called on canvas '".concat(e,"' before page was loaded")),l=document.getElementById(e)):e?l=e:(l=document.createElement("canvas"),l.id="lumagl-canvas",l.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",l.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(l,document.body.firstChild)),l}function m4(t){const e=fn(t)?"WebGL2":"WebGL1",n=h4(t),r=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",o=t.debug?" debug":"";Lt.info(1,"".concat(e).concat(o," context ").concat(r))()}function g4(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function y4(t,e,n){let r="width"in n?n.width:t.canvas.clientWidth,o="height"in n?n.height:t.canvas.clientHeight;(!r||!o)&&(Lt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=t.canvas.width||1,o=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const l=t.luma.canvasSizeInfo;if(l.clientWidth!==r||l.clientHeight!==o||l.devicePixelRatio!==e){let a=e;const d=Math.floor(r*a),g=Math.floor(o*a);t.canvas.width=d,t.canvas.height=g,(t.drawingBufferWidth!==d||t.drawingBufferHeight!==g)&&(Lt.warn("Device pixel ratio clamped")(),a=Math.min(t.drawingBufferWidth/r,t.drawingBufferHeight/o),t.canvas.width=Math.floor(r*a),t.canvas.height=Math.floor(o*a)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:r,clientHeight:o,devicePixelRatio:e})}}const Up="8.5.18",v4="set luma.log.level=1 (or higher) to trace rendering";class _4{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Fx({id:e})),this.stats.get(e)}}const Hu=new _4;if(globalThis.luma&&globalThis.luma.VERSION!==Up)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Up));globalThis.luma||(nl()&&Lt.log(1,"luma.gl ".concat(Up," - ").concat(v4))(),globalThis.luma=globalThis.luma||{VERSION:Up,version:Up,log:Lt,stats:Hu,globals:{modules:{},nodeIO:{}}});function x4(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function b4(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function mt(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function w_(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const r=t[e];return mt(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function Jl(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const E_={};function ru(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";E_[t]=E_[t]||1;const e=E_[t]++;return"".concat(t,"-").concat(e)}function c2(t){return mt(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Wh(t){let e=!0;for(const n in t){e=!1;break}return e}function pI(t,e,n,r){const o="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),l=Object.getPrototypeOf(t);r.forEach(a=>{l.methodName||(l[a]=()=>{throw Lt.removed("Calling removed method ".concat(e,".").concat(a,": "),o)(),new Error(a)})})}const uh="Resource subclass must define virtual methods";let rl=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ev(e);const{id:r,userData:o={}}=n;this.gl=e,this.gl2=e,this.id=r||ru(this[Symbol.toStringTag]),this.userData=o,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=w_(this.gl,e),mt(e);const o=(this.constructor.PARAMETERS||{})[e];if(o){const l=fn(this.gl);if(!((!("webgl2"in o)||l)&&(!("extension"in o)||this.gl.getExtension(o.extension)))){const d=o.webgl1,g="webgl2"in o?o.webgl2:o.webgl1;return l?g:d}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:r}=e,o=this.constructor.PARAMETERS||{},l=fn(this.gl),a={},d=n||Object.keys(o);for(const g of d){const x=o[g];if(x&&(!("webgl2"in x)||l)&&(!("extension"in x)||this.gl.getExtension(x.extension))){const P=r?Jl(this.gl,g):g;a[P]=this.getParameter(g,e),r&&x.type==="GLenum"&&(a[P]=Jl(this.gl,a[P]))}}return a}setParameter(e,n){e=w_(this.gl,e),mt(e);const o=(this.constructor.PARAMETERS||{})[e];if(o){const l=fn(this.gl);if(!((!("webgl2"in o)||l)&&(!("extension"in o)||this.gl.getExtension(o.extension))))throw new Error("Parameter not available on this platform");o.type==="GLenum"&&(n=w_(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,r){return pI(this,e,n,r)}initialize(e){}_createHandle(){throw new Error(uh)}_deleteHandle(){throw new Error(uh)}_bindHandle(e){throw new Error(uh)}_getOptsFromHandle(){throw new Error(uh)}_getParameter(e,n){throw new Error(uh)}_setParameter(e,n){throw new Error(uh)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Hu.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Hu.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const o=Hu.get("Memory Usage".concat(r));o.get("GPU Memory").addCount(e),o.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=Hu.get("Memory Usage".concat(n));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const w4="Failed to deduce GL constant from typed array";function l1(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(w4)}}function rd(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function E4(t){let{data:e,width:n,height:r,bytesPerPixel:o=4,temp:l}=t;const a=n*o;l=l||new Uint8Array(a);for(let d=0;d<r/2;++d){const g=d*a,x=(r-d-1)*a;l.set(e.subarray(g,g+a)),e.copyWithin(g,x,x+a),e.set(l,x)}}function T4(t){let{data:e,width:n,height:r}=t;const o=Math.round(n/2),l=Math.round(r/2),a=new Uint8Array(o*l*4);for(let d=0;d<l;d++)for(let g=0;g<o;g++)for(let x=0;x<4;x++)a[(d*o+g)*4+x]=e[(d*2*n+g*2)*4+x];return{data:a,width:o,height:l}}function u1(t,e,n){const{removedProps:r={},deprecatedProps:o={},replacedProps:l={}}=n;for(const d in r)if(d in e){const x=r[d]?"".concat(t,".").concat(r[d]):"N/A";Lt.removed("".concat(t,".").concat(d),x)()}for(const d in o)if(d in e){const g=o[d];Lt.deprecated("".concat(t,".").concat(d),"".concat(t,".").concat(g))()}let a=null;for(const d in l)if(d in e){const g=l[d];Lt.deprecated("".concat(t,".").concat(d),"".concat(t,".").concat(g))(),a=a||Object.assign({},e),a[g]=e[d],delete a[d]}return a||e}const S4={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},P4={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class zo{static getBytesPerElement(e){return rd(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return mt(e.size),rd(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new zo(S4,...n)}constructor(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(o=>this._assign(o)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return zo.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return zo.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=u1("Accessor",e,P4),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const h2=10,dI={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},A4={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:dI},C4={removedProps:dI};class Yn extends rl{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/zo.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/zo.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=u1("Buffer",e,A4),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=u1("Buffer",e,C4),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new zo(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:r=0,srcOffset:o=0}=e,l=e.byteLength||e.length;mt(n);const a=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(a,this.handle),o!==0||l!==void 0?(Gi(this.gl),this.gl.bufferSubData(this.target,r,n,o,l)):this.gl.bufferSubData(a,r,n),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:r=0,writeOffset:o=0,size:l}=e;const{gl:a}=this;return Gi(a),a.bindBuffer(36662,n.handle),a.bindBuffer(36663,this.handle),a.copyBufferSubData(36662,36663,r,o,l),a.bindBuffer(36662,null),a.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:r=0,length:o=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Gi(this.gl);const l=rd(this.accessor.type||5126,{clamped:!1}),a=this._getAvailableElementCount(n),d=r;let g,x;e?(x=e.length,g=x-d):(g=Math.min(a,o||a),x=d+g);const E=Math.min(a,g);return o=o||E,mt(o<=E),e=e||new l(x),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,r,o),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:r=0,size:o}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?o!==void 0?this.gl.bindBufferRange(e,n,this.handle,r,o):(mt(r===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(h2,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;mt(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const o=this._getTarget();this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,r,this.usage),this.gl.bufferSubData(o,n,e),this.gl.bindBuffer(o,null),this.debugData=e.slice(0,h2),this.bytesUsed=r,this._trackAllocatedMemory(r);const l=l1(e);return mt(l),this.setAccessor(new zo(this.accessor,{type:l})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;mt(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const o=this._getTarget();return this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,r,n),this.gl.bindBuffer(o,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=rd(this.accessor.type||5126,{clamped:!1}),r=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new zo(this.accessor,{type:l1(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return Lt.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Lt.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Lt.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Lt.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new zo(this.accessor,e),this}}const Hx={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},mI={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},gI={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function I4(t,e){const n=Hx[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const r=fn(t)&&n.gl2||n.gl1;return typeof r=="string"?t.getExtension(r):r}function M4(t,e){const n=Hx[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const k4=[9729,9728],f2=globalThis.WebGLBuffer||function(){};class sc extends rl{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:o}=n;let l=!0;return r&&(l=l&&I4(e,r),l=l&&(!o||M4(e,r))),l}constructor(e,n){const{id:r=ru("texture"),handle:o,target:l}=n;super(e,{id:r,handle:o}),this.target=l,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(W=>this.initialize(Object.assign({},e,{pixels:W,data:W}))),this;const r=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(r&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:o=null,format:l=6408,border:a=0,recreate:d=!1,parameters:g={},pixelStore:x={},textureUnit:E=void 0}=e;n||(n=o);let{width:P,height:A,dataFormat:R,type:j,compressed:X=!1,mipmaps:D=!0}=e;const{depth:F=0}=e;return{width:P,height:A,compressed:X,dataFormat:R,type:j}=this._deduceParameters({format:l,type:j,dataFormat:R,compressed:X,data:n,width:P,height:A}),this.width=P,this.height=A,this.depth=F,this.format=l,this.type=j,this.dataFormat=R,this.border=a,this.textureUnit=E,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),D&&this._isNPOT()&&(Lt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),D=!1,this._updateForNPOT(g)),this.mipmaps=D,this.setImageData({data:n,width:P,height:A,depth:F,format:l,type:j,dataFormat:R,border:a,mipmaps:D,parameters:x,compressed:X}),D&&this.generateMipmap(),this.setParameters(g),d&&(this.data=n),r&&(this._video={video:n,parameters:g,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:r,mipmaps:o=!1}=e;return r!==this.width||n!==this.height?this.initialize({width:r,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:o}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Lt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Uo(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:r=null,level:o=0,format:l=this.format,border:a=this.border,offset:d=0,parameters:g={}}=e;let{data:x=null,type:E=this.type,width:P=this.width,height:A=this.height,dataFormat:R=this.dataFormat,compressed:j=!1}=e;x||(x=r),{type:E,dataFormat:R,compressed:j,width:P,height:A}=this._deduceParameters({format:l,type:E,dataFormat:R,compressed:j,data:x,width:P,height:A});const{gl:X}=this;X.bindTexture(this.target,this.handle);let D=null;({data:x,dataType:D}=this._getDataType({data:x,compressed:j}));let F,W=0;if(Uo(this.gl,g,()=>{switch(D){case"null":X.texImage2D(n,o,l,P,A,a,R,E,x);break;case"typed-array":X.texImage2D(n,o,l,P,A,a,R,E,x,d);break;case"buffer":F=Gi(X),F.bindBuffer(35052,x.handle||x),F.texImage2D(n,o,l,P,A,a,R,E,d),F.bindBuffer(35052,null);break;case"browser-object":fn(X)?X.texImage2D(n,o,l,P,A,a,R,E,x):X.texImage2D(n,o,l,R,E,x);break;case"compressed":for(const[J,le]of x.entries())X.compressedTexImage2D(n,J,le.format,le.width,le.height,a,le.data),W+=le.levelSize;break;default:mt(!1,"Unknown image data type")}}),D==="compressed")this._trackAllocatedMemory(W,"Texture");else if(x&&x.byteLength)this._trackAllocatedMemory(x.byteLength,"Texture");else{const J=mI[this.dataFormat]||4,le=gI[this.type]||1;this._trackAllocatedMemory(this.width*this.height*J*le,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:r=null,data:o=null,x:l=0,y:a=0,width:d=this.width,height:g=this.height,level:x=0,format:E=this.format,type:P=this.type,dataFormat:A=this.dataFormat,compressed:R=!1,offset:j=0,border:X=this.border,parameters:D={}}=e;if({type:P,dataFormat:A,compressed:R,width:d,height:g}=this._deduceParameters({format:E,type:P,dataFormat:A,compressed:R,data:o,width:d,height:g}),mt(this.depth===0,"texSubImage not supported for 3D textures"),o||(o=r),o&&o.data){const F=o;o=F.data,d=F.shape[0],g=F.shape[1]}o instanceof Yn&&(o=o.handle),this.gl.bindTexture(this.target,this.handle),Uo(this.gl,D,()=>{if(R)this.gl.compressedTexSubImage2D(n,x,l,a,d,g,E,o);else if(o===null)this.gl.texSubImage2D(n,x,l,a,d,g,A,P,null);else if(ArrayBuffer.isView(o))this.gl.texSubImage2D(n,x,l,a,d,g,A,P,o,j);else if(o instanceof f2){const F=Gi(this.gl);F.bindBuffer(35052,o),F.texSubImage2D(n,x,l,a,d,g,A,P,j),F.bindBuffer(35052,null)}else fn(this.gl)?Gi(this.gl).texSubImage2D(n,x,l,a,d,g,A,P,o):this.gl.texSubImage2D(n,x,l,a,A,P,o)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Lt.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:r=!1}=e;return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof Yn?{data:n.handle,dataType:"buffer"}:n instanceof f2?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:r}=e;let{width:o,height:l,dataFormat:a,type:d,compressed:g}=e;const x=Hx[n];return a=a||x&&x.dataFormat,d=d||x&&x.types[0],g=g||x&&x.compressed,{width:o,height:l}=this._deduceImageSize(r,o,l),{dataFormat:a,type:d,compressed:g,width:o,height:l,format:n,data:r}}_deduceImageSize(e,n,r){let o;return typeof ImageData<"u"&&e instanceof ImageData?o={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?o={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?o={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?o={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?o={width:e.videoWidth,height:e.videoHeight}:e?o={width:n,height:r}:o={width:n>=0?n:1,height:r>=0?r:1},mt(o,"Could not deduced texture size"),mt(n===void 0||o.width===n,"Deduced texture width does not match supplied width"),mt(r===void 0||o.height===r,"Deduced texture height does not match supplied height"),o}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:mt(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return fn(this.gl)||!this.width||!this.height?!1:!c2(this.width)||!c2(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:k4.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let L4="";function R4(t,e){return mt(typeof t=="string"),t=L4+t,new Promise((n,r)=>{try{const o=new Image;o.onload=()=>n(o),o.onerror=()=>r(new Error("Could not load image ".concat(t,"."))),o.crossOrigin=e&&e.crossOrigin||"anonymous",o.src=t}catch(o){r(o)}})}class Ai extends sc{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return sc.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ev(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:R4(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const c1=[34069,34070,34071,34072,34073,34074];class yI extends sc{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ev(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:n,data:r,x:o=0,y:l=0,mipmapLevel:a=0}=e;return this._subImage({target:n,data:r,x:o,y:l,mipmapLevel:a})}async setCubeMapImageData(e){let{width:n,height:r,pixels:o,data:l,border:a=0,format:d=6408,type:g=5121}=e;const{gl:x}=this,E=o||l,P=await Promise.all(c1.map(A=>{const R=E[A];return Promise.all(Array.isArray(R)?R:[R])}));this.bind(),c1.forEach((A,R)=>{P[R].length>1&&this.opts.mipmaps!==!1&&Lt.warn("".concat(this.id," has mipmap and multiple LODs."))(),P[R].forEach((j,X)=>{n&&r?x.texImage2D(A,X,d,n,r,a,d,g,j):x.texImage2D(A,X,d,d,g,j)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:r,height:o,pixels:l,data:a,border:d=0,format:g=6408,type:x=5121}=e,{gl:E}=this,P=l||a;return this.bind(),P instanceof Promise?P.then(A=>this.setImageDataForFace(Object.assign({},e,{face:n,data:A,pixels:A}))):this.width||this.height?E.texImage2D(n,0,g,r,o,d,g,x,P):E.texImage2D(n,0,g,g,x,P),this}}yI.FACES=c1;class O4 extends sc{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return fn(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Gi(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:r=6408,width:o,height:l,depth:a=1,border:d=0,format:g,type:x=5121,offset:E=0,data:P,parameters:A={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Uo(this.gl,A,()=>{ArrayBuffer.isView(P)&&this.gl.texImage3D(this.target,n,r,o,l,a,d,g,x,P),P instanceof Yn&&(this.gl.bindBuffer(35052,P.handle),this.gl.texImage3D(this.target,n,r,o,l,a,d,g,x,E))}),P&&P.byteLength)this._trackAllocatedMemory(P.byteLength,"Texture");else{const R=mI[this.dataFormat]||4,j=gI[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*R*j,"Texture")}return this.loaded=!0,this}}const ku="EXT_color_buffer_float",p2={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:ku,bpp:2},[33327]:{gl2:ku,bpp:4},[34842]:{gl2:ku,bpp:8},[33326]:{gl2:ku,bpp:4},[33328]:{gl2:ku,bpp:8},[34836]:{gl2:ku,bpp:16},[35898]:{gl2:ku,bpp:4}};function z4(t,e,n){const r=n[e];if(!r)return!1;const o=fn(t)&&r.gl2||r.gl1;return typeof o=="string"?t.getExtension(o):o}class qu extends rl{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||z4(e,n,p2)}static getSamplesForFormat(e,n){let{format:r}=n;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:r=1,height:o=1,samples:l=0}=e;return mt(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),l!==0&&fn(this.gl)?this.gl.renderbufferStorageMultisample(36161,l,n,r,o):this.gl.renderbufferStorage(36161,n,r,o),this.format=n,this.width=r,this.height=o,this.samples=l,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*p2[this.format].bpp),this}resize(e){let{width:n,height:r}=e;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const D4=256,F4=1024,N4=16384,d2=6144,m2=6145,g2=6146,y2=34041,vI="clear: bad arguments";function qx(t){let{framebuffer:e=null,color:n=null,depth:r=null,stencil:o=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const l={};e&&(l.framebuffer=e);let a=0;n&&(a|=N4,n!==!0&&(l.clearColor=n)),r&&(a|=D4,r!==!0&&(l.clearDepth=r)),o&&(a|=F4,r!==!0&&(l.clearStencil=r)),mt(a!==0,vI),Uo(t,l,()=>{t.clear(a)})}function B4(t){let{framebuffer:e=null,buffer:n=d2,drawBuffer:r=0,value:o=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Gi(t),Uo(t,{framebuffer:e},()=>{switch(n){case d2:switch(o.constructor){case Int32Array:t.clearBufferiv(n,r,o);break;case Uint32Array:t.clearBufferuiv(n,r,o);break;case Float32Array:default:t.clearBufferfv(n,r,o)}break;case m2:t.clearBufferfv(m2,0,[o]);break;case g2:t.clearBufferiv(g2,0,[o]);break;case y2:const[l,a]=o;t.clearBufferfi(y2,0,l,a);break;default:mt(!1,vI)}})}function U4(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return mt(!1),0}}function tv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:r=0,sourceFormat:o=6408}=e;let{sourceAttachment:l=36064,target:a=null,sourceWidth:d,sourceHeight:g,sourceType:x}=e;const{framebuffer:E,deleteFramebuffer:P}=_I(t);mt(E);const{gl:A,handle:R,attachments:j}=E;d=d||E.width,g=g||E.height,l===36064&&R===null&&(l=1028),mt(j[l]),x=x||j[l].type,a=j4(a,x,o,d,g),x=x||l1(a);const X=A.bindFramebuffer(36160,R);return A.readPixels(n,r,d,g,o,x,a),A.bindFramebuffer(36160,X||null),P&&E.delete(),a}function v2(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=tv(t,{sourceAttachment:e}),{width:o,height:l}=t;for(;l>n;)({data:r,width:o,height:l}=T4({data:r,width:o,height:l}));E4({data:r,width:o,height:l});const a=document.createElement("canvas");a.width=o,a.height=l;const d=a.getContext("2d"),g=d.createImageData(o,l);return g.data.set(r),d.putImageData(g,0,0),a.toDataURL()}function V4(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:r=0,sourceY:o=0,targetMipmaplevel:l=0,targetInternalFormat:a=6408}=n;let{targetX:d,targetY:g,targetZ:x,width:E,height:P}=n;const{framebuffer:A,deleteFramebuffer:R}=_I(t);mt(A);const{gl:j,handle:X}=A,D=typeof d<"u"||typeof g<"u"||typeof x<"u";d=d||0,g=g||0,x=x||0;const F=j.bindFramebuffer(36160,X);mt(e);let W=null;if(e instanceof sc&&(W=e,E=Number.isFinite(E)?E:W.width,P=Number.isFinite(P)?P:W.height,W.bind(0),e=W.target),!D)j.copyTexImage2D(e,l,a,r,o,E,P,0);else switch(e){case 3553:case 34067:j.copyTexSubImage2D(e,l,d,g,r,o,E,P);break;case 35866:case 32879:Gi(j).copyTexSubImage3D(e,l,d,g,x,r,o,E,P);break}return W&&W.unbind(),j.bindFramebuffer(36160,F||null),R&&A.delete(),W}function _I(t){return t instanceof qr?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:J4(t),deleteFramebuffer:!0}}function j4(t,e,n,r,o){if(t)return t;e=e||5121;const l=rd(e,{clamped:!1}),a=U4(n);return new l(r*o*a)}const mr={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function G4(t){const e=new Ai(t,{format:6408,type:5126,dataFormat:6408}),n=new qr(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),r=n.getStatus();return e.delete(),n.delete(),r===36053}const xI={[mr.WEBGL2]:[!1,!0],[mr.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[mr.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[mr.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[mr.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[mr.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[mr.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[mr.FLOAT_BLEND]:["EXT_float_blend"],[mr.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[mr.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[mr.TEXTURE_FLOAT]:["OES_texture_float",!0],[mr.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[mr.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[mr.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[mr.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[mr.COLOR_ATTACHMENT_RGBA32F]:[G4,"EXT_color_buffer_float"],[mr.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[mr.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[mr.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[mr.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[mr.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[mr.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},W4=2;function H4(t,e){return bI(t,e)}function bI(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>wI(t,n))}function q4(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in xI)t.luma.caps[e]===void 0&&(t.luma.caps[e]=wI(t,e));return t.luma.caps}function wI(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=Z4(t,e)),t.luma.caps[e]||Lt.log(W4,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function Z4(t,e){const n=xI[e];mt(n,e);let r;const o=fn(t)&&n[1]||n[0];if(typeof o=="function")r=o(t);else if(Array.isArray(o)){r=!0;for(const l of o)r=r&&Boolean(t.getExtension(l))}else typeof o=="string"?r=Boolean(t.getExtension(o)):typeof o=="boolean"?r=o:mt(!1);return r}const _2="Multiple render targets not supported";class qr extends rl{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:o}=n;let l=!0;return r&&(l=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),o&&(l=l&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),l}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new qr(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Gi(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Gi(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:r=1,attachments:o=null,color:l=!0,depth:a=!0,stencil:d=!1,check:g=!0,readBuffer:x=void 0,drawBuffers:E=void 0}=e;if(mt(n>=0&&r>=0,"Width and height need to be integers"),this.width=n,this.height=r,o)for(const P in o){const A=o[P];(Array.isArray(A)?A[0]:A).resize({width:n,height:r})}else o=this._createDefaultAttachments(l,a,d,n,r);this.update({clearAttachments:!0,attachments:o,readBuffer:x,drawBuffers:E}),o&&g&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:r,drawBuffers:o,clearAttachments:l=!1,resizeAttachments:a=!0}=e;this.attach(n,{clearAttachments:l,resizeAttachments:a});const{gl:d}=this,g=d.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),o&&this._setDrawBuffers(o),d.bindFramebuffer(36160,g||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:r}=e;if(this.handle===null)return mt(n===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),n!==this.width&&r!==this.height&&Lt.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(r))();for(const o in this.attachments)this.attachments[o].resize({width:n,height:r});return this.width=n,this.height=r,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};n&&Object.keys(this.attachments).forEach(a=>{o[a]=null}),Object.assign(o,e);const l=this.gl.bindFramebuffer(36160,this.handle);for(const a in o){mt(a!==void 0,"Misspelled framebuffer binding point?");const d=Number(a),g=o[d];let x=g;if(!x)this._unattach(d);else if(x instanceof qu)this._attachRenderbuffer({attachment:d,renderbuffer:x});else if(Array.isArray(g)){const[E,P=0,A=0]=g;x=E,this._attachTexture({attachment:d,texture:E,layer:P,level:A})}else this._attachTexture({attachment:d,texture:x,layer:0,level:0});r&&x&&x.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,l||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(a=>!this.attachments[a]).forEach(a=>{delete this.attachments[a]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(X4(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:r,stencil:o,drawBuffers:l=[]}=e,a=this.gl.bindFramebuffer(36160,this.handle);return(n||r||o)&&qx(this.gl,{color:n,depth:r,stencil:o}),l.forEach((d,g)=>{B4(this.gl,{drawBuffer:g,value:d})}),this.gl.bindFramebuffer(36160,a||null),this}readPixels(){return Lt.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Lt.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Lt.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Lt.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Lt.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Lt.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:r=0,y:o=0,width:l,height:a}=e;const d=Gi(this.gl),g=d.bindFramebuffer(36008,this.handle);return r===0&&o===0&&l===void 0&&a===void 0?d.invalidateFramebuffer(36008,n):d.invalidateFramebuffer(36008,n,r,o,l,a),d.bindFramebuffer(36008,g),this}getAttachmentParameter(e,n,r){let o=this._getAttachmentParameterFallback(n);return o===null&&(this.gl.bindFramebuffer(36160,this.handle),o=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),r&&o>1e3&&(o=Jl(this.gl,o)),o}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const o={};for(const l of r){const a=n?Jl(this.gl,l):l;o[a]=this.getAttachmentParameter(e,l,n)}return o}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),r={};for(const o of n){const l=Number(o),a=e?Jl(this.gl,l):l;r[a]=this.getAttachmentParameters(l,e)}return r}show(){return typeof window<"u"&&window.open(v2(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Lt.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const r=v2(this,{targetMaxHeight:100});return Lt.image({logLevel:e,message:n,image:r},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,r,o,l){let a=null;return e&&(a=a||{},a[36064]=new Ai(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:o,height:l,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(a[36064])),n&&r?(a=a||{},a[33306]=new qu(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:o,height:111}),this.ownResources.push(a[33306])):n?(a=a||{},a[36096]=new qu(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:o,height:l}),this.ownResources.push(a[36096])):r&&mt(!1),a}_unattach(e){const n=this.attachments[e];n&&(n instanceof qu?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:r}=e;const{gl:o}=this;o.framebufferRenderbuffer(36160,n,36161,r.handle),this.attachments[n]=r}_attachTexture(e){let{attachment:n=36064,texture:r,layer:o,level:l}=e;const{gl:a}=this;switch(a.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:Gi(a).framebufferTextureLayer(36160,n,r.target,l,o);break;case 34067:const g=$4(o);a.framebufferTexture2D(36160,n,g,r.handle,l);break;case 3553:a.framebufferTexture2D(36160,n,3553,r.handle,l);break;default:mt(!1,"Illegal texture type")}a.bindTexture(r.target,null),this.attachments[n]=r}_setReadBuffer(e){const n=EB(this.gl);n?n.readBuffer(e):mt(e===36064||e===1029,_2),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,r=Gi(n);if(r)r.drawBuffers(e);else{const o=n.getExtension("WEBGL_draw_buffers");o?o.drawBuffersWEBGL(e):mt(e.length===1&&(e[0]===36064||e[0]===1029),_2)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=q4(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function $4(t){return t<34069?t+34069:t}function X4(t){return(qr.STATUS||{})[t]||"Framebuffer error ".concat(t)}const Y4=[36049,36048,33296,33298,33299,33300,33301,33302,33303];qr.ATTACHMENT_PARAMETERS=Y4;function K4(t,e){mt(t instanceof Ai||t instanceof yI||t instanceof O4);const n=t.constructor,{gl:r,width:o,height:l,format:a,type:d,dataFormat:g,border:x,mipmaps:E}=t,P=Object.assign({width:o,height:l,format:a,type:d,dataFormat:g,border:x,mipmaps:E},e);return new n(r,P)}function J4(t,e){const{gl:n,width:r,height:o,id:l}=t;return new qr(n,Object.assign({},e,{id:"framebuffer-for-".concat(l),width:r,height:o,attachments:{[36064]:t}}))}function Ig(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=t.match(n);return r?r[1]:e}const Q4=35632,e5=35633;function t5(t){switch(t){case Q4:return"fragment";case e5:return"vertex";default:return"unknown type"}}function n5(t,e,n,r){const o=t.split(/\r?\n/),l={},a={},d=r||Ig(e)||"(unnamed)",g="".concat(t5(n)," shader ").concat(d);for(let E=0;E<o.length;E++){const P=o[E];if(P.length<=1)continue;const A=P.split(":"),R=A[0],j=parseInt(A[2],10);if(isNaN(j))throw new Error("GLSL compilation error in ".concat(g,": ").concat(t));R!=="WARNING"?l[j]=P:a[j]=P}const x=r5(e);return{shaderName:g,errors:x2(l,x),warnings:x2(a,x)}}function x2(t,e){let n="";for(let r=0;r<e.length;r++){const o=e[r];if(!(!t[r+3]&&!t[r+2]&&!t[r+1])&&(n+="".concat(o,`
`),t[r+1])){const l=t[r+1],a=l.split(":",3),d=a[0],g=parseInt(a[1],10)||0,x=l.substring(a.join(":").length+1).trim();n+=EI("^^^ ".concat(d,": ").concat(x,`

`),g)}}return n}function r5(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=t.split(/\r?\n/),o=String(r.length+e-1).length;return r.map((l,a)=>{const d=String(a+e),g=d.length;return EI(d,o-g)+n+l})}function EI(t,e){let n="";for(let r=0;r<e;++r)n+=" ";return"".concat(n).concat(t)}function TI(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const i5="Shader: GLSL source code must be a JavaScript string";class id extends rl{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return mt(!1),"unknown"}}constructor(e,n){ev(e),mt(typeof n.source=="string",i5);const r=Ig(n.source,null)||n.id||ru("unnamed ".concat(id.getTypeName(n.shaderType)));super(e,{id:r}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const r=Ig(n,null);r&&(this.id=ru(r)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(id.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Ig(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:o,errors:l,warnings:a}=n5(r,this.source,this.shaderType,this.id);throw Lt.error("GLSL compilation errors in ".concat(o,`
`).concat(l))(),Lt.warn("GLSL compilation warnings in ".concat(o,`
`).concat(a))(),new Error("GLSL compilation errors in ".concat(o))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class T_ extends id{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class S_ extends id{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const o5={[5126]:sr.bind(null,"uniform1fv",Mo,1,Bi),[35664]:sr.bind(null,"uniform2fv",Mo,2,Bi),[35665]:sr.bind(null,"uniform3fv",Mo,3,Bi),[35666]:sr.bind(null,"uniform4fv",Mo,4,Bi),[5124]:sr.bind(null,"uniform1iv",Ml,1,Bi),[35667]:sr.bind(null,"uniform2iv",Ml,2,Bi),[35668]:sr.bind(null,"uniform3iv",Ml,3,Bi),[35669]:sr.bind(null,"uniform4iv",Ml,4,Bi),[35670]:sr.bind(null,"uniform1iv",Ml,1,Bi),[35671]:sr.bind(null,"uniform2iv",Ml,2,Bi),[35672]:sr.bind(null,"uniform3iv",Ml,3,Bi),[35673]:sr.bind(null,"uniform4iv",Ml,4,Bi),[35674]:sr.bind(null,"uniformMatrix2fv",Mo,4,js),[35675]:sr.bind(null,"uniformMatrix3fv",Mo,9,js),[35676]:sr.bind(null,"uniformMatrix4fv",Mo,16,js),[35678]:Ei,[35680]:Ei,[5125]:sr.bind(null,"uniform1uiv",Qm,1,Bi),[36294]:sr.bind(null,"uniform2uiv",Qm,2,Bi),[36295]:sr.bind(null,"uniform3uiv",Qm,3,Bi),[36296]:sr.bind(null,"uniform4uiv",Qm,4,Bi),[35685]:sr.bind(null,"uniformMatrix2x3fv",Mo,6,js),[35686]:sr.bind(null,"uniformMatrix2x4fv",Mo,8,js),[35687]:sr.bind(null,"uniformMatrix3x2fv",Mo,6,js),[35688]:sr.bind(null,"uniformMatrix3x4fv",Mo,12,js),[35689]:sr.bind(null,"uniformMatrix4x2fv",Mo,8,js),[35690]:sr.bind(null,"uniformMatrix4x3fv",Mo,12,js),[35678]:Ei,[35680]:Ei,[35679]:Ei,[35682]:Ei,[36289]:Ei,[36292]:Ei,[36293]:Ei,[36298]:Ei,[36299]:Ei,[36300]:Ei,[36303]:Ei,[36306]:Ei,[36307]:Ei,[36308]:Ei,[36311]:Ei},a5={},s5={},l5={},b2=[0];function Zx(t,e,n,r){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(b2[0]=t,t=b2);const o=t.length;if(o%e&&Lt.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let l=r[o];l||(l=new n(o),r[o]=l);for(let a=0;a<o;a++)l[a]=t[a];return l}function Mo(t,e){return Zx(t,e,Float32Array,a5)}function Ml(t,e){return Zx(t,e,Int32Array,s5)}function Qm(t,e){return Zx(t,e,Uint32Array,l5)}function w2(t,e,n){const r=o5[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,t,e)}function u5(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:Boolean(n[2])}}function c5(t,e,n){for(const r in t){const o=t[r];if((!n||Boolean(n[r]))&&!h5(o))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),o),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function h5(t){return Array.isArray(t)||ArrayBuffer.isView(t)?p5(t):isFinite(t)||t===!0||t===!1||t instanceof sc||t instanceof qu?!0:t instanceof qr?Boolean(t.texture):!1}function f5(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const r=t[e];for(let o=0,l=n.length;o<l;++o)r[o]=n[o]}else t[e]=n.slice();else t[e]=n}function p5(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ei(){let t=null;return(e,n,r)=>{const o=t!==r;return o&&(e.uniform1i(n,r),t=r),o}}function sr(t,e,n,r){let o=null,l=null;return(a,d,g)=>{const x=e(g,n),E=x.length;let P=!1;if(o===null)o=new Float32Array(E),l=E,P=!0;else{mt(l===E,"Uniform length cannot change.");for(let A=0;A<E;++A)if(x[A]!==o[A]){P=!0;break}}return P&&(r(a,t,d,x),o.set(x)),P}}function Bi(t,e,n,r){t[e](n,r)}function js(t,e,n,r){t[e](n,!1,r)}const d5=5120,m5=5121,g5=5122,y5=5123,E2=0,eg=1,v5=2,_5=3,tg=4,x5=5,b5=6,ii=5126,w5=35664,E5=35665,T5=35666,_p=5124,S5=35667,P5=35668,A5=35669,xp=5125,C5=36294,I5=36295,M5=36296,k5=35670,L5=35671,R5=35672,O5=35673,z5=35674,D5=35675,F5=35676,N5=35685,B5=35686,U5=35687,V5=35688,j5=35689,G5=35690,h1={[ii]:[ii,1,"float"],[w5]:[ii,2,"vec2"],[E5]:[ii,3,"vec3"],[T5]:[ii,4,"vec4"],[_p]:[_p,1,"int"],[S5]:[_p,2,"ivec2"],[P5]:[_p,3,"ivec3"],[A5]:[_p,4,"ivec4"],[xp]:[xp,1,"uint"],[C5]:[xp,2,"uvec2"],[I5]:[xp,3,"uvec3"],[M5]:[xp,4,"uvec4"],[k5]:[ii,1,"bool"],[L5]:[ii,2,"bvec2"],[R5]:[ii,3,"bvec3"],[O5]:[ii,4,"bvec4"],[z5]:[ii,8,"mat2"],[N5]:[ii,8,"mat2x3"],[B5]:[ii,8,"mat2x4"],[D5]:[ii,12,"mat3"],[U5]:[ii,12,"mat3x2"],[V5]:[ii,12,"mat3x4"],[F5]:[ii,16,"mat4"],[j5]:[ii,16,"mat4x2"],[G5]:[ii,16,"mat4x3"]};function W5(t){switch(t){case E2:return E2;case eg:return eg;case _5:return eg;case v5:return eg;case tg:return tg;case x5:return tg;case b5:return tg;default:return mt(!1),0}}function T2(t){const e=h1[t];if(!e)return null;const[n,r]=e;return{type:n,components:r}}function SI(t,e){switch(t){case d5:case m5:case g5:case y5:t=ii;break}for(const n in h1){const[r,o,l]=h1[n];if(r===t&&o===e)return{glType:n,name:l}}return null}class H5{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,r=n.getProgramParameter(e.handle,35721);for(let o=0;o<r;o++){const{name:l,type:a,size:d}=n.getActiveAttrib(e.handle,o),g=n.getAttribLocation(e.handle,l);g>=0&&this._addAttribute(g,l,a,d)}this.attributeInfos.sort((o,l)=>o.location-l.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!fn(n))return;const r=n.getProgramParameter(e.handle,35971);for(let o=0;o<r;o++){const{name:l,type:a,size:d}=n.getTransformFeedbackVarying(e.handle,o);this._addVarying(o,l,a,d)}this.varyingInfos.sort((o,l)=>o.location-l.location)}_addAttribute(e,n,r,o){const{type:l,components:a}=T2(r),d={type:l,size:o*a};this._inferProperties(e,n,d);const g={location:e,name:n,accessor:new zo(d)};this.attributeInfos.push(g),this.attributeInfosByLocation[e]=g,this.attributeInfosByName[g.name]=g}_inferProperties(e,n,r){/instance/i.test(n)&&(r.divisor=1)}_addVarying(e,n,r,o){const{type:l,components:a}=T2(r),d=new zo({type:l,size:o*a}),g={location:e,name:n,accessor:d};this.varyingInfos.push(g),this.varyingInfosByName[g.name]=g}}const S2=4,q5=35981,Z5=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class PI extends rl{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",Z5),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:r,fs:o,varyings:l,bufferMode:a=q5}=e;return this.hash=n||"",this.vs=typeof r=="string"?new T_(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof o=="string"?new S_(this.gl,{id:"".concat(e.id,"-fs"),source:o}):o,mt(this.vs instanceof T_),mt(this.fs instanceof S_),this.uniforms={},this._textureUniforms={},l&&l.length>0&&(Gi(this.gl),this.varyings=l,this.gl2.transformFeedbackVaryings(this.handle,l,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new H5(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:r=4,vertexCount:o,offset:l=0,start:a,end:d,isIndexed:g=!1,indexType:x=5123,instanceCount:E=0,isInstanced:P=E>0,vertexArray:A=null,transformFeedback:R,framebuffer:j,parameters:X={},uniforms:D,samplers:F}=e;if((D||F)&&(Lt.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(D||{})),Lt.priority>=n){const W=j?j.id:"default",J="mode=".concat(Jl(this.gl,r)," verts=").concat(o," ")+"instances=".concat(E," indexType=").concat(Jl(this.gl,x)," ")+"isInstanced=".concat(P," isIndexed=").concat(g," ")+"Framebuffer=".concat(W);Lt.log(n,J)()}return mt(A),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||o===0||P&&E===0?!1:(A.bindForDraw(o,E,()=>{if(j!==void 0&&(X=Object.assign({},X,{framebuffer:j})),R){const W=W5(r);R.begin(W)}this._bindTextures(),Uo(this.gl,X,()=>{g&&P?this.gl2.drawElementsInstanced(r,o,x,l,E):g&&fn(this.gl)&&!isNaN(a)&&!isNaN(d)?this.gl2.drawRangeElements(r,a,d,o,x,l):g?this.gl.drawElements(r,o,x,l):P?this.gl2.drawArraysInstanced(r,l,o,E):this.gl.drawArrays(r,l,o)}),R&&R.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Lt.priority>=2&&c5(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const r=e[n],o=this._uniformSetters[n];if(o){let l=r,a=!1;if(l instanceof qr&&(l=l.texture),l instanceof sc)if(a=this.uniforms[n]!==r,a){o.textureIndex===void 0&&(o.textureIndex=this._textureIndexCounter++);const d=l,{textureIndex:g}=o;d.bind(g),l=g,this._textureUniforms[n]=d}else l=o.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(o(l)||a)&&f5(this.uniforms,n,r)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const r=this._textureUniforms[n];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),r={};for(const o of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new T_({handle:o});break;case 35632:r.fs=new S_({handle:o});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=ru(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Lt.time(S2,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Lt.timeEnd(S2,"linkProgram for ".concat(this._getName()))(),e.debug||Lt.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const r=this.gl.getActiveUniform(this.handle,n),{name:o}=u5(r.name);let l=e.getUniformLocation(this.handle,o);if(this._uniformSetters[o]=w2(e,l,r),r.size>1)for(let a=0;a<r.size;a++)l=e.getUniformLocation(this.handle,"".concat(o,"[").concat(a,"]")),this._uniformSetters["".concat(o,"[").concat(a,"]")]=w2(e,l,r)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const $5=34918,X5=34919,Y5=35007,K5=36795,J5=35976,Q5=35887,eU=36202;class yy extends rl{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=fn(e),o=bI(e,mr.TIMER_QUERY);let l=r||o;for(const a of n)switch(a){case"queries":l=l&&r;break;case"timers":l=l&&o;break;default:mt(!1)}return l}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(Y5)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?eU:Q5)}beginTransformFeedbackQuery(){return this.begin(J5)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,X5);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(K5)}getResult(){return this.gl2.getQueryParameter(this.handle,$5)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((r,o)=>{const l=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):n++>e?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(l)};requestAnimationFrame(l)}),this._pollingPromise}_createHandle(){return yy.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class AI extends rl{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return fn(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Gi(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Wh(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const r=this._getVaryingIndex(e),{buffer:o,byteSize:l,byteOffset:a}=this._getBufferParams(n);return r<0?(this.unused[e]=o,Lt.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=n,this.bindOnUse||this._bindBuffer(r,o,a,l),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,r,o;return e instanceof Yn?o=e:(o=e.buffer,r=e.byteSize,n=e.byteOffset),(n!==void 0||r!==void 0)&&(n=n||0,r=r||o.byteLength-n),{buffer:o,byteOffset:n,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:r,byteOffset:o}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,o,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;const l=n&&n.handle;return!l||o===void 0?this.gl.bindBufferBase(35982,e,l):this.gl.bindBufferRange(35982,e,l,r,o),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let ng=null;function tU(t){return(!ng||ng.byteLength<t)&&(ng=new ArrayBuffer(t)),ng}function nU(t,e){const n=tU(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function rU(t){let{target:e,source:n,start:r=0,count:o=1}=t;const l=n.length,a=o*l;let d=0;for(let g=r;d<l;d++)e[g++]=n[d];for(;d<a;)d<a-d?(e.copyWithin(r+d,r,r+d),d*=2):(e.copyWithin(r+d,r,r+a-d),d=a);return e}const iU="elements must be GL.ELEMENT_ARRAY_BUFFER";class Ro extends rl{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?fn(e)||qC()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Ro(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Ro.MAX_ATTRIBUTES=Ro.MAX_ATTRIBUTES||e.getParameter(34921),Ro.MAX_ATTRIBUTES}static setConstant(e,n,r){switch(r.constructor){case Float32Array:Ro._setConstantFloatArray(e,n,r);break;case Int32Array:Ro._setConstantIntArray(e,n,r);break;case Uint32Array:Ro._setConstantUintArray(e,n,r);break;default:mt(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Ro.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return mt(!e||e.target===34963,iU),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,r){if(n.target===34963)return this.setElementBuffer(n,r);const{size:o,type:l,stride:a,offset:d,normalized:g,integer:x,divisor:E}=r,{gl:P,gl2:A}=this;return e=Number(e),this.bind(()=>{P.bindBuffer(34962,n.handle),x?(mt(fn(P)),A.vertexAttribIPointer(e,o,l,a,d)):P.vertexAttribPointer(e,o,l,g,a,d),P.enableVertexAttribArray(e),A.vertexAttribDivisor(e,E||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!Ro.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const r=this._normalizeConstantArrayValue(n),o=r.byteLength*e,l=r.length*e;let a=!this.buffer;if(this.buffer=this.buffer||new Yn(this.gl,o),a=a||this.buffer.reallocate(o),a=a||!this._compareConstantArrayValues(r,this.bufferValue),a){const d=nU(n.constructor,l);rU({target:d,source:r,start:0,count:l}),this.buffer.subData(d),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==n[r])return!1;return!0}static _setConstantFloatArray(e,n,r){switch(r.length){case 1:e.vertexAttrib1fv(n,r);break;case 2:e.vertexAttrib2fv(n,r);break;case 3:e.vertexAttrib3fv(n,r);break;case 4:e.vertexAttrib4fv(n,r);break;default:mt(!1)}}static _setConstantIntArray(e,n,r){switch(mt(fn(e)),r.length){case 1:e.vertexAttribI1iv(n,r);break;case 2:e.vertexAttribI2iv(n,r);break;case 3:e.vertexAttribI3iv(n,r);break;case 4:e.vertexAttribI4iv(n,r);break;default:mt(!1)}}static _setConstantUintArray(e,n,r){switch(mt(fn(e)),r.length){case 1:e.vertexAttribI1uiv(n,r);break;case 2:e.vertexAttribI2uiv(n,r);break;case 3:e.vertexAttribI3uiv(n,r);break;case 4:e.vertexAttribI4uiv(n,r);break;default:mt(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:r}=n;return mt(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const oU="VertexArray: attributes must be Buffers or constants (i.e. typed array)",aU=/^(.+)__LOCATION_([0-9]+)$/,sU=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class lU{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Ro(e),pI(this,"VertexArray","v6.0",sU),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const r=e[n];this._setAttribute(n,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,r);const{location:o,accessor:l}=this._resolveLocationAndAccessor(e,n,n.accessor,r);return o>=0&&(this.values[o]=n,this.accessors[o]=l,this.clearDrawParams(),this.vertexArrayObject.setBuffer(o,n,l)),this}setConstant(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:o,accessor:l}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},r));return o>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[o]=n,this.accessors[o]=l,this.clearDrawParams(),this.vertexArrayObject.enable(o,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Yn(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof Yn&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof Yn&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,r){let o;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),o=r()}),o}_resolveLocationAndAccessor(e,n,r,o){const l={location:-1,accessor:null},{location:a,name:d}=this._getAttributeIndex(e);if(!Number.isFinite(a)||a<0)return this.unused[e]=n,Lt.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),l;const g=this._getAttributeInfo(d||a);if(!g)return l;const x=this.accessors[a]||{},E=zo.resolve(g.accessor,x,r,o),{size:P,type:A}=E;return mt(Number.isFinite(P)&&Number.isFinite(A)),{location:a,accessor:E}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const r=aU.exec(e),o=r?r[1]:e,l=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(o)+l,name:o}:{location:-1}}_setAttribute(e,n){if(n instanceof Yn)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof Yn){const r=n[0],o=n[1];this.setBuffer(e,r,o)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const r=n;this.setConstant(e,r)}else if(n.buffer instanceof Yn){const r=n;this.setBuffer(e,r.buffer,r)}else throw new Error(oU)}_setConstantAttributes(e,n){const r=Math.max(e|0,n|0);let o=this.values[0];ArrayBuffer.isView(o)&&this._setConstantAttributeZero(o,r);for(let l=1;l<this.vertexArrayObject.MAX_ATTRIBUTES;l++)o=this.values[l],ArrayBuffer.isView(o)&&this._setConstantAttribute(l,o)}_setConstantAttributeZero(e,n){if(Ro.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,n){Ro.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const r=this.values[n],o=this.accessors[n];if(!r)return;const{divisor:l}=o,a=l>0;if(e.isInstanced=e.isInstanced||a,r instanceof Yn){const d=r;if(a){const g=d.getVertexCount(o);e.instanceCount=Math.min(e.instanceCount,g)}else{const g=d.getVertexCount(o);e.vertexCount=Math.min(e.vertexCount,g)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Lt.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function uU(t,e){const{maxElts:n=16,size:r=1}=e;let o="[";for(let a=0;a<t.length&&a<n;++a)a>0&&(o+=",".concat(a%r===0?" ":"")),o+=od(t[a],e);const l=t.length>n?"...":"]";return"".concat(o).concat(l)}function od(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:r=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return uU(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return r?"0":"0.";if(r||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const o=t.toPrecision(2);return o.indexOf(".0")===o.length-2?o.slice(0,-1):o}function P2(t){let{header:e="Uniforms",program:n,uniforms:r,undefinedOnly:o=!1}=t;mt(n);const l=".*_.*",a=".*Matrix",d=n._uniformSetters,g={},x=Object.keys(d).sort();let E=0;for(const R of x)!R.match(l)&&!R.match(a)&&P_({table:g,header:e,uniforms:r,uniformName:R,undefinedOnly:o})&&E++;for(const R of x)R.match(a)&&P_({table:g,header:e,uniforms:r,uniformName:R,undefinedOnly:o})&&E++;for(const R of x)g[R]||P_({table:g,header:e,uniforms:r,uniformName:R,undefinedOnly:o})&&E++;let P=0;const A={};if(!o)for(const R in r){const j=r[R];g[R]||(P++,A[R]={Type:"NOT USED: ".concat(j),[e]:od(j)})}return{table:g,count:E,unusedTable:A,unusedCount:P}}function P_(t){let{table:e,header:n,uniforms:r,uniformName:o,undefinedOnly:l}=t;const a=r[o],d=cU(a);return!l||!d?(e[o]={[n]:d?od(a):"N/A","Uniform Type":d?a:"NOT PROVIDED"},!0):!1}function cU(t){return t!=null}function hU(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=A2(e,e.elements,null,n));const o=e.values;for(const l in o){const a=e._getAttributeInfo(l);if(a){let d="".concat(l,": ").concat(a.name);const g=e.accessors[a.location];g&&(d="".concat(l,": ").concat(fU(a.name,g))),r[d]=A2(e,o[l],g,n)}}return r}function A2(t,e,n,r){const{gl:o}=t;if(!e)return{[r]:"null","Format ":"N/A"};let l="NOT PROVIDED",a=1,d=0,g=0,x,E,P;if(n&&(l=n.type,a=n.size,l=String(l).replace("Array",""),x=l.indexOf("nt")!==-1),e instanceof Yn){const A=e,{data:R,changed:j}=A.getDebugData();E=j?"*":"",P=R,g=A.byteLength,d=g/R.BYTES_PER_ELEMENT/a;let X;if(n){const D=n.divisor>0;X="".concat(D?"I ":"P "," ").concat(d," (x").concat(a,"=").concat(g," bytes ").concat(Jl(o,l),")")}else x=!0,X="".concat(g," bytes");return{[r]:"".concat(E).concat(od(P,{size:a,isInteger:x})),"Format ":X}}return P=e,a=e.length,l=String(e.constructor.name).replace("Array",""),x=l.indexOf("nt")!==-1,{[r]:"".concat(od(P,{size:a,isInteger:x})," (constant)"),"Format ":"".concat(a,"x").concat(l," (constant)")}}function fU(t,e){const{type:n,size:r}=e,o=SI(n,r);return o?"".concat(t," (").concat(o.name,")"):t}function pU(t){const e={},n="Accessors for ".concat(t.id);for(const r of t.attributeInfos)if(r){const o=C2(r);e["in ".concat(o)]={[n]:JSON.stringify(r.accessor)}}for(const r of t.varyingInfos)if(r){const o=C2(r);e["out ".concat(o)]={[n]:JSON.stringify(r.accessor)}}return e}function C2(t){const{type:e,size:n}=t.accessor,r=SI(e,n);return r?"".concat(r.name," ").concat(t.name):t.name}const I2=nl()&&typeof document<"u";let dU=0;class mU{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=D=>fI(D),onAddHTML:r=null,onInitialize:o=()=>{},onRender:l=()=>{},onFinalize:a=()=>{},onError:d,gl:g=null,glOptions:x={},debug:E=!1,createFramebuffer:P=!1,autoResizeViewport:A=!0,autoResizeDrawingBuffer:R=!0,stats:j=Hu.get("animation-loop-".concat(dU++))}=e;let{useDevicePixels:X=!0}=e;"useDevicePixelRatio"in e&&(Lt.deprecated("useDevicePixelRatio","useDevicePixels")(),X=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:r,onInitialize:o,onRender:l,onFinalize:a,onError:d,gl:g,glOptions:x,debug:E,createFramebuffer:P},this.gl=g,this.needsRedraw=null,this.timeline=null,this.stats=j,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:A,autoResizeDrawingBuffer:R,useDevicePixels:X}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return mt(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=yy.isSupported(this.gl,["timers"])?new yy(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):n}setViewParameters(){return Lt.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=I2?new Promise((e,n)=>{if(I2&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):b4(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):x4(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Wx(this.props.gl,e):this.onCreateContext(e),!Qy(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");s4(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let r=1;const{canvas:o}=this.gl;return o&&o.clientHeight?r=o.clientWidth/o.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&f4(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new qr(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Id="vs",$x="fs";function Vo(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const A_={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function gU(t){const e={};for(const n in t){const r=t[n],o=yU(r);e[n]=o}return e}function yU(t){let e=M2(t);return e==="object"?t?"type"in t?Object.assign({},t,A_[t.type]):"value"in t?(e=M2(t.value),Object.assign({type:e},t,A_[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},A_[e])}function M2(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const vU="vs",_U="fs";class k2{constructor(e){let{name:n,vs:r,fs:o,dependencies:l=[],uniforms:a,getUniforms:d,deprecations:g=[],defines:x={},inject:E={},vertexShader:P,fragmentShader:A}=e;Vo(typeof n=="string"),this.name=n,this.vs=r||P,this.fs=o||A,this.getModuleUniforms=d,this.dependencies=l,this.deprecations=this._parseDeprecationDefinitions(g),this.defines=x,this.injections=xU(E),a&&(this.uniforms=gU(a))}getModuleSource(e){let n;switch(e){case vU:n=this.vs||"";break;case _U:n=this.fs||"";break;default:Vo(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},r=this.uniforms;for(const o in r){const l=r[o];o in e&&!l.private?(l.validate&&Vo(l.validate(e[o],l),"".concat(this.name,": invalid ").concat(o)),n[o]=e[o]):n[o]=l.value}return n}}function xU(t){const e={vs:{},fs:{}};for(const n in t){let r=t[n];const o=n.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[o][n]=r}return e}function bU(t){return wU(II(t))}function wU(t){const e={},n={};return CI({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,o)=>n[o]-n[r]).map(r=>e[r])}function CI(t){let{modules:e,level:n,moduleMap:r,moduleDepth:o}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const l of e)r[l.name]=l,(o[l.name]===void 0||o[l.name]<n)&&(o[l.name]=n);for(const l of e)l.dependencies&&CI({modules:l.dependencies,level:n+1,moduleMap:r,moduleDepth:o})}function II(t,e){return t.map(n=>(n instanceof k2||(Vo(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),Vo(n.name,"shader module has no name"),n=new k2(n),n.dependencies=II(n.dependencies)),n))}function EU(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",r=n.indexOf("MSIE ")!==-1,o=n.indexOf("Trident/")!==-1;return r||o}const TU=7936,SU=7937,PU=7938,AU=35724,Xx={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Du={};Object.keys(Xx).forEach(t=>{Du[t]=t});function CU(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function IU(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||TU),r=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||SU);return{gpuVendor:MU(n,r),vendor:n,renderer:r,version:t.getParameter(PU),shadingLanguageVersion:t.getParameter(AU)}}function MU(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const C_={};function L2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Xx[e];if(Vo(r,e),!EU(n))return!0;if(e in C_)return C_[e];const o=r[0],l=n.behavior||"enable",a="#extension GL_".concat(o," : ").concat(l,`
void main(void) {}`),d=t.createShader(35633);t.shaderSource(d,a),t.compileShader(d);const g=t.getShaderParameter(d,35713);return t.deleteShader(d),C_[e]=g,g}function kU(t,e){const n=Xx[e];Vo(n,e);const r=CU(t)&&n[1]||n[0],o=typeof r=="string"?Boolean(t.getExtension(r)):r;return Vo(o===!1||o===!0),o}function rg(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>kU(t,n))}function LU(t){switch(IU(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function RU(t,e,n){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return rg(t,Du.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),rg(t,Du.GLSL_DERIVATIVES)&&L2(t,Du.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),rg(t,Du.GLSL_FRAG_DATA)&&L2(t,Du.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),rg(t,Du.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const OU=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,zU=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,DU={[Id]:OU,[$x]:zU},Mg="__LUMA_INJECT_DECLARATIONS__",R2=/void\s+main\s*\([^)]*\)\s*\{\n?/,O2=/}\n?[^{}]*$/,I_=[];function z2(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=e===Id;for(const l in n){const a=n[l];a.sort((g,x)=>g.order-x.order),I_.length=a.length;for(let g=0,x=a.length;g<x;++g)I_[g]=a[g].injection;const d="".concat(I_.join(`
`),`
`);switch(l){case"vs:#decl":o&&(t=t.replace(Mg,d));break;case"vs:#main-start":o&&(t=t.replace(R2,g=>g+d));break;case"vs:#main-end":o&&(t=t.replace(O2,g=>d+g));break;case"fs:#decl":o||(t=t.replace(Mg,d));break;case"fs:#main-start":o||(t=t.replace(R2,g=>g+d));break;case"fs:#main-end":o||(t=t.replace(O2,g=>d+g));break;default:t=t.replace(l,g=>g+d)}}return t=t.replace(Mg,""),r&&(t=t.replace(/\}\s*$/,l=>l+DU[e])),t}function f1(t){const e={};return Vo(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const r in n)e[r]=e[r]?"".concat(e[r],`
`).concat(n[r]):n[r]}),e}function Hh(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const MI=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],FU=[...MI,[Hh("attribute"),"in $1"],[Hh("varying"),"out $1"]],NU=[...MI,[Hh("varying"),"in $1"]],kI=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],BU=[...kI,[Hh("in"),"attribute $1"],[Hh("out"),"varying $1"]],UU=[...kI,[Hh("in"),"varying $1"]],p1="gl_FragColor",d1=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,VU=/void\s+main\s*\([^)]*\)\s*\{\n?/;function jU(t,e,n){switch(e){case 300:return n?vy(t,FU):GU(t);case 100:return n?vy(t,BU):WU(t);default:throw new Error("unknown GLSL version ".concat(e))}}function vy(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function GU(t){t=vy(t,NU);const e=t.match(d1);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(p1,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(VU,r=>"out vec4 ".concat(n,`;
`).concat(r)).replace(new RegExp("\\b".concat(p1,"\\b"),"g"),n)}return t}function WU(t){t=vy(t,UU);const e=t.match(d1);if(e){const n=e[1];t=t.replace(d1,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),p1)}return t}const HU=`

`.concat(Mg,`

`),LI={[Id]:"vertex",[$x]:"fragment"},qU=`precision highp float;

`;function ZU(t,e){const{vs:n,fs:r}=e,o=bU(e.modules||[]);return{gl:t,vs:D2(t,Object.assign({},e,{source:n,type:Id,modules:o})),fs:D2(t,Object.assign({},e,{source:r,type:$x,modules:o})),getUniforms:$U(o)}}function D2(t,e){let{id:n,source:r,type:o,modules:l,defines:a={},hookFunctions:d=[],inject:g={},transpileToGLSL100:x=!1,prologue:E=!0,log:P}=e;Vo(typeof r=="string","shader source must be a string");const A=o===Id,R=r.split(`
`);let j=100,X="",D=r;R[0].indexOf("#version ")===0?(j=300,X=R[0],D=R.slice(1).join(`
`)):X="#version ".concat(j);const F={};l.forEach(Ee=>{Object.assign(F,Ee.getDefines())}),Object.assign(F,a);let W=E?"".concat(X,`
`).concat(YU({id:n,source:r,type:o}),`
`).concat(XU({type:o}),`
`).concat(LU(t),`
`).concat(RU(t),`
`).concat(KU(F),`
`).concat(A?"":qU,`
`):"".concat(X,`
`);const J=QU(d),le={},ue={},ye={};for(const Ee in g){const Pe=typeof g[Ee]=="string"?{injection:g[Ee],order:0}:g[Ee],we=Ee.match(/^(v|f)s:(#)?([\w-]+)$/);if(we){const ze=we[2],Fe=we[3];ze?Fe==="decl"?ue[Ee]=[Pe]:ye[Ee]=[Pe]:le[Ee]=[Pe]}else ye[Ee]=[Pe]}for(const Ee of l){P&&Ee.checkDeprecations(D,P);const Pe=Ee.getModuleSource(o,j);W+=Pe;const we=Ee.injections[o];for(const ze in we){const Fe=ze.match(/^(v|f)s:#([\w-]+)$/);if(Fe){const He=Fe[2]==="decl"?ue:ye;He[ze]=He[ze]||[],He[ze].push(we[ze])}else le[ze]=le[ze]||[],le[ze].push(we[ze])}}return W+=HU,W=z2(W,o,ue),W+=JU(J[o],le),W+=D,W=z2(W,o,ye),W=jU(W,x?100:j,A),W}function $U(t){return function(n){const r={};for(const o of t){const l=o.getUniforms(n,r);Object.assign(r,l)}return r}}function XU(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(LI[e].toUpperCase(),`
`)}function YU(t){let{id:e,source:n,type:r}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(LI[r],`

`):""}function KU(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const r in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const o=t[r];(o||Number.isFinite(o))&&(n+="#define ".concat(r.toUpperCase()," ").concat(t[r],`
`))}return e===0&&(n+=`
`),n}function JU(t,e){let n="";for(const r in t){const o=t[r];if(n+="void ".concat(o.signature,` {
`),o.header&&(n+="  ".concat(o.header)),e[r]){const l=e[r];l.sort((a,d)=>a.order-d.order);for(const a of l)n+="  ".concat(a.injection,`
`)}o.footer&&(n+="  ".concat(o.footer)),n+=`}
`}return n}function QU(t){const e={vs:{},fs:{}};return t.forEach(n=>{let r;typeof n!="string"?(r=n,n=r.hook):r={},n=n.trim();const[o,l]=n.split(":"),a=n.replace(/\(.+/,"");e[o][a]=Object.assign(r,{signature:l})}),e}const e6="void main() {gl_FragColor = vec4(0);}",RI=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,t6=`#version 300 es
`.concat(RI);function OI(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[r,o,l]=n;if(!e.includes(r)||!o||!l)return null;const a=l.split(";")[0];return{qualifier:r,type:o,name:a}}function zI(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:r,output:o}=t;if(!n)return e===300?t6:e>300?"#version ".concat(e,`
`).concat(RI):e6;const l=i6(n,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(n,`;
out vec4 `).concat(o,`;
void main() {
  `).concat(o," = ").concat(l,`;
}`):"varying ".concat(r," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(l,`;
}`)}function n6(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Vo(!1),null}}function r6(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Vo(!1),null}}function i6(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Vo(!1),null}}const o6=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,a6={name:"fp32",vs:o6,fs:null},us={};us.EPSILON=1e-12;us.debug=!1;us.precision=4;us.printTypes=!1;us.printDegrees=!1;us.printRowMajor=!0;function F2(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Yx(t,e,n){const r=us.EPSILON;n&&(us.EPSILON=n);try{if(t===e)return!0;if(F2(t)&&F2(e)){if(t.length!==e.length)return!1;for(let o=0;o<t.length;++o)if(!Yx(t[o],e[o]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):Number.isFinite(t)&&Number.isFinite(e)?Math.abs(t-e)<=us.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{us.EPSILON=r}}const s6=new Uint8Array([0,255,255,255]),l6={pickingSelectedColor:null,pickingHighlightColor:s6,pickingActive:!1,pickingAttribute:!1};function u6(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:l6;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}const c6=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,h6=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,f6={name:"picking",vs:c6,fs:h6,getUniforms:u6},p6=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,d6={name:"transform",vs:p6,fs:null};class Md{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Md(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:r="",defines:o={},inject:l={},varyings:a=[],bufferMode:d=35981,transpileToGLSL100:g=!1}=e,x=this._getModuleList(e.modules),E=this._getHash(n),P=this._getHash(r),A=x.map(J=>this._getHash(J.name)).sort(),R=a.map(J=>this._getHash(J)),j=Object.keys(o).sort(),X=Object.keys(l).sort(),D=[],F=[];for(const J of j)D.push(this._getHash(J)),D.push(this._getHash(o[J]));for(const J of X)F.push(this._getHash(J)),F.push(this._getHash(l[J]));const W="".concat(E,"/").concat(P,"D").concat(D.join("/"),"M").concat(A.join("/"),"I").concat(F.join("/"),"V").concat(R.join("/"),"H").concat(this.stateHash,"B").concat(d).concat(g?"T":"");if(!this._programCache[W]){const J=ZU(this.gl,{vs:n,fs:r,modules:x,inject:l,defines:o,hookFunctions:this._hookFunctions,transpileToGLSL100:g});this._programCache[W]=new PI(this.gl,{hash:W,vs:J.vs,fs:J.fs,varyings:a,bufferMode:d}),this._getUniforms[W]=J.getUniforms||(le=>{}),this._useCounts[W]=0}return this._useCounts[W]++,this._programCache[W]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),r={};let o=0;for(let l=0,a=this._defaultModules.length;l<a;++l){const d=this._defaultModules[l],g=d.name;n[o++]=d,r[g]=!0}for(let l=0,a=e.length;l<a;++l){const d=e[l],g=d.name;r[g]||(n[o++]=d,r[g]=!0)}return n.length=o,n}}const m6={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function g6(t,e,n){const r={};let o=e.indices;for(const l in e.attributes){const a=e.attributes[l],d=y6(l,n);if(l==="indices")o=a;else if(a.constant)r[d]=a.value;else{const g=a.value,x={...a};delete x.value,r[d]=[new Yn(t,g),x],v6(l,x)}}if(o){const l=o.value||o;mt(l instanceof Uint16Array||l instanceof Uint32Array,'attribute array for "indices" must be of integer type');const a={size:1,isIndexed:o.isIndexed===void 0?!0:o.isIndexed};r.indices=[new Yn(t,{data:l,target:34963}),a]}return r}function y6(t,e){const{attributeMap:n=m6}=e||{};return n&&n[t]||t}function v6(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}mt(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const ch=2,_6=1e4,x6="Model needs drawMode and vertexCount",N2=()=>{},b6={};class Kx{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=ru("model")}=n;mt(Qy(e)),this.id=r,this.gl=e,this.id=n.id||ru("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||Md.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:r,fs:o,modules:l,defines:a,inject:d,varyings:g,bufferMode:x,transpileToGLSL100:E}=e;this.programProps={program:n,vs:r,fs:o,modules:l,defines:a,inject:d,varyings:g,bufferMode:x,transpileToGLSL100:E},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},mt(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),x6)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:r,fs:o,modules:l,defines:a,inject:d,varyings:g,bufferMode:x,transpileToGLSL100:E}=e;this.programProps={program:n,vs:r,fs:o,modules:l,defines:a,inject:d,varyings:g,bufferMode:x,transpileToGLSL100:E},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return mt(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return mt(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=g6(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Wh(e))return this;const n={};for(const r in e){const o=e[r];n[r]=o.getValue?o.getValue():o}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return qx(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:r,uniforms:o={},attributes:l={},transformFeedback:a=this.transformFeedback,parameters:d={},vertexArray:g=this.vertexArray}=e;this.setAttributes(l),this.updateModuleSettings(n),this.setUniforms(o);let x;Lt.priority>=ch&&(x=this._logDrawCallStart(ch));const E=this.vertexArray.getDrawParams(),{isIndexed:P=E.isIndexed,indexType:A=E.indexType,indexOffset:R=E.indexOffset,vertexArrayInstanced:j=E.isInstanced}=this.props;j&&!this.isInstanced&&Lt.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:X,instanceCount:D}=this,{onBeforeRender:F=N2,onAfterRender:W=N2}=this.props;F(),this.program.setUniforms(this.uniforms);const J=this.program.draw(Object.assign(b6,e,{logPriority:x,uniforms:null,framebuffer:r,parameters:d,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:g,transformFeedback:a,isIndexed:P,indexType:A,isInstanced:X,instanceCount:D,offset:P?R:0}));return W(),Lt.priority>=ch&&this._logDrawCallEnd(x,g,r),J}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:r,unbindModels:o=[]}=e;let{parameters:l}=e;r&&this._setFeedbackBuffers(r),n&&(l=Object.assign({},l,{[35977]:n})),o.forEach(a=>a.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:l}))}finally{o.forEach(a=>a.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Lt.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:r,fs:o,modules:l,inject:a,defines:d,varyings:g,bufferMode:x,transpileToGLSL100:E}=this.programProps;n=this.programManager.get({vs:r,fs:o,modules:l,inject:a,defines:d,varyings:g,bufferMode:x,transpileToGLSL100:E}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}mt(n instanceof PI,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new lU(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof Yn&&n.delete()}}_setAnimationProps(e){this.animated&&mt(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Wh(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new AI(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:_6;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Lt.group(ch,">>> DRAWING MODEL ".concat(this.id),{collapsed:Lt.level<=2})(),e}_logDrawCallEnd(e,n,r,o){if(e===void 0)return;const l=hU({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:d,unusedCount:g}=P2({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:x,count:E}=P2({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});E>0&&Lt.log("MISSING UNIFORMS",Object.keys(x))(),g>0&&Lt.log("UNUSED UNIFORMS",Object.keys(d))();const P=pU(this.vertexArray.configuration);Lt.table(e,l)(),Lt.table(e,a)(),Lt.table(e+1,P)(),o&&o.log({logLevel:ch,message:"Rendered to ".concat(o.id)}),Lt.groupEnd(ch)()}}class w6{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:o}=n;return{attributes:Object.assign({},r,e.attributes),transformFeedback:o}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],r=e?n[e]:null;return r?r instanceof Yn?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,r=this.getBuffer(n);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&mt(fn(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const o in this.feedbackMap){const l=this.feedbackMap[o];o in n&&(r[l]=o)}Object.assign(r,e.feedbackBuffers);for(const o in r){const l=r[o];if(typeof l=="string"){const a=n[l],{byteLength:d,usage:g,accessor:x}=a;r[o]=this._createNewBuffer(o,{byteLength:d,usage:g,accessor:x})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:r})}_setupTransformFeedback(e,n){let{model:r}=n;const{program:o}=r;e.transformFeedback=new AI(this.gl,{program:o,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceBuffers:n,feedbackBuffers:r})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const o in this.feedbackMap){const l=this.feedbackMap[o];n[o]=e.feedbackBuffers[l],r[l]=e.sourceBuffers[o],mt(r[l]instanceof Yn)}return{sourceBuffers:n,feedbackBuffers:r}}_createNewBuffer(e,n){const r=new Yn(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const E6="transform_uSampler_",_y="transform_uSize_",B2="transform_position";function T6(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:r,targetTexture:o}=t,a=Object.keys(n).length,d=null;const g={};let x=e,E={};if(a>0||r){const P=x.split(`
`),A=P.slice();if(P.forEach((R,j,X)=>{if(a>0){const D=I6(R,n);if(D){const{updatedLine:F,inject:W}=D;A[j]=F,E=f1([E,W]),Object.assign(g,D.samplerTextureMap),a--}}r&&!d&&(d=C6(R,r))}),r){mt(o);const R="".concat(_y).concat(r),j="uniform vec2 ".concat(R,`;
`),X="     vec2 ".concat(B2," = transform_getPos(").concat(R,`);
     gl_Position = vec4(`).concat(B2,`, 0, 1.);
`);E=f1([E,{"vs:#decl":j,"vs:#main-start":X}])}x=A.join(`
`)}return{vs:x,targetTextureType:d,inject:E,samplerTextureMap:g}}function S6(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:r}=t;const o={};let l,a;n&&({width:l,height:a}=r,o["".concat(_y).concat(n)]=[l,a]);for(const d in e)({width:l,height:a}=e[d]),o["".concat(_y).concat(d)]=[l,a];return o}function P6(t){return OI(t,["attribute","in"])}function A6(t){const e="".concat(E6).concat(t),n="".concat(_y).concat(t),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:r}}function C6(t,e){const n=OI(t,["varying","out"]);return n&&n.name===e?n.type:null}function I6(t,e){const n={},r=P6(t);if(!r)return null;const{type:o,name:l}=r;if(l&&e[l]){const a="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:d,sizeName:g,uniformDeclerations:x}=A6(l),E=n6(o),P="  ".concat(o," ").concat(l," = transform_getInput(").concat(d,", ").concat(g,").").concat(E,`;
`);return n[d]=l,{updatedLine:a,inject:{"vs:#decl":x,"vs:#main-start":P},samplerTextureMap:n}}return null}const M6={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},k6="transform_output";class L6{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:r,framebuffer:o,targetTexture:l}=this.bindings[this.currentIndex],a=Object.assign({},n,e.attributes),d=Object.assign({},e.uniforms),g=Object.assign({},e.parameters);let x=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(const P in this.samplerTextureMap){const A=this.samplerTextureMap[P];d[P]=r[A]}this._setSourceTextureParameters();const E=S6({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:l});Object.assign(d,E)}return this.hasTargetTexture&&(x=!1,g.viewport=[0,0,o.width,o.height]),{attributes:a,framebuffer:o,uniforms:d,discard:x,parameters:g}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],r=tv(n);if(!e)return r;const o=r.constructor,l=r6(this.targetTextureType),a=new o(r.length*l/4);let d=0;for(let g=0;g<r.length;g+=4)for(let x=0;x<l;x++)a[d++]=r[g+x];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:r}=e;if(r instanceof Ai)return r;const o=n[r];return o?(this._targetRefTexName=r,this._createNewTexture(o)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:r={},_targetTexture:o}=e,l=this._createTargetTexture({sourceTextures:r,textureOrReference:o});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:r,targetTexture:l}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((r,o,l)=>{l[o]=o}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new Yn(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceTextures:n,targetTexture:r})}}_updateBinding(e,n){const{sourceBuffers:r,sourceTextures:o,targetTexture:l}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,o),Object.assign(e.sourceBuffers,r),l){e.targetTexture=l;const{width:a,height:d}=l,{framebuffer:g}=e;g?(g.update({attachments:{[36064]:l},resizeAttachments:!1}),g.resize({width:a,height:d})):e.framebuffer=new qr(this.gl,{id:"transform-framebuffer",width:a,height:d,attachments:{[36064]:l}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const r in n)n[r].setParameters(M6)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:r}}_createNewTexture(e){const n=K4(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:r}=this.bindings[this.currentIndex],{vs:o,uniforms:l,targetTextureType:a,inject:d,samplerTextureMap:g}=T6({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),x=f1([e.inject||{},d]);this.targetTextureType=a,this.samplerTextureMap=g;const E=e._fs||zI({version:TI(o),input:this.targetTextureVarying,inputType:a,output:k6}),P=this.hasSourceTextures||this.targetTextureVarying?[d6].concat(e.modules||[]):e.modules;return{vs:o,fs:E,modules:P,uniforms:l,inject:x}}}class Jx{static isSupported(e){return fn(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:r}=this;e&&e.delete(),n&&n.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,r=this._updateDrawOptions(e);n&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)e=e||r.swap();mt(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n){const o=r.getData(e);if(o)return o}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Kx(n,Object.assign({},e,{fs:e.fs||zI({version:TI(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of r)n=o.updateModelProps(n);return n}_buildResourceTransforms(e,n){R6(n)&&(this.bufferTransform=new w6(e,n)),O6(n)&&(this.textureTransform=new L6(e,n)),mt(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of r)n=Object.assign(n,o.getDrawOptions(n));return n}}function R6(t){return!!(!Wh(t.feedbackBuffers)||!Wh(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function O6(t){return!!(!Wh(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const U2={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class DI{static get DRAW_MODE(){return U2}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=ru("geometry"),drawMode:r=U2.TRIANGLES,attributes:o={},indices:l=null,vertexCount:a=null}=e;this.id=n,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(o,l),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const r in e){let o=e[r];o=ArrayBuffer.isView(o)?{value:o}:o,mt(ArrayBuffer.isView(o.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!o.size&&(o.size=3),r==="indices"?(mt(!this.indices),this.indices=o):this.attributes[r]=o}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const o in e){const l=e[o],{value:a,size:d,constant:g}=l;!g&&a&&d>=1&&(r=Math.min(r,a.length/d))}return mt(Number.isFinite(r)),r}}let z6=1,D6=1;class FI{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:o=1,repeat:l=1}=e,a=z6++,d={time:0,delay:n,duration:r,rate:o,repeat:l};return this._setChannelTime(d,this.time),this.channels.set(a,d),a}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const o of n)this._setChannelTime(o,this.time);const r=this.animations.values();for(const o of r){const{animation:l,channel:a}=o;l.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=D6++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,o=e.duration*e.repeat;r>=o?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const F6=[255,255,255],N6=1;let B6=0;class U6{constructor(e={}){oe(this,"id",void 0),oe(this,"color",void 0),oe(this,"intensity",void 0),oe(this,"type","ambient");const{color:n=F6}=e,{intensity:r=N6}=e;this.id=e.id||"ambient-".concat(B6++),this.color=n,this.intensity=r}}function V2(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Do={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function V6(t,{precision:e=Do.precision}={}){return t=j6(t),"".concat(parseFloat(t.toPrecision(e)))}function qh(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function pi(t,e,n){return W6(t,r=>Math.max(e,Math.min(n,r)))}function xy(t,e,n){return qh(t)?t.map((r,o)=>xy(r,e[o],n)):n*e+(1-n)*t}function ad(t,e,n){const r=Do.EPSILON;n&&(Do.EPSILON=n);try{if(t===e)return!0;if(qh(t)&&qh(e)){if(t.length!==e.length)return!1;for(let o=0;o<t.length;++o)if(!ad(t[o],e[o]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Do.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Do.EPSILON=r}}function j6(t){return Math.round(t/Do.EPSILON)*Do.EPSILON}function G6(t){return t.clone?t.clone():new Array(t.length)}function W6(t,e,n){if(qh(t)){const r=t;n=n||G6(r);for(let o=0;o<n.length&&o<r.length;++o)n[o]=e(t[o],o,n);return n}return e(t)}function H6(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class NI extends H6(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:qh(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Do)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+V6(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!ad(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let o=0;o<this.ELEMENTS;++o){const l=e[o];this[o]=l+r*(n[o]-l)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Do.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function q6(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Oo(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function M_(t,e,n=""){if(Do.debug&&!q6(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class Z6 extends NI{get x(){return this[0]}set x(e){this[0]=Oo(e)}get y(){return this[1]}set y(e){this[1]=Oo(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const o=this[r]-e[r];n+=o*o}return Oo(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return Oo(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return V2(e>=0&&e<this.ELEMENTS,"index is out of range"),Oo(this[e])}setComponent(e,n){return V2(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var kg=1e-6,Zh=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function $6(){var t=new Zh(2);return Zh!=Float32Array&&(t[0]=0,t[1]=0),t}function X6(t,e,n){var r=e[0],o=e[1];return t[0]=n[0]*r+n[4]*o+n[12],t[1]=n[1]*r+n[5]*o+n[13],t}(function(){var t=$6();return function(e,n,r,o,l,a){var d,g;for(n||(n=2),r||(r=0),o?g=Math.min(o*n+r,e.length):g=e.length,d=r;d<g;d+=n)t[0]=e[d],t[1]=e[d+1],l(t,t,a),e[d]=t[0],e[d+1]=t[1];return e}})();function Y6(t,e,n){const r=e[0],o=e[1],l=n[3]*r+n[7]*o||1;return t[0]=(n[0]*r+n[4]*o)/l,t[1]=(n[1]*r+n[5]*o)/l,t}function BI(t,e,n){const r=e[0],o=e[1],l=e[2],a=n[3]*r+n[7]*o+n[11]*l||1;return t[0]=(n[0]*r+n[4]*o+n[8]*l)/a,t[1]=(n[1]*r+n[5]*o+n[9]*l)/a,t[2]=(n[2]*r+n[6]*o+n[10]*l)/a,t}function K6(t,e,n){const r=e[0],o=e[1];return t[0]=n[0]*r+n[2]*o,t[1]=n[1]*r+n[3]*o,t[2]=e[2],t}function J6(){var t=new Zh(3);return Zh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Q6(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function eV(t,e,n){var r=e[0],o=e[1],l=e[2],a=n[0],d=n[1],g=n[2];return t[0]=o*g-l*d,t[1]=l*a-r*g,t[2]=r*d-o*a,t}function UI(t,e,n){var r=e[0],o=e[1],l=e[2],a=n[3]*r+n[7]*o+n[11]*l+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*o+n[8]*l+n[12])/a,t[1]=(n[1]*r+n[5]*o+n[9]*l+n[13])/a,t[2]=(n[2]*r+n[6]*o+n[10]*l+n[14])/a,t}function tV(t,e,n){var r=e[0],o=e[1],l=e[2];return t[0]=r*n[0]+o*n[3]+l*n[6],t[1]=r*n[1]+o*n[4]+l*n[7],t[2]=r*n[2]+o*n[5]+l*n[8],t}function nV(t,e,n){var r=n[0],o=n[1],l=n[2],a=n[3],d=e[0],g=e[1],x=e[2],E=o*x-l*g,P=l*d-r*x,A=r*g-o*d,R=o*A-l*P,j=l*E-r*A,X=r*P-o*E,D=a*2;return E*=D,P*=D,A*=D,R*=2,j*=2,X*=2,t[0]=d+E+R,t[1]=g+P+j,t[2]=x+A+X,t}function rV(t,e,n,r){var o=[],l=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],l[0]=o[0],l[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),l[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t}function iV(t,e,n,r){var o=[],l=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],l[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),l[1]=o[1],l[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t}function oV(t,e,n,r){var o=[],l=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],l[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),l[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),l[2]=o[2],t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t}function aV(t,e){var n=t[0],r=t[1],o=t[2],l=e[0],a=e[1],d=e[2],g=Math.sqrt(n*n+r*r+o*o),x=Math.sqrt(l*l+a*a+d*d),E=g*x,P=E&&Q6(t,e)/E;return Math.acos(Math.min(Math.max(P,-1),1))}(function(){var t=J6();return function(e,n,r,o,l,a){var d,g;for(n||(n=3),r||(r=0),o?g=Math.min(o*n+r,e.length):g=e.length,d=r;d<g;d+=n)t[0]=e[d],t[1]=e[d+1],t[2]=e[d+2],l(t,t,a),e[d]=t[0],e[d+1]=t[1],e[d+2]=t[2];return e}})();const k_=[0,0,0];let ig;class ms extends Z6{static get ZERO(){return ig||(ig=new ms(0,0,0),Object.freeze(ig)),ig}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&qh(e)?this.copy(e):(Do.debug&&(Oo(e),Oo(n),Oo(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Do.debug&&(Oo(e.x),Oo(e.y),Oo(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Oo(e)}angle(e){return aV(this,e)}cross(e){return eV(this,this,e),this.check()}rotateX({radians:e,origin:n=k_}){return rV(this,this,n,e),this.check()}rotateY({radians:e,origin:n=k_}){return iV(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=k_}){return oV(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return UI(this,this,e),this.check()}transformAsVector(e){return BI(this,this,e),this.check()}transformByMatrix3(e){return tV(this,this,e),this.check()}transformByMatrix2(e){return K6(this,this,e),this.check()}transformByQuaternion(e){return nV(this,this,e),this.check()}}class sV extends NI{toString(){let e="[";if(Do.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=Oo(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let o=0;o<this.RANK;++o)n[o]=this[r+o];return n}setColumn(e,n){const r=e*this.RANK;for(let o=0;o<this.RANK;++o)this[r+o]=n[o];return this}}function lV(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function uV(t,e){if(t===e){var n=e[1],r=e[2],o=e[3],l=e[6],a=e[7],d=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=l,t[11]=e[14],t[12]=o,t[13]=a,t[14]=d}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function cV(t,e){var n=e[0],r=e[1],o=e[2],l=e[3],a=e[4],d=e[5],g=e[6],x=e[7],E=e[8],P=e[9],A=e[10],R=e[11],j=e[12],X=e[13],D=e[14],F=e[15],W=n*d-r*a,J=n*g-o*a,le=n*x-l*a,ue=r*g-o*d,ye=r*x-l*d,Ee=o*x-l*g,Pe=E*X-P*j,we=E*D-A*j,ze=E*F-R*j,Fe=P*D-A*X,Be=P*F-R*X,He=A*F-R*D,We=W*He-J*Be+le*Fe+ue*ze-ye*we+Ee*Pe;return We?(We=1/We,t[0]=(d*He-g*Be+x*Fe)*We,t[1]=(o*Be-r*He-l*Fe)*We,t[2]=(X*Ee-D*ye+F*ue)*We,t[3]=(A*ye-P*Ee-R*ue)*We,t[4]=(g*ze-a*He-x*we)*We,t[5]=(n*He-o*ze+l*we)*We,t[6]=(D*le-j*Ee-F*J)*We,t[7]=(E*Ee-A*le+R*J)*We,t[8]=(a*Be-d*ze+x*Pe)*We,t[9]=(r*ze-n*Be-l*Pe)*We,t[10]=(j*ye-X*le+F*W)*We,t[11]=(P*le-E*ye-R*W)*We,t[12]=(d*we-a*Fe-g*Pe)*We,t[13]=(n*Fe-r*we+o*Pe)*We,t[14]=(X*J-j*ue-D*W)*We,t[15]=(E*ue-P*J+A*W)*We,t):null}function hV(t){var e=t[0],n=t[1],r=t[2],o=t[3],l=t[4],a=t[5],d=t[6],g=t[7],x=t[8],E=t[9],P=t[10],A=t[11],R=t[12],j=t[13],X=t[14],D=t[15],F=e*a-n*l,W=e*d-r*l,J=e*g-o*l,le=n*d-r*a,ue=n*g-o*a,ye=r*g-o*d,Ee=x*j-E*R,Pe=x*X-P*R,we=x*D-A*R,ze=E*X-P*j,Fe=E*D-A*j,Be=P*D-A*X;return F*Be-W*Fe+J*ze+le*we-ue*Pe+ye*Ee}function j2(t,e,n){var r=e[0],o=e[1],l=e[2],a=e[3],d=e[4],g=e[5],x=e[6],E=e[7],P=e[8],A=e[9],R=e[10],j=e[11],X=e[12],D=e[13],F=e[14],W=e[15],J=n[0],le=n[1],ue=n[2],ye=n[3];return t[0]=J*r+le*d+ue*P+ye*X,t[1]=J*o+le*g+ue*A+ye*D,t[2]=J*l+le*x+ue*R+ye*F,t[3]=J*a+le*E+ue*j+ye*W,J=n[4],le=n[5],ue=n[6],ye=n[7],t[4]=J*r+le*d+ue*P+ye*X,t[5]=J*o+le*g+ue*A+ye*D,t[6]=J*l+le*x+ue*R+ye*F,t[7]=J*a+le*E+ue*j+ye*W,J=n[8],le=n[9],ue=n[10],ye=n[11],t[8]=J*r+le*d+ue*P+ye*X,t[9]=J*o+le*g+ue*A+ye*D,t[10]=J*l+le*x+ue*R+ye*F,t[11]=J*a+le*E+ue*j+ye*W,J=n[12],le=n[13],ue=n[14],ye=n[15],t[12]=J*r+le*d+ue*P+ye*X,t[13]=J*o+le*g+ue*A+ye*D,t[14]=J*l+le*x+ue*R+ye*F,t[15]=J*a+le*E+ue*j+ye*W,t}function fV(t,e,n){var r=n[0],o=n[1],l=n[2],a,d,g,x,E,P,A,R,j,X,D,F;return e===t?(t[12]=e[0]*r+e[4]*o+e[8]*l+e[12],t[13]=e[1]*r+e[5]*o+e[9]*l+e[13],t[14]=e[2]*r+e[6]*o+e[10]*l+e[14],t[15]=e[3]*r+e[7]*o+e[11]*l+e[15]):(a=e[0],d=e[1],g=e[2],x=e[3],E=e[4],P=e[5],A=e[6],R=e[7],j=e[8],X=e[9],D=e[10],F=e[11],t[0]=a,t[1]=d,t[2]=g,t[3]=x,t[4]=E,t[5]=P,t[6]=A,t[7]=R,t[8]=j,t[9]=X,t[10]=D,t[11]=F,t[12]=a*r+E*o+j*l+e[12],t[13]=d*r+P*o+X*l+e[13],t[14]=g*r+A*o+D*l+e[14],t[15]=x*r+R*o+F*l+e[15]),t}function pV(t,e,n){var r=n[0],o=n[1],l=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function dV(t,e,n,r){var o=r[0],l=r[1],a=r[2],d=Math.hypot(o,l,a),g,x,E,P,A,R,j,X,D,F,W,J,le,ue,ye,Ee,Pe,we,ze,Fe,Be,He,We,_t;return d<kg?null:(d=1/d,o*=d,l*=d,a*=d,g=Math.sin(n),x=Math.cos(n),E=1-x,P=e[0],A=e[1],R=e[2],j=e[3],X=e[4],D=e[5],F=e[6],W=e[7],J=e[8],le=e[9],ue=e[10],ye=e[11],Ee=o*o*E+x,Pe=l*o*E+a*g,we=a*o*E-l*g,ze=o*l*E-a*g,Fe=l*l*E+x,Be=a*l*E+o*g,He=o*a*E+l*g,We=l*a*E-o*g,_t=a*a*E+x,t[0]=P*Ee+X*Pe+J*we,t[1]=A*Ee+D*Pe+le*we,t[2]=R*Ee+F*Pe+ue*we,t[3]=j*Ee+W*Pe+ye*we,t[4]=P*ze+X*Fe+J*Be,t[5]=A*ze+D*Fe+le*Be,t[6]=R*ze+F*Fe+ue*Be,t[7]=j*ze+W*Fe+ye*Be,t[8]=P*He+X*We+J*_t,t[9]=A*He+D*We+le*_t,t[10]=R*He+F*We+ue*_t,t[11]=j*He+W*We+ye*_t,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function mV(t,e,n){var r=Math.sin(n),o=Math.cos(n),l=e[4],a=e[5],d=e[6],g=e[7],x=e[8],E=e[9],P=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*o+x*r,t[5]=a*o+E*r,t[6]=d*o+P*r,t[7]=g*o+A*r,t[8]=x*o-l*r,t[9]=E*o-a*r,t[10]=P*o-d*r,t[11]=A*o-g*r,t}function gV(t,e,n){var r=Math.sin(n),o=Math.cos(n),l=e[0],a=e[1],d=e[2],g=e[3],x=e[8],E=e[9],P=e[10],A=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*o-x*r,t[1]=a*o-E*r,t[2]=d*o-P*r,t[3]=g*o-A*r,t[8]=l*r+x*o,t[9]=a*r+E*o,t[10]=d*r+P*o,t[11]=g*r+A*o,t}function yV(t,e,n){var r=Math.sin(n),o=Math.cos(n),l=e[0],a=e[1],d=e[2],g=e[3],x=e[4],E=e[5],P=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*o+x*r,t[1]=a*o+E*r,t[2]=d*o+P*r,t[3]=g*o+A*r,t[4]=x*o-l*r,t[5]=E*o-a*r,t[6]=P*o-d*r,t[7]=A*o-g*r,t}function vV(t,e){var n=e[0],r=e[1],o=e[2],l=e[3],a=n+n,d=r+r,g=o+o,x=n*a,E=r*a,P=r*d,A=o*a,R=o*d,j=o*g,X=l*a,D=l*d,F=l*g;return t[0]=1-P-j,t[1]=E+F,t[2]=A-D,t[3]=0,t[4]=E-F,t[5]=1-x-j,t[6]=R+X,t[7]=0,t[8]=A+D,t[9]=R-X,t[10]=1-x-P,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _V(t,e,n,r,o,l,a){var d=1/(n-e),g=1/(o-r),x=1/(l-a);return t[0]=l*2*d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l*2*g,t[6]=0,t[7]=0,t[8]=(n+e)*d,t[9]=(o+r)*g,t[10]=(a+l)*x,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*l*2*x,t[15]=0,t}function xV(t,e,n,r,o){var l=1/Math.tan(e/2),a;return t[0]=l/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0?(a=1/(r-o),t[10]=(o+r)*a,t[14]=2*o*r*a):(t[10]=-1,t[14]=-2*r),t}var bV=xV;function wV(t,e,n,r,o,l,a){var d=1/(e-n),g=1/(r-o),x=1/(l-a);return t[0]=-2*d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*x,t[11]=0,t[12]=(e+n)*d,t[13]=(o+r)*g,t[14]=(a+l)*x,t[15]=1,t}var EV=wV;function TV(t,e,n,r){var o,l,a,d,g,x,E,P,A,R,j=e[0],X=e[1],D=e[2],F=r[0],W=r[1],J=r[2],le=n[0],ue=n[1],ye=n[2];return Math.abs(j-le)<kg&&Math.abs(X-ue)<kg&&Math.abs(D-ye)<kg?lV(t):(E=j-le,P=X-ue,A=D-ye,R=1/Math.hypot(E,P,A),E*=R,P*=R,A*=R,o=W*A-J*P,l=J*E-F*A,a=F*P-W*E,R=Math.hypot(o,l,a),R?(R=1/R,o*=R,l*=R,a*=R):(o=0,l=0,a=0),d=P*a-A*l,g=A*o-E*a,x=E*l-P*o,R=Math.hypot(d,g,x),R?(R=1/R,d*=R,g*=R,x*=R):(d=0,g=0,x=0),t[0]=o,t[1]=d,t[2]=E,t[3]=0,t[4]=l,t[5]=g,t[6]=P,t[7]=0,t[8]=a,t[9]=x,t[10]=A,t[11]=0,t[12]=-(o*j+l*X+a*D),t[13]=-(d*j+g*X+x*D),t[14]=-(E*j+P*X+A*D),t[15]=1,t)}function SV(){var t=new Zh(4);return Zh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function PV(t,e,n){var r=e[0],o=e[1],l=e[2],a=e[3];return t[0]=n[0]*r+n[4]*o+n[8]*l+n[12]*a,t[1]=n[1]*r+n[5]*o+n[9]*l+n[13]*a,t[2]=n[2]*r+n[6]*o+n[10]*l+n[14]*a,t[3]=n[3]*r+n[7]*o+n[11]*l+n[15]*a,t}(function(){var t=SV();return function(e,n,r,o,l,a){var d,g;for(n||(n=4),r||(r=0),o?g=Math.min(o*n+r,e.length):g=e.length,d=r;d<g;d+=n)t[0]=e[d],t[1]=e[d+1],t[2]=e[d+2],t[3]=e[d+3],l(t,t,a),e[d]=t[0],e[d+1]=t[1],e[d+2]=t[2],e[d+3]=t[3];return e}})();var m1;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(m1||(m1={}));const AV=45*Math.PI/180,CV=1,L_=.1,R_=500,IV=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class sa extends sV{static get IDENTITY(){return kV()}static get ZERO(){return MV()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return m1}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,o,l,a,d,g,x,E,P,A,R,j,X,D){return this[0]=e,this[1]=n,this[2]=r,this[3]=o,this[4]=l,this[5]=a,this[6]=d,this[7]=g,this[8]=x,this[9]=E,this[10]=P,this[11]=A,this[12]=R,this[13]=j,this[14]=X,this[15]=D,this.check()}setRowMajor(e,n,r,o,l,a,d,g,x,E,P,A,R,j,X,D){return this[0]=e,this[1]=l,this[2]=x,this[3]=R,this[4]=n,this[5]=a,this[6]=E,this[7]=j,this[8]=r,this[9]=d,this[10]=P,this[11]=X,this[12]=o,this[13]=g,this[14]=A,this[15]=D,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(IV)}fromObject(e){return this.check()}fromQuaternion(e){return vV(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:o,top:l,near:a=L_,far:d=R_}=e;return d===1/0?LV(this,n,r,o,l,a):_V(this,n,r,o,l,a,d),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:o=[0,1,0]}=e;return TV(this,n,r,o),this.check()}ortho(e){const{left:n,right:r,bottom:o,top:l,near:a=L_,far:d=R_}=e;return EV(this,n,r,o,l,a,d),this.check()}orthographic(e){const{fovy:n=AV,aspect:r=CV,focalDistance:o=1,near:l=L_,far:a=R_}=e;G2(n);const d=n/2,g=o*Math.tan(d),x=g*r;return this.ortho({left:-x,right:x,bottom:-g,top:g,near:l,far:a})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:o=.1,far:l=500}=e;return G2(n),bV(this,n,r,o,l),this.check()}determinant(){return hV(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),o=1/r[0],l=1/r[1],a=1/r[2];return e[0]=this[0]*o,e[1]=this[1]*l,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*o,e[5]=this[5]*l,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*o,e[9]=this[9]*l,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),o=1/r[0],l=1/r[1],a=1/r[2];return e[0]=this[0]*o,e[1]=this[1]*l,e[2]=this[2]*a,e[3]=this[4]*o,e[4]=this[5]*l,e[5]=this[6]*a,e[6]=this[8]*o,e[7]=this[9]*l,e[8]=this[10]*a,e}transpose(){return uV(this,this),this.check()}invert(){return cV(this,this),this.check()}multiplyLeft(e){return j2(this,e,this),this.check()}multiplyRight(e){return j2(this,this,e),this.check()}rotateX(e){return mV(this,this,e),this.check()}rotateY(e){return gV(this,this,e),this.check()}rotateZ(e){return yV(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return dV(this,this,e,n),this.check()}scale(e){return pV(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return fV(this,this,e),this.check()}transform(e,n){return e.length===4?(n=PV(n||[-0,-0,-0,-0],e,this),M_(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let o;switch(r){case 2:o=X6(n||[-0,-0],e,this);break;case 3:o=UI(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return M_(o,e.length),o}transformAsVector(e,n){let r;switch(e.length){case 2:r=Y6(n||[-0,-0],e,this);break;case 3:r=BI(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return M_(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let og,ag;function MV(){return og||(og=new sa([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(og)),og}function kV(){return ag||(ag=new sa,Object.freeze(ag)),ag}function G2(t){if(t>Math.PI*2)throw Error("expected radians")}function LV(t,e,n,r,o,l){const a=2*l/(n-e),d=2*l/(o-r),g=(n+e)/(n-e),x=(o+r)/(o-r),E=-1,P=-1,A=-2*l;return t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=g,t[9]=x,t[10]=E,t[11]=P,t[12]=0,t[13]=0,t[14]=A,t[15]=0,t}const RV=[255,255,255],OV=1,zV=[0,0,-1];let DV=0;class W2{constructor(e={}){oe(this,"id",void 0),oe(this,"color",void 0),oe(this,"intensity",void 0),oe(this,"type","directional"),oe(this,"direction",void 0),oe(this,"shadow",void 0);const{color:n=RV}=e,{intensity:r=OV}=e,{direction:o=zV}=e,{_shadow:l=!1}=e;this.id=e.id||"directional-".concat(DV++),this.color=n,this.intensity=r,this.type="directional",this.direction=new ms(o).normalize().toArray(),this.shadow=l}getProjectedLight(e){return this}}class FV{constructor(e,n={id:"pass"}){oe(this,"id",void 0),oe(this,"gl",void 0),oe(this,"props",void 0);const{id:r}=n;this.id=r,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class kd extends FV{constructor(...e){super(...e),oe(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return Qs(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:r,viewports:o,views:l,onViewportActive:a,clearStack:d=!0,clearCanvas:g=!0}=e;e.pass=e.pass||"unknown";const x=this.gl;g&&BV(x,n),d&&(this._lastRenderIndex=-1);const E=[];for(const P of o){const A=l&&l[P.id];a==null||a(P);const R=this._getDrawLayerParams(P,e),j=P.subViewports||[P];for(const X of j){const D=this._drawLayersInViewport(x,{target:n,moduleParameters:r,viewport:X,view:A,pass:e.pass,layers:e.layers},R);E.push(D)}}return E}_getDrawLayerParams(e,{layers:n,pass:r,layerFilter:o,cullRect:l,effects:a,moduleParameters:d},g=!1){const x=[],E=VI(this._lastRenderIndex+1),P={layer:n[0],viewport:e,isPicking:r.startsWith("picking"),renderPass:r,cullRect:l},A={};for(let R=0;R<n.length;R++){const j=n[R],X=this._shouldDrawLayer(j,P,o,A),D={shouldDrawLayer:X};X&&!g&&(D.layerRenderIndex=E(j,X),D.moduleParameters=this._getModuleParameters(j,a,r,d),D.layerParameters=this.getLayerParameters(j,R,e)),x[R]=D}return x}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:o,target:l,viewport:a,view:d},g){const x=NV(e,{moduleParameters:r,target:l,viewport:a});if(d&&d.props.clear){const P=d.props.clear===!0?{color:!0,depth:!0}:d.props.clear;Uo(e,{scissorTest:!0,scissor:x},()=>qx(e,P))}const E={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Qs(e,{viewport:x});for(let P=0;P<n.length;P++){const A=n[P],{shouldDrawLayer:R,layerRenderIndex:j,moduleParameters:X,layerParameters:D}=g[P];if(R&&A.props.pickable&&E.pickableCount++,A.isComposite)E.compositeCount++;else if(R){E.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,j),X.viewport=a;try{A._drawLayer({moduleParameters:X,uniforms:{layerIndex:j},parameters:D})}catch(F){A.raiseError(F,"drawing ".concat(A," to ").concat(o))}}}return E}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,o){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(n))return!1;n.layer=a,a=a.parent}if(r){const d=n.layer.id;if(d in o||(o[d]=r(n)),!o[d])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,o){var l;const a=Object.assign(Object.create(((l=e.internalState)===null||l===void 0?void 0:l.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:ac(this.gl)});if(n)for(const g of n){var d;Object.assign(a,(d=g.getModuleParameters)===null||d===void 0?void 0:d.call(g,e))}return Object.assign(a,this.getModuleParameters(e,n),o)}}function VI(t=0,e={}){const n={},r=(o,l)=>{const a=o.props._offset,d=o.id,g=o.parent&&o.parent.id;let x;if(g&&!(g in e)&&r(o.parent,!1),g in n){const E=n[g]=n[g]||VI(e[g],e);x=E(o,l),n[d]=E}else Number.isFinite(a)?(x=a+(e[g]||0),n[d]=null):x=t;return l&&x>=t&&(t=x+1),e[d]=x,x};return r}function NV(t,{moduleParameters:e,target:n,viewport:r}){const o=n&&n.id!=="default-framebuffer",l=e&&e.devicePixelRatio||ac(t),a=o?n.height:t.drawingBufferHeight,d=r;return[d.x*l,a-(d.y+d.height)*l,d.width*l,d.height*l]}function BV(t,e){const n=e?e.width:t.drawingBufferWidth,r=e?e.height:t.drawingBufferHeight;Qs(t,{viewport:[0,0,n,r]}),t.clear(16640)}class UV extends kd{constructor(e,n){super(e,n),oe(this,"shadowMap",void 0),oe(this,"depthBuffer",void 0),oe(this,"fbo",void 0),this.shadowMap=new Ai(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new qu(e,{format:33189,width:1,height:1}),this.fbo=new qr(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;Uo(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],o=ac(this.gl),l=r.width*o,a=r.height*o;(l!==n.width||a!==n.height)&&n.resize({width:l,height:a}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const jI="#define SMOOTH_EDGE_RADIUS 0.5",VV=`
`.concat(jI,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),jV=`
`.concat(jI,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),GV={name:"geometry",vs:VV,fs:jV},WV=Object.keys(Vn).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Vn[t],";")).join(""),HV=Object.keys(ls).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(ls[t],";")).join(""),qV=Object.keys(gy).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(gy[t],";")).join(""),ZV="".concat(WV,`
`).concat(HV,`
`).concat(qV,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function $V(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function nv(t){let e={},n;return r=>{for(const o in r)if(!$V(r[o],e[o])){n=t(r),e=r;break}return n}}const H2=[0,0,0,0],XV=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],GI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],YV=[0,0,0],WI=[0,0,0],KV=nv(ej);function HI(t,e,n=WI){n.length<3&&(n=[n[0],n[1],0]);let r=n,o,l=!0;switch(e===Vn.LNGLAT_OFFSETS||e===Vn.METER_OFFSETS?o=n:o=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case ls.WEB_MERCATOR:(e===Vn.LNGLAT||e===Vn.CARTESIAN)&&(o=[0,0,0],l=!1);break;case ls.WEB_MERCATOR_AUTO_OFFSET:e===Vn.LNGLAT?r=o:e===Vn.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],o=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case ls.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case ls.GLOBE:l=!1,o=null;break;default:l=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:r,offsetMode:l}}function JV(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:o}=t;let{viewMatrix:l,viewProjectionMatrix:a}=t,d=H2,g=H2,x=t.cameraPosition;const{geospatialOrigin:E,shaderCoordinateOrigin:P,offsetMode:A}=HI(t,e,n);return A&&(g=t.projectPosition(E||P),x=[x[0]-g[0],x[1]-g[1],x[2]-g[2]],g[3]=1,d=Yy([],g,a),l=r||l,a=Xl([],o,l),a=Xl([],a,XV)),{viewMatrix:l,viewProjectionMatrix:a,projectionCenter:d,originCommon:g,cameraPosCommon:x,shaderCoordinateOrigin:P,geospatialOrigin:E}}function QV({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=Vn.DEFAULT,coordinateOrigin:o=WI,autoWrapLongitude:l=!1}){r===Vn.DEFAULT&&(r=t.isGeospatial?Vn.LNGLAT:Vn.CARTESIAN);const a=KV({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:o});return a.project_uWrapLongitude=l,a.project_uModelMatrix=n||GI,a}function ej({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:o,viewProjectionMatrix:l,originCommon:a,cameraPosCommon:d,shaderCoordinateOrigin:g,geospatialOrigin:x}=JV(t,n,r),E=t.getDistanceScales(),P=[t.width*e,t.height*e],A=Yy([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,R={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:g,project_uCommonOrigin:a.slice(0,3),project_uCenter:o,project_uPseudoMeters:Boolean(t._pseudoMeters),project_uViewportSize:P,project_uDevicePixelRatio:e,project_uFocalDistance:A,project_uCommonUnitsPerMeter:E.unitsPerMeter,project_uCommonUnitsPerWorldUnit:E.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:YV,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:l,project_uModelMatrix:GI,project_uCameraPosition:d};if(x){const j=t.getDistanceScales(x);switch(n){case Vn.METER_OFFSETS:R.project_uCommonUnitsPerWorldUnit=j.unitsPerMeter,R.project_uCommonUnitsPerWorldUnit2=j.unitsPerMeter2;break;case Vn.LNGLAT:case Vn.LNGLAT_OFFSETS:t._pseudoMeters||(R.project_uCommonUnitsPerMeter=j.unitsPerMeter),R.project_uCommonUnitsPerWorldUnit=j.unitsPerDegree,R.project_uCommonUnitsPerWorldUnit2=j.unitsPerDegree2;break;case Vn.CARTESIAN:R.project_uCommonUnitsPerWorldUnit=[1,1,j.unitsPerMeter[2]],R.project_uCommonUnitsPerWorldUnit2=[0,0,j.unitsPerMeter2[2]];break}}return R}const tj={};function nj(t=tj){return"viewport"in t?QV(t):{}}const rv={name:"project",dependencies:[a6,GV],vs:ZV,getUniforms:nj};var $h=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function rj(){var t=new $h(4);return $h!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function ij(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function oj(t,e,n){var r=e[0],o=e[1],l=e[2],a=e[3];return t[0]=n[0]*r+n[4]*o+n[8]*l+n[12]*a,t[1]=n[1]*r+n[5]*o+n[9]*l+n[13]*a,t[2]=n[2]*r+n[6]*o+n[10]*l+n[14]*a,t[3]=n[3]*r+n[7]*o+n[11]*l+n[15]*a,t}(function(){var t=rj();return function(e,n,r,o,l,a){var d,g;for(n||(n=4),r||(r=0),o?g=Math.min(o*n+r,e.length):g=e.length,d=r;d<g;d+=n)t[0]=e[d],t[1]=e[d+1],t[2]=e[d+2],t[3]=e[d+3],l(t,t,a),e[d]=t[0],e[d+1]=t[1],e[d+2]=t[2],e[d+3]=t[3];return e}})();function aj(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Rh(t,e){const n=oj([],e,t);return ij(n,n,1/n[3]),n}function q2(t,e){const n=t%e;return n<0?e+n:n}function g1(t,e,n){return t<e?e:t>n?n:t}function sj(t){return Math.log(t)*Math.LOG2E}const Qx=Math.log2||sj;function Z2(t,e,n){var r=n[0],o=n[1],l=n[2],a,d,g,x,E,P,A,R,j,X,D,F;return e===t?(t[12]=e[0]*r+e[4]*o+e[8]*l+e[12],t[13]=e[1]*r+e[5]*o+e[9]*l+e[13],t[14]=e[2]*r+e[6]*o+e[10]*l+e[14],t[15]=e[3]*r+e[7]*o+e[11]*l+e[15]):(a=e[0],d=e[1],g=e[2],x=e[3],E=e[4],P=e[5],A=e[6],R=e[7],j=e[8],X=e[9],D=e[10],F=e[11],t[0]=a,t[1]=d,t[2]=g,t[3]=x,t[4]=E,t[5]=P,t[6]=A,t[7]=R,t[8]=j,t[9]=X,t[10]=D,t[11]=F,t[12]=a*r+E*o+j*l+e[12],t[13]=d*r+P*o+X*l+e[13],t[14]=g*r+A*o+D*l+e[14],t[15]=x*r+R*o+F*l+e[15]),t}function lj(t,e,n){var r=n[0],o=n[1],l=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function uj(t,e,n){var r=Math.sin(n),o=Math.cos(n),l=e[4],a=e[5],d=e[6],g=e[7],x=e[8],E=e[9],P=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*o+x*r,t[5]=a*o+E*r,t[6]=d*o+P*r,t[7]=g*o+A*r,t[8]=x*o-l*r,t[9]=E*o-a*r,t[10]=P*o-d*r,t[11]=A*o-g*r,t}function cj(t,e,n){var r=Math.sin(n),o=Math.cos(n),l=e[0],a=e[1],d=e[2],g=e[3],x=e[4],E=e[5],P=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*o+x*r,t[1]=a*o+E*r,t[2]=d*o+P*r,t[3]=g*o+A*r,t[4]=x*o-l*r,t[5]=E*o-a*r,t[6]=P*o-d*r,t[7]=A*o-g*r,t}function hj(){var t=new $h(2);return $h!=Float32Array&&(t[0]=0,t[1]=0),t}function qI(t,e,n,r){var o=e[0],l=e[1];return t[0]=o+r*(n[0]-o),t[1]=l+r*(n[1]-l),t}(function(){var t=hj();return function(e,n,r,o,l,a){var d,g;for(n||(n=2),r||(r=0),o?g=Math.min(o*n+r,e.length):g=e.length,d=r;d<g;d+=n)t[0]=e[d],t[1]=e[d+1],l(t,t,a),e[d]=t[0],e[d+1]=t[1];return e}})();function fj(){var t=new $h(3);return $h!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function pj(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}(function(){var t=fj();return function(e,n,r,o,l,a){var d,g;for(n||(n=3),r||(r=0),o?g=Math.min(o*n+r,e.length):g=e.length,d=r;d<g;d+=n)t[0]=e[d],t[1]=e[d+1],t[2]=e[d+2],l(t,t,a),e[d]=t[0],e[d+1]=t[1],e[d+2]=t[2];return e}})();function el(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ca=Math.PI,ZI=Ca/4,oa=Ca/180,y1=180/Ca,Xh=512,by=4003e4,sg=85.051129,dj=1.5;function mj(t){return Qx(t)}function wy(t){const[e,n]=t;el(Number.isFinite(e)),el(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*oa,o=n*oa,l=Xh*(r+Ca)/(2*Ca),a=Xh*(Ca+Math.log(Math.tan(ZI+o*.5)))/(2*Ca);return[l,a]}function Yh(t){const[e,n]=t,r=e/Xh*(2*Ca)-Ca,o=2*(Math.atan(Math.exp(n/Xh*(2*Ca)-Ca))-ZI);return[r*y1,o*y1]}function gj(t){const{latitude:e}=t;el(Number.isFinite(e));const n=Math.cos(e*oa);return mj(by*n)-9}function O_(t){const e=Math.cos(t*oa);return Xh/by/e}function v1(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;el(Number.isFinite(e)&&Number.isFinite(n));const o=Xh,l=Math.cos(e*oa),a=o/360,d=a/l,g=o/by/l,x={unitsPerMeter:[g,g,g],metersPerUnit:[1/g,1/g,1/g],unitsPerDegree:[a,d,g],degreesPerUnit:[1/a,1/d,1/g]};if(r){const E=oa*Math.tan(e*oa)/l,P=a*E/2,A=o/by*E,R=A/d*g;x.unitsPerDegree2=[0,P,A],x.unitsPerMeter2=[R,0,R]}return x}function $I(t,e){const[n,r,o]=t,[l,a,d]=e,{unitsPerMeter:g,unitsPerMeter2:x}=v1({longitude:n,latitude:r,highPrecision:!0}),E=wy(t);E[0]+=l*(g[0]+x[0]*a),E[1]+=a*(g[1]+x[1]*a);const P=Yh(E),A=(o||0)+(d||0);return Number.isFinite(o)||Number.isFinite(d)?[P[0],P[1],A]:P}function yj(t){const{height:e,pitch:n,bearing:r,altitude:o,scale:l,center:a}=t,d=aj();Z2(d,d,[0,0,-o]),uj(d,d,-n*oa),cj(d,d,r*oa);const g=l/e;return lj(d,d,[g,g,g]),a&&Z2(d,d,pj([],a)),d}function vj(t){const{width:e,height:n,altitude:r,pitch:o=0,offset:l,center:a,scale:d,nearZMultiplier:g=1,farZMultiplier:x=1}=t;let{fovy:E=Ey(dj)}=t;r!==void 0&&(E=Ey(r));const P=E*oa,A=o*oa,R=XI(E);let j=R;a&&(j+=a[2]*d/Math.cos(A)/n);const X=P*(.5+(l?l[1]:0)/n),D=Math.sin(X)*j/Math.sin(g1(Math.PI/2-A-X,.01,Math.PI-.01)),F=Math.sin(A)*D+j,W=j*10,J=Math.min(F*x,W);return{fov:P,aspect:e/n,focalDistance:R,near:g,far:J}}function Ey(t){return 2*Math.atan(.5/t)*y1}function XI(t){return .5/Math.tan(.5*t*oa)}function YI(t,e){const[n,r,o=0]=t;return el(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o)),Rh(e,[n,r,o,1])}function iv(t,e,n=0){const[r,o,l]=t;if(el(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(l))return Rh(e,[r,o,l,1]);const a=Rh(e,[r,o,0,1]),d=Rh(e,[r,o,1,1]),g=a[2],x=d[2],E=g===x?0:((n||0)-g)/(x-g);return qI([],a,d,E)}function KI(t){const{width:e,height:n,bounds:r,minExtent:o=0,maxZoom:l=24,offset:a=[0,0]}=t,[[d,g],[x,E]]=r,P=_j(t.padding),A=wy([d,g1(E,-sg,sg)]),R=wy([x,g1(g,-sg,sg)]),j=[Math.max(Math.abs(R[0]-A[0]),o),Math.max(Math.abs(R[1]-A[1]),o)],X=[e-P.left-P.right-Math.abs(a[0])*2,n-P.top-P.bottom-Math.abs(a[1])*2];el(X[0]>0&&X[1]>0);const D=X[0]/j[0],F=X[1]/j[1],W=(P.right-P.left)/2/D,J=(P.top-P.bottom)/2/F,le=[(R[0]+A[0])/2+W,(R[1]+A[1])/2+J],ue=Yh(le),ye=Math.min(l,Qx(Math.abs(Math.min(D,F))));return el(Number.isFinite(ye)),{longitude:ue[0],latitude:ue[1],zoom:ye}}function _j(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(el(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const $2=Math.PI/180;function xj(t,e=0){const{width:n,height:r,unproject:o}=t,l={targetZ:e},a=o([0,r],l),d=o([n,r],l);let g,x;const E=t.fovy?.5*t.fovy*$2:Math.atan(.5/t.altitude),P=(90-t.pitch)*$2;return E>P-.01?(g=X2(t,0,e),x=X2(t,n,e)):(g=o([0,0],l),x=o([n,0],l)),[a,d,x,g]}function X2(t,e,n){const{pixelUnprojectionMatrix:r}=t,o=Rh(r,[e,0,1,1]),l=Rh(r,[e,t.height,1,1]),d=(n*t.distanceScales.unitsPerMeter[2]-o[2])/(l[2]-o[2]),g=qI([],o,l,d),x=Yh(g);return x.push(n),x}const Y2=512;function bj(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:o,latitude:l,zoom:a,bearing:d=0}=t;(o<-180||o>180)&&(o=q2(o+180,360)-180),(d<-180||d>180)&&(d=q2(d+180,360)-180);const g=Qx(n/Y2);if(a<=g)a=g,l=0;else{const x=n/2/Math.pow(2,a),E=Yh([0,x])[1];if(l<E)l=E;else{const P=Yh([0,Y2-x])[1];l>P&&(l=P)}}return{width:e,height:n,longitude:o,latitude:l,zoom:a,pitch:r,bearing:d}}const wj=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Ej=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Tj=nv(Ij),Sj=nv(Mj),Pj=[0,0,0,1],Aj=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Cj(t,e){const[n,r,o]=t,l=iv([n,r,o],e);return Number.isFinite(o)?l:[l[0],l[1],0]}function Ij({viewport:t,center:e}){return new sa(t.viewProjectionMatrix).invert().transform(e)}function Mj({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,o=t.isGeospatial?void 0:1,l=[[0,0,o],[t.width,0,o],[0,t.height,o],[t.width,t.height,o],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(a=>Cj(a,r));for(const a of e){const d=a.clone().translate(new ms(t.center).negate()),g=l.map(E=>d.transform(E)),x=new sa().ortho({left:Math.min(...g.map(E=>E[0])),right:Math.max(...g.map(E=>E[0])),bottom:Math.min(...g.map(E=>E[1])),top:Math.max(...g.map(E=>E[1])),near:Math.min(...g.map(E=>-E[2])),far:Math.max(...g.map(E=>-E[2]))});n.push(x.multiplyRight(a))}return n}function kj(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||Pj,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},o=Tj({viewport:t.viewport,center:e.project_uCenter}),l=[],a=Sj({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let d=0;d<t.shadowMatrices.length;d++){const g=a[d],x=g.clone().translate(new ms(t.viewport.center).negate());e.project_uCoordinateSystem===Vn.LNGLAT&&e.project_uProjectionMode===ls.WEB_MERCATOR?(a[d]=x,l[d]=o):(a[d]=g.clone().multiplyRight(Aj),l[d]=x.transform(o))}for(let d=0;d<a.length;d++)r["shadow_uViewProjectionMatrices[".concat(d,"]")]=a[d],r["shadow_uProjectCenters[".concat(d,"]")]=l[d],t.shadowMaps&&t.shadowMaps.length>0?r["shadow_uShadowMap".concat(d)]=t.shadowMaps[d]:r["shadow_uShadowMap".concat(d)]=t.dummyShadowMap;return r}const z_={name:"shadow",dependencies:[rv],vs:wj,fs:Ej,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?kj(t,e):{}},Lj={color:[255,255,255],intensity:1},K2=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Rj=[0,0,0,200/255];class JI{constructor(e={}){oe(this,"id","lighting-effect"),oe(this,"props",void 0),oe(this,"shadowColor",Rj),oe(this,"shadow",void 0),oe(this,"ambientLight",void 0),oe(this,"directionalLights",void 0),oe(this,"pointLights",void 0),oe(this,"shadowPasses",[]),oe(this,"shadowMaps",[]),oe(this,"dummyShadowMap",null),oe(this,"programManager",void 0),oe(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:r,viewports:o,onViewportActive:l,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Md.getDefaultProgramManager(e),z_&&this.programManager.addDefaultModule(z_)),this.dummyShadowMap||(this.dummyShadowMap=new Ai(e,{width:1,height:1}));for(let d=0;d<this.shadowPasses.length;d++)this.shadowPasses[d].render({layers:n,layerFilter:r,viewports:o,onViewportActive:l,views:a,moduleParameters:{shadowLightId:d,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(z_),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new sa().lookAt({eye:new ms(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new UV(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new U6(Lj),this.directionalLights.push(new W2(K2[0]),new W2(K2[1])))}}class Oj{constructor(e={}){oe(this,"_pool",[]),oe(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:o,padding:l=0,copy:a=!1,initialize:d=!1,maxCount:g}){const x=o||e&&e.constructor||Float32Array,E=n*r+l;if(ArrayBuffer.isView(e)){if(E<=e.length)return e;if(E*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new x(e.buffer,0,E)}let P=1/0;g&&(P=g*r+l);const A=this._allocate(x,E,d,P);return e&&a?A.set(e):d||A.fill(0,0,4),this._release(e),A}release(e){this._release(e)}_allocate(e,n,r,o){let l=Math.max(Math.ceil(n*this.opts.overAlloc),1);l>o&&(l=o);const a=this._pool,d=e.BYTES_PER_ELEMENT*l,g=a.findIndex(x=>x.byteLength>=d);if(g>=0){const x=new e(a.splice(g,1)[0],0,l);return r&&x.fill(0),x}return new e(l)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:o}=r,l=n.findIndex(a=>a.byteLength>=o);l<0?n.push(r):(l>0||n.length<this.opts.poolSize)&&n.splice(l,0,r),n.length>this.opts.poolSize&&n.shift()}}const sd=new Oj;function Ap(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function zj(t,e){const n=t%e;return n<0?e+n:n}function Dj(t){return[t[12],t[13],t[14]]}function Fj(t){return{left:hh(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:hh(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:hh(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:hh(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:hh(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:hh(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const J2=new ms;function hh(t,e,n,r){J2.set(t,e,n);const o=J2.len();return{distance:r/o,normal:new ms(-t/o,-e/o,-n/o)}}function Nj(t){return t-Math.fround(t)}let bp;function D_(t,e){const{size:n=1,startIndex:r=0}=e,o=e.endIndex!==void 0?e.endIndex:t.length,l=(o-r)/n;bp=sd.allocate(bp,l,{type:Float32Array,size:n*2});let a=r,d=0;for(;a<o;){for(let g=0;g<n;g++){const x=t[a++];bp[d+g]=x,bp[d+g+n]=Nj(x)}d+=n*2}return bp.subarray(0,l*n*2)}const Bj=Math.PI/180,Uj=Ap(),Q2=[0,0,0],Vj={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function jj({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:o,padding:l,near:a,far:d}){const g=t/e,x=n?new sa().orthographic({fovy:r,aspect:g,focalDistance:o,near:a,far:d}):new sa().perspective({fovy:r,aspect:g,near:a,far:d});if(l){const{left:E=0,right:P=0,top:A=0,bottom:R=0}=l,j=pi((E+t-P)/2,0,t)-t/2,X=pi((A+e-R)/2,0,e)-e/2;x[8]-=j*2/t,x[9]+=X*2/e}return x}class dc{constructor(e={}){oe(this,"id",void 0),oe(this,"x",void 0),oe(this,"y",void 0),oe(this,"width",void 0),oe(this,"height",void 0),oe(this,"padding",void 0),oe(this,"isGeospatial",void 0),oe(this,"zoom",void 0),oe(this,"focalDistance",void 0),oe(this,"position",void 0),oe(this,"modelMatrix",void 0),oe(this,"distanceScales",void 0),oe(this,"scale",void 0),oe(this,"center",void 0),oe(this,"cameraPosition",void 0),oe(this,"projectionMatrix",void 0),oe(this,"viewMatrix",void 0),oe(this,"viewMatrixUncentered",void 0),oe(this,"viewMatrixInverse",void 0),oe(this,"viewProjectionMatrix",void 0),oe(this,"pixelProjectionMatrix",void 0),oe(this,"pixelUnprojectionMatrix",void 0),oe(this,"resolution",void 0),oe(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Vj,this.focalDistance=e.focalDistance||1,this.position=e.position||Q2,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ls.WEB_MERCATOR:ls.WEB_MERCATOR_AUTO_OFFSET:ls.IDENTITY}equals(e){return e instanceof dc?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&ad(e.projectionMatrix,this.projectionMatrix)&&ad(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),o=YI(r,this.pixelProjectionMatrix),[l,a]=o,d=n?a:this.height-a;return e.length===2?[l,d]:[l,d,o[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[o,l,a]=e,d=n?l:this.height-l,g=r&&r*this.distanceScales.unitsPerMeter[2],x=iv([o,d,a],this.pixelUnprojectionMatrix,g),[E,P,A]=this.unprojectPosition(x);return Number.isFinite(a)?[E,P,A]:Number.isFinite(r)?[E,P,r]:[E,P]}projectPosition(e){const[n,r]=this.projectFlat(e),o=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,o]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),o=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,o]}projectFlat(e){if(this.isGeospatial){const n=wy(e);return n[1]=pi(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Yh(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),o=this.unproject([this.width,0],n),l=this.unproject([0,this.height],n),a=this.unproject([this.width,this.height],n);return[Math.min(r[0],o[0],l[0],a[0]),Math.min(r[1],o[1],l[1],a[1]),Math.max(r[0],o[0],l[0],a[0]),Math.max(r[1],o[1],l[1],a[1])]}getDistanceScales(e){return e?v1({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:o=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Fj(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=gj({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||v1({latitude:r,longitude:n}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:l,modelMatrix:a}=e;let d=Q2;if(l&&(d=a?new sa(a).transformAsVector(l,[]):l),this.isGeospatial){const g=this.projectPosition([n,r,0]);this.center=new ms(d).scale(this.distanceScales.unitsPerMeter).add(g)}else this.center=this.projectPosition(d)}_initMatrices(e){const{viewMatrix:n=Uj,projectionMatrix:r=null,orthographic:o=!1,fovyRadians:l,fovy:a=75,near:d=.1,far:g=1e3,padding:x=null,focalDistance:E=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new sa().multiplyRight(n).translate(new ms(this.center).negate()),this.projectionMatrix=r||jj({width:this.width,height:this.height,orthographic:o,fovyRadians:l||a*Bj,focalDistance:E,padding:x,near:d,far:g});const P=Ap();Xl(P,P,this.projectionMatrix),Xl(P,P,this.viewMatrix),this.viewProjectionMatrix=P,this.viewMatrixInverse=q0([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Dj(this.viewMatrixInverse);const A=Ap(),R=Ap();kx(A,A,[this.width/2,-this.height/2,1]),ly(A,A,[1,-1,0]),Xl(R,A,this.viewProjectionMatrix),this.pixelProjectionMatrix=R,this.pixelUnprojectionMatrix=q0(Ap(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||En.warn("Pixel project matrix not invertible")()}}oe(dc,"displayName","Viewport");class lc extends dc{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:o=0,pitch:l=0,bearing:a=0,nearZMultiplier:d=.1,farZMultiplier:g=1.01,orthographic:x=!1,projectionMatrix:E,repeat:P=!1,worldOffset:A=0,position:R,padding:j,legacyMeterSizes:X=!1}=e;let{width:D,height:F,altitude:W=1.5}=e;const J=Math.pow(2,o);D=D||1,F=F||1;let le,ue=null;if(E)W=E[5]/2,le=Ey(W);else{e.fovy?(le=e.fovy,W=XI(le)):le=Ey(W);let Ee;if(j){const{top:Pe=0,bottom:we=0}=j;Ee=[0,pi((Pe+F-we)/2,0,F)-F/2]}ue=vj({width:D,height:F,scale:J,center:R&&[0,0,R[2]*O_(n)],offset:Ee,pitch:l,fovy:le,nearZMultiplier:d,farZMultiplier:g})}let ye=yj({height:F,pitch:l,bearing:a,scale:J,altitude:W});A&&(ye=new sa().translate([512*A,0,0]).multiplyLeft(ye)),super({...e,width:D,height:F,viewMatrix:ye,longitude:r,latitude:n,zoom:o,...ue,fovy:le,focalDistance:W}),oe(this,"longitude",void 0),oe(this,"latitude",void 0),oe(this,"pitch",void 0),oe(this,"bearing",void 0),oe(this,"altitude",void 0),oe(this,"fovy",void 0),oe(this,"orthographic",void 0),oe(this,"_subViewports",void 0),oe(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=r,this.zoom=o,this.pitch=l,this.bearing=a,this.altitude=W,this.fovy=le,this.orthographic=x,this._subViewports=P?[]:null,this._pseudoMeters=X,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let o=n;o<=r;o++){const l=o?new lc({...this,worldOffset:o}):this;this._subViewports.push(l)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),o=(e[2]||0)*O_(e[1]);return[n,r,o]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),o=(e[2]||0)/O_(r);return[n,r,o]}addMetersToLngLat(e,n){return $I(e,n)}panByPosition(e,n){const r=iv(n,this.pixelUnprojectionMatrix),o=this.projectFlat(e),l=rc([],o,Lx([],r)),a=rc([],this.center,l),[d,g]=this.unprojectFlat(a);return{longitude:d,latitude:g}}getBounds(e={}){const n=xj(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:o}=this,{longitude:l,latitude:a,zoom:d}=KI({width:r,height:o,bounds:e,...n});return new lc({width:r,height:o,longitude:l,latitude:a,zoom:d})}}oe(lc,"displayName","WebMercatorViewport");function F_(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof lc){const[o,l,a=0]=t,d=e.getDistanceScales([o,l]);r[2]=a*d.unitsPerMeter[2]}return r}function Gj(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:o,fromCoordinateSystem:l,fromCoordinateOrigin:a}=t;return o===Vn.DEFAULT&&(o=e.isGeospatial?Vn.LNGLAT:Vn.CARTESIAN),l===void 0&&(l=o),a===void 0&&(a=r),{viewport:e,coordinateSystem:o,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:l,fromCoordinateOrigin:a}}function QI(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:o,offsetMode:l}){let[a,d,g=0]=t;switch(n&&([a,d,g]=Yy([],[a,d,g,1],n)),r){case Vn.LNGLAT:return F_([a,d,g],e,l);case Vn.LNGLAT_OFFSETS:return F_([a+o[0],d+o[1],g+(o[2]||0)],e,l);case Vn.METER_OFFSETS:return F_($I(o,[a,d,g]),e,l);case Vn.CARTESIAN:default:return e.isGeospatial?[a+o[0],d+o[1],g+o[2]]:e.projectPosition([a,d,g])}}function Wj(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:o,modelMatrix:l,fromCoordinateSystem:a,fromCoordinateOrigin:d}=Gj(e),{geospatialOrigin:g,shaderCoordinateOrigin:x,offsetMode:E}=HI(n,r,o),P=QI(t,{viewport:n,modelMatrix:l,coordinateSystem:a,coordinateOrigin:d,offsetMode:E});if(E){const A=n.projectPosition(g||x);m3(P,P,A)}return P}const eS={blendFunc:[1,0,32771,0],blendEquation:32774};class eM extends kd{constructor(...e){super(...e),oe(this,"pickZ",void 0),oe(this,"_colorEncoderState",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:o,onViewportActive:l,pickingFBO:a,deviceRect:{x:d,y:g,width:x,height:E},cullRect:P,effects:A,pass:R="picking",pickZ:j,moduleParameters:X}){const D=this.gl;this.pickZ=j;const F=this._resetColorEncoder(j),W=Uo(D,{scissorTest:!0,scissor:[d,g,x,E],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...eS,blend:!j},()=>super.render({target:a,layers:e,layerFilter:n,views:r,viewports:o,onViewportActive:l,cullRect:P,effects:A==null?void 0:A.filter(le=>le.useInPicking),pass:R,moduleParameters:X}));return this._colorEncoderState=null,{decodePickingColor:F&&qj.bind(null,F),stats:W}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,r){const o={...e.props.parameters};return!this._colorEncoderState||e.props.operation.includes("terrain")?o.blend=!1:(Object.assign(o,eS),o.blend=!0,o.blendColor=Hj(this._colorEncoderState,e,r)),o}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function Hj(t,e,n){const{byLayer:r,byAlpha:o}=t;let l,a=r.get(e);return a?(a.viewports.push(n),l=a.a):(l=r.size+1,l<=255?(a={a:l,layer:e,viewports:[n]},r.set(e,a),o[l]=a):(En.warn("Too many pickable layers, only picking the first 255")(),l=0)),[0,0,0,l/255]}function qj(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const ph={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Ty=Symbol.for("component"),Ql=Symbol.for("propTypes"),N_=Symbol.for("deprecatedProps"),Oh=Symbol.for("asyncPropDefaults"),uc=Symbol.for("asyncPropOriginal"),Vl=Symbol.for("asyncPropResolved");function eb(t,e=()=>!0){return Array.isArray(t)?tM(t,e,[]):e(t)?[t]:[]}function tM(t,e,n){let r=-1;for(;++r<t.length;){const o=t[r];Array.isArray(o)?tM(o,e,n):e(o)&&n.push(o)}return n}function Zj({target:t,source:e,start:n=0,count:r=1}){const o=e.length,l=r*o;let a=0;for(let d=n;a<o;a++)t[d++]=e[a];for(;a<l;)a<l-a?(t.copyWithin(n+a,n,n+a),a*=2):(t.copyWithin(n+a,n,n+l-a),a=l);return t}class $j{constructor(e,n,r){oe(this,"id",void 0),oe(this,"context",void 0),oe(this,"isLoaded",void 0),oe(this,"persistent",void 0),oe(this,"_loadCount",0),oe(this,"_subscribers",new Set),oe(this,"_data",void 0),oe(this,"_loader",void 0),oe(this,"_error",void 0),oe(this,"_content",void 0),this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let o=e;typeof e=="string"&&(o=my(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(l=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=l)}).catch(l=>{this._loadCount===r&&(this.isLoaded=!0,this._error=l||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const l of this._subscribers)l.onChange(this.getData())}}class Xj{constructor({gl:e,protocol:n}){oe(this,"protocol",void 0),oe(this,"_context",void 0),oe(this,"_resources",void 0),oe(this,"_consumers",void 0),oe(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:o=!0}){let l=this._resources[e];l?l.setData(n,r):(l=new $j(e,n,this._context),this._resources[e]=l),l.persistent=o}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const o=n[r],l=this._resources[o.resourceId];l&&l.unsubscribe(o)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:o="default"}){const{_resources:l,protocol:a}=this;e.startsWith(a)&&(e=e.replace(a,""),l[e]||this.add({resourceId:e,data:null,persistent:!1}));const d=l[e];if(this._track(r,o,d,n),d)return d.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,o){const l=this._consumers,a=l[e]=l[e]||{},d=a[n]||{},g=d.resourceId&&this._resources[d.resourceId];g&&(g.unsubscribe(d),this.prune()),r&&(a[n]=d,d.onChange=o,d.resourceId=r.id,r.subscribe(d))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const Yj=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,nM={name:"project32",dependencies:[rv],vs:Yj},rM={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...f6},Kj=[rv],Jj=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Qj(t){const e=Md.getDefaultProgramManager(t);for(const n of Kj)e.addDefaultModule(n);for(const n of Jj)e.addShaderHook(n);return e}const e8="layerManager.setLayers",t8="layerManager.activateViewport";class n8{constructor(e,{deck:n,stats:r,viewport:o,timeline:l}={}){oe(this,"layers",void 0),oe(this,"context",void 0),oe(this,"resourceManager",void 0),oe(this,"_lastRenderedLayers",[]),oe(this,"_needsRedraw",!1),oe(this,"_needsUpdate",!1),oe(this,"_nextLayers",null),oe(this,"_debug",!1),oe(this,"activateViewport",a=>{ji(t8,this,a),a&&(this.context.viewport=a)}),this.layers=[],this.resourceManager=new Xj({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&Qj(e),stats:r||new Fx({id:"deck.gl"}),viewport:o||new dc({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new FI,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const o=r.getNeedsRedraw(e);n=n||o}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){ji(e8,this,n,e),this._lastRenderedLayers=e;const r=eb(e,Boolean);for(const o of r)o.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,r){r.raiseError(n,"".concat(e," of ").concat(r))}_updateLayers(e,n){const r={};for(const a of e)r[a.id]?En.warn("Multiple old layers with same id ".concat(a.id))():r[a.id]=a;const o=[];this._updateSublayersRecursively(n,r,o),this._finalizeOldLayers(r);let l=!1;for(const a of o)if(a.hasUniformTransition()){l="Uniform transition in ".concat(a);break}this._needsUpdate=l,this.layers=o}_updateSublayersRecursively(e,n,r){for(const o of e){o.context=this.context;const l=n[o.id];l===null&&En.warn("Multiple new layers with same id ".concat(o.id))(),n[o.id]=null;let a=null;try{this._debug&&l!==o&&o.validateProps(),l?(this._transferLayerState(l,o),this._updateLayer(o)):this._initializeLayer(o),r.push(o),a=o.isComposite?o.getSubLayers():null}catch(d){this._handleError("matching",d,o)}a&&this._updateSublayersRecursively(a,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=ph.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=ph.MATCHED,n!==e&&(e.lifecycle=ph.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=ph.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=ph.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function mc(t,e,n){if(t===e)return!0;if(!t||!e||Array.isArray(t)!==Array.isArray(e)||typeof t!="object"||typeof e!="object")return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1}else for(const r in e)if(!(r in t))return!1;for(const r in t)if(n){if(t[r]!==e[r]&&!mc(t[r],e[r],n-1))return!1}else if(t[r]!==e[r])return!1;return!0}class r8{constructor(e){oe(this,"width",void 0),oe(this,"height",void 0),oe(this,"views",void 0),oe(this,"viewState",void 0),oe(this,"controllers",void 0),oe(this,"timeline",void 0),oe(this,"_viewports",void 0),oe(this,"_viewportMap",void 0),oe(this,"_isUpdating",void 0),oe(this,"_needsRedraw",void 0),oe(this,"_needsUpdate",void 0),oe(this,"_eventManager",void 0),oe(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),o={x:e[0],y:e[1]};for(let l=r.length-1;l>=0;--l){const a=r[l];if(a.containsPixel(o)){const d=e.slice();return d[0]-=a.x,d[1]-=a.y,a.unproject(d,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=eb(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!mc(e,this.viewState,1)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):En.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:l=>{var a;return(a=this.getView(e.id))===null||a===void 0?void 0:a.makeViewport({viewState:l,width:this.width,height:this.height})}})}_updateController(e,n,r,o){const l=e.controller;if(l){const a={...n,...l,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return o||(o=this._createController(e,a)),o&&o.setProps(a),o}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let o=e.length;o--;){const l=e[o],a=this.getViewState(l),d=l.makeViewport({viewState:a,width:this.width,height:this.height});let g=n[l.id];const x=Boolean(l.controller);x&&!g&&(r=!0),(r||!x)&&g&&(g.finalize(),g=null),this.controllers[l.id]=this._updateController(l,a,d,g),this._viewports.unshift(d)}for(const o in n){const l=n[o];l&&!this.controllers[o]&&l.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,o)=>!e[o].equals(n[o]))}}const i8=/([0-9]+\.?[0-9]*)(%|px)/;function kl(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=i8.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function Ll(t,e){return t.relative?Math.round(t.position*e):t.position}function Ti(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class cc{constructor(e){oe(this,"id",void 0),oe(this,"viewportInstance",void 0),oe(this,"_x",void 0),oe(this,"_y",void 0),oe(this,"_width",void 0),oe(this,"_height",void 0),oe(this,"_padding",void 0),oe(this,"props",void 0);const{id:n,x:r=0,y:o=0,width:l="100%",height:a="100%",padding:d=null,viewportInstance:g}=e||{};Ti(!g||g instanceof dc),this.viewportInstance=g,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=kl(r),this._y=kl(o),this._width=kl(l),this._height=kl(a),this._padding=d&&{left:kl(d.left||0),right:kl(d.right||0),top:kl(d.top||0),bottom:kl(d.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&mc(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);const o=this.getDimensions({width:e,height:n});return new this.ViewportType({...r,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:Ll(this._x,e),y:Ll(this._y,n),width:Ll(this._width,e),height:Ll(this._height,n)};return this._padding&&(r.padding={left:Ll(this._padding.left,e),top:Ll(this._padding.top,n),right:Ll(this._padding.right,e),bottom:Ll(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Ld{constructor(e){oe(this,"_inProgress",void 0),oe(this,"_handle",void 0),oe(this,"_timeline",void 0),oe(this,"time",void 0),oe(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(n=(r=this.settings).onStart)===null||n===void 0||n.call(r,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:o}=this;this._handle=r.addChannel({delay:r.getTime(),duration:o.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const tS=()=>{},_1={BREAK:1,SNAP_TO_END:2,IGNORE:3},o8=t=>t,a8=_1.BREAK;class s8{constructor(e){oe(this,"getControllerState",void 0),oe(this,"props",void 0),oe(this,"propsInTransition",void 0),oe(this,"transition",void 0),oe(this,"onViewStateChange",void 0),oe(this,"onStateChange",void 0),oe(this,"_onTransitionUpdate",n=>{const{time:r,settings:{interpolator:o,startProps:l,endProps:a,duration:d,easing:g}}=n,x=g(r/d),E=o.interpolateProps(l,a,x);this.propsInTransition=this.getControllerState({...this.props,...E}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Ld(e.timeline),this.onViewStateChange=e.onViewStateChange||tS,this.onStateChange=e.onStateChange||tS}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let o=r;if(this.transition.inProgress){const{interruption:l,endProps:a}=this.transition.settings;o={...r,...l===_1.SNAP_TO_END?a:this.propsInTransition||r}}this._triggerTransition(o,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&Boolean(r)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===_1.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),o=this.getControllerState(n).shortestPathFrom(r),l=n.transitionInterpolator,a=l.getDuration?l.getDuration(e,n):n.transitionDuration;if(a===0)return;const d=l.initializeProps(e,o);this.propsInTransition={};const g={duration:a,easing:n.transitionEasing||o8,interpolator:l,interruption:n.transitionInterruption||a8,startProps:d.start,endProps:d.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(g),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class l8{constructor(e){oe(this,"_propsToCompare",void 0),oe(this,"_propsToExtract",void 0),oe(this,"_requiredProps",void 0);const{compare:n,extract:r,required:o}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=o}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!ad(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},o={};for(const l of this._propsToExtract)(l in e||l in n)&&(r[l]=e[l],o[l]=n[l]);return this._checkRequiredProps(r),this._checkRequiredProps(o),{start:r,end:o}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];Ti(Number.isFinite(r)||Array.isArray(r),"".concat(n," is required for transition"))})}}const u8=["longitude","latitude","zoom","bearing","pitch"],c8=["longitude","latitude","zoom"];class tb extends l8{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:u8,required:c8},super(r.transitionProps),oe(this,"opts",void 0),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:o,around:l}=this.opts;if(o&&l){const a=o(e),d=o(n),g=a.unproject(l);r.start.around=l,Object.assign(r.end,{around:d.project(g),aroundPosition:g,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const o={};for(const l of this._propsToExtract)o[l]=xy(e[l]||0,n[l]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const l=this.opts.makeViewport({...n,...o});Object.assign(o,l.panByPosition(n.aroundPosition,xy(e.around,n.around,r)))}return o}}const Rl={transitionDuration:0},h8=300,lg=t=>1-(1-t)*(1-t),fh={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Lu={};class iM{constructor(e){oe(this,"props",void 0),oe(this,"state",{}),oe(this,"transitionManager",void 0),oe(this,"eventManager",void 0),oe(this,"onViewStateChange",void 0),oe(this,"onStateChange",void 0),oe(this,"makeViewport",void 0),oe(this,"_controllerState",void 0),oe(this,"_events",{}),oe(this,"_interactionState",{isDragging:!1}),oe(this,"_customEvents",[]),oe(this,"_eventStartBlocked",null),oe(this,"_panMove",!1),oe(this,"invertPan",!1),oe(this,"dragMode","rotate"),oe(this,"inertia",0),oe(this,"scrollZoom",!0),oe(this,"dragPan",!0),oe(this,"dragRotate",!0),oe(this,"doubleClickZoom",!0),oe(this,"touchZoom",!0),oe(this,"touchRotate",!1),oe(this,"keyboard",!0),this.transitionManager=new s8({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:o}=e;return[o.x-n,o.y-r]}isPointInBounds(e,n){const{width:r,height:o}=this.props;if(n&&n.handled)return!1;const l=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=o;return l&&n&&n.stopPropagation(),l}isFunctionKeyPressed(e){const{srcEvent:n}=e;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?h8:0;const{scrollZoom:r=!0,dragPan:o=!0,dragRotate:l=!0,doubleClickZoom:a=!0,touchZoom:d=!0,touchRotate:g=!1,keyboard:x=!0}=e,E=Boolean(this.onViewStateChange);this.toggleEvents(fh.WHEEL,E&&r),this.toggleEvents(fh.PAN,E&&(o||l)),this.toggleEvents(fh.PINCH,E&&(d||g)),this.toggleEvents(fh.TRIPLE_PAN,E&&g),this.toggleEvents(fh.DOUBLE_TAP,E&&a),this.toggleEvents(fh.KEYBOARD,E&&x),this.scrollZoom=r,this.dragPan=o,this.dragRotate=l,this.doubleClickZoom=a,this.touchZoom=d,this.touchRotate=g,this.keyboard=x}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const o={...e.getViewportProps(),...n},l=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),l){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:a})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const o=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(o,Rl,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,Rl,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),o=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],l=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:lg},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Rl,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),o=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],l=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:lg},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:r=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:l}=e;let a=2/(1+Math.exp(-Math.abs(l*r)));l<0&&a!==0&&(a=1/a);const d=this.controllerState.zoom({pos:n,scale:a});return this.updateViewport(d,{...this._getTransitionProps({around:n}),transitionDuration:o?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,Rl,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Rl,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),o=[r[0],r[1]+=e.velocityY*n/2],l=this.controllerState.rotate({pos:o});this.updateViewport(l,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:lg},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Lu._startPinchRotation=e.rotation,Lu._lastPinchEvent=e,this.updateViewport(r,Rl,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,o=this.getCenter(e);n=n.zoom({pos:o,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:Lu._startPinchRotation-r})}return this.updateViewport(n,Rl,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Lu._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=Lu;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const o=this.getCenter(e);let l=this.controllerState.rotateEnd();const a=Math.log2(e.scale),d=(a-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),g=Math.pow(2,a+d*n/2);l=l.zoom({pos:o,scale:g}).zoomEnd(),this.updateViewport(l,{...this._getTransitionProps({around:o}),transitionDuration:n,transitionEasing:lg},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Lu._startPinchRotation=null,Lu._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),o=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(o,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:o,rotateSpeedX:l,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:d}=this;let g;const x={};switch(e.srcEvent.code){case"Minus":g=n?d.zoomOut(r).zoomOut(r):d.zoomOut(r),x.isZooming=!0;break;case"Equal":g=n?d.zoomIn(r).zoomIn(r):d.zoomIn(r),x.isZooming=!0;break;case"ArrowLeft":n?(g=d.rotateLeft(l),x.isRotating=!0):(g=d.moveLeft(o),x.isPanning=!0);break;case"ArrowRight":n?(g=d.rotateRight(l),x.isRotating=!0):(g=d.moveRight(o),x.isPanning=!0);break;case"ArrowUp":n?(g=d.rotateUp(a),x.isRotating=!0):(g=d.moveUp(o),x.isPanning=!0);break;case"ArrowDown":n?(g=d.rotateDown(a),x.isRotating=!0):(g=d.moveDown(o),x.isPanning=!0);break;default:return!1}return this.updateViewport(g,this._getTransitionProps(),x),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Rl:e?{...n,transitionInterpolator:new tb({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class oM{constructor(e,n){oe(this,"_viewportProps",void 0),oe(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const nS=5,f8=1.2;class p8 extends oM{constructor(e){const{width:n,height:r,latitude:o,longitude:l,zoom:a,bearing:d=0,pitch:g=0,altitude:x=1.5,position:E=[0,0,0],maxZoom:P=20,minZoom:A=0,maxPitch:R=60,minPitch:j=0,startPanLngLat:X,startZoomLngLat:D,startRotatePos:F,startBearing:W,startPitch:J,startZoom:le,normalize:ue=!0}=e;Ti(Number.isFinite(l)),Ti(Number.isFinite(o)),Ti(Number.isFinite(a)),super({width:n,height:r,latitude:o,longitude:l,zoom:a,bearing:d,pitch:g,altitude:x,maxZoom:P,minZoom:A,maxPitch:R,minPitch:j,normalize:ue,position:E},{startPanLngLat:X,startZoomLngLat:D,startRotatePos:F,startBearing:W,startPitch:J,startZoom:le}),oe(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const l=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(l)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:o,startBearing:l,startPitch:a}=this.getState();if(!o||l===void 0||a===void 0)return this;let d;return e?d=this._getNewRotation(e,o,a,l):d={bearing:l+n,pitch:a+r},this._getUpdatedState(d)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:o,startZoomLngLat:l}=this.getState();if(l||(o=this.getViewportProps().zoom,l=this._unproject(n)||this._unproject(e)),!l)return this;const{maxZoom:a,minZoom:d}=this.getViewportProps();let g=o+Math.log2(r);g=pi(g,d,a);const x=this.makeViewport({...this.getViewportProps(),zoom:g});return this._getUpdatedState({zoom:g,...x.panByPosition(l,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:o,longitude:l}=r;return Math.abs(o-n.bearing)>180&&(r.bearing=o<0?o+360:o-360),Math.abs(l-n.longitude)>180&&(r.longitude=l<0?l+360:l-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:o}=e;e.zoom=pi(o,r,n);const{maxPitch:l,minPitch:a,pitch:d}=e;e.pitch=pi(d,a,l);const{normalize:g=!0}=e;return g&&Object.assign(e,bj(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,o){const l=e[0]-n[0],a=e[1]-n[1],d=e[1],g=n[1],{width:x,height:E}=this.getViewportProps(),P=l/x;let A=0;a>0?Math.abs(E-g)>nS&&(A=a/(g-E)*f8):a<0&&g>nS&&(A=1-d/g),A=pi(A,-1,1);const{minPitch:R,maxPitch:j}=this.getViewportProps(),X=o+180*P;let D=r;return A>0?D=r+A*(j-r):A<0&&(D=r-A*(R-r)),{pitch:D,bearing:X}}}class d8 extends iM{constructor(...e){super(...e),oe(this,"ControllerState",p8),oe(this,"transition",{transitionDuration:300,transitionInterpolator:new tb({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),oe(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class nb extends cc{get ViewportType(){return lc}get ControllerType(){return d8}}oe(nb,"displayName","MapView");const m8=new JI;function g8(t,e){var n,r;const o=(n=t.order)!==null&&n!==void 0?n:1/0,l=(r=e.order)!==null&&r!==void 0?r:1/0;return o-l}class y8{constructor(){oe(this,"effects",void 0),oe(this,"_resolvedEffects",[]),oe(this,"_defaultEffects",[]),oe(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(o=>g8(o,e)>0);r<0?n.push(e):n.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!mc(e.effects,this.effects,1))&&this._setEffects(e.effects)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const o of this.effects)n[o.id]=o;const r=[];for(const o of e){const l=n[o.id];l&&l!==o?l.setProps?(l.setProps(o.props),r.push(l)):(l.cleanup(),r.push(o)):r.push(o),delete n[o.id]}for(const o in n)n[o].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(o=>o instanceof JI)||this._resolvedEffects.push(m8),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class v8 extends kd{shouldDrawLayer(e){return e.props.operation.includes("draw")}}const _8="deckRenderer.renderLayers";class x8{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new v8(e),this.pickLayersPass=new eM(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||qr.getDefaultFramebuffer(this.gl),e.preRenderStats={},this._preRender(e.effects,e);const r=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,o=n.render({...e,target:r});this._postRender(e.effects,e),this.renderCount++,ji(_8,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){let r=null;for(const o of e)n.preRenderStats[o.id]=o.preRender(this.gl,n),o.postRender&&(r=o);r&&this._resizeRenderBuffers(),this.lastPostProcessEffect=r}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new qr(this.gl),new qr(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:r}=this,o={inputBuffer:r[0],swapBuffer:r[1],target:null};for(const l of e)if(l.postRender){if(l===this.lastPostProcessEffect){o.target=n.target,l.postRender(this.gl,o);break}const a=l.postRender(this.gl,o);o.inputBuffer=a,o.swapBuffer=a===r[0]?r[1]:r[0]}}}const b8={pickedColor:null,pickedObjectIndex:-1};function w8({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:o,deviceRect:l}){const{x:a,y:d,width:g,height:x}=l;let E=o*o,P=-1,A=0;for(let R=0;R<x;R++){const j=R+d-r,X=j*j;if(X>E)A+=4*g;else for(let D=0;D<g;D++){if(t[A+3]-1>=0){const W=D+a-n,J=W*W+X;J<=E&&(E=J,P=A)}A+=4}}if(P>=0){const R=t.slice(P,P+4),j=e(R);if(j){const X=Math.floor(P/4/g),D=P/4-X*g;return{...j,pickedColor:R,pickedX:a+D,pickedY:d+X}}En.error("Picked non-existent layer. Is picking buffer corrupt?")()}return b8}function E8({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const l=t.slice(r,r+4),a=l.join(",");if(!n.has(a)){const d=e(l);d?n.set(a,{...d,color:l}):En.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function aM({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:o,z:l}){let a=e[0];e.length>1&&(a=S8((t==null?void 0:t.pickedViewports)||e,{x:r,y:o}));let d;if(a){const g=[r-a.x,o-a.y];l!==void 0&&(g[2]=l),d=a.unproject(g)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:r,y:o,pixel:[r,o],coordinate:d,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function T8(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:o}=t,{pickedColor:l,pickedLayer:a,pickedObjectIndex:d}=e,g=a?[a]:[];if(r==="hover"){const P=n.index,A=n.layerId,R=a?a.props.id:null;if(R!==A||d!==P){if(R!==A){const j=o.find(X=>X.props.id===A);j&&g.unshift(j)}n.layerId=R,n.index=d,n.info=null}}const x=aM(t),E=new Map;return E.set(null,x),g.forEach(P=>{let A={...x};P===a&&(A.color=l,A.index=d,A.picked=!0),A=sM({layer:P,info:A,mode:r});const R=A.layer;P===a&&r==="hover"&&(n.info=A),E.set(R.id,A),r==="hover"&&R.updateAutoHighlight(A)}),E}function sM({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function S8(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class P8{constructor(e){oe(this,"gl",void 0),oe(this,"pickingFBO",void 0),oe(this,"depthFBO",void 0),oe(this,"pickLayersPass",void 0),oe(this,"layerFilter",void 0),oe(this,"lastPickedInfo",void 0),oe(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new eM(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:o},l=this.lastPickedInfo.info){const a=l&&l.layer&&l.layer.id,d=l&&l.viewport&&l.viewport.id,g=a?r.find(A=>A.id===a):null,x=d&&o.find(A=>A.id===d)||o[0],E=x&&x.unproject([e-x.x,n-x.y]);return{...l,...{x:e,y:n,viewport:x,coordinate:E,layer:g}}}_resizeBuffer(){var e,n;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new qr(r),qr.isSupported(r,{colorBufferFloat:!0}))){const o=new qr(r);o.attach({[36064]:new Ai(r,{format:fn(r)?34836:6408,type:5126})}),this.depthFBO=o}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:o,y:l,radius:a=0,depth:d=1,mode:g="query",unproject3D:x,onViewportActive:E,effects:P}){const A=this._getPickable(e),R=ac(this.gl);if(!A)return{result:[],emptyInfo:aM({viewports:r,x:o,y:l,pixelRatio:R})};this._resizeBuffer();const j=b_(this.gl,[o,l],!0),X=[j.x+Math.floor(j.width/2),j.y+Math.floor(j.height/2)],D=Math.round(a*R),{width:F,height:W}=this.pickingFBO,J=this._getPickingRect({deviceX:X[0],deviceY:X[1],deviceRadius:D,deviceWidth:F,deviceHeight:W}),le={x:o-a,y:l-a,width:a*2+1,height:a*2+1};let ue;const ye=[],Ee=new Set;for(let Pe=0;Pe<d;Pe++){let we;if(J){const Fe=this._drawAndSample({layers:A,views:n,viewports:r,onViewportActive:E,deviceRect:J,cullRect:le,effects:P,pass:"picking:".concat(g)});we=w8({...Fe,deviceX:X[0],deviceY:X[1],deviceRadius:D,deviceRect:J})}else we={pickedColor:null,pickedObjectIndex:-1};let ze;we.pickedLayer&&x&&this.depthFBO&&(ze=this._drawAndSample({layers:[we.pickedLayer],views:n,viewports:r,onViewportActive:E,deviceRect:{x:we.pickedX,y:we.pickedY,width:1,height:1},cullRect:le,effects:P,pass:"picking:".concat(g,":z")},!0).pickedColors[0]),we.pickedLayer&&Pe+1<d&&(Ee.add(we.pickedLayer),we.pickedLayer.disablePickingIndex(we.pickedObjectIndex)),ue=T8({pickInfo:we,lastPickedInfo:this.lastPickedInfo,mode:g,layers:A,viewports:r,x:o,y:l,z:ze,pixelRatio:R});for(const Fe of ue.values())Fe.layer&&ye.push(Fe);if(!we.pickedColor)break}for(const Pe of Ee)Pe.restorePickingColors();return{result:ye,emptyInfo:ue.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:o,y:l,width:a=1,height:d=1,mode:g="query",maxObjects:x=null,onViewportActive:E,effects:P}){const A=this._getPickable(e);if(!A)return[];this._resizeBuffer();const R=ac(this.gl),j=b_(this.gl,[o,l],!0),X=j.x,D=j.y+j.height,F=b_(this.gl,[o+a,l+d],!0),W=F.x+F.width,J=F.y,le={x:X,y:J,width:W-X,height:D-J},ue=this._drawAndSample({layers:A,views:n,viewports:r,onViewportActive:E,deviceRect:le,cullRect:{x:o,y:l,width:a,height:d},effects:P,pass:"picking:".concat(g)}),ye=E8(ue),Ee=new Map,Pe=Number.isFinite(x);for(let we=0;we<ye.length&&!(Pe&&x&&Ee.size>=x);we++){const ze=ye[we];let Fe={color:ze.pickedColor,layer:null,index:ze.pickedObjectIndex,picked:!0,x:o,y:l,pixelRatio:R};Fe=sM({layer:ze.pickedLayer,info:Fe,mode:g}),Ee.has(Fe.object)||Ee.set(Fe.object,Fe)}return Array.from(Ee.values())}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:o,deviceRect:l,cullRect:a,effects:d,pass:g},x=!1){const E=x?this.depthFBO:this.pickingFBO,P={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:o,pickingFBO:E,deviceRect:l,cullRect:a,effects:d,pass:g,pickZ:x,preRenderStats:{}};for(const W of d)W.useInPicking&&(P.preRenderStats[W.id]=W.preRender(this.gl,P));const{decodePickingColor:A}=this.pickLayersPass.render(P),{x:R,y:j,width:X,height:D}=l,F=new(x?Float32Array:Uint8Array)(X*D*4);return tv(E,{sourceX:R,sourceY:j,sourceWidth:X,sourceHeight:D,target:F}),{pickedColors:F,decodePickingColor:A}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:o,deviceHeight:l}){const a=Math.max(0,e-r),d=Math.max(0,n-r),g=Math.min(o,e+r+1)-a,x=Math.min(l,n+r+1)-d;return g<=0||x<=0?null:{x:a,y:d,width:g,height:x}}}const A8={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class C8{constructor(e){oe(this,"el",null),oe(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,A8),n.appendChild(this.el))}setTooltip(e,n,r){const o=this.el;if(o){if(typeof e=="string")o.innerText=e;else if(e)e.text&&(o.innerText=e.text),e.html&&(o.innerHTML=e.html),e.className&&(o.className=e.className),Object.assign(o.style,e.style);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform="translate(".concat(n,"px, ").concat(r,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}const lM=1,uM=2,x1=4,I8={mousedown:lM,mousemove:uM,mouseup:x1};function M8(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function k8(t){const e=t.prototype.handler;t.prototype.handler=function(r){const o=this.store;r.button>0&&r.type==="pointerdown"&&(M8(o,l=>l.pointerId===r.pointerId)||o.push(r)),e.call(this,r)}}function L8(t){t.prototype.handler=function(n){let r=I8[n.type];r&lM&&n.button>=0&&(this.pressed=!0),r&uM&&n.which===0&&(r=x1),this.pressed&&(r&x1&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}k8(oc.PointerEventInput);L8(oc.MouseInput);const R8=oc.Manager;class ov{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const O8=es?[[es.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[es.Rotate,{enable:!1}],[es.Pinch,{enable:!1}],[es.Swipe,{enable:!1}],[es.Pan,{threshold:0,enable:!1}],[es.Press,{enable:!1}],[es.Tap,{event:"doubletap",taps:2,enable:!1}],[es.Tap,{event:"anytap",enable:!1}],[es.Tap,{enable:!1}]]:null,rS={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},z8={doubletap:["tap"]},D8={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},rb={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},F8={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},iS={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},N8=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Eh=typeof window<"u"?window:global;let b1=!1;try{const t={get passive(){return b1=!0,!0}};Eh.addEventListener("test",null,t),Eh.removeEventListener("test",null)}catch{b1=!1}const B8=N8.indexOf("firefox")!==-1,{WHEEL_EVENTS:U8}=rb,oS="wheel",aS=4.000244140625,V8=40,j8=.25;class G8 extends ov{constructor(e,n,r){super(e,n,r),this.handleEvent=o=>{if(!this.options.enable)return;let l=o.deltaY;Eh.WheelEvent&&(B8&&o.deltaMode===Eh.WheelEvent.DOM_DELTA_PIXEL&&(l/=Eh.devicePixelRatio),o.deltaMode===Eh.WheelEvent.DOM_DELTA_LINE&&(l*=V8)),l!==0&&l%aS===0&&(l=Math.floor(l/aS)),o.shiftKey&&l&&(l=l*j8),this.callback({type:oS,center:{x:o.clientX,y:o.clientY},delta:-l,srcEvent:o,pointerType:"mouse",target:o.target})},this.events=(this.options.events||[]).concat(U8),this.events.forEach(o=>e.addEventListener(o,this.handleEvent,b1?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===oS&&(this.options.enable=n)}}const{MOUSE_EVENTS:W8}=rb,sS="pointermove",lS="pointerover",uS="pointerout",cS="pointerenter",hS="pointerleave";class H8 extends ov{constructor(e,n,r){super(e,n,r),this.handleEvent=l=>{this.handleOverEvent(l),this.handleOutEvent(l),this.handleEnterEvent(l),this.handleLeaveEvent(l),this.handleMoveEvent(l)},this.pressed=!1;const{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,this.events=(this.options.events||[]).concat(W8),this.events.forEach(l=>e.addEventListener(l,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===sS&&(this.enableMoveEvent=n),e===lS&&(this.enableOverEvent=n),e===uS&&(this.enableOutEvent=n),e===cS&&(this.enableEnterEvent=n),e===hS&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(lS,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(uS,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(cS,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(hS,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(sS,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:q8}=rb,fS="keydown",pS="keyup";class Z8 extends ov{constructor(e,n,r){super(e,n,r),this.handleEvent=o=>{const l=o.target||o.srcElement;l.tagName==="INPUT"&&l.type==="text"||l.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:fS,srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:pS,srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(q8),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===fS&&(this.enableDownEvent=n),e===pS&&(this.enableUpEvent=n)}}const dS="contextmenu";class $8 extends ov{constructor(e,n,r){super(e,n,r),this.handleEvent=o=>{this.options.enable&&this.callback({type:dS,center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===dS&&(this.options.enable=n)}}const w1=1,Sy=2,E1=4,X8={pointerdown:w1,pointermove:Sy,pointerup:E1,mousedown:w1,mousemove:Sy,mouseup:E1},Y8=1,K8=2,J8=3,Q8=0,e9=1,t9=2,n9=1,r9=2,i9=4;function o9(t){const e=X8[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r,which:o}=t.srcEvent;let l=!1,a=!1,d=!1;return e===E1||e===Sy&&!Number.isFinite(n)?(l=o===Y8,a=o===K8,d=o===J8):e===Sy?(l=Boolean(n&n9),a=Boolean(n&i9),d=Boolean(n&r9)):e===w1&&(l=r===Q8,a=r===e9,d=r===t9),{leftButton:l,middleButton:a,rightButton:d}}function a9(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),o=r.width/e.offsetWidth||1,l=r.height/e.offsetHeight||1,a={x:(n.x-r.left-e.clientLeft)/o,y:(n.y-r.top-e.clientTop)/l};return{center:n,offsetCenter:a}}const B_={srcElement:"root",priority:0};class s9{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let o=n.srcEvent.target;for(;o&&o!==r.rootElement;){if(this._emit(r,o),r.handled)return;o=o.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,o=!1,l=!1){const{handlers:a,handlersByElement:d}=this;let g=B_;typeof r=="string"||r&&r.addEventListener?g={...B_,srcElement:r}:r&&(g={...B_,...r});let x=d.get(g.srcElement);x||(x=[],d.set(g.srcElement,x));const E={type:e,handler:n,srcElement:g.srcElement,priority:g.priority};o&&(E.once=!0),l&&(E.passive=!0),a.push(E),this._active=this._active||!E.passive;let P=x.length-1;for(;P>=0&&!(x[P].priority>=E.priority);)P--;x.splice(P+1,0,E)}remove(e,n){const{handlers:r,handlersByElement:o}=this;for(let l=r.length-1;l>=0;l--){const a=r[l];if(a.type===e&&a.handler===n){r.splice(l,1);const d=o.get(a.srcElement);d.splice(d.indexOf(a),1),d.length===0&&o.delete(a.srcElement)}}this._active=r.some(l=>!l.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let o=!1;const l=()=>{e.handled=!0},a=()=>{e.handled=!0,o=!0},d=[];for(let g=0;g<r.length;g++){const{type:x,handler:E,once:P}=r[g];if(E({...e,type:x,stopPropagation:l,stopImmediatePropagation:a}),P&&d.push(r[g]),o)break}for(let g=0;g<d.length;g++){const{type:x,handler:E}=d[g];this.remove(x,E)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...o9(e),...a9(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const l9={events:null,recognizers:null,recognizerOptions:{},Manager:R8,touchAction:"none",tabIndex:0};class u9{constructor(e=null,n){this._onBasicInput=o=>{const{srcEvent:l}=o,a=D8[l.type];a&&this.manager.emit(a,o)},this._onOtherEvent=o=>{this.manager.emit(o.type,o)},this.options={...l9,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||O8}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(rS).forEach(o=>{const l=this.manager.get(o);l&&rS[o].forEach(a=>{l.recognizeWith(a)})});for(const o in n.recognizerOptions){const l=this.manager.get(o);if(l){const a=n.recognizerOptions[o];delete a.enable,l.set(a)}}this.wheelInput=new G8(e,this._onOtherEvent,{enable:!1}),this.moveInput=new H8(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Z8(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new $8(e,this._onOtherEvent,{enable:!1});for(const[o,l]of this.events)l.isEmpty()||(this._toggleRecognizer(l.recognizerName,!0),this.manager.on(o,l.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const o=r.get(e);if(o&&o.options.enable!==n){o.set({enable:n});const l=z8[e];l&&!this.options.recognizers&&l.forEach(a=>{const d=r.get(a);n?(d.requireFailure(e),o.dropRequireFailure(a)):d.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,o,l){if(typeof e!="string"){r=n;for(const E in e)this._addEventHandler(E,e[E],r,o,l);return}const{manager:a,events:d}=this,g=iS[e]||e;let x=d.get(g);x||(x=new s9(this),d.set(g,x),x.recognizerName=F8[g]||g,a&&a.on(g,x.handleEvent)),x.add(e,n,r,o,l),x.isEmpty()||this._toggleRecognizer(x.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const a in e)this._removeEventHandler(a,e[a]);return}const{events:r}=this,o=iS[e]||e,l=r.get(o);if(l&&(l.remove(e,n),l.isEmpty())){const{recognizerName:a}=l;let d=!1;for(const g of r.values())if(g.recognizerName===a&&!g.isEmpty()){d=!0;break}d||this._toggleRecognizer(a,!1)}}}function Ru(){}const c9=({isDragging:t})=>t?"grabbing":"grab",cM={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Ru,onResize:Ru,onViewStateChange:Ru,onInteractionStateChange:Ru,onBeforeRender:Ru,onAfterRender:Ru,onLoad:Ru,onError:t=>En.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:c9,getTooltip:null,debug:!1,drawPickingColors:!1};class av{constructor(e){oe(this,"props",void 0),oe(this,"width",0),oe(this,"height",0),oe(this,"userData",{}),oe(this,"canvas",null),oe(this,"viewManager",null),oe(this,"layerManager",null),oe(this,"effectManager",null),oe(this,"deckRenderer",null),oe(this,"deckPicker",null),oe(this,"eventManager",null),oe(this,"tooltip",null),oe(this,"metrics",void 0),oe(this,"animationLoop",void 0),oe(this,"stats",void 0),oe(this,"viewState",void 0),oe(this,"cursorState",void 0),oe(this,"_needsRedraw",void 0),oe(this,"_pickRequest",void 0),oe(this,"_lastPointerDownInfo",null),oe(this,"_metricsCounter",void 0),oe(this,"_onPointerMove",n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;r.x=o.x,r.y=o.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n}),oe(this,"_onEvent",n=>{const r=QT[n.type],o=n.offsetCenter;if(!r||!o||!this.layerManager)return;const l=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:l,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:d}=a,g=d&&(d[r.handler]||d.props[r.handler]),x=this.props[r.handler];let E=!1;g&&(E=g.call(d,a,n)),!E&&x&&x(a,n)}),oe(this,"_onPointerDown",n=>{const r=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo}),this.props={...cM,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&En.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),qC()==="IE"&&En.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Fx({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&sd.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,o,l,a,d;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(r=this.effectManager)===null||r===void 0||r.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(l=this.deckPicker)===null||l===void 0||l.finalize(),this.deckPicker=null,(a=this.eventManager)===null||a===void 0||a.destroy(),this.eventManager=null,(d=this.tooltip)===null||d===void 0||d.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var g;(g=this.canvas.parentElement)===null||g===void 0||g.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&En.removed("onLayerHover","onHover")(),"onLayerClick"in e&&En.removed("onLayerClick","onClick")(),e.initialViewState&&!mc(this.props.initialViewState,e.initialViewState,1)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),o=this.layerManager.needsRedraw(e),l=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return n=n||r||o||l||a,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Ti(this.viewManager),this.viewManager.views}getViewports(e){return Ti(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,r){Ti(this.deckPicker);const{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(n).timeStart();const l=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return o.get(n).timeEnd(),l}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Ti(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const l=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=l}if(r||r===0){var o;const l=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((o=e.style)===null||o===void 0?void 0:o.position)||"absolute",this.canvas.style.height=l}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const n=e.clientWidth||e.width,r=e.clientHeight||e.height;if(n!==this.width||r!==this.height){var o;this.width=n,this.height=r,(o=this.viewManager)===null||o===void 0||o.setProps({width:n,height:r}),this.props.onResize({width:n,height:r})}}_createAnimationLoop(e){const{width:n,height:r,gl:o,glOptions:l,debug:a,onError:d,onBeforeRender:g,onAfterRender:x,useDevicePixels:E}=e;return new mU({width:n,height:r,useDevicePixels:E,autoResizeViewport:!1,gl:o,onCreateContext:P=>fI({...l,...P,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:P=>this._setGLContext(P.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:g,onAfterRender:x,onError:d})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new nb({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let l=o,a=!1;for(const d of r){var n;l=d,a=((n=d.layer)===null||n===void 0?void 0:n.onHover(d,e.event))||a}if(!a&&this.props.onHover&&this.props.onHover(l,e.event),this.props.getTooltip&&this.tooltip){const d=this.props.getTooltip(l);this.tooltip.setTooltip(d,l.x,l.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Wx(e,{enable:!0,copyState:!0})),this.tooltip=new C8(this.canvas),Qs(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new FI;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new u9(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in QT)this.eventManager.on(o,this._onEvent);this.viewManager=new r8({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new n8(e,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new y8,this.deckRenderer=new x8(e),this.deckPicker=new P8(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:r}=this.layerManager.context;Qs(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),En.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=Hu.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}oe(av,"defaultProps",cM);oe(av,"VERSION",xB);class U_{constructor(e,n){oe(this,"opts",void 0),oe(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:r}=this.source,{size:o}=n;let l=r;if(r&&r.length!==o){l=new Float32Array(o);const a=n.elementOffset||0;for(let d=0;d<o;++d)l[d]=r[a+d]}return l}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function h9(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Lg(t){return t.stride||t.size*t.bytesPerElement}function hM(t,e){e.offset&&En.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Lg(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,o=e.elementOffset||0,l=r*n+o*t.bytesPerElement+(t.offset||0);return{...e,offset:l,stride:n}}function f9(t,e){const n=hM(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class p9{constructor(e,n,r){oe(this,"gl",void 0),oe(this,"id",void 0),oe(this,"size",void 0),oe(this,"settings",void 0),oe(this,"value",void 0),oe(this,"doublePrecision",void 0),oe(this,"_buffer",void 0),oe(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const o=n.logicalType||n.type,l=o===5130;let{defaultValue:a}=n;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let d;l?d=5126:!o&&n.isIndexed?d=e&&H4(e,mr.ELEMENT_INDEX_UINT32)?5125:5123:d=o||5126;let g=h9(o||d||5126);this.doublePrecision=l,l&&n.fp64===!1&&(g=Float32Array),this.value=null,this.settings={...n,defaultType:g,defaultValue:a,logicalType:o,type:d,size:this.size,bytesPerElement:g.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new Yn(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Lg(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),sd.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const r={},o=this.value instanceof Float64Array,l=f9(this.getAccessor(),n||{});return r[e]=new U_(this,l.high),r["".concat(e,"64Low")]=o?new U_(this,l.low):new Float32Array(this.size),r}if(n){const r=hM(this.getAccessor(),n);return{[e]:new U_(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:o}=this,l=r*o;if(n&&l&&n.length>=l){const a=new Array(o).fill(1/0),d=new Array(o).fill(-1/0);for(let g=0;g<l;)for(let x=0;x<o;x++){const E=n[g++];E<a[x]&&(a[x]=E),E>d[x]&&(d[x]=E)}e=[a,d]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Yn?r={buffer:e}:r=e;const o={...this.settings,...r};if(n.bufferAccessor=o,n.bounds=null,r.constant){let l=r.value;if(l=this._normalizeValue(l,[],0),this.settings.normalized&&(l=this.normalizeConstant(l)),!(!n.constant||!this._areValuesEqual(l,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=l}else if(r.buffer){const l=r.buffer;n.externalBuffer=l,n.constant=!1,this.value=r.value||null;const a=r.value instanceof Float64Array;o.type=r.type||l.accessor.type,o.bytesPerElement=l.accessor.BYTES_PER_ELEMENT*(a?2:1),o.stride=Lg(o)}else if(r.value){this._checkExternalBuffer(r);let l=r.value;n.externalBuffer=null,n.constant=!1,this.value=l,o.bytesPerElement=l.BYTES_PER_ELEMENT,o.stride=Lg(o);const{buffer:a,byteOffset:d}=this;this.doublePrecision&&l instanceof Float64Array&&(l=D_(l,o));const g=l.byteLength+d+o.stride*2;a.byteLength<g&&a.reallocate(g),a.setAccessor(null),a.subData({data:l,offset:d}),o.type=r.type||a.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:o}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?D_(n,{size:this.size,startIndex:r,endIndex:o}):n.subarray(r,o),offset:r*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:r}=this,o=r.allocatedValue,l=sd.allocate(o,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=l;const{buffer:a,byteOffset:d}=this;return a.byteLength<l.byteLength+d&&(a.reallocate(l.byteLength+d),n&&o&&a.subData({data:o instanceof Float64Array?D_(o,this):o,offset:d})),r.allocatedValue=l,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=n.BYTES_PER_ELEMENT<4),o)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&En.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:o,size:l}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e)return n[r]=o[0],n;switch(l){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:let a=l;for(;--a>=0;)n[r+a]=Number.isFinite(e[a])?e[a]:o[a]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let o=0;o<r;o++)if(e[o]!==n[o])return!1;return!0}}const mS=[],gS=[];function ib(t,e=0,n=1/0){let r=mS;const o={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(gS.length=t.length,r=gS):r=mS,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),o.index=e-1),{iterable:r,objectInfo:o}}function fM(t){return t&&t[Symbol.asyncIterator]}function d9(t,e){const{size:n,stride:r,offset:o,startIndices:l,nested:a}=e,d=t.BYTES_PER_ELEMENT,g=r?r/d:n,x=o?o/d:0,E=Math.floor((t.length-x)/g);return(P,{index:A,target:R})=>{if(!l){const F=A*g+x;for(let W=0;W<n;W++)R[W]=t[F+W];return R}const j=l[A],X=l[A+1]||E;let D;if(a){D=new Array(X-j);for(let F=j;F<X;F++){const W=F*g+x;R=new Array(n);for(let J=0;J<n;J++)R[J]=t[W+J];D[F-j]=R}}else if(g===n)D=t.subarray(j*n+x,X*n+x);else{D=new t.constructor((X-j)*n);let F=0;for(let W=j;W<X;W++){const J=W*g+x;for(let le=0;le<n;le++)D[F++]=t[J+le]}}return D}}const m9=[],Rg=[[0,1/0]];function g9(t,e){if(t===Rg||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let o=0;for(let l=0;l<r;l++){const a=t[l];a[1]<e[0]?(n.push(a),o=l+1):a[0]>e[1]?n.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return n.splice(o,0,e),n}function V_(t){const{source:e,target:n,start:r=0,size:o,getData:l}=t,a=t.end||n.length,d=e.length,g=a-r;if(d>g){n.set(e.subarray(0,g),r);return}if(n.set(e,r),!l)return;let x=d;for(;x<g;){const E=l(x,e);for(let P=0;P<o;P++)n[r+x]=E[P]||0,x++}}function y9({source:t,target:e,size:n,getData:r,sourceStartIndices:o,targetStartIndices:l}){if(!Array.isArray(l))return V_({source:t,target:e,size:n,getData:r}),e;let a=0,d=0;const g=r&&((E,P)=>r(E+d,P)),x=Math.min(o.length,l.length);for(let E=1;E<x;E++){const P=o[E]*n,A=l[E]*n;V_({source:t.subarray(a,P),target:e,start:d,end:A,size:n,getData:g}),a=P,d=A}return d<e.length&&V_({source:[],target:e,start:d,size:n,getData:g}),e}const v9={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function pM(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...v9[n],...e,...t,type:n}}function dM(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function mM(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function gM(t){t.push(t.shift())}function ob(t,e){const{doublePrecision:n,settings:r,value:o,size:l}=t,a=n&&o instanceof Float64Array?2:1;return(r.noAlloc?o.length:e*l)*a}function yM({buffer:t,numInstances:e,attribute:n,fromLength:r,fromStartIndices:o,getData:l=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,d=n.size*a,g=n.byteOffset,x=n.startIndices,E=o&&x,P=ob(n,e),A=n.isConstant;if(!E&&r>=P)return;const R=A?n.value:n.getBuffer().getData({srcByteOffset:g});if(n.settings.normalized&&!A){const F=l;l=(W,J)=>n.normalizeConstant(F(W,J))}const j=A?(F,W)=>l(R,W):(F,W)=>l(R.subarray(F,F+d),W),X=t.getData({length:r}),D=new Float32Array(P);y9({source:X,target:D,sourceStartIndices:o,targetStartIndices:x,size:d,getData:j}),t.byteLength<D.byteLength+g&&t.reallocate(D.byteLength+g),t.subData({data:D,offset:g})}class ab extends p9{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Rg}),oe(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,o=Array.isArray(n)?e[n.find(l=>e[l])]:e[n];return pM(o,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:o=1/0}=n;this.state.updateRanges=g9(this.state.updateRanges,[r,o])}else this.state.updateRanges=Rg}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=m9}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Rg),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:l},settings:{update:a,noAlloc:d}}=this;let g=!0;if(a){for(const[x,E]of l)a.call(o,this,{data:n,startRow:x,endRow:E,props:r,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[x,E]of l){const P=Number.isFinite(x)?this.getVertexOffset(x):0,A=Number.isFinite(E)?this.getVertexOffset(E):d||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:P,endOffset:A})}this._checkAttributeArray()}else g=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),g}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:o}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),o.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const a=e;Ti(ArrayBuffer.isView(a.value),"invalid ".concat(o.accessor));const d=Boolean(a.size)&&a.size!==this.size;return r.binaryAccessor=d9(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:n,nested:d}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const r in e)Object.assign(n,super.getShaderAttributes(r,e[r]));return n}_autoUpdater(e,{data:n,startRow:r,endRow:o,props:l,numInstances:a}){if(e.constant)return;const{settings:d,state:g,value:x,size:E,startIndices:P}=e,{accessor:A,transform:R}=d,j=g.binaryAccessor||(typeof A=="function"?A:l[A]);Ti(typeof j=="function",'accessor "'.concat(A,'" is not a function'));let X=e.getVertexOffset(r);const{iterable:D,objectInfo:F}=ib(n,r,o);for(const W of D){F.index++;let J=j(W,F);if(R&&(J=R.call(this,J)),P){const le=(F.index<P.length-1?P[F.index+1]:a)-P[F.index];if(J&&Array.isArray(J[0])){let ue=X;for(const ye of J)e._normalizeValue(ye,x,ue),ue+=E}else J&&J.length>E?x.set(J,X):(e._normalizeValue(J,F.target,0),Zj({target:x,source:F.target,start:X,count:le}));X+=le*E}else e._normalizeValue(J,x,X),X+=E}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class _9{constructor({gl:e,attribute:n,timeline:r}){oe(this,"gl",void 0),oe(this,"type","interpolation"),oe(this,"attributeInTransition",void 0),oe(this,"settings",void 0),oe(this,"attribute",void 0),oe(this,"transition",void 0),oe(this,"currentStartIndices",void 0),oe(this,"currentLength",void 0),oe(this,"transform",void 0),oe(this,"buffers",void 0),this.gl=e,this.transition=new Ld(r),this.attribute=n,this.attributeInTransition=new ab(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=b9(e,n);const o={byteLength:0,usage:35050};this.buffers=[new Yn(e,o),new Yn(e,o)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:o,attribute:l}=this;gM(o);const a={numInstances:n,attribute:l,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const d of o)yM({buffer:d,...a});this.currentStartIndices=l.startIndices,this.currentLength=ob(l,n),this.attributeInTransition.setData({buffer:o[1],value:l.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/l.size),sourceBuffers:{aFrom:o[0],aTo:dM(r,l)},feedbackBuffers:{vCurrent:o[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:r}=this.settings,{time:o}=this.transition;let l=o/n;r&&(l=r(l)),this.transform.run({uniforms:{time:l}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const x9=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function b9(t,e){const n=mM(e.size);return new Jx(t,{vs:x9,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class w9{constructor({gl:e,attribute:n,timeline:r}){oe(this,"gl",void 0),oe(this,"type","spring"),oe(this,"attributeInTransition",void 0),oe(this,"settings",void 0),oe(this,"attribute",void 0),oe(this,"transition",void 0),oe(this,"currentStartIndices",void 0),oe(this,"currentLength",void 0),oe(this,"texture",void 0),oe(this,"framebuffer",void 0),oe(this,"transform",void 0),oe(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Ld(r),this.attribute=n,this.attributeInTransition=new ab(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=T9(e),this.framebuffer=S9(e,this.texture),this.transform=E9(e,n,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new Yn(e,o),new Yn(e,o),new Yn(e,o)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:r,buffers:o,attribute:l}=this,a={numInstances:n,attribute:l,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const d of o)yM({buffer:d,...a});this.settings=e,this.currentStartIndices=l.startIndices,this.currentLength=ob(l,n),this.attributeInTransition.setData({buffer:o[1],value:l.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/l.size),sourceBuffers:{aTo:dM(r,l)}})}update(){const{buffers:e,transform:n,framebuffer:r,transition:o}=this;if(!o.update())return!1;const a=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:a.stiffness,damping:a.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),gM(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),tv(r)[0]>0||o.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function E9(t,e,n){const r=mM(e.size);return new Jx(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function T9(t){return new Ai(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function S9(t,e){return new qr(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const P9={interpolation:_9,spring:w9};class A9{constructor(e,{id:n,timeline:r}){oe(this,"id",void 0),oe(this,"isSupported",void 0),oe(this,"gl",void 0),oe(this,"timeline",void 0),oe(this,"transitions",void 0),oe(this,"needsRedraw",void 0),oe(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Jx.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const o in e){const l=e[o],a=l.getTransitionSetting(n);a&&this._updateAttribute(o,l,a)}for(const o in this.transitions){const l=e[o];(!l||!l.getTransitionSetting(n))&&this._removeTransition(o)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,r){const o=this.transitions[e];let l=!o||o.type!==r.type;if(l){if(!this.isSupported){En.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}o&&this._removeTransition(e);const a=P9[r.type];a?this.transitions[e]=new a({attribute:n,timeline:this.timeline,gl:this.gl}):(En.error("unsupported transition type '".concat(r.type,"'"))(),l=!1)}(l||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const yS="attributeManager.invalidate",C9="attributeManager.updateStart",I9="attributeManager.updateEnd",M9="attribute.updateStart",k9="attribute.allocate",L9="attribute.updateEnd";class R9{constructor(e,{id:n="attribute-manager",stats:r,timeline:o}={}){oe(this,"id",void 0),oe(this,"gl",void 0),oe(this,"attributes",void 0),oe(this,"updateTriggers",void 0),oe(this,"needsRedraw",void 0),oe(this,"userData",void 0),oe(this,"stats",void 0),oe(this,"attributeTransitionManager",void 0),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new A9(e,{id:"".concat(n,"-transitions"),timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);ji(yS,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);ji(yS,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:o,props:l={},buffers:a={},context:d={}}){let g=!1;ji(C9,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const x in this.attributes){const E=this.attributes[x],P=E.settings.accessor;E.startIndices=r,E.numInstances=n,l[x]&&En.removed("props.".concat(x),"data.attributes.".concat(x))(),E.setExternalBuffer(a[x])||E.setBinaryValue(typeof P=="string"?a[P]:void 0,e.startIndices)||typeof P=="string"&&!a[P]&&E.setConstantValue(l[P])||E.needsUpdate()&&(g=!0,this._updateAttribute({attribute:E,numInstances:n,data:e,props:l,context:d})),this.needsRedraw=this.needsRedraw||E.needsRedraw()}g&&ji(I9,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,o={...r.getAttributes()};for(const l in n){const a=n[l];a.needsRedraw(e)&&!r.hasAttribute(l)&&(o[l]=a)}return o}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const r={};for(const o in e)n[o]||Object.assign(r,e[o].getShaderAttributes());return r}_add(e,n={}){for(const r in e){const o=e[r];this.attributes[r]=this._createAttribute(r,o,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,r){const o={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:r.instanced?1:n.divisor||0};return new ab(this.gl,o)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(o=>{e[o]||(e[o]=[]),e[o].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:o}=this,l=o[e];return l&&l.forEach(a=>{const d=r[a];d&&d.setNeedsUpdate(d.id,n)}),l}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(ji(M9,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&ji(k9,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,ji(L9,n,r))}}class O9 extends Ld{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:o,easing:l}}=this,a=l(e/o);this._value=xy(n,r,a)}}const vS=1e-5;function _S(t,e,n,r,o){const l=e-t,d=(n-e)*o,g=-l*r;return d+g+l+e}function z9(t,e,n,r,o){if(Array.isArray(n)){const l=[];for(let a=0;a<n.length;a++)l[a]=_S(t[a],e[a],n[a],r,o);return l}return _S(t,e,n,r,o)}function xS(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const o=t[r]-e[r];n+=o*o}return Math.sqrt(n)}return Math.abs(t-e)}class D9 extends Ld{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:o}=this.settings,{_prevValue:l=e,_currValue:a=e}=this;let d=z9(l,a,n,r,o);const g=xS(d,n),x=xS(d,a);g<vS&&x<vS&&(d=n,this.end()),this._prevValue=a,this._currValue=d}}const F9={interpolation:O9,spring:D9};class N9{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,o){const{transitions:l}=this;if(l.has(e)){const g=l.get(e),{value:x=g.settings.fromValue}=g;n=x,this.remove(e)}if(o=pM(o),!o)return;const a=F9[o.type];if(!a){En.error("unsupported transition type '".concat(o.type,"'"))();return}const d=new a(this.timeline);d.start({...o,fromValue:n,toValue:r}),l.set(e,d)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function B9(t){const e=t[Ql];for(const n in e){const r=e[n],{validate:o}=r;if(o&&!o(t[n],r))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function U9(t,e){const n=vM({newProps:t,oldProps:e,propTypes:t[Ql],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=j9(t,e);let o=!1;return r||(o=G9(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:o,extensionsChanged:W9(t,e),transitionsChanged:V9(t,e)}}function V9(t,e){if(!t.transitions)return!1;const n={},r=t[Ql];let o=!1;for(const l in t.transitions){const a=r[l],d=a&&a.type;(d==="number"||d==="color"||d==="array")&&T1(t[l],e[l],a)&&(n[l]=!0,o=!0)}return o?n:!1}function vM({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:o="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(o," changed shallowly");for(const l of Object.keys(t))if(!(l in n)){if(!(l in e))return"".concat(o,".").concat(l," added");const a=T1(t[l],e[l],r[l]);if(a)return"".concat(o,".").concat(l," ").concat(a)}for(const l of Object.keys(e))if(!(l in n)){if(!(l in t))return"".concat(o,".").concat(l," dropped");if(!Object.hasOwnProperty.call(t,l)){const a=T1(t[l],e[l],r[l]);if(a)return"".concat(o,".").concat(l," ").concat(a)}}return!1}function T1(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function j9(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:o}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&o&&(n=o(t.data,e.data)||n),n}function G9(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&bS(t,e,"all"))return{all:!0};const n={};let r=!1;for(const o in t.updateTriggers)o!=="all"&&bS(t,e,o)&&(n[o]=!0,r=!0);return r?n:!1}function W9(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let o=0;o<r.length;o++)if(!r[o].equals(n[o]))return!0;return!1}function bS(t,e,n){let r=t.updateTriggers[n];r=r??{};let o=e.updateTriggers[n];return o=o??{},vM({oldProps:o,newProps:r,triggerName:n})}const H9="count(): argument not an object",q9="count(): argument not a container";function Z9(t){if(!X9(t))throw new Error(H9);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if($9(t))return Object.keys(t).length;throw new Error(q9)}function $9(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function X9(t){return t!==null&&typeof t=="object"}function Y9(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(o=>o.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const o in e.inject)r[o]=(r[o]||"")+e.inject[o];n.inject=r}return n}const K9={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},S1={};function J9(t,e,n){if(e instanceof Ai)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let r=null;e.compressed&&(r={[10241]:e.data.length>1?9985:9729});const o=new Ai(t,{...e,parameters:{...K9,...r,...n}});return S1[o.id]=!0,o}function Q9(t){!t||!(t instanceof Ai)||S1[t.id]&&(t.delete(),delete S1[t.id])}const eG={boolean:{validate(t,e){return!0},equal(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||ld(t)&&(t.length===3||t.length===4)},equal(t,e,n){return j_(t,e)}},accessor:{validate(t,e){const n=Py(t);return n==="function"||n===Py(e.value)},equal(t,e,n){return typeof e=="function"?!0:j_(t,e)}},array:{validate(t,e){return e.optional&&!t||ld(t)},equal(t,e,n){return n.compare?j_(t,e):t===e}},object:{equal(t,e,n){return n.compare?mc(t,e,n.depth||0):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:r}=n.props;return r&&t?r(t):t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.gl?null:J9(r.gl,t,{...e.parameters,...n.props.textureParameters})},release:t=>{Q9(t)}}};function j_(t,e){if(t===e)return!0;if(!ld(t)||!ld(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}function tG(t){const e={},n={},r={};for(const[o,l]of Object.entries(t)){const a=l==null?void 0:l.deprecatedFor;if(a)r[o]=Array.isArray(a)?a:[a];else{const d=nG(o,l);e[o]=d,n[o]=d.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function nG(t,e){switch(Py(e)){case"object":return wp(t,e);case"array":return wp(t,{type:"array",value:e,compare:!1});case"boolean":return wp(t,{type:"boolean",value:e});case"number":return wp(t,{type:"number",value:e});case"function":return wp(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function wp(t,e){return"type"in e?{name:t,...eG[e.type],...e}:"value"in e?{name:t,type:Py(e.value),...e}:{name:t,type:"object",value:e}}function ld(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Py(t){return ld(t)?"array":t===null?"null":typeof t}function rG(t,e){let n;for(let l=e.length-1;l>=0;l--){const a=e[l];"extensions"in a&&(n=a.extensions)}const r=P1(t.constructor,n),o=Object.create(r);o[Ty]=t,o[uc]={},o[Vl]={};for(let l=0;l<e.length;++l){const a=e[l];for(const d in a)o[d]=a[d]}return Object.freeze(o),o}const iG="_mergedDefaultProps";function P1(t,e){let n=iG;if(e)for(const o of e){const l=o.constructor;l&&(n+=":".concat(l.extensionName||l.name))}const r=Ay(t,n);return r||(t[n]=oG(t,e||[]))}function oG(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),o=P1(r),l=Ay(t,"defaultProps")||{},a=tG(l),d=Object.assign(Object.create(null),o,a.defaultProps),g=Object.assign(Object.create(null),o==null?void 0:o[Ql],a.propTypes),x=Object.assign(Object.create(null),o==null?void 0:o[N_],a.deprecatedProps);for(const E of e){const P=P1(E.constructor);P&&(Object.assign(d,P),Object.assign(g,P[Ql]),Object.assign(x,P[N_]))}return aG(d,t),lG(d,g),sG(d,x),d[Ql]=g,d[N_]=x,e.length===0&&!sb(t,"_propTypes")&&(t._propTypes=g),d}function aG(t,e){const n=cG(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function sG(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const o="".concat(this.id,": ").concat(n);for(const l of e[n])sb(this,l)||(this[l]=r);En.deprecated(o,e[n].join("/"))()}})}function lG(t,e){const n={},r={};for(const o in e){const l=e[o],{name:a,value:d}=l;l.async&&(n[a]=d,r[a]=uG(a))}t[Oh]=n,t[uc]={},Object.defineProperties(t,r)}function uG(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||fM(e)?this[uc][t]=e:this[Vl][t]=e},get(){if(this[Vl]){if(t in this[Vl])return this[Vl][t]||this[Oh][t];if(t in this[uc]){const e=this[Ty]&&this[Ty].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Oh][t]}}return this[Oh][t]}}}function sb(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ay(t,e){return sb(t,e)&&t[e]}function cG(t){const e=Ay(t,"layerName")||Ay(t,"componentName");return e||En.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}let hG=0;class lb{constructor(...e){oe(this,"id",void 0),oe(this,"props",void 0),oe(this,"count",void 0),this.props=rG(this,e),this.id=this.props.id,this.count=hG++}clone(e){const{props:n}=this,r={};for(const o in n[Oh])o in n[Vl]?r[o]=n[Vl][o]:o in n[uc]&&(r[o]=n[uc][o]);return new this.constructor({...n,...r,...e})}}oe(lb,"componentName","Component");oe(lb,"defaultProps",{});const fG=Object.freeze({});class pG{constructor(e){oe(this,"component",void 0),oe(this,"onAsyncPropUpdated",void 0),oe(this,"asyncProps",void 0),oe(this,"oldProps",void 0),oe(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||fG}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Ty]||this.component;const n=e[Vl]||{},r=e[uc]||e,o=e[Oh]||{};for(const l in n){const a=n[l];this._createAsyncPropData(l,o[l]),this._updateAsyncProp(l,a),n[l]=this.getAsyncProp(l)}for(const l in r){const a=r[l];this._createAsyncPropData(l,o[l]),this._updateAsyncProp(l,a)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(fM(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const o=this.asyncProps[e];o&&r>=o.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=n,o.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const o=r.pendingLoadCount;n.then(l=>{this.component&&(l=this._postProcessValue(r,l),this._setAsyncPropValue(e,l,o),this._onResolve(e,l))}).catch(l=>{this._onError(e,l)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const o=r.pendingLoadCount;let l=[],a=0;for await(const d of n){if(!this.component)return;const{dataTransform:g}=this.component.props;g?l=g(d,l):l=l.concat(d),Object.defineProperty(l,"__diff",{enumerable:!1,value:[{startRow:a,endRow:l.length}]}),a=l.length,this._setAsyncPropValue(e,l,o)}this._onResolve(e,l)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const o=this.component&&this.component.props[Ql];this.asyncProps[e]={type:o&&o[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class dG extends pG{constructor({attributeManager:e,layer:n}){super(n),oe(this,"attributeManager",void 0),oe(this,"needsRedraw",void 0),oe(this,"needsUpdate",void 0),oe(this,"subLayers",void 0),oe(this,"usesPickingColorCache",void 0),oe(this,"hasPickingBuffer",void 0),oe(this,"changeFlags",void 0),oe(this,"viewport",void 0),oe(this,"uniformTransitions",void 0),oe(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,o=r==null?void 0:r.props.fetch;return o?o(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const o=r.props.onDataLoad;e==="data"&&o&&o(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const mG="layer.changeFlag",gG="layer.initialize",yG="layer.update",vG="layer.finalize",_G="layer.matched",wS=2**24-1,xG=Object.freeze([]),bG=nv(({oldViewport:t,viewport:e})=>t.equals(e));let ns=new Uint8ClampedArray(0);const wG={data:{type:"data",value:xG,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:o,signal:l})=>{const{resourceManager:a}=n.context;if(o=o||n.getLoadOptions(),r=r||n.props.loaders,l){var d;o={...o,fetch:{...(d=o)===null||d===void 0?void 0:d.fetch,signal:l}}}let g=a.contains(t);return!g&&!o&&(a.add({resourceId:t,data:my(t,r),persistent:!1}),g=!0),g?a.subscribe({resourceId:t,onChange:x=>{var E;return(E=n.internalState)===null||E===void 0?void 0:E.reloadAsyncProp(e,x)},consumerId:n.id,requestId:e}):my(t,r,o)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:Vn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0,depth:1},loadOptions:{type:"object",value:null,optional:!0,compare:!0,depth:3},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class of extends lb{constructor(...e){super(...e),oe(this,"internalState",null),oe(this,"lifecycle",ph.NO_STATE),oe(this,"context",void 0),oe(this,"state",void 0),oe(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Ti(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=QI(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,l,a]=YI(r,n.pixelProjectionMatrix);return e.length===2?[o,l]:[o,l,a]}unproject(e){return Ti(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Ti(this.internalState);const r=this.internalState.viewport||this.context.viewport;return Wj(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Vn.DEFAULT||e===Vn.LNGLAT||e===Vn.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Ti(e instanceof Uint8Array);const[n,r,o]=e;return n+r*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Z9(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;const n=this.getAttributeManager();if(!n)return null;const{positions:r,instancePositions:o}=n.attributes;return(e=r||o)===null||e===void 0?void 0:e.getBounds()}getShaders(e){for(const n of this.props.extensions)e=Y9(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const o of r)n.invalidateAll(o);else n.invalidateAll();if(n){const{props:o}=e,l=this.internalState.hasPickingBuffer,a=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(d=>d.getNeedsPickingBuffer.call(this,d));if(l!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:d,instancePickingColors:g}=n.attributes,x=d||g;x&&(a&&x.constant&&(x.constant=!1,n.invalidate(x.id)),!x.value&&!a&&(x.constant=!0,x.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(e,n){var r,o;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((r=(o=this.props).onError)!==null&&r!==void 0&&r.call(o,e))){var l,a;(l=this.context)===null||l===void 0||(a=l.onError)===null||a===void 0||a.call(l,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!bG({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),o=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:o,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const l=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(l)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const o in n)Object.defineProperty(r,o,{value:n[o]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(ns.length/3);if(this.internalState.usesPickingColorCache=!0,r<n){n>wS&&En.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ns=sd.allocate(ns,n,{size:3,copy:!0,maxCount:Math.max(n,wS)});const o=Math.floor(ns.length/3),l=[];for(let a=r;a<o;a++)this.encodePickingColor(a,l),ns[a*3+0]=l[0],ns[a*3+1]=l[1],ns[a*3+2]=l[2]}e.value=ns.subarray(0,n*3)}_setModelAttributes(e,n){const r=this.getAttributeManager(),o=e.userData.excludeAttributes||{},l=r.getShaderAttributes(n,o);e.setAttributes(l)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,o=n||r;if(!o)return;const l=o.getVertexOffset(e),a=o.getVertexOffset(e+1);o.buffer.subData({data:new Uint8Array(a-l),offset:l})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==ns.buffer&&(r.value=ns.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Ti(!this.internalState),Ti(Number.isFinite(this.props.coordinateSystem)),ji(gG,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new dG({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(En.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new N9(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){ji(_G,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(ji(yG,this,e),!e)return;const n=this.props,r=this.context,o=this.internalState,l=r.viewport,a=this._updateUniformTransition();o.propsInTransition=a,r.viewport=o.viewport||l,this.props=a;try{const d=this._getUpdateParams(),g=this.getModels();if(r.gl)this.updateState(d);else try{this.updateState(d)}catch{}for(const E of this.props.extensions)E.updateState.call(this,d,E);const x=this.getModels()[0]!==g[0];this._postUpdate(d,x)}finally{r.viewport=l,this.props=n,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){ji(vG,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const o=this.props,l=this.context;this.props=this.internalState.propsInTransition||o;const a=this.props.opacity;n.opacity=Math.pow(a,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:d}=this.props,g=d&&d(n)||[0,0];Qs(l.gl,{polygonOffset:g}),Uo(l.gl,r,()=>{const x={moduleParameters:e,uniforms:n,parameters:r,context:l};for(const E of this.props.extensions)E.draw.call(this,x,E);this.draw(x)})}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const o in e)if(e[o]){let l=!1;switch(o){case"dataChanged":const a=e[o],d=n[o];a&&Array.isArray(d)&&(n.dataChanged=Array.isArray(a)?d.concat(a):a,l=!0);default:n[o]||(n[o]=e[o],l=!0)}l&&ji(mG,this,o,e)}const r=Boolean(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const r=U9(e,n);if(r.updateTriggersChanged)for(const l in r.updateTriggersChanged)r.updateTriggersChanged[l]&&this.invalidateAttribute(l);if(r.transitionsChanged)for(const l in r.transitionsChanged){var o;this.internalState.uniformTransitions.add(l,n[l],e[l],(o=e.transitions)===null||o===void 0?void 0:o[l])}return this.setChangeFlags(r)}validateProps(){B9(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.pickingHighlightColor=r(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new R9(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:o}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:l}=this.state;l==null||l.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:d,highlightColor:g}=r;if(n||o.autoHighlight!==a||o.highlightedObjectIndex!==d||o.highlightColor!==g){const x={};a||(x.pickingSelectedColor=null),Array.isArray(g)&&(x.pickingHighlightColor=g),(n||d!==o.highlightedObjectIndex)&&(x.pickingSelectedColor=Number.isFinite(d)&&d>=0?this.encodePickingColor(d):null),this.setModuleParameters(x)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),o=r?r.getNeedsRedraw(e):!1;n=n||o;for(const l of this.props.extensions){const a=l.getNeedsRedraw.call(this,e);n=n||a}return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}oe(of,"defaultProps",wG);oe(of,"layerName","Layer");const EG="compositeLayer.renderLayers";class _M extends of{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,o)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,o)}return e}getSubLayerProps(e={}){var n;const{opacity:r,pickable:o,visible:l,parameters:a,getPolygonOffset:d,highlightedObjectIndex:g,autoHighlight:x,highlightColor:E,coordinateSystem:P,coordinateOrigin:A,wrapLongitude:R,positionFormat:j,modelMatrix:X,extensions:D,fetch:F,operation:W,_subLayerProps:J}=this.props,le={id:"",updateTriggers:{},opacity:r,pickable:o,visible:l,parameters:a,getPolygonOffset:d,highlightedObjectIndex:g,autoHighlight:x,highlightColor:E,coordinateSystem:P,coordinateOrigin:A,wrapLongitude:R,positionFormat:j,modelMatrix:X,extensions:D,fetch:F,operation:W},ue=J&&e.id&&J[e.id],ye=ue&&ue.updateTriggers,Ee=e.id||"sublayer";if(ue){const Pe=this.props[Ql],we=e.type?e.type._propTypes:{};for(const ze in ue){const Fe=we[ze]||Pe[ze];Fe&&Fe.type==="accessor"&&(ue[ze]=this.getSubLayerAccessor(ue[ze]))}}Object.assign(le,e,ue),le.id="".concat(this.props.id,"-").concat(Ee),le.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...ye};for(const Pe of D){const we=Pe.getSubLayerProps.call(this,Pe);we&&Object.assign(le,we,{updateTriggers:Object.assign(le.updateTriggers,we.updateTriggers)})}return le}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const o=!r||this.needsUpdate();if(o){const l=this.renderLayers();r=eb(l,Boolean),this.internalState.subLayers=r}ji(EG,this,o,r);for(const l of r)l.parent=this}}oe(_M,"layerName","CompositeLayer");const TG=new sa().lookAt({eye:[0,0,1]});function SG({width:t,height:e,near:n,far:r,padding:o}){let l=-t/2,a=t/2,d=-e/2,g=e/2;if(o){const{left:x=0,right:E=0,top:P=0,bottom:A=0}=o,R=pi((x+t-E)/2,0,t)-t/2,j=pi((P+e-A)/2,0,e)-e/2;l-=R,a-=R,d+=j,g+=j}return new sa().ortho({left:l,right:a,bottom:d,top:g,near:n,far:r})}class PG extends dc{constructor(e){const{width:n,height:r,near:o=.1,far:l=1e3,zoom:a=0,target:d=[0,0,0],padding:g=null,flipY:x=!0}=e,E=Array.isArray(a)?a[0]:a,P=Array.isArray(a)?a[1]:a,A=Math.min(E,P),R=Math.pow(2,A);let j;if(E!==P){const X=Math.pow(2,E),D=Math.pow(2,P);j={unitsPerMeter:[X/R,D/R,1],metersPerUnit:[R/X,R/D,1]}}super({...e,longitude:void 0,position:d,viewMatrix:TG.clone().scale([R,R*(x?-1:1),R]),projectionMatrix:SG({width:n||1,height:r||1,padding:g,near:o,far:l}),zoom:A,distanceScales:j})}projectFlat([e,n]){const{unitsPerMeter:r}=this.distanceScales;return[e*r[0],n*r[1]]}unprojectFlat([e,n]){const{metersPerUnit:r}=this.distanceScales;return[e*r[0],n*r[1]]}panByPosition(e,n){const r=iv(n,this.pixelUnprojectionMatrix),o=this.projectFlat(e),l=rc([],o,Lx([],r)),a=rc([],this.center,l);return{target:this.unprojectFlat(a)}}}class AG extends oM{constructor(e){const{width:n,height:r,rotationX:o=0,rotationOrbit:l=0,target:a=[0,0,0],zoom:d=0,minRotationX:g=-90,maxRotationX:x=90,minZoom:E=-1/0,maxZoom:P=1/0,startPanPosition:A,startRotatePos:R,startRotationX:j,startRotationOrbit:X,startZoomPosition:D,startZoom:F}=e;super({width:n,height:r,rotationX:o,rotationOrbit:l,target:a,zoom:d,minRotationX:g,maxRotationX:x,minZoom:E,maxZoom:P},{startPanPosition:A,startRotatePos:R,startRotationX:j,startRotationOrbit:X,startZoomPosition:D,startZoom:F}),oe(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const r=this.getState().startPanPosition||n;if(!r)return this;const l=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(l)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:o,startRotationX:l,startRotationOrbit:a}=this.getState(),{width:d,height:g}=this.getViewportProps();if(!o||l===void 0||a===void 0)return this;let x;if(e){let E=(e[0]-o[0])/d;const P=(e[1]-o[1])/g;(l<-90||l>90)&&(E*=-1),x={rotationX:l+P*180,rotationOrbit:a+E*180}}else x={rotationX:l+r,rotationOrbit:a+n};return this._getUpdatedState(x)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{rotationOrbit:o}=r;return Math.abs(o-n.rotationOrbit)>180&&(r.rotationOrbit=o<0?o+360:o-360),r}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:o,startZoomPosition:l}=this.getState();if(l||(o=this.getViewportProps().zoom,l=this._unproject(n)||this._unproject(e)),!l)return this;const a=this._calculateNewZoom({scale:r,startZoom:o}),d=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...d.panByPosition(l,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:r,minZoom:o}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const l=n+Math.log2(e);return pi(l,o,r)}_panFromCenter(e){const{width:n,height:r,target:o}=this.getViewportProps();return this.pan({startPosition:o,pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:o,maxRotationX:l,minRotationX:a,rotationOrbit:d}=e;return e.zoom=Array.isArray(o)?[pi(o[0],r,n),pi(o[1],r,n)]:pi(o,r,n),e.rotationX=pi(e.rotationX,a,l),(d<-180||d>180)&&(e.rotationOrbit=zj(d+180,360)-180),e}}class CG extends AG{constructor(e){super(e),oe(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:r,minZoom:o}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);let l=Math.log2(e);if(Array.isArray(n)){let[a,d]=n;switch(this.zoomAxis){case"X":a=pi(a+l,o,r);break;case"Y":d=pi(d+l,o,r);break;default:let g=Math.min(a+l,d+l);g<o&&(l+=o-g),g=Math.max(a+l,d+l),g>r&&(l+=r-g),a+=l,d+=l}return[a,d]}return pi(n+l,o,r)}}class IG extends iM{constructor(...e){super(...e),oe(this,"ControllerState",CG),oe(this,"transition",{transitionDuration:300,transitionInterpolator:new tb(["target","zoom"])}),oe(this,"dragMode","pan")}_onPanRotate(){return!1}}class xM extends cc{get ViewportType(){return PG}get ControllerType(){return IG}}oe(xM,"displayName","OrthographicView");class bM{constructor(e){oe(this,"opts",void 0),e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&mc(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:n}=e.constructor,r={updateTriggers:{}};for(const o in n)if(o in this.props){const l=n[o],a=this.props[o];r[o]=a,l&&l.type==="accessor"&&(r.updateTriggers[o]=this.props.updateTriggers[o],typeof a=="function"&&(r[o]=this.getSubLayerAccessor(a)))}return r}initializeState(e,n){}updateState(e,n){}getNeedsRedraw(e){return!1}getNeedsPickingBuffer(e){return!1}draw(e,n){}finalizeState(e,n){}}oe(bM,"defaultProps",{});const MG=typeof window<"u"?st.useLayoutEffect:st.useEffect,kG=MG;function Cy(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const LG={position:"absolute",zIndex:-1};function wM(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>wM(n,e));if(sv(t)){if(RG(t))return e.style=LG,st.cloneElement(t,e);if(OG(t))return st.cloneElement(t,e)}return t}function sv(t){return t&&typeof t=="object"&&"type"in t||!1}function RG(t){const e=t.type,n=e&&e.defaultProps;return n&&n.mapStyle}function OG(t){const e=t.type;return e&&e.deckGLViewProps}function A1(t){if(typeof t=="function")return st.createElement(cc,{},t);if(Array.isArray(t))return t.map(A1);if(sv(t)){if(t.type===st.Fragment)return A1(t.props.children);if(Cy(t.type,cc))return t}return t}function zG({children:t,layers:e=[],views:n=null}){const r=[],o=[],l={};return st.Children.forEach(A1(t),a=>{if(sv(a)){const d=a.type;if(Cy(d,of)){const g=DG(d,a.props);o.push(g)}else r.push(a);if(Cy(d,cc)&&d!==cc&&a.props.id){const g=new d(a.props);l[g.id]=g}}else a&&r.push(a)}),Object.keys(l).length>0&&(Array.isArray(n)?n.forEach(a=>{l[a.id]=a}):n&&(l[n.id]=n),n=Object.values(l)),e=o.length>0?[...o,...e]:e,{layers:e,children:r,views:n}}function DG(t,e){const n={},r=t.defaultProps||{};for(const o in e)r[o]!==e[o]&&(n[o]=e[o]);return new t(n)}function FG({children:t,deck:e,ContextProvider:n}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const o={},l=r.views[0].id;for(const a of t){let d=l,g=a;sv(a)&&Cy(a.type,cc)&&(d=a.props.id||l,g=a.props.children);const x=r.getViewport(d),E=r.getViewState(d);if(x){E.padding=x.padding;const{x:P,y:A,width:R,height:j}=x;g=wM(g,{x:P,y:A,width:R,height:j,viewport:x,viewState:E}),o[d]||(o[d]={viewport:x,children:[]}),o[d].children.push(g)}}return Object.keys(o).map(a=>{const{viewport:d,children:g}=o[a],{x,y:E,width:P,height:A}=d,R={position:"absolute",left:x,top:E,width:P,height:A},j="view-".concat(a),X=st.createElement("div",{key:j,id:j,style:R},...g);if(n){const D={viewport:d,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:F=>{F.viewId=a,e._onViewStateChange(F)}};return st.createElement(n,{key:j,value:D},X)}return X})}const NG={mixBlendMode:null};function BG({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},o={left:0,top:0};if(n)for(const l in n)l in NG?o[l]=n[l]:r[l]=n[l];return{containerStyle:r,canvasStyle:o}}function UG(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function EM(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function VG(t,e,n){const r=new e({...n,_customRender:o=>{t.redrawReason=o;const l=r.getViewports();t.lastRenderedViewports!==l?t.forceUpdate():EM(t)}});return r}const TM=st.forwardRef((t,e)=>{const[n,r]=st.useState(0),l=st.useRef({control:null,version:n,forceUpdate:()=>r(ue=>ue+1)}).current,a=st.useRef(null),d=st.useRef(null),g=st.useMemo(()=>zG(t),[t.layers,t.views,t.children]);let x=!0;const E=ue=>{var ye;return x&&t.viewState?(l.viewStateUpdateRequested=ue,null):(l.viewStateUpdateRequested=null,(ye=t.onViewStateChange)===null||ye===void 0?void 0:ye.call(t,ue))},P=ue=>{if(x)l.interactionStateUpdateRequested=ue;else{var ye;l.interactionStateUpdateRequested=null,(ye=t.onInteractionStateChange)===null||ye===void 0||ye.call(t,ue)}},A=st.useMemo(()=>{const ue={...t,style:null,width:"100%",height:"100%",parent:a.current,canvas:d.current,layers:g.layers,views:g.views,onViewStateChange:E,onInteractionStateChange:P};return delete ue._customRender,l.deck&&l.deck.setProps(ue),ue},[t]);st.useEffect(()=>{const ue=t.Deck||av;return l.deck=VG(l,ue,{...A,parent:a.current,canvas:d.current}),()=>{var ye;return(ye=l.deck)===null||ye===void 0?void 0:ye.finalize()}},[]),kG(()=>{EM(l);const{viewStateUpdateRequested:ue,interactionStateUpdateRequested:ye}=l;ue&&E(ue),ye&&P(ye)}),st.useImperativeHandle(e,()=>UG(l),[]);const R=l.deck&&l.deck.isInitialized?l.deck.getViewports():void 0,{ContextProvider:j,width:X,height:D,id:F,style:W}=t,{containerStyle:J,canvasStyle:le}=st.useMemo(()=>BG({width:X,height:D,style:W}),[X,D,W]);if(!l.viewStateUpdateRequested&&l.lastRenderedViewports===R||l.version!==n){l.lastRenderedViewports=R,l.version=n;const ue=FG({children:g.children,deck:l.deck,ContextProvider:j}),ye=st.createElement("canvas",{key:"canvas",id:F||"deckgl-overlay",ref:d,style:le});l.control=st.createElement("div",{id:"".concat(F||"deckgl","-wrapper"),ref:a,style:J},[ye,ue])}return x=!1,l.control});TM.defaultProps=av.defaultProps;const jG=TM;function cn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const GG=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  // convert size in meters to pixels, then scaled and clamp
 
  // project meters to pixels and clamp to limits 
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );

  // scale icon height to match instanceSize
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;

  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,WG=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);

  // if colorMode == 0, use pixel color from the texture
  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  // Take the global opacity and the alpha from vColor into account for the alpha component
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,HG=1024,qG=4,ES=()=>{},TS={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function ZG(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function $G(t,e,n,r){return n===e.width&&r===e.height?e:(t.canvas.height=r,t.canvas.width=n,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,n,r),t.canvas)}function ud(t){return t&&(t.id||t.url)}function XG(t,e,n,r){const o=t.width,l=t.height,a=new Ai(t.gl,{width:e,height:n,parameters:r});return V4(t,a,{targetY:0,width:o,height:l}),t.delete(),a}function SS(t,e,n){for(let r=0;r<e.length;r++){const{icon:o,xOffset:l}=e[r],a=ud(o);t[a]={...o,x:l,y:n}}}function YG({icons:t,buffer:e,mapping:n={},xOffset:r=0,yOffset:o=0,rowHeight:l=0,canvasWidth:a}){let d=[];for(let g=0;g<t.length;g++){const x=t[g],E=ud(x);if(!n[E]){const{height:P,width:A}=x;r+A+e>a&&(SS(n,d,o),r=0,o=l+o+e,l=0,d=[]),d.push({icon:x,xOffset:r}),r=r+A+e,l=Math.max(l,P)}}return d.length>0&&SS(n,d,o),{mapping:n,rowHeight:l,xOffset:r,yOffset:o,canvasWidth:a,canvasHeight:ZG(l+o+e)}}function KG(t,e,n){if(!t||!e)return null;n=n||{};const r={},{iterable:o,objectInfo:l}=ib(t);for(const a of o){l.index++;const d=e(a,l),g=ud(d);if(!d)throw new Error("Icon is missing.");if(!d.url)throw new Error("Icon url is missing.");!r[g]&&(!n[g]||d.url!==n[g].url)&&(r[g]={...d,source:a,sourceIndex:l.index})}return r}class JG{constructor(e,{onUpdate:n=ES,onError:r=ES}){cn(this,"gl",void 0),cn(this,"onUpdate",void 0),cn(this,"onError",void 0),cn(this,"_loadOptions",null),cn(this,"_texture",null),cn(this,"_externalTexture",null),cn(this,"_mapping",{}),cn(this,"_textureParameters",null),cn(this,"_pendingCount",0),cn(this,"_autoPacking",!1),cn(this,"_xOffset",0),cn(this,"_yOffset",0),cn(this,"_rowHeight",0),cn(this,"_buffer",qG),cn(this,"_canvasWidth",HG),cn(this,"_canvasHeight",0),cn(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=r}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?ud(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:r,iconMapping:o,textureParameters:l}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),o&&(this._mapping=o),r){var a;(a=this._texture)===null||a===void 0||a.delete(),this._texture=null,this._externalTexture=r}l&&(this._textureParameters=l)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(KG(e,n,this._mapping)||{});if(r.length>0){const{mapping:o,xOffset:l,yOffset:a,rowHeight:d,canvasHeight:g}=YG({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=d,this._mapping=o,this._xOffset=l,this._yOffset=a,this._canvasHeight=g,this._texture||(this._texture=new Ai(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||TS})),this._texture.height!==this._canvasHeight&&(this._texture=XG(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||TS)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const n=this._canvas.getContext("2d");for(const r of e)this._pendingCount++,my(r.url,aI,this._loadOptions).then(o=>{const l=ud(r),{x:a,y:d,width:g,height:x}=this._mapping[l],E=$G(n,o,g,x);this._texture.setSubImageData({data:E,x:a,y:d,width:g,height:x}),this._texture.generateMipmap(),this.onUpdate()}).catch(o=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:o})}).finally(()=>{this._pendingCount--})}}const SM=[0,0,0,255],QG={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:SM},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class ub extends of{constructor(...e){super(...e),cn(this,"state",void 0)}getShaders(){return super.getShaders({vs:GG,fs:WG,modules:[nM,rM]})}initializeState(){this.state={iconManager:new JG(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:SM},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:r,changeFlags:o}=e,l=this.getAttributeManager(),{iconAtlas:a,iconMapping:d,data:g,getIcon:x,textureParameters:E}=n,{iconManager:P}=this.state,A=a||this.internalState.isAsyncPropLoading("iconAtlas");if(P.setProps({loadOptions:n.loadOptions,autoPacking:!A,iconAtlas:a,iconMapping:A?d:null,textureParameters:E}),A?r.iconMapping!==n.iconMapping&&l.invalidate("getIcon"):(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getIcon))&&P.packIcons(g,x),o.extensionsChanged){var R;const{gl:j}=this.context;(R=this.state.model)===null||R===void 0||R.delete(),this.state.model=this._getModel(j),l.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:o,sizeUnits:l,billboard:a,alphaCutoff:d}=this.props,{iconManager:g}=this.state,x=g.getTexture();x&&this.state.model.setUniforms(e).setUniforms({iconsTexture:x,iconsTextureDim:[x.width,x.height],sizeUnits:gy[l],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:o,billboard:a,alphaCutoff:d}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new Kx(e,{...this.getShaders(),id:this.props.id,geometry:new DI({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const r=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;r?r(e):En.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:r,anchorX:o=n/2,anchorY:l=r/2}=this.state.iconManager.getIconMapping(e);return[n/2-o,r/2-l]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:r,width:o,height:l}=this.state.iconManager.getIconMapping(e);return[n,r,o,l]}}cn(ub,"defaultProps",QG);cn(ub,"layerName","IconLayer");const e7=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float buffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;

    // if enable sdf (signed distance fields)
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }

    // Take the global opacity and the alpha from color into account for the alpha component
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,PS=192/256,AS=[],t7={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class cb extends ub{constructor(...e){super(...e),cn(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:e7}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:r,target:o})=>this.encodePickingColor(r,o)}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;let{outlineColor:o}=n;o!==r.outlineColor&&(o=o.map(l=>l/255),o[3]=Number.isFinite(o[3])?o[3]:1,this.setState({outlineColor:o})),!n.sdf&&n.outlineWidth&&En.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:r,outlineWidth:o}=this.props,{outlineColor:l}=this.state;e.uniforms={...e.uniforms,buffer:PS,outlineBuffer:o?Math.max(r,PS*(1-o)):-1,gamma:r,sdf:Boolean(n),outlineColor:l},super.draw(e)}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):AS}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):AS}}cn(cb,"defaultProps",t7);cn(cb,"layerName","MultiIconLayer");var Iy={},n7={get exports(){return Iy},set exports(t){Iy=t}};n7.exports=hb;Iy.default=hb;var Vp=1e20;function hb(t,e,n,r,o,l){this.fontSize=t||24,this.buffer=e===void 0?3:e,this.cutoff=r||.25,this.fontFamily=o||"sans-serif",this.fontWeight=l||"normal",this.radius=n||8;var a=this.size=this.fontSize+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}hb.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var o=e.data[r*4+3]/255;this.gridOuter[r]=o===1?0:o===0?Vp:Math.pow(Math.max(0,.5-o),2),this.gridInner[r]=o===1?Vp:o===0?0:Math.pow(Math.max(0,o-.5),2)}for(CS(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),CS(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++){var l=this.gridOuter[r]-this.gridInner[r];n[r]=Math.max(0,Math.min(255,Math.round(255-255*(l/this.radius+this.cutoff))))}return n};function CS(t,e,n,r,o,l,a){for(var d=0;d<e;d++){for(var g=0;g<n;g++)r[g]=t[g*e+d];for(IS(r,o,l,a,n),g=0;g<n;g++)t[g*e+d]=o[g]}for(g=0;g<n;g++){for(d=0;d<e;d++)r[d]=t[g*e+d];for(IS(r,o,l,a,e),d=0;d<e;d++)t[g*e+d]=Math.sqrt(o[d])}}function IS(t,e,n,r,o){n[0]=0,r[0]=-Vp,r[1]=+Vp;for(var l=1,a=0;l<o;l++){for(var d=(t[l]+l*l-(t[n[a]]+n[a]*n[a]))/(2*l-2*n[a]);d<=r[a];)a--,d=(t[l]+l*l-(t[n[a]]+n[a]*n[a]))/(2*l-2*n[a]);a++,n[a]=l,r[a]=d,r[a+1]=+Vp}for(l=0,a=0;l<o;l++){for(;r[a+1]<l;)a++;e[l]=(l-n[a])*(l-n[a])+t[n[a]]}}const r7=32,i7=[];function o7(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function a7({characterSet:t,getFontWidth:e,fontHeight:n,buffer:r,maxCanvasWidth:o,mapping:l={},xOffset:a=0,yOffset:d=0}){let g=0,x=a;for(const P of t)if(!l[P]){const A=e(P);x+A+r*2>o&&(x=0,g++),l[P]={x:x+r,y:d+g*(n+r*2)+r,width:A,height:n},x+=A+r*2}const E=n+r*2;return{mapping:l,xOffset:x,yOffset:d+g*E,canvasHeight:o7(d+(g+1)*E)}}function PM(t,e,n,r){let o=0;for(let a=e;a<n;a++){var l;const d=t[a];o+=((l=r[d])===null||l===void 0?void 0:l.width)||0}return o}function AM(t,e,n,r,o,l){let a=e,d=0;for(let g=e;g<n;g++){const x=PM(t,g,g+1,o);d+x>r&&(a<g&&l.push(g),a=g,d=0),d+=x}return d}function s7(t,e,n,r,o,l){let a=e,d=e,g=e,x=0;for(let E=e;E<n;E++)if((t[E]===" "||t[E+1]===" "||E+1===n)&&(g=E+1),g>d){let P=PM(t,d,g,o);x+P>r&&(a<d&&(l.push(d),a=d,x=0),P>r&&(P=AM(t,d,g,r,o,l),a=l[l.length-1])),d=g,x+=P}return x}function l7(t,e,n,r,o=0,l){l===void 0&&(l=t.length);const a=[];return e==="break-all"?AM(t,o,l,n,r,a):s7(t,o,l,n,r,a),a}function u7(t,e,n,r,o,l){let a=0,d=0;for(let g=e;g<n;g++){const x=t[g],E=r[x];E?(d||(d=E.height),o[g]=a+E.width/2,a+=E.width):(En.warn("Missing character: ".concat(x," (").concat(x.codePointAt(0),")"))(),o[g]=a,a+=r7)}l[0]=a,l[1]=d}function MS(t,e,n,r,o){const l=Array.from(t),a=l.length,d=new Array(a),g=new Array(a),x=new Array(a),E=(n==="break-word"||n==="break-all")&&isFinite(r)&&r>0,P=[0,0],A=[0,0];let R=0,j=0,X=0;for(let D=0;D<=a;D++){const F=l[D];if((F===`
`||D===a)&&(X=D),X>j){const W=E?l7(l,n,r,o,j,X):i7;for(let J=0;J<=W.length;J++){const le=J===0?j:W[J-1],ue=J<W.length?W[J]:X;u7(l,le,ue,o,d,A);for(let ye=le;ye<ue;ye++)g[ye]=R+A[1]/2,x[ye]=A[0];R=R+A[1]*e,P[0]=Math.max(P[0],A[0])}j=X}F===`
`&&(d[j]=0,g[j]=0,x[j]=0,j++)}return P[1]=R,{x:d,y:g,rowWidth:x,size:P}}function c7({value:t,length:e,stride:n,offset:r,startIndices:o,characterSet:l}){const a=t.BYTES_PER_ELEMENT,d=n?n/a:1,g=r?r/a:0,x=o[e]||Math.ceil((t.length-g)/d),E=l&&new Set,P=new Array(e);let A=t;if(d>1||g>0){const R=t.constructor;A=new R(x);for(let j=0;j<x;j++)A[j]=t[j*d+g]}for(let R=0;R<e;R++){const j=o[R],X=o[R+1]||x,D=A.subarray(j,X);P[R]=String.fromCodePoint.apply(null,D),E&&D.forEach(E.add,E)}if(E)for(const R of E)l.add(String.fromCodePoint(R));return{texts:P,characterCount:x}}class CM{constructor(e=5){cn(this,"limit",void 0),cn(this,"_cache",{}),cn(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function h7(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const jp={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:h7(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},kS=1024,f7=.9,LS=1.2,IM=3;let My=new CM(IM);function p7(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const r=My.get(t);if(!r)return n;for(const o in r.mapping)n.has(o)&&n.delete(o);return n}function d7(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function RS(t,e,n,r){t.font="".concat(r," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function m7(t){En.assert(Number.isFinite(t)&&t>=IM,"Invalid cache limit"),My=new CM(t)}class g7{constructor(){cn(this,"props",{...jp}),cn(this,"_key",void 0),cn(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return LS}setProps(e={}){Object.assign(this.props,e);const n=this._key;this._key=this._getKey();const r=p7(this._key,this.props.characterSet),o=My.get(this._key);if(o&&r.size===0){this._key!==n&&(this._atlas=o);return}const l=this._generateFontAtlas(this._key,r,o);this._atlas=l,My.set(this._key,l)}_generateFontAtlas(e,n,r){const{fontFamily:o,fontWeight:l,fontSize:a,buffer:d,sdf:g,radius:x,cutoff:E}=this.props;let P=r&&r.data;P||(P=document.createElement("canvas"),P.width=kS);const A=P.getContext("2d");RS(A,o,a,l);const{mapping:R,canvasHeight:j,xOffset:X,yOffset:D}=a7({getFontWidth:F=>A.measureText(F).width,fontHeight:a*LS,buffer:d,characterSet:n,maxCanvasWidth:kS,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(P.height!==j){const F=A.getImageData(0,0,P.width,P.height);P.height=j,A.putImageData(F,0,0)}if(RS(A,o,a,l),g){const F=new Iy(a,d,x,E,o,l),W=A.getImageData(0,0,F.size,F.size);for(const J of n)d7(F.draw(J),W),A.putImageData(W,R[J].x-d,R[J].y+d)}else for(const F of n)A.fillText(F,R[F].x,R[F].y+a*f7);return{xOffset:X,yOffset:D,mapping:R,data:P,width:P.width,height:P.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:r,buffer:o,sdf:l,radius:a,cutoff:d}=this.props;return l?"".concat(e," ").concat(n," ").concat(r," ").concat(o," ").concat(a," ").concat(d):"".concat(e," ").concat(n," ").concat(r," ").concat(o)}}const y7=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;

  // convert size in meters to pixels, then scaled and clamp

  // project meters to pixels and clamp to limits
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,v7=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,_7={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class fb extends of{constructor(...e){super(...e),cn(this,"state",void 0)}getShaders(){return super.getShaders({vs:y7,fs:v7,modules:[nM,rM]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var r;const{gl:o}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:r,sizeUnits:o,sizeMinPixels:l,sizeMaxPixels:a,getLineWidth:d}=this.props;let{padding:g}=this.props;g.length<4&&(g=[g[0],g[1],g[0],g[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:Boolean(d),padding:g,sizeUnits:gy[o],sizeScale:r,sizeMinPixels:l,sizeMaxPixels:a}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new Kx(e,{...this.getShaders(),id:this.props.id,geometry:new DI({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}cn(fb,"defaultProps",_7);cn(fb,"layerName","TextBackgroundLayer");const OS={start:1,middle:0,end:-1},zS={top:1,center:0,bottom:-1},G_=[0,0,0,255],x7=1,b7={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:G_},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:jp.characterSet},fontFamily:jp.fontFamily,fontWeight:jp.fontWeight,lineHeight:x7,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:G_},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:G_},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class pb extends _M{constructor(...e){super(...e),cn(this,"state",void 0),cn(this,"getBoundingRect",(n,r)=>{const o=this.state.fontAtlasManager.mapping,l=this.state.getText,{wordBreak:a,maxWidth:d,lineHeight:g,getTextAnchor:x,getAlignmentBaseline:E}=this.props,P=l(n,r)||"",{size:[A,R]}=MS(P,g,a,d,o),j=OS[typeof x=="function"?x(n,r):x],X=zS[typeof E=="function"?E(n,r):E];return[(j-1)*A/2,(X-1)*R/2,A,R]}),cn(this,"getIconOffsets",(n,r)=>{const o=this.state.fontAtlasManager.mapping,l=this.state.getText,{wordBreak:a,maxWidth:d,lineHeight:g,getTextAnchor:x,getAlignmentBaseline:E}=this.props,P=l(n,r)||"",{x:A,y:R,rowWidth:j,size:[X,D]}=MS(P,g,a,d,o),F=OS[typeof x=="function"?x(n,r):x],W=zS[typeof E=="function"?E(n,r):E],J=A.length,le=new Array(J*2);let ue=0;for(let ye=0;ye<J;ye++){const Ee=(1-F)*(X-j[ye])/2;le[ue++]=(F-1)*X/2+Ee+A[ye],le[ue++]=(W-1)*D/2+R[ye]}return le})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new g7}}updateState(e){const{props:n,oldProps:r,changeFlags:o}=e;(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==r.lineHeight||n.wordBreak!==r.wordBreak||n.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:r}=this.props,{fontAtlasManager:o,characterSet:l}=this.state,a={...e,characterSet:l,fontFamily:n,fontWeight:r};if(!o.mapping)return o.setProps(a),!0;for(const d in a)if(a[d]!==o.props[d])return o.setProps(a),!0;return!1}_updateText(){var e;const{data:n,characterSet:r}=this.props,o=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:l}=this.props,a=n.startIndices,d;const g=r==="auto"&&new Set;if(o&&a){const{texts:x,characterCount:E}=c7({...ArrayBuffer.isView(o)?{value:o}:o,length:n.length,startIndices:a,characterSet:g});d=E,l=(P,{index:A})=>x[A]}else{const{iterable:x,objectInfo:E}=ib(n);a=[0],d=0;for(const P of x){E.index++;const A=Array.from(l(P,E)||"");g&&A.forEach(g.add,g),d+=A.length,a.push(d)}}this.setState({getText:l,startIndices:a,numInstances:d,characterSet:g||r})}renderLayers(){const{startIndices:e,numInstances:n,getText:r,fontAtlasManager:{scale:o,texture:l,mapping:a},styleVersion:d}=this.state,{data:g,_dataDiff:x,getPosition:E,getColor:P,getSize:A,getAngle:R,getPixelOffset:j,getBackgroundColor:X,getBorderColor:D,getBorderWidth:F,backgroundPadding:W,background:J,billboard:le,fontSettings:ue,outlineWidth:ye,outlineColor:Ee,sizeScale:Pe,sizeUnits:we,sizeMinPixels:ze,sizeMaxPixels:Fe,transitions:Be,updateTriggers:He}=this.props,We=this.getSubLayerClass("characters",cb),_t=this.getSubLayerClass("background",fb);return[J&&new _t({getFillColor:X,getLineColor:D,getLineWidth:F,padding:W,getPosition:E,getSize:A,getAngle:R,getPixelOffset:j,billboard:le,sizeScale:Pe/this.state.fontAtlasManager.props.fontSize,sizeUnits:we,sizeMinPixels:ze,sizeMaxPixels:Fe,transitions:Be&&{getPosition:Be.getPosition,getAngle:Be.getAngle,getSize:Be.getSize,getFillColor:Be.getBackgroundColor,getLineColor:Be.getBorderColor,getLineWidth:Be.getBorderWidth,getPixelOffset:Be.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:He.getPosition,getAngle:He.getAngle,getSize:He.getSize,getFillColor:He.getBackgroundColor,getLineColor:He.getBorderColor,getLineWidth:He.getBorderWidth,getPixelOffset:He.getPixelOffset,getBoundingRect:{getText:He.getText,getTextAnchor:He.getTextAnchor,getAlignmentBaseline:He.getAlignmentBaseline,styleVersion:d}}}),{data:g.attributes&&g.attributes.background?{length:g.length,attributes:g.attributes.background}:g,_dataDiff:x,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new We({sdf:ue.sdf,smoothing:Number.isFinite(ue.smoothing)?ue.smoothing:jp.smoothing,outlineWidth:ye,outlineColor:Ee,iconAtlas:l,iconMapping:a,getPosition:E,getColor:P,getSize:A,getAngle:R,getPixelOffset:j,billboard:le,sizeScale:Pe*o,sizeUnits:we,sizeMinPixels:ze*o,sizeMaxPixels:Fe*o,transitions:Be&&{getPosition:Be.getPosition,getAngle:Be.getAngle,getColor:Be.getColor,getSize:Be.getSize,getPixelOffset:Be.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:He.getText,getPosition:He.getPosition,getAngle:He.getAngle,getColor:He.getColor,getSize:He.getSize,getPixelOffset:He.getPixelOffset,getIconOffsets:{getText:He.getText,getTextAnchor:He.getTextAnchor,getAlignmentBaseline:He.getAlignmentBaseline,styleVersion:d}}}),{data:g,_dataDiff:x,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){m7(e)}}cn(pb,"defaultProps",b7);cn(pb,"layerName","TextLayer");const w7=`
#ifdef NON_INSTANCED_MODEL
attribute float collidePriorities;
#else
attribute float instanceCollidePriorities;
#endif

uniform sampler2D collide_texture;
uniform bool collide_sort;
uniform bool collide_enabled;

vec2 collide_getCoords(vec4 position) {
  vec4 collide_clipspace = project_common_position_to_clipspace(position);
  return (1.0 + collide_clipspace.xy / collide_clipspace.w) / 2.0;
}

float collide_match(vec2 tex, vec3 pickingColor) {
  vec4 collide_pickingColor = texture2D(collide_texture, tex);
  float delta = dot(abs(collide_pickingColor.rgb - pickingColor), vec3(1.0));
  float e = 0.001;
  return step(delta, e);
}

float collide_isVisible(vec2 texCoords, vec3 pickingColor) {
  if (!collide_enabled) {
    return 1.0;
  }

  // Visibility test, sample area of 5x5 pixels in order to fade in/out.
  // Due to the locality, the lookups will be cached
  // This reduces the flicker present when objects are shown/hidden
  const int N = 2;
  float accumulator = 0.0;
  vec2 step = vec2(1.0 / project_uViewportSize);

  const float floatN = float(N);
  vec2 delta = -floatN * step;
  for(int i = -N; i <= N; i++) {
    delta.x = -step.x * floatN;
    for(int j = -N; j <= N; j++) {
      accumulator += collide_match(texCoords + delta, pickingColor);
      delta.x += step.x;
    }
    delta.y += step.y;
  }

  float W = 2.0 * floatN + 1.0;
  return pow(accumulator / (W * W), 2.2);
}
`,E7={"vs:#decl":`
  float collide_fade = 1.0;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  if (collide_sort) {
    #ifdef NON_INSTANCED_MODEL
    float collidePriority = collidePriorities;
    #else
    float collidePriority = instanceCollidePriorities;
    #endif
    position.z = -0.001 * collidePriority * position.w; // Support range -1000 -> 1000
  }

  if (collide_enabled) {
    vec4 collide_common_position = project_position(vec4(geometry.worldPosition, 1.0));
    vec2 collide_texCoords = collide_getCoords(collide_common_position);
    collide_fade = collide_isVisible(collide_texCoords, geometry.pickingColor / 255.0);
    if (collide_fade < 0.0001) {
      position = vec4(0.);
    }
  }
  `,"vs:DECKGL_FILTER_COLOR":`
  color.a *= collide_fade;
  `},T7={name:"collide",dependencies:[rv],vs:w7,inject:E7};class S7 extends kd{renderCollideMap(e,n){const r=this.gl,o=[!0,!0,!0,!0],l=1;return Uo(r,{scissorTest:!0,scissor:[l,l,e.width-2*l,e.height-2*l],clearColor:[0,0,0,0],blend:!1,colorMask:o,depthTest:!0,depthRange:[0,1]},()=>this.render({...n,target:e,pass:"collide"}))}shouldDrawLayer(e){return Boolean(e.props.extensions.find(n=>n.constructor.extensionName==="CollideExtension"))&&e.props.collideEnabled}getModuleParameters(){return{drawToCollideMap:!0,pickingActive:1,pickingAttribute:!1,lightSources:{}}}}class P7 extends kd{constructor(e,n){super(e,n),me(this,"maskMap",void 0),me(this,"fbo",void 0);const{mapSize:r=2048}=n;this.maskMap=new Ai(e,{width:r,height:r,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.fbo=new qr(e,{id:"maskmap",width:r,height:r,attachments:{[36064]:this.maskMap}})}render(e){const n=this.gl,r=[!1,!1,!1,!1];return r[e.channel]=!0,Uo(n,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:r,depthTest:!1},()=>super.render({...e,target:this.fbo,pass:"mask"}))}shouldDrawLayer(e){return e.props.operation.includes("mask")}delete(){this.fbo.delete(),this.maskMap.delete()}}function A7({layers:t,viewport:e}){let n=null;for(const l of t){const a=l.getBounds();a&&(n?(n[0]=Math.min(n[0],a[0][0]),n[1]=Math.min(n[1],a[0][1]),n[2]=Math.max(n[2],a[1][0]),n[3]=Math.max(n[3],a[1][1])):n=[a[0][0],a[0][1],a[1][0],a[1][1]])}const r=e.getBounds();if(!n)return r;const o=I7(r);return n[2]-n[0]<o[2]-o[0]||n[3]-n[1]<o[3]-o[1]||(n[0]=Math.max(n[0],o[0]),n[1]=Math.max(n[1],o[1]),n[2]=Math.min(n[2],o[2]),n[3]=Math.min(n[3],o[3])),n}function C7({bounds:t,viewport:e,width:n,height:r}){if(t[2]<=t[0]||t[3]<=t[1])return null;if(e.resolution!==void 0)return En.warn("MaskExtension is not supported in GlobeView")(),null;const o=1;if(n-=o*2,r-=o*2,e.isGeospatial){const{longitude:d,latitude:g,zoom:x}=KI({width:n,height:r,bounds:[[t[0],t[1]],[t[2],t[3]]],maxZoom:20});return new lc({longitude:d,latitude:g,zoom:x,x:o,y:o,width:n,height:r})}const l=[(t[0]+t[2])/2,(t[1]+t[3])/2,0],a=Math.min(1048576,n/(t[2]-t[0]),r/(t[3]-t[1]));return new xM({x:o,y:o}).makeViewport({width:n,height:r,viewState:{target:l,zoom:Math.log2(a)}})}function I7(t){const e={x:t[2]-t[0],y:t[3]-t[1]},n={x:t[0]+.5*e.x,y:t[1]+.5*e.y};return[n.x-e.x,n.y-e.y,n.x+e.x,n.y+e.y]}class M7{constructor(){me(this,"id","mask-effect"),me(this,"props",null),me(this,"useInPicking",!0),me(this,"order",0),me(this,"dummyMaskMap",void 0),me(this,"channels",[]),me(this,"masks",null),me(this,"maskPass",void 0),me(this,"maskMap",void 0),me(this,"lastViewport",void 0)}preRender(e,{layers:n,layerFilter:r,viewports:o,onViewportActive:l,views:a,pass:d}){let g=!1;if(this.dummyMaskMap||(this.dummyMaskMap=new Ai(e,{width:1,height:1})),d.startsWith("picking"))return{didRender:g};const x=n.filter(R=>R.props.visible&&R.props.operation.includes("mask"));if(x.length===0)return this.masks=null,this.channels.length=0,{didRender:g};this.masks={},this.maskPass||(this.maskPass=new P7(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const E=this._sortMaskChannels(x),P=o[0],A=!this.lastViewport||!this.lastViewport.equals(P);for(const R in E){const j=this._renderChannel(E[R],{layerFilter:r,onViewportActive:l,views:a,viewport:P,viewportChanged:A});g||(g=j)}return{didRender:g}}_renderChannel(e,{layerFilter:n,onViewportActive:r,views:o,viewport:l,viewportChanged:a}){let d=!1;const g=this.channels[e.index];if(!g)return d;const x=e===g||g.layers.length!==e.layers.length||e.layerBounds.some((E,P)=>E!==g.layerBounds[P]);if(e.bounds=g.bounds,e.maskBounds=g.maskBounds,this.channels[e.index]=e,(x||a)&&(this.lastViewport=l,e.bounds=A7({layers:e.layers,viewport:l}),x||!Yx(e.bounds,g.bounds))){const{maskPass:E,maskMap:P}=this,A=C7({bounds:e.bounds,viewport:l,width:P.width,height:P.height});e.maskBounds=A?A.getBounds():[0,0,1,1],E.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:n,viewports:A?[A]:[],onViewportActive:r,views:o,moduleParameters:{devicePixelRatio:1}}),d=!0}return this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem},d}_sortMaskChannels(e){const n={};let r=0;for(const o of e){const{id:l}=o.root;let a=n[l];if(!a){if(++r>4){En.warn("Too many mask layers. The max supported is 4")();continue}a={id:l,index:this.channels.findIndex(d=>(d==null?void 0:d.id)===l),layers:[],layerBounds:[],coordinateOrigin:o.root.props.coordinateOrigin,coordinateSystem:o.root.props.coordinateSystem},n[l]=a}a.layers.push(o),a.layerBounds.push(o.getBounds())}for(let o=0;o<4;o++){const l=this.channels[o];(!l||!(l.id in n))&&(this.channels[o]=null)}for(const o in n){const l=n[o];l.index<0&&(l.index=this.channels.findIndex(a=>!a),this.channels[l.index]=l)}return n}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const W_=2;class k7{constructor(){me(this,"id","collide-effect"),me(this,"props",null),me(this,"useInPicking",!0),me(this,"order",1),me(this,"channels",{}),me(this,"collidePasses",{}),me(this,"collideFBOs",{}),me(this,"dummyCollideMap",void 0),me(this,"lastViewport",void 0)}preRender(e,{effects:n,layers:r,layerFilter:o,viewports:l,onViewportActive:a,views:d,pass:g,preRenderStats:x={}}){var E;if(this.dummyCollideMap||(this.dummyCollideMap=new Ai(e,{width:1,height:1})),g.startsWith("picking"))return;const P=r.filter(({props:{visible:F,collideEnabled:W}})=>F&&W);if(P.length===0){this.channels={};return}const A=n==null?void 0:n.filter(F=>F.constructor===M7),R=(E=x["mask-effect"])===null||E===void 0?void 0:E.didRender,j=this._groupByCollideGroup(e,P),X=l[0],D=!this.lastViewport||!this.lastViewport.equals(X)||R;for(const F in j){const W=this.collideFBOs[F],J=j[F];W.resize({width:e.canvas.width/W_,height:e.canvas.height/W_}),this._render(J,{effects:A,layerFilter:o,onViewportActive:a,views:d,viewport:X,viewportChanged:D})}}_render(e,{effects:n,layerFilter:r,onViewportActive:o,views:l,viewport:a,viewportChanged:d}){const{collideGroup:g}=e,x=this.channels[g];if(!x)return;const E=e===x||x.layers.length!==e.layers.length||e.layerBounds.some((P,A)=>!Yx(P,x.layerBounds[A]));if(this.channels[g]=e,E||d){this.lastViewport=a;const P=this.collideFBOs[g];this.collidePasses[g].renderCollideMap(P,{pass:"collide",layers:e.layers,effects:n,layerFilter:r,viewports:a?[a]:[],onViewportActive:o,views:l,moduleParameters:{dummyCollideMap:this.dummyCollideMap,devicePixelRatio:ac(P.gl)/W_}})}}_groupByCollideGroup(e,n){const r={};for(const o of n){const{collideGroup:l}=o.props;let a=r[l];a||(a={collideGroup:l,layers:[],layerBounds:[]},r[l]=a),a.layers.push(o),a.layerBounds.push(o.getBounds())}for(const o of Object.keys(r))this.collidePasses[o]||this.createPass(e,o),this.channels[o]||(this.channels[o]=r[o]);for(const o of Object.keys(this.collidePasses))r[o]||this.destroyPass(o);return r}getModuleParameters(){const{collideFBOs:e,dummyCollideMap:n}=this;return{collideFBOs:e,dummyCollideMap:n}}cleanup(){this.dummyCollideMap&&(this.dummyCollideMap.delete(),this.dummyCollideMap=void 0),this.channels={};for(const e of Object.keys(this.collidePasses))this.destroyPass(e);this.collidePasses={},this.lastViewport=void 0}createPass(e,n){this.collidePasses[n]=new S7(e,{id:n});const{width:r,height:o}=e.canvas,l=new Ai(e,{width:r,height:o,parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071}}),a=new qu(e,{format:33189,width:r,height:o});this.collideFBOs[n]=new qr(e,{id:"Collide-".concat(n),width:r,height:o,attachments:{[36064]:l,[36096]:a}})}destroyPass(e){delete this.collidePasses[e];const n=this.collideFBOs[e];for(const r of Object.values(n.attachments))r.delete();n.delete(),delete this.collideFBOs[e]}}const L7={getCollidePriority:{type:"accessor",value:0},collideEnabled:!0,collideGroup:{type:"string",value:"default"},collideTestProps:{}};class db extends bM{isEnabled(e){return e.getAttributeManager()!==null}getShaders(){return{modules:[T7]}}draw({uniforms:e,context:n,moduleParameters:r}){const{collideEnabled:o,collideGroup:l}=this.props,{drawToCollideMap:a,collideFBOs:d={}}=r,g=Object.keys(d),x=o&&l&&g.includes(l);e.collide_enabled=x,a?(e.collide_sort=Boolean(this.props.getCollidePriority),e.collide_texture=r.dummyCollideMap,this.props=this.clone(this.props.collideTestProps).props):(e.collide_sort=!1,e.collide_texture=x?r.collideFBOs[l]:r.dummyCollideMap)}initializeState(e,n){var r;if(!n.isEnabled(this))return;(r=this.context.deck)===null||r===void 0||r._addDefaultEffect(new k7),this.getAttributeManager().add({collidePriorities:{size:1,accessor:"getCollidePriority",shaderAttributes:{collidePriorities:{divisor:0},instanceCollidePriorities:{divisor:1}}}})}getNeedsPickingBuffer(){return this.props.collideEnabled}}me(db,"defaultProps",L7);me(db,"extensionName","CollideExtension");function Mn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const DS=100;let R7=class{constructor(e,n){if(Mn(this,"schema",void 0),Mn(this,"options",void 0),Mn(this,"length",0),Mn(this,"rows",null),Mn(this,"cursor",0),Mn(this,"_headers",[]),this.options=n,this.schema=e,!Array.isArray(e)){this._headers=[];for(const r in e)this._headers[e[r].index]=e[r].name}}rowCount(){return this.length}addArrayRow(e,n){Number.isFinite(n)&&(this.cursor=n),this.rows=this.rows||new Array(DS),this.rows[this.length]=e,this.length++}addObjectRow(e,n){Number.isFinite(n)&&(this.cursor=n),this.rows=this.rows||new Array(DS),this.rows[this.length]=e,this.length++}getBatch(){let e=this.rows;return e?(e=e.slice(0,this.length),this.rows=null,{shape:this.options.shape,batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}};function MM(t,e){if(!t)throw new Error("null row");if(!e)throw new Error("no headers");const n={};for(let r=0;r<e.length;r++)n[e[r]]=t[r];return n}function kM(t,e){if(!t)throw new Error("null row");if(!e)throw new Error("no headers");const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=t[e[r]];return n}const FS=100;class O7{constructor(e,n){if(Mn(this,"schema",void 0),Mn(this,"options",void 0),Mn(this,"length",0),Mn(this,"objectRows",null),Mn(this,"arrayRows",null),Mn(this,"cursor",0),Mn(this,"_headers",[]),this.options=n,this.schema=e,!Array.isArray(e)){this._headers=[];for(const r in e)this._headers[e[r].index]=e[r].name}}rowCount(){return this.length}addArrayRow(e,n){switch(Number.isFinite(n)&&(this.cursor=n),this.options.shape){case"object-row-table":const r=MM(e,this._headers);this.addObjectRow(r,n);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(FS),this.arrayRows[this.length]=e,this.length++;break}}addObjectRow(e,n){switch(Number.isFinite(n)&&(this.cursor=n),this.options.shape){case"array-row-table":const r=kM(e,this._headers);this.addArrayRow(r,n);break;case"object-row-table":this.objectRows=this.objectRows||new Array(FS),this.objectRows[this.length]=e,this.length++;break}}getBatch(){let e=this.arrayRows||this.objectRows;return e?(e=e.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const z7=100;class D7{constructor(e,n){Mn(this,"schema",void 0),Mn(this,"length",0),Mn(this,"allocated",0),Mn(this,"columns",{}),this.schema=e,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(e){this._reallocateColumns();let n=0;for(const r in this.columns)this.columns[r][this.length]=e[n++];this.length++}addObjectRow(e){this._reallocateColumns();for(const n in e)this.columns[n][this.length]=e[n];this.length++}getBatch(){this._pruneColumns();const e=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const r in this.schema){const o=this.schema[r];e[o.name]=this.columns[o.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:e,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:z7,this.columns={};for(const e in this.schema){const n=this.schema[e],r=n.type||Float32Array,o=this.columns[n.index];if(o&&ArrayBuffer.isView(o)){const l=new r(this.allocated);l.set(o),this.columns[n.index]=l}else o?(o.length=this.allocated,this.columns[n.index]=o):this.columns[n.index]=new r(this.allocated)}}}_pruneColumns(){for(const[e,n]of Object.entries(this.columns))this.columns[e]=n.slice(0,this.length)}}const F7={shape:"array-row-table",batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},NS="TableBatchBuilder";class cd{constructor(e,n){Mn(this,"schema",void 0),Mn(this,"options",void 0),Mn(this,"aggregator",null),Mn(this,"batchCount",0),Mn(this,"bytesUsed",0),Mn(this,"isChunkComplete",!1),Mn(this,"lastBatchEmittedMs",Date.now()),Mn(this,"totalLength",0),Mn(this,"totalBytes",0),Mn(this,"rowBytes",0),this.schema=e,this.options={...F7,...n}}limitReached(){var e,n;return!!(Boolean((e=this.options)===null||e===void 0?void 0:e.limit)&&this.totalLength>=this.options.limit||Boolean((n=this.options)===null||n===void 0?void 0:n._limitMB)&&this.totalBytes/1e6>=this.options._limitMB)}addRow(e){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(e),this.totalBytes+=this.rowBytes,Array.isArray(e)?this.addArrayRow(e):this.addObjectRow(e))}addArrayRow(e){if(!this.aggregator){const n=this._getTableBatchType();this.aggregator=new n(this.schema,this.options)}this.aggregator.addArrayRow(e)}addObjectRow(e){if(!this.aggregator){const n=this._getTableBatchType();this.aggregator=new n(this.schema,this.options)}this.aggregator.addObjectRow(e)}chunkComplete(e){e instanceof ArrayBuffer&&(this.bytesUsed+=e.byteLength),typeof e=="string"&&(this.bytesUsed+=e.length),this.isChunkComplete=!0}getFullBatch(e){return this._isFull()?this._getBatch(e):null}getFinalBatch(e){return this._getBatch(e)}_estimateRowMB(e){return Array.isArray(e)?e.length*8:Object.keys(e).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(e){if(!this.aggregator)return null;e!=null&&e.bytesUsed&&(this.bytesUsed=e.bytesUsed);const n=this.aggregator.getBatch();return n.count=this.batchCount,n.bytesUsed=this.bytesUsed,Object.assign(n,e),this.batchCount++,this.aggregator=null,n}_getTableBatchType(){switch(this.options.shape){case"row-table":return R7;case"array-row-table":case"object-row-table":return O7;case"columnar-table":return D7;case"arrow-table":if(!cd.ArrowBatch)throw new Error(NS);return cd.ArrowBatch;default:throw new Error(NS)}}}Mn(cd,"ArrowBatch",void 0);let LM;class BS extends Array{enqueue(e){return this.push(e)}dequeue(){return this.shift()}}LM=Symbol.asyncIterator;class N7{constructor(){Mn(this,"_values",void 0),Mn(this,"_settlers",void 0),Mn(this,"_closed",void 0),this._values=new BS,this._settlers=new BS,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[LM](){return this}enqueue(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const n=this._settlers.dequeue();e instanceof Error?n.reject(e):n.resolve({value:e})}else this._values.enqueue(e)}next(){if(this._values.length>0){const e=this._values.dequeue();return e instanceof Error?Promise.reject(e):Promise.resolve({value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((e,n)=>{this._settlers.enqueue({resolve:e,reject:n})})}}/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/const US="\uFEFF",cs={parse:B7,unparse:U7,RECORD_SEP:String.fromCharCode(30),UNIT_SEP:String.fromCharCode(31),BYTE_ORDER_MARK:US,BAD_DELIMITERS:["\r",`
`,'"',US],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:C1,ParserHandle:OM,ChunkStreamer:RM,StringStreamer:Kh},lv=cs;function B7(t,e,n){e=e||{};var r=e.dynamicTyping||!1;if(to(r)&&(e.dynamicTypingFunction=r,r={}),e.dynamicTyping=r,e.transform=to(e.transform)?e.transform:!1,e.worker&&cs.WORKERS_SUPPORTED){var o=newWorker();o.userStep=e.step,o.userChunk=e.chunk,o.userComplete=e.complete,o.userError=e.error,e.step=to(e.step),e.chunk=to(e.chunk),e.complete=to(e.complete),e.error=to(e.error),delete e.worker,o.postMessage({input:t,config:e,workerId:o.id});return}var l=null;return typeof t=="string"&&(l=new Kh(e)),l||(l=new n(e)),l.stream(t)}function U7(t,e){var n=!1,r=!0,o=",",l=`\r
`,a='"',d=a+a,g=!1,x=null;P();var E=new RegExp(hd(a),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return R(null,t,g);if(typeof t[0]=="object")return R(x||A(t[0]),t,g)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:A(t.data[0])),!Array.isArray(t.data[0])&&typeof t.data[0]!="object"&&(t.data=[t.data])),R(t.fields||[],t.data||[],g);throw new Error("Unable to serialize unrecognized input");function P(){if(typeof e=="object"){if(typeof e.delimiter=="string"&&!cs.BAD_DELIMITERS.filter(function(D){return e.delimiter.indexOf(D)!==-1}).length&&(o=e.delimiter),(typeof e.quotes=="boolean"||Array.isArray(e.quotes))&&(n=e.quotes),(typeof e.skipEmptyLines=="boolean"||typeof e.skipEmptyLines=="string")&&(g=e.skipEmptyLines),typeof e.newline=="string"&&(l=e.newline),typeof e.quoteChar=="string"&&(a=e.quoteChar),typeof e.header=="boolean"&&(r=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");x=e.columns}e.escapeChar!==void 0&&(d=e.escapeChar+a)}}function A(D){if(typeof D!="object")return[];var F=[];for(var W in D)F.push(W);return F}function R(D,F,W){var J="";typeof D=="string"&&(D=JSON.parse(D)),typeof F=="string"&&(F=JSON.parse(F));var le=Array.isArray(D)&&D.length>0,ue=!Array.isArray(F[0]);if(le&&r){for(var ye=0;ye<D.length;ye++)ye>0&&(J+=o),J+=j(D[ye],ye);F.length>0&&(J+=l)}for(var Ee=0;Ee<F.length;Ee++){var Pe=le?D.length:F[Ee].length,we=!1,ze=le?Object.keys(F[Ee]).length===0:F[Ee].length===0;if(W&&!le&&(we=W==="greedy"?F[Ee].join("").trim()==="":F[Ee].length===1&&F[Ee][0].length===0),W==="greedy"&&le){for(var Fe=[],Be=0;Be<Pe;Be++){var He=ue?D[Be]:Be;Fe.push(F[Ee][He])}we=Fe.join("").trim()===""}if(!we){for(var We=0;We<Pe;We++){We>0&&!ze&&(J+=o);var _t=le&&ue?D[We]:We;J+=j(F[Ee][_t],We)}Ee<F.length-1&&(!W||Pe>0&&!ze)&&(J+=l)}}return J}function j(D,F){if(typeof D>"u"||D===null)return"";if(D.constructor===Date)return JSON.stringify(D).slice(1,25);D=D.toString().replace(E,d);var W=typeof n=="boolean"&&n||Array.isArray(n)&&n[F]||X(D,cs.BAD_DELIMITERS)||D.indexOf(o)>-1||D.charAt(0)===" "||D.charAt(D.length-1)===" ";return W?a+D+a:D}function X(D,F){for(var W=0;W<F.length;W++)if(D.indexOf(F[W])>-1)return!0;return!1}}function RM(t){this._handle=null,this._finished=!1,this._completed=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},e.call(this,t),this.parseChunk=function(n,r){if(this.isFirstChunk&&to(this._config.beforeFirstChunk)){var o=this._config.beforeFirstChunk(n);o!==void 0&&(n=o)}this.isFirstChunk=!1;var l=this._partialLine+n;this._partialLine="";var a=this._handle.parse(l,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var d=a.meta.cursor;this._finished||(this._partialLine=l.substring(d-this._baseIndex),this._baseIndex=d),a&&a.data&&(this._rowCount+=a.data.length);var g=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(to(this._config.chunk)&&!r){if(this._config.chunk(a,this._handle),this._handle.paused()||this._handle.aborted())return;a=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(a.data),this._completeResults.errors=this._completeResults.errors.concat(a.errors),this._completeResults.meta=a.meta),!this._completed&&g&&to(this._config.complete)&&(!a||!a.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),!g&&(!a||!a.meta.paused)&&this._nextChunk(),a}},this._sendError=function(n){to(this._config.error)&&this._config.error(n)};function e(n){var r=mb(n);r.chunkSize=parseInt(r.chunkSize),!n.step&&!n.chunk&&(r.chunkSize=null),this._handle=new OM(r),this._handle.streamer=this,this._config=r}}function Kh(t){t=t||{},RM.call(this,t);var e;this.stream=function(n){return e=n,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var n=this._config.chunkSize,r=n?e.substr(0,n):e;return e=n?e.substr(n):"",this._finished=!e,this.parseChunk(r)}}}Kh.prototype=Object.create(Kh.prototype);Kh.prototype.constructor=Kh;function OM(t){var e=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,n=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,r=this,o=0,l=0,a,d,g=!1,x=!1,E,P=[],A={data:[],errors:[],meta:{}};if(to(t.step)){var R=t.step;t.step=function(Pe){if(A=Pe,D())X();else{if(X(),!A.data||A.data.length===0)return;o+=Pe.data.length,t.preview&&o>t.preview?d.abort():R(A,r)}}}this.parse=function(Pe,we,ze){var Fe=t.quoteChar||'"';if(t.newline||(t.newline=ye(Pe,Fe)),E=!1,t.delimiter)to(t.delimiter)&&(t.delimiter=t.delimiter(Pe),A.meta.delimiter=t.delimiter);else{var Be=ue(Pe,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);Be.successful?t.delimiter=Be.bestDelimiter:(E=!0,t.delimiter=cs.DefaultDelimiter),A.meta.delimiter=t.delimiter}var He=mb(t);return t.preview&&t.header&&He.preview++,a=Pe,d=new C1(He),A=d.parse(a,we,ze),X(),g?{meta:{paused:!0}}:A||{meta:{paused:!1}}},this.paused=function(){return g},this.pause=function(){g=!0,d.abort(),a=a.substr(d.getCharIndex())},this.resume=function(){g=!1,r.streamer.parseChunk(a,!0)},this.aborted=function(){return x},this.abort=function(){x=!0,d.abort(),A.meta.aborted=!0,to(t.complete)&&t.complete(A),a=""};function j(Pe){return t.skipEmptyLines==="greedy"?Pe.join("").trim()==="":Pe.length===1&&Pe[0].length===0}function X(){if(A&&E&&(Ee("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+cs.DefaultDelimiter+"'"),E=!1),t.skipEmptyLines)for(var Pe=0;Pe<A.data.length;Pe++)j(A.data[Pe])&&A.data.splice(Pe--,1);return D()&&F(),le()}function D(){return t.header&&P.length===0}function F(){if(!A)return;function Pe(ze){to(t.transformHeader)&&(ze=t.transformHeader(ze)),P.push(ze)}if(Array.isArray(A.data[0])){for(var we=0;D()&&we<A.data.length;we++)A.data[we].forEach(Pe);A.data.splice(0,1)}else A.data.forEach(Pe)}function W(Pe){return t.dynamicTypingFunction&&t.dynamicTyping[Pe]===void 0&&(t.dynamicTyping[Pe]=t.dynamicTypingFunction(Pe)),(t.dynamicTyping[Pe]||t.dynamicTyping)===!0}function J(Pe,we){return W(Pe)?we==="true"||we==="TRUE"?!0:we==="false"||we==="FALSE"?!1:e.test(we)?parseFloat(we):n.test(we)?new Date(we):we===""?null:we:we}function le(){if(!A||!A.data||!t.header&&!t.dynamicTyping&&!t.transform)return A;function Pe(ze,Fe){var Be=t.header?{}:[],He;for(He=0;He<ze.length;He++){var We=He,_t=ze[He];t.header&&(We=He>=P.length?"__parsed_extra":P[He]),t.transform&&(_t=t.transform(_t,We)),_t=J(We,_t),We==="__parsed_extra"?(Be[We]=Be[We]||[],Be[We].push(_t)):Be[We]=_t}return t.header&&(He>P.length?Ee("FieldMismatch","TooManyFields","Too many fields: expected "+P.length+" fields but parsed "+He,l+Fe):He<P.length&&Ee("FieldMismatch","TooFewFields","Too few fields: expected "+P.length+" fields but parsed "+He,l+Fe)),Be}var we=1;return!A.data[0]||Array.isArray(A.data[0])?(A.data=A.data.map(Pe),we=A.data.length):A.data=Pe(A.data,0),t.header&&A.meta&&(A.meta.fields=P),l+=we,A}function ue(Pe,we,ze,Fe,Be){var He,We,_t;Be=Be||[",","	","|",";",cs.RECORD_SEP,cs.UNIT_SEP];for(var gn=0;gn<Be.length;gn++){var pn=Be[gn],$n=0,Tn=0,lr=0;_t=void 0;for(var Jt=new C1({comments:Fe,delimiter:pn,newline:we,preview:10}).parse(Pe),dn=0;dn<Jt.data.length;dn++){if(ze&&j(Jt.data[dn])){lr++;continue}var An=Jt.data[dn].length;if(Tn+=An,typeof _t>"u"){_t=0;continue}else An>1&&($n+=Math.abs(An-_t),_t=An)}Jt.data.length>0&&(Tn/=Jt.data.length-lr),(typeof We>"u"||$n>We)&&Tn>1.99&&(We=$n,He=pn)}return t.delimiter=He,{successful:!!He,bestDelimiter:He}}function ye(Pe,we){Pe=Pe.substr(0,1024*1024);var ze=new RegExp(hd(we)+"([^]*?)"+hd(we),"gm");Pe=Pe.replace(ze,"");var Fe=Pe.split("\r"),Be=Pe.split(`
`),He=Be.length>1&&Be[0].length<Fe[0].length;if(Fe.length===1||He)return`
`;for(var We=0,_t=0;_t<Fe.length;_t++)Fe[_t][0]===`
`&&We++;return We>=Fe.length/2?`\r
`:"\r"}function Ee(Pe,we,ze,Fe){A.errors.push({type:Pe,code:we,message:ze,row:Fe})}}function hd(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function C1(t){t=t||{};var e=t.delimiter,n=t.newline,r=t.comments,o=t.step,l=t.preview,a=t.fastMode,d;t.quoteChar===void 0?d='"':d=t.quoteChar;var g=d;if(t.escapeChar!==void 0&&(g=t.escapeChar),(typeof e!="string"||cs.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),r===e)throw new Error("Comment character same as delimiter");r===!0?r="#":(typeof r!="string"||cs.BAD_DELIMITERS.indexOf(r)>-1)&&(r=!1),n!==`
`&&n!=="\r"&&n!==`\r
`&&(n=`
`);var x=0,E=!1;this.parse=function(P,A,R){if(typeof P!="string")throw new Error("Input must be a string");var j=P.length,X=e.length,D=n.length,F=r.length,W=to(o);x=0;var J=[],le=[],ue=[],ye=0;if(!P)return Jt();if(a||a!==!1&&P.indexOf(d)===-1){for(var Ee=P.split(n),Pe=0;Pe<Ee.length;Pe++){if(ue=Ee[Pe],x+=ue.length,Pe!==Ee.length-1)x+=n.length;else if(R)return Jt();if(!(r&&ue.substr(0,F)===r)){if(W){if(J=[],pn(ue.split(e)),dn(),E)return Jt()}else pn(ue.split(e));if(l&&Pe>=l)return J=J.slice(0,l),Jt(!0)}}return Jt()}for(var we=P.indexOf(e,x),ze=P.indexOf(n,x),Fe=new RegExp(hd(g)+hd(d),"g"),Be;;){if(P[x]===d){for(Be=x,x++;;){if(Be=P.indexOf(d,Be+1),Be===-1)return R||le.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:J.length,index:x}),Tn();if(Be===j-1){var He=P.substring(x,Be).replace(Fe,d);return Tn(He)}if(d===g&&P[Be+1]===g){Be++;continue}if(!(d!==g&&Be!==0&&P[Be-1]===g)){var We=ze===-1?we:Math.min(we,ze),_t=$n(We);if(P[Be+1+_t]===e){if(ue.push(P.substring(x,Be).replace(Fe,d)),x=Be+1+_t+X,we=P.indexOf(e,x),ze=P.indexOf(n,x),W&&(dn(),E))return Jt();if(l&&J.length>=l)return Jt(!0);break}var gn=$n(ze);if(P.substr(Be+1+gn,D)===n){if(ue.push(P.substring(x,Be).replace(Fe,d)),lr(Be+1+gn+D),we=P.indexOf(e,x),W&&(dn(),E))return Jt();if(l&&J.length>=l)return Jt(!0);break}le.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:J.length,index:x}),Be++}}if(W&&(dn(),E))return Jt();if(l&&J.length>=l)return Jt(!0);continue}if(r&&ue.length===0&&P.substr(x,F)===r){if(ze===-1)return Jt();x=ze+D,ze=P.indexOf(n,x),we=P.indexOf(e,x);continue}if(we!==-1&&(we<ze||ze===-1)){ue.push(P.substring(x,we)),x=we+X,we=P.indexOf(e,x);continue}if(ze!==-1){if(ue.push(P.substring(x,ze)),lr(ze+D),W&&(dn(),E))return Jt();if(l&&J.length>=l)return Jt(!0);continue}break}return Tn();function pn(An){J.push(An),ye=x}function $n(An){var et=0;if(An!==-1){var yt=P.substring(Be+1,An);yt&&yt.trim()===""&&(et=yt.length)}return et}function Tn(An){return R||(typeof An>"u"&&(An=P.substr(x)),ue.push(An),x=j,pn(ue),W&&dn()),Jt()}function lr(An){x=An,pn(ue),ue=[],ze=P.indexOf(n,x)}function Jt(An,et){var yt=et||!1;return{data:yt?J[0]:J,errors:le,meta:{delimiter:e,linebreak:n,aborted:E,truncated:!!An,cursor:ye+(A||0)}}}function dn(){o(Jt(void 0,!0)),J=[],le=[]}},this.abort=function(){E=!0},this.getCharIndex=function(){return x}}function mb(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var n in t)e[n]=mb(t[n]);return e}function to(t){return typeof t=="function"}const{ChunkStreamer:zM}=lv;function ky(t){t=t||{},zM.call(this,t),this.textDecoder=new TextDecoder(this._config.encoding),this.stream=async function(e){this._input=e;try{for await(const n of e)this.parseChunk(this.getStringChunk(n));this._finished=!0,this.parseChunk("")}catch(n){this._sendError(n)}},this._nextChunk=function(){},this.getStringChunk=function(e){return typeof e=="string"?e:this.textDecoder.decode(e,{stream:!0})}}ky.prototype=Object.create(zM.prototype);ky.prototype.constructor=ky;const V7="3.3.0-alpha.10",gb={csv:{shape:"object-row-table",optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}},j7={id:"csv",module:"csv",name:"CSV",version:V7,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(t,e)=>VS(new TextDecoder().decode(t),e),parseText:(t,e)=>VS(t,e),parseInBatches:G7,options:gb};async function VS(t,e){const n={...gb.csv,...e==null?void 0:e.csv},r=W7(t),l=n.header==="auto"?DM(r):Boolean(n.header),a={...n,header:l,download:!1,transformHeader:l?FM():void 0,error:E=>{throw new Error(E)}},d=lv.parse(t,a);let{data:g}=d;const x=d.meta.fields||NM(n.columnPrefix,r.length);switch(n.shape){case"object-row-table":g=g.map(E=>Array.isArray(E)?MM(E,x):E);break;case"array-row-table":g=g.map(E=>Array.isArray(E)?E:kM(E,x));break}return g}function G7(t,e){var n;e={...e},e.batchSize==="auto"&&(e.batchSize=4e3);const r={...gb.csv,...(n=e)===null||n===void 0?void 0:n.csv},o=new N7;let l=!0,a=null,d=null,g=null;const x={...r,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(E){let P=E.data;if(r.skipEmptyLines&&P.flat().join("").trim()==="")return;const A=E.meta.cursor;if(l&&!a&&(r.header==="auto"?DM(P):Boolean(r.header))){a=P.map(FM());return}l&&(l=!1,a||(a=NM(r.columnPrefix,P.length)),g=H7(P,a)),r.optimizeMemoryUsage&&(P=JSON.parse(JSON.stringify(P))),d=d||new cd(g,{shape:r.shape||"array-row-table",...e});try{d.addRow(P);const R=d&&d.getFullBatch({bytesUsed:A});R&&o.enqueue(R)}catch(R){o.enqueue(R)}},complete(E){try{const P=E.meta.cursor,A=d&&d.getFinalBatch({bytesUsed:P});A&&o.enqueue(A)}catch(P){o.enqueue(P)}o.close()}};return lv.parse(t,x,ky),o}function DM(t){return t&&t.every(e=>typeof e=="string")}function W7(t){return lv.parse(t,{download:!1,dynamicTyping:!0,preview:1}).data[0]}function FM(){const t=new Set;return e=>{let n=e,r=1;for(;t.has(n);)n="".concat(e,".").concat(r),r++;return t.add(n),n}}function NM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=[];for(let r=0;r<e;r++)n.push("".concat(t).concat(r+1));return n}function H7(t,e){const n=e?{}:[];for(let r=0;r<t.length;r++){const o=e&&e[r]||r;switch(typeof t[r]){case"number":case"boolean":n[o]={name:String(o),index:r,type:Float32Array};break;case"string":default:n[o]={name:String(o),index:r,type:Array}}}return n}function BM(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function q7(t){return t.length===1&&(t=Z7(t)),{left:function(e,n,r,o){for(r==null&&(r=0),o==null&&(o=e.length);r<o;){var l=r+o>>>1;t(e[l],n)<0?r=l+1:o=l}return r},right:function(e,n,r,o){for(r==null&&(r=0),o==null&&(o=e.length);r<o;){var l=r+o>>>1;t(e[l],n)>0?o=l:r=l+1}return r}}}function Z7(t){return function(e,n){return BM(t(e),n)}}var $7=q7(BM),X7=$7.right,I1=Math.sqrt(50),M1=Math.sqrt(10),k1=Math.sqrt(2);function Y7(t,e,n){var r,o=-1,l,a,d;if(e=+e,t=+t,n=+n,t===e&&n>0)return[t];if((r=e<t)&&(l=t,t=e,e=l),(d=Og(t,e,n))===0||!isFinite(d))return[];if(d>0)for(t=Math.ceil(t/d),e=Math.floor(e/d),a=new Array(l=Math.ceil(e-t+1));++o<l;)a[o]=(t+o)*d;else for(t=Math.floor(t*d),e=Math.ceil(e*d),a=new Array(l=Math.ceil(t-e+1));++o<l;)a[o]=(t-o)/d;return r&&a.reverse(),a}function Og(t,e,n){var r=(e-t)/Math.max(0,n),o=Math.floor(Math.log(r)/Math.LN10),l=r/Math.pow(10,o);return o>=0?(l>=I1?10:l>=M1?5:l>=k1?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(l>=I1?10:l>=M1?5:l>=k1?2:1)}function K7(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),o=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),l=r/o;return l>=I1?o*=10:l>=M1?o*=5:l>=k1&&(o*=2),e<t?-o:o}function J7(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}var ea="$";function Ly(){}Ly.prototype=UM.prototype={constructor:Ly,has:function(t){return ea+t in this},get:function(t){return this[ea+t]},set:function(t,e){return this[ea+t]=e,this},remove:function(t){var e=ea+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===ea&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===ea&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===ea&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===ea&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===ea&&++t;return t},empty:function(){for(var t in this)if(t[0]===ea)return!1;return!0},each:function(t){for(var e in this)e[0]===ea&&t(this[e],e.slice(1),this)}};function UM(t,e){var n=new Ly;if(t instanceof Ly)t.each(function(d,g){n.set(g,d)});else if(Array.isArray(t)){var r=-1,o=t.length,l;if(e==null)for(;++r<o;)n.set(r,t[r]);else for(;++r<o;)n.set(e(l=t[r],r,t),l)}else if(t)for(var a in t)n.set(a,t[a]);return n}function jS(){}var Ou=UM.prototype;jS.prototype={constructor:jS,has:Ou.has,add:function(t){return t+="",this[ea+t]=t,this},remove:Ou.remove,clear:Ou.clear,values:Ou.keys,size:Ou.size,empty:Ou.empty,each:Ou.each};var VM=Array.prototype,Q7=VM.map,GS=VM.slice;function yb(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function jM(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Rd(){}var fd=.7,Ry=1/fd,zh="\\s*([+-]?\\d+)\\s*",pd="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ps="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",eW=/^#([0-9a-f]{3,8})$/,tW=new RegExp("^rgb\\("+[zh,zh,zh]+"\\)$"),nW=new RegExp("^rgb\\("+[ps,ps,ps]+"\\)$"),rW=new RegExp("^rgba\\("+[zh,zh,zh,pd]+"\\)$"),iW=new RegExp("^rgba\\("+[ps,ps,ps,pd]+"\\)$"),oW=new RegExp("^hsl\\("+[pd,ps,ps]+"\\)$"),aW=new RegExp("^hsla\\("+[pd,ps,ps,pd]+"\\)$"),WS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};yb(Rd,dd,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:HS,formatHex:HS,formatHsl:sW,formatRgb:qS,toString:qS});function HS(){return this.rgb().formatHex()}function sW(){return GM(this).formatHsl()}function qS(){return this.rgb().formatRgb()}function dd(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=eW.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?ZS(e):n===3?new Fo(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?ug(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?ug(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=tW.exec(t))?new Fo(e[1],e[2],e[3],1):(e=nW.exec(t))?new Fo(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=rW.exec(t))?ug(e[1],e[2],e[3],e[4]):(e=iW.exec(t))?ug(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=oW.exec(t))?YS(e[1],e[2]/100,e[3]/100,1):(e=aW.exec(t))?YS(e[1],e[2]/100,e[3]/100,e[4]):WS.hasOwnProperty(t)?ZS(WS[t]):t==="transparent"?new Fo(NaN,NaN,NaN,0):null}function ZS(t){return new Fo(t>>16&255,t>>8&255,t&255,1)}function ug(t,e,n,r){return r<=0&&(t=e=n=NaN),new Fo(t,e,n,r)}function lW(t){return t instanceof Rd||(t=dd(t)),t?(t=t.rgb(),new Fo(t.r,t.g,t.b,t.opacity)):new Fo}function L1(t,e,n,r){return arguments.length===1?lW(t):new Fo(t,e,n,r??1)}function Fo(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}yb(Fo,L1,jM(Rd,{brighter:function(t){return t=t==null?Ry:Math.pow(Ry,t),new Fo(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?fd:Math.pow(fd,t),new Fo(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$S,formatHex:$S,formatRgb:XS,toString:XS}));function $S(){return"#"+H_(this.r)+H_(this.g)+H_(this.b)}function XS(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function H_(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function YS(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new is(t,e,n,r)}function GM(t){if(t instanceof is)return new is(t.h,t.s,t.l,t.opacity);if(t instanceof Rd||(t=dd(t)),!t)return new is;if(t instanceof is)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,o=Math.min(e,n,r),l=Math.max(e,n,r),a=NaN,d=l-o,g=(l+o)/2;return d?(e===l?a=(n-r)/d+(n<r)*6:n===l?a=(r-e)/d+2:a=(e-n)/d+4,d/=g<.5?l+o:2-l-o,a*=60):d=g>0&&g<1?0:a,new is(a,d,g,t.opacity)}function uW(t,e,n,r){return arguments.length===1?GM(t):new is(t,e,n,r??1)}function is(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}yb(is,uW,jM(Rd,{brighter:function(t){return t=t==null?Ry:Math.pow(Ry,t),new is(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?fd:Math.pow(fd,t),new is(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,o=2*n-r;return new Fo(q_(t>=240?t-240:t+120,o,r),q_(t,o,r),q_(t<120?t+240:t-120,o,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function q_(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}function vb(t){return function(){return t}}function cW(t,e){return function(n){return t+n*e}}function hW(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function fW(t){return(t=+t)==1?WM:function(e,n){return n-e?hW(e,n,t):vb(isNaN(e)?n:e)}}function WM(t,e){var n=e-t;return n?cW(t,n):vb(isNaN(t)?e:t)}const KS=function t(e){var n=fW(e);function r(o,l){var a=n((o=L1(o)).r,(l=L1(l)).r),d=n(o.g,l.g),g=n(o.b,l.b),x=WM(o.opacity,l.opacity);return function(E){return o.r=a(E),o.g=d(E),o.b=g(E),o.opacity=x(E),o+""}}return r.gamma=t,r}(1);function pW(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),o;return function(l){for(o=0;o<n;++o)r[o]=t[o]*(1-l)+e[o]*l;return r}}function dW(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function mW(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,o=new Array(r),l=new Array(n),a;for(a=0;a<r;++a)o[a]=_b(t[a],e[a]);for(;a<n;++a)l[a]=e[a];return function(d){for(a=0;a<r;++a)l[a]=o[a](d);return l}}function gW(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Oy(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function yW(t,e){var n={},r={},o;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(o in e)o in t?n[o]=_b(t[o],e[o]):r[o]=e[o];return function(l){for(o in n)r[o]=n[o](l);return r}}var R1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Z_=new RegExp(R1.source,"g");function vW(t){return function(){return t}}function _W(t){return function(e){return t(e)+""}}function xW(t,e){var n=R1.lastIndex=Z_.lastIndex=0,r,o,l,a=-1,d=[],g=[];for(t=t+"",e=e+"";(r=R1.exec(t))&&(o=Z_.exec(e));)(l=o.index)>n&&(l=e.slice(n,l),d[a]?d[a]+=l:d[++a]=l),(r=r[0])===(o=o[0])?d[a]?d[a]+=o:d[++a]=o:(d[++a]=null,g.push({i:a,x:Oy(r,o)})),n=Z_.lastIndex;return n<e.length&&(l=e.slice(n),d[a]?d[a]+=l:d[++a]=l),d.length<2?g[0]?_W(g[0].x):vW(e):(e=g.length,function(x){for(var E=0,P;E<e;++E)d[(P=g[E]).i]=P.x(x);return d.join("")})}function _b(t,e){var n=typeof e,r;return e==null||n==="boolean"?vb(e):(n==="number"?Oy:n==="string"?(r=dd(e))?(e=r,KS):xW:e instanceof dd?KS:e instanceof Date?gW:dW(e)?pW:Array.isArray(e)?mW:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?yW:Oy)(t,e)}function bW(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function wW(t){return function(){return t}}function EW(t){return+t}var JS=[0,1];function Th(t){return t}function O1(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:wW(isNaN(e)?NaN:.5)}function QS(t){var e=t[0],n=t[t.length-1],r;return e>n&&(r=e,e=n,n=r),function(o){return Math.max(e,Math.min(n,o))}}function TW(t,e,n){var r=t[0],o=t[1],l=e[0],a=e[1];return o<r?(r=O1(o,r),l=n(a,l)):(r=O1(r,o),l=n(l,a)),function(d){return l(r(d))}}function SW(t,e,n){var r=Math.min(t.length,e.length)-1,o=new Array(r),l=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)o[a]=O1(t[a],t[a+1]),l[a]=n(e[a],e[a+1]);return function(d){var g=X7(t,d,1,r)-1;return l[g](o[g](d))}}function PW(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function AW(){var t=JS,e=JS,n=_b,r,o,l,a=Th,d,g,x;function E(){return d=Math.min(t.length,e.length)>2?SW:TW,g=x=null,P}function P(A){return isNaN(A=+A)?l:(g||(g=d(t.map(r),e,n)))(r(a(A)))}return P.invert=function(A){return a(o((x||(x=d(e,t.map(r),Oy)))(A)))},P.domain=function(A){return arguments.length?(t=Q7.call(A,EW),a===Th||(a=QS(t)),E()):t.slice()},P.range=function(A){return arguments.length?(e=GS.call(A),E()):e.slice()},P.rangeRound=function(A){return e=GS.call(A),n=bW,E()},P.clamp=function(A){return arguments.length?(a=A?QS(t):Th,P):a!==Th},P.interpolate=function(A){return arguments.length?(n=A,E()):n},P.unknown=function(A){return arguments.length?(l=A,P):l},function(A,R){return r=A,o=R,E()}}function CW(t,e){return AW()(t,e)}function zy(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Jh(t){return t=zy(Math.abs(t)),t?t[1]:NaN}function IW(t,e){return function(n,r){for(var o=n.length,l=[],a=0,d=t[0],g=0;o>0&&d>0&&(g+d+1>r&&(d=Math.max(1,r-g)),l.push(n.substring(o-=d,o+d)),!((g+=d+1)>r));)d=t[a=(a+1)%t.length];return l.reverse().join(e)}}function MW(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var kW=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Dy(t){if(!(e=kW.exec(t)))throw new Error("invalid format: "+t);var e;return new xb({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Dy.prototype=xb.prototype;function xb(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}xb.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function LW(t){e:for(var e=t.length,n=1,r=-1,o;n<e;++n)switch(t[n]){case".":r=o=n;break;case"0":r===0&&(r=n),o=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(o+1):t}var HM;function RW(t,e){var n=zy(t,e);if(!n)return t+"";var r=n[0],o=n[1],l=o-(HM=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,a=r.length;return l===a?r:l>a?r+new Array(l-a+1).join("0"):l>0?r.slice(0,l)+"."+r.slice(l):"0."+new Array(1-l).join("0")+zy(t,Math.max(0,e+l-1))[0]}function eP(t,e){var n=zy(t,e);if(!n)return t+"";var r=n[0],o=n[1];return o<0?"0."+new Array(-o).join("0")+r:r.length>o+1?r.slice(0,o+1)+"."+r.slice(o+1):r+new Array(o-r.length+2).join("0")}const tP={"%":function(t,e){return(t*100).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return eP(t*100,e)},r:eP,s:RW,X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function nP(t){return t}var rP=Array.prototype.map,iP=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function OW(t){var e=t.grouping===void 0||t.thousands===void 0?nP:IW(rP.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",o=t.decimal===void 0?".":t.decimal+"",l=t.numerals===void 0?nP:MW(rP.call(t.numerals,String)),a=t.percent===void 0?"%":t.percent+"",d=t.minus===void 0?"-":t.minus+"",g=t.nan===void 0?"NaN":t.nan+"";function x(P){P=Dy(P);var A=P.fill,R=P.align,j=P.sign,X=P.symbol,D=P.zero,F=P.width,W=P.comma,J=P.precision,le=P.trim,ue=P.type;ue==="n"?(W=!0,ue="g"):tP[ue]||(J===void 0&&(J=12),le=!0,ue="g"),(D||A==="0"&&R==="=")&&(D=!0,A="0",R="=");var ye=X==="$"?n:X==="#"&&/[boxX]/.test(ue)?"0"+ue.toLowerCase():"",Ee=X==="$"?r:/[%p]/.test(ue)?a:"",Pe=tP[ue],we=/[defgprs%]/.test(ue);J=J===void 0?6:/[gprs]/.test(ue)?Math.max(1,Math.min(21,J)):Math.max(0,Math.min(20,J));function ze(Fe){var Be=ye,He=Ee,We,_t,gn;if(ue==="c")He=Pe(Fe)+He,Fe="";else{Fe=+Fe;var pn=Fe<0||1/Fe<0;if(Fe=isNaN(Fe)?g:Pe(Math.abs(Fe),J),le&&(Fe=LW(Fe)),pn&&+Fe==0&&j!=="+"&&(pn=!1),Be=(pn?j==="("?j:d:j==="-"||j==="("?"":j)+Be,He=(ue==="s"?iP[8+HM/3]:"")+He+(pn&&j==="("?")":""),we){for(We=-1,_t=Fe.length;++We<_t;)if(gn=Fe.charCodeAt(We),48>gn||gn>57){He=(gn===46?o+Fe.slice(We+1):Fe.slice(We))+He,Fe=Fe.slice(0,We);break}}}W&&!D&&(Fe=e(Fe,1/0));var $n=Be.length+Fe.length+He.length,Tn=$n<F?new Array(F-$n+1).join(A):"";switch(W&&D&&(Fe=e(Tn+Fe,Tn.length?F-He.length:1/0),Tn=""),R){case"<":Fe=Be+Fe+He+Tn;break;case"=":Fe=Be+Tn+Fe+He;break;case"^":Fe=Tn.slice(0,$n=Tn.length>>1)+Be+Fe+He+Tn.slice($n);break;default:Fe=Tn+Be+Fe+He;break}return l(Fe)}return ze.toString=function(){return P+""},ze}function E(P,A){var R=x((P=Dy(P),P.type="f",P)),j=Math.max(-8,Math.min(8,Math.floor(Jh(A)/3)))*3,X=Math.pow(10,-j),D=iP[8+j/3];return function(F){return R(X*F)+D}}return{format:x,formatPrefix:E}}var cg,qM,ZM;zW({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function zW(t){return cg=OW(t),qM=cg.format,ZM=cg.formatPrefix,cg}function DW(t){return Math.max(0,-Jh(Math.abs(t)))}function FW(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Jh(e)/3)))*3-Jh(Math.abs(t)))}function NW(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Jh(e)-Jh(t))+1}function BW(t,e,n,r){var o=K7(t,e,n),l;switch(r=Dy(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(l=FW(o,a))&&(r.precision=l),ZM(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(l=NW(o,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=l-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(l=DW(o))&&(r.precision=l-(r.type==="%")*2);break}}return qM(r)}function UW(t){var e=t.domain;return t.ticks=function(n){var r=e();return Y7(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var o=e();return BW(o[0],o[o.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),o=0,l=r.length-1,a=r[o],d=r[l],g;return d<a&&(g=a,a=d,d=g,g=o,o=l,l=g),g=Og(a,d,n),g>0?(a=Math.floor(a/g)*g,d=Math.ceil(d/g)*g,g=Og(a,d,n)):g<0&&(a=Math.ceil(a*g)/g,d=Math.floor(d*g)/g,g=Og(a,d,n)),g>0?(r[o]=Math.floor(a/g)*g,r[l]=Math.ceil(d/g)*g,e(r)):g<0&&(r[o]=Math.ceil(a*g)/g,r[l]=Math.floor(d*g)/g,e(r)),t},t}function $M(){var t=CW(Th,Th);return t.copy=function(){return PW(t,$M())},J7.apply(t,arguments),UW(t)}const VW="./geonames-sm.csv",oP={latitude:39.1,longitude:-94.57,zoom:3.8,maxZoom:16,pitch:0,bearing:0},jW="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json",GW=$M().domain([3,4,5,6,7]).range([[29,145,192],[65,182,196],[127,205,187],[199,233,180],[237,248,177]]);function WW({data:t=VW,cluster:e=!0,fontSize:n=32,mapStyle:r=jW}){const[o,l]=st.useState(oP.zoom),a=st.useCallback(({viewState:P})=>{l(P.zoom)},[]),d=2**o,g=d/3*n,x=Math.min(d/1e3,.5)*n,E=new pb({id:"world-cities",data:t,characterSet:"auto",fontSettings:{buffer:8},getText:P=>P.name,getPosition:P=>[P.longitude,P.latitude],getColor:P=>GW(Math.log10(P.population)),getSize:P=>Math.pow(P.population,.25)/40,sizeScale:n,sizeMaxPixels:g,sizeMinPixels:x,maxWidth:64*12,collideEnabled:e,getCollidePriority:P=>Math.log10(P.population),collideTestProps:{background:!0,sizeScale:n*2,sizeMaxPixels:g*2,sizeMinPixels:x*2,backgroundPadding:8},extensions:[new db],loaders:[j7]});return K_.createElement(jG,{views:new nb({repeat:!0}),layers:[E],initialViewState:oP,onViewStateChange:a,controller:{dragRotate:!1}},K_.createElement(ic,{reuseMaps:!0,mapStyle:r,preventStyleDiffing:!0}))}function HW(t){J_.render(K_.createElement(WW,null),t)}HW(document.getElementById("app"))});export default qW();
