(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{138:function(e){e.exports={"san-francisco":{viewState:{longitude:-122.4192016,latitude:37.7751543,zoom:13,pitch:0,bearing:0},sourceIndex:311},"new-york":{sourceIndex:58689,viewState:{longitude:-73.9963128,latitude:40.7512821,zoom:13,pitch:0,bearing:0}},seattle:{sourceIndex:164774,viewState:{latitude:47.6098543,longitude:-122.3350119,zoom:13,pitch:0,bearing:0}},nairobi:{sourceIndex:66128,viewState:{longitude:36.8382651,latitude:-1.2575046,zoom:13,pitch:0,bearing:0}}}},215:function(e,t,n){e.exports=n(310)},220:function(e,t,n){},304:function(e,t){},310:function(e,t,n){"use strict";n.r(t);var i=n(4),o=n.n(i),a=n(105),r=n.n(a),s=(n(220),n(84)),u=n.n(s),c=n(115),d=n(198),l=n(50),f=n(197),h=n(135),g=n(137),v=n(136),m=n(138),p=n(139),b=n(191),x=n(127),y=n(192),w=[{value:"cincinnati",label:"Cincinnati"},{value:"london",label:"London"},{value:"nairobi",label:"Nairobi"},{value:"new-york",label:"New York"},{value:"san-francisco",label:"San Francisco"},{value:"seattle",label:"Seattle"}],C=[{value:0,label:"Base Map"},{value:1,label:"Node Distance"},{value:2,label:"Average Speed"},{value:3,label:"Isochronic Map"}],_=function(e){var t=e.city,n=e.mapType,i=e.setMapType,a=e.hour,r=e.setHour,s=e.setCity;return o.a.createElement(b.Block,{className:"controls",style:{position:"fixed",top:20,left:20,padding:20,width:"200px",backgroundColor:"white",border:"1px solid #eee"}},o.a.createElement(x.FormControl,{label:"City"},o.a.createElement(p.Select,{value:[w.find(function(e){return e.value===t})],clearable:!1,options:w,labelKey:"label",valueKey:"value",onChange:function(e){var t=e.value;s(t[0].value)}})),o.a.createElement(x.FormControl,{label:"Map Type"},o.a.createElement(p.Select,{value:[C.find(function(e){return e.value===n})],clearable:!1,options:C,labelKey:"label",valueKey:"value",onChange:function(e){var t=e.value;i(t[0].value)}})),o.a.createElement(x.FormControl,{label:"Hour"},o.a.createElement(y.Slider,{min:0,max:23,step:1,value:[a],onChange:function(e){var t=e.value;return r(Number(t))}})))},T=n(317),P=n(38),O=n(39),B=n(82),S=n(36),E=n(65),I=n(83),V=n(19),A=n(188),j=n(49),k=n(21),R=n.n(k),D=n(55),F=n(7),L=512,M={1:R.a.R32F,2:R.a.RG32F,3:R.a.RGB32F,4:R.a.RGBA32F},N={1:R.a.RED,2:R.a.RG,3:R.a.RGB,4:R.a.RGBA};function z(e){var t;return{width:L,height:(t=e/L,Math.pow(2,Math.max(0,Math.ceil(Math.log2(t)))))}}function G(e,t){var n;return new F.j(e,{data:null,format:M[t],type:R.a.FLOAT,border:0,mipmaps:!1,parameters:(n={},Object(D.a)(n,R.a.TEXTURE_MAG_FILTER,R.a.NEAREST),Object(D.a)(n,R.a.TEXTURE_MIN_FILTER,R.a.NEAREST),n),dataFormat:N[t],width:1,height:1})}var H=function(){function e(t){Object(P.a)(this,e);var n=[G(t,4),G(t,4)],i=new F.c(t,{byteLength:4,accessor:{size:1,type:R.a.FLOAT}}),o=new F.g(t,{id:"".concat(this.id||"transform","-framebuffer-0"),width:1,height:1,attachments:Object(D.a)({},R.a.COLOR_ATTACHMENT0,n[0])});this.gl=t,this.nodeValueTexture=null,this.nodeValueTextures=n,this.nodeValueFramebuffer=o,this.nodeValueBuffer=i,this._model=this._getModel(t),this._swapTexture=!1}return Object(O.a)(e,[{key:"update",value:function(e){var t=e.nodeCount,n=e.edgeCount,i=e.attributes,o=z(t);this.nodeValueFramebuffer.resize(o),this.nodeValueBuffer.reallocate(o.width*o.height*4*4),this._model.setVertexCount(n),this._model.setAttributes({edgeSourceIndices:i.edgeSourceIndices,edgeTargetIndices:i.edgeTargetIndices,edgeValues:i.edgeValues}),this._model.setUniforms({textureDims:[o.width,o.height]})}},{key:"reset",value:function(e){var t,n=this.gl,i=this.nodeValueFramebuffer,o=this.nodeValueTextures,a=!0,r=!1,s=void 0;try{for(var u,c=o[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var d=u.value;i.attach(Object(D.a)({},R.a.COLOR_ATTACHMENT0,d)),Object(F.m)(n,{framebuffer:i,color:[1e6,1e6,1e6,0]}),d.setSubImageData(Object(l.a)({data:new Float32Array([0,0,0,0])},{x:(t=e)%L,y:Math.floor(t/L)},{width:1,height:1}))}}catch(f){r=!0,s=f}finally{try{a||null==c.return||c.return()}finally{if(r)throw s}}}},{key:"run",value:function(){var e=this._swapTexture,t=this.nodeValueFramebuffer,n=this.nodeValueTextures,i=this.nodeValueBuffer,o=this._model,a=n[e?0:1],r=n[e?1:0];t.attach(Object(D.a)({},R.a.COLOR_ATTACHMENT0,r)),o.draw({framebuffer:t,parameters:{viewport:[0,0,r.width,r.height],blend:!0,blendFunc:[R.a.ONE,R.a.ONE,R.a.ONE,R.a.ONE],blendEquation:[R.a.MIN,R.a.MAX],depthMask:!1,depthTest:!1},uniforms:{nodeValueSampler:a}}),Object(F.x)(t,{target:i,sourceFormat:R.a.RGBA,sourceType:R.a.FLOAT}),this.nodeValueTexture=r,this._swapTexture=!this._swapTexture}},{key:"_getModel",value:function(e){return new F.i(e,{vs:"#version 300 es\n\nuniform vec2 textureDims;\nuniform sampler2D nodeValueSampler;\n\nin float edgeSourceIndices;\nin float edgeTargetIndices;\nin vec3 edgeValues;\n\nout vec3 value;\n\nivec2 getVexelCoord(float index) {\n  float y = floor(index / textureDims.x);\n  float x = index - textureDims.x * y;\n  return ivec2(x, y);\n}\n\nvec2 getTexCoord(float index) {\n  vec2 texCoord = vec2(getVexelCoord(index)) + 0.5;\n  texCoord /= textureDims;\n\n  return texCoord;\n}\n\nvoid main() {\n  vec2 texCoord = getTexCoord(edgeTargetIndices);\n  gl_Position = vec4(texCoord * 2.0 - 1.0, 0.0, 1.0);\n\n  vec3 sourceValue = texelFetch(nodeValueSampler, getVexelCoord(edgeSourceIndices), 0).rgb;\n  value = sourceValue + edgeValues;\n}\n      ",fs:"#version 300 es\nprecision highp float;\n#define MAX_VALUE 1000000.0\n\nin vec3 value;\nout vec4 color;\n\nvoid main() {\n  if (value.r >= MAX_VALUE) {\n    discard;\n  }\n  color = vec4(value, 1.0);\n}\n      ",drawMode:R.a.POINTS})}}]),e}(),U=function(){function e(t){Object(P.a)(this,e),this._sourcePositionsBuffer=[new F.c(t,{accessor:{size:3},byteLength:12}),new F.c(t,{accessor:{size:3},byteLength:12})],this._targetPositionsBuffer=[new F.c(t,{accessor:{size:3},byteLength:12}),new F.c(t,{accessor:{size:3},byteLength:12})],this._validityBuffer=[new F.c(t,{accessor:{size:1},byteLength:4}),new F.c(t,{accessor:{size:1},byteLength:4})],this.nodePositionsTexture=G(t,4),this._swapBuffer=!1,this._transform=this._getTransform(t),this._bufferChanged=!1,this.gl=t}return Object(O.a)(e,[{key:"reset",value:function(e){this._bufferChanged&&this.update()}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.nodeCount,n=void 0===t?this._nodeCount:t,i=e.edgeCount,o=void 0===i?this._edgeCount:i,a=e.attributes,r=void 0===a?this._attributes:a;this._swapBuffer=!this._swapBuffer,this._nodeCount=n,this._edgeCount=o,this._attributes=r;var s=this.nodePositionsTexture,u=this.sourcePositionsBuffer,c=this.targetPositionsBuffer,d=this.validityBuffer;s.resize(z(n)),u.reallocate(3*o*4),c.reallocate(3*o*4),d.reallocate(4*o),this._transform.update({sourceBuffers:{edgeSourceIndices:r.edgeSourceIndices,edgeTargetIndices:r.edgeTargetIndices},feedbackBuffers:{sourcePositions:this.sourcePositionsBuffer,targetPositions:this.targetPositionsBuffer,isValid:this.validityBuffer},elementCount:o}),this._bufferChanged=!1}},{key:"run",value:function(e){var t=e.nodePositionsBuffer,n=this._transform,i=this.nodePositionsTexture;i.setSubImageData({data:t}),n.run({uniforms:{nodePositions:i,textureDims:[i.width,i.height]}}),this._bufferChanged=!0}},{key:"_getTransform",value:function(e){return new F.k(e,{vs:"#version 300 es\nin float edgeSourceIndices;\nin float edgeTargetIndices;\n\nuniform sampler2D nodePositions;\nuniform vec2 textureDims;\n\nout vec3 sourcePositions;\nout vec3 targetPositions;\nout float isValid;\n\nivec2 getVexelCoord(float index) {\n  float y = floor(index / textureDims.x);\n  float x = index - textureDims.x * y;\n  return ivec2(x, y);\n}\n\nvoid main() {\n  ivec2 sourceCoord = getVexelCoord(edgeSourceIndices);\n  ivec2 targetoord = getVexelCoord(edgeTargetIndices);\n\n  vec4 source = texelFetch(nodePositions, sourceCoord, 0);\n  vec4 target = texelFetch(nodePositions, targetoord, 0);\n\n  sourcePositions = source.rgb;\n  targetPositions = target.rgb;\n\n  isValid = source.a * target.a;\n}\n",varyings:["sourcePositions","targetPositions","isValid"],elementCount:1,feedbackBuffers:{sourcePositions:this.sourcePositionsBuffer,targetPositions:this.targetPositionsBuffer,isValid:this.validityBuffer}})}},{key:"sourcePositionsBuffer",get:function(){return this._sourcePositionsBuffer[this._swapBuffer?1:0]}},{key:"targetPositionsBuffer",get:function(){return this._targetPositionsBuffer[this._swapBuffer?1:0]}},{key:"validityBuffer",get:function(){return this._validityBuffer[this._swapBuffer?1:0]}}]),e}(),K=[120,300,600,900,1200,1800,2700,3600],W=function(){function e(t){Object(P.a)(this,e),this._nodePositionsBuffer=[new F.c(t,{accessor:{size:4},byteLength:12}),new F.c(t,{accessor:{size:4},byteLength:12})],this._nodeColorsBuffer=[new F.c(t,{accessor:{size:4},byteLength:16}),new F.c(t,{accessor:{size:4},byteLength:16})],this._nodeRadiusBuffer=[new F.c(t,{accessor:{size:1},byteLength:4}),new F.c(t,{accessor:{size:1},byteLength:4})],this._swapBuffer=!1,this._bufferChanged=!1,this._transform=this._getTransform(t),this.gl=t}return Object(O.a)(e,[{key:"reset",value:function(e){this._sourcePosition=this._transform.sourceBuffers[0].nodePositions.value.slice(2*e,2*e+2),this._bufferChanged&&this.update()}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.nodeCount,n=void 0===t?this._nodeCount:t,i=e.attributes,o=void 0===i?this._attributes:i;this._swapBuffer=!this._swapBuffer,this._nodeCount=n,this._attributes=o;var a=z(n);this.nodePositionsBuffer.reallocate(a.width*a.height*4*4),this.nodeColorsBuffer.reallocate(a.width*a.height*4*4),this.nodeRadiusBuffer.reallocate(a.width*a.height*4),this._transform.update({sourceBuffers:{nodePositions:o.nodePositions,nodeIndices:o.nodeIndices},feedbackBuffers:{position:this.nodePositionsBuffer,color:this.nodeColorsBuffer,radius:this.nodeRadiusBuffer},elementCount:n}),this._bufferChanged=!1}},{key:"run",value:function(e){var t=e.moduleParameters,n=e.mode,i=e.nodeValueTexture,o=e.distortion;this._transform.model.updateModuleSettings(t),this._transform.run({uniforms:{sourcePosition:this._sourcePosition,nodeValues:i,mode:n,distortion:o,textureDims:[i.width,i.height]}}),this._bufferChanged=!0}},{key:"_getTransform",value:function(e){return new F.k(e,{vs:"#version 300 es\n\n#define MODE_NONE 0\n#define MODE_NODE_DISTANCE 1\n#define MODE_TRAFFIC 2\n#define MODE_ISOCHRONIC 3\n\nin vec2 nodePositions;\nin float nodeIndices;\n\nuniform int mode;\nuniform sampler2D nodeValues;\nuniform vec2 textureDims;\nuniform vec2 sourcePosition;\nuniform float distortion;\n\nout vec4 position;\nout vec4 color;\nout float radius;\n\nconst vec4 GREEN = vec4(0., 255., 0., 255.);\nconst vec4 YELLOW = vec4(255., 255., 0., 255.);\nconst vec4 RED = vec4(255., 0., 0., 255.);\nconst vec4 BLACK = vec4(0., 0., 0., 255.);\nconst vec4 GRAY = vec4(200., 200., 200., 100.);\n\nivec2 getVexelCoord(float index) {\n  float y = floor(index / textureDims.x);\n  float x = index - textureDims.x * y;\n  return ivec2(x, y);\n}\n\nvec4 colorScale(float r) {\n  vec4 c = mix(GREEN, YELLOW, r);\n  c = mix(c, RED, max(r - 1.0, 0.0));\n  c = mix(c, BLACK, min(1.0, max(r - 2.0, 0.0)));\n  return c;\n}\n\nvoid main() {\n  vec4 valuePixel = texelFetch(nodeValues, getVexelCoord(nodeIndices), 0);\n  float travelTime = valuePixel.r;\n  float streetDistance = valuePixel.g;\n  float nodeDistance = valuePixel.b;\n  float isValid = valuePixel.a;\n\n  position = vec4(nodePositions, 0.0, isValid);\n  color = GRAY;\n  radius = 10.;\n\n  if (mode == MODE_NODE_DISTANCE) {\n\n    color = mix(color, BLACK, isValid);\n    radius = mix(radius, sqrt(nodeDistance) * 5., isValid);\n\n  } else if (mode == MODE_TRAFFIC) {\n\n    float r = travelTime / streetDistance * 12.;\n    r = mix(0.0, r, distortion * isValid);\n    position.z = r * 400.;\n    radius = mix(radius, radius * 3.0, isValid);\n    color = mix(GRAY, colorScale(r), isValid);\n\n  } else if (mode == MODE_ISOCHRONIC) {\n\n    float geoDistance = length((nodePositions - sourcePosition) * project_uCommonUnitsPerWorldUnit.xy / project_uCommonUnitsPerMeter.xy);\n    float r = travelTime / geoDistance * ".concat(6..toFixed(1),";\n    r = mix(1.0, r, distortion * isValid);\n    position.xy = mix(sourcePosition, nodePositions, r);\n    radius = mix(radius, radius * 3.0, isValid);\n    color = mix(GRAY, colorScale(r), isValid);\n\n  }\n}\n"),varyings:["position","color","radius"],elementCount:1,feedbackBuffers:{position:this.nodePositionsBuffer,color:this.nodeColorsBuffer,radius:this.nodeRadiusBuffer}})}},{key:"nodePositionsBuffer",get:function(){return this._nodePositionsBuffer[this._swapBuffer?1:0]}},{key:"nodeColorsBuffer",get:function(){return this._nodeColorsBuffer[this._swapBuffer?1:0]}},{key:"nodeRadiusBuffer",get:function(){return this._nodeRadiusBuffer[this._swapBuffer?1:0]}}]),e}(),Y=n(319),q=n(316),X=function(e){function t(){return Object(P.a)(this,t),Object(B.a)(this,Object(S.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(O.a)(t,[{key:"initializeState",value:function(e){Object(E.a)(Object(S.a)(t.prototype),"initializeState",this).call(this,e),this.getAttributeManager().getAttributes().instancePositions.size=4}}]),t}(Y.a),J=function(e){function t(){return Object(P.a)(this,t),Object(B.a)(this,Object(S.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(O.a)(t,[{key:"getShaders",value:function(){var e=Object(E.a)(Object(S.a)(t.prototype),"getShaders",this).call(this);return e.inject={"vs:#decl":"\nattribute float instanceValid;\n","vs:#main-end":"\nvColor.a *= instanceValid + 0.1;\n"},e}},{key:"initializeState",value:function(e){Object(E.a)(Object(S.a)(t.prototype),"initializeState",this).call(this,e),this.getAttributeManager().addInstanced({instanceValid:{size:1,accessor:"getIsValid",transition:!0}})}}]),t}(n(320).a),$=1,Q=3,Z=function(e){function t(){return Object(P.a)(this,t),Object(B.a)(this,Object(S.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(O.a)(t,[{key:"initializeState",value:function(e){var t=e.gl;this.setState({attributes:this._getAttributes(t),nodeAttributesTransform:new W(t),edgeAttributesTransform:new U(t),shortestPathTransform:new H(t),transitionDuration:0,iteration:1/0,lastAttributeChange:-1,animation:requestAnimationFrame(this.animate.bind(this))})}},{key:"updateState",value:function(e){var t=e.props,n=e.oldProps,i=e.changeFlags,o=i.dataChanged||i.updateTriggersChanged,a=this.state,r=a.attributes,s=a.shortestPathTransform,u=a.nodeAttributesTransform,c=a.edgeAttributesTransform;if(t.data&&o){var d=t.data.nodes.length,l=t.data.edges.length;for(var f in r){var h=r[f];if(i.dataChanged||i.updateTriggersChanged&&i.updateTriggersChanged[h.userData.accessor]){h.setNeedsUpdate();var g=f.startsWith("node"),v=g?d:l;h.allocate(v),h.updateBuffer({numInstances:v,data:g?t.data.nodes:t.data.edges,props:t,context:this})}}s.update({nodeCount:d,edgeCount:l,attributes:r}),u.update({nodeCount:d,edgeCount:l,attributes:r}),c.update({nodeCount:d,edgeCount:l,attributes:r}),this.setState({transitionDuration:l,maxIterations:Math.ceil(Math.sqrt(d))+60})}o||t.sourceIndex!==n.sourceIndex?(s.reset(t.sourceIndex),u.reset(t.sourceIndex),c.reset(t.sourceIndex),this.setState({iteration:0,lastAttributeChange:0})):t.mode!==n.mode&&(u.update(),c.update(),this.state.iteration>=this.state.maxIterations&&this._updateAttributes(),this.setState({lastAttributeChange:this.state.iteration}))}},{key:"finalizeState",value:function(){Object(E.a)(Object(S.a)(t.prototype),"finalizeState",this).call(this),cancelAnimationFrame(this.state.animation)}},{key:"animate",value:function(){this.state.iteration<this.state.maxIterations&&(this.state.shortestPathTransform.run(),this._updateAttributes());this.state.iteration++,this.state.animation=requestAnimationFrame(this.animate.bind(this))}},{key:"_updateAttributes",value:function(){var e=this.state,t=e.shortestPathTransform,n=e.nodeAttributesTransform,i=e.edgeAttributesTransform,o=e.iteration,a=this.getCurrentLayer().props,r=Object.assign(Object.create(a),{viewport:this.context.viewport});n.run({moduleParameters:r,mode:a.mode,nodeValueTexture:t.nodeValueTexture,distortion:Math.min(o/60,1)}),i.run({nodePositionsBuffer:n.nodePositionsBuffer})}},{key:"_getAttributes",value:function(e){return{nodePositions:new j.a(e,{size:2,accessor:"getNodePosition"}),nodeIndices:new j.a(e,{size:1,accessor:"getNodeIndex"}),edgeSourceIndices:new j.a(e,{size:1,type:R.a.INT,accessor:"getEdgeSource"}),edgeTargetIndices:new j.a(e,{size:1,type:R.a.INT,accessor:"getEdgeTarget"}),edgeValues:new j.a(e,{size:3,accessor:"getEdgeValue"})}}},{key:"_transitionEasing",value:function(e){var t=this.state,n=t.iteration-t.lastAttributeChange;return n<=60?n/60:1}},{key:"_getIsochronicRings",value:function(){var e=this.props,t=e.data,n=e.getNodePosition,i=e.sourceIndex,o=e.mode,a=n(t.nodes[i]);return o===Q&&[new Y.a(this.getSubLayerProps({id:"isochronic-rings-circle",data:K,filled:!1,stroked:!0,lineWidthMinPixels:1,coordinateSystem:V.a.METER_OFFSETS,coordinateOrigin:a,getPosition:function(e){return[0,0]},getRadius:function(e){return 6*e},getLineColor:[0,128,255]})),new q.a(this.getSubLayerProps({id:"isochronic-rings-legend",data:K,coordinateSystem:V.a.METER_OFFSETS,coordinateOrigin:a,getTextAnchor:"start",getPosition:function(e){return[6*e,0]},getText:function(e){return" ".concat(e/60," min")},getSize:20,getColor:[0,128,255]}))]}},{key:"renderLayers",value:function(){var e=this.props,t=e.data,n=e.getNodePosition,i=this.state,o=i.nodeAttributesTransform,a=i.edgeAttributesTransform,r=i.transitionDuration,s=this.props.transition&&{duration:r,easing:this._transitionEasing.bind(this)};return[new J(this.getSubLayerProps({id:"edges",data:t.edges,getSourcePosition:function(e){return[0,0]},getTargetPosition:function(e){return[0,0]},getColor:[200,200,200],widthScale:3,instanceSourcePositions:a.sourcePositionsBuffer,instanceTargetPositions:a.targetPositionsBuffer,instanceValid:a.validityBuffer,transitions:s&&{getSourcePosition:s,getTargetPosition:s,getIsValid:s}})),new X(this.getSubLayerProps({id:"nodes",data:t.nodes,getPosition:n,instancePositions:o.nodePositionsBuffer,instanceFillColors:o.nodeColorsBuffer,instanceRadius:o.nodeRadiusBuffer,transitions:s&&{getPosition:s,getFillColor:s,getRadius:s},pickable:!0,autoHighlight:!0,highlightColor:[0,200,255,200]})),this._getIsochronicRings()]}}]),t}(A.a);Z.defaultProps={mode:$,getNodePosition:{type:"accessor"},getNodeIndex:{type:"accessor"},getEdgeSource:{type:"accessor"},getEdgeTarget:{type:"accessor"},getEdgeValue:{type:"accessor"}};var ee=function(e){var t=e.viewState,n=e.graph,i=e.mode,a=e.setSourceIndex,r=e.setViewState,s=e.hour,u=e.sourceIndex;return o.a.createElement("div",null,o.a.createElement(T.a,{viewState:t,pickingRadius:5,controller:!0,onViewStateChange:function(e){var t=e.viewState;r(t)},style:{left:"280px",width:"calc(100vw - 280px)"},layers:[new Z({data:n,sourceIndex:u,onClick:function(e){var t=e.index;a(t)},getNodePosition:function(e){return[e.lon,e.lat]},getNodeIndex:function(e,t){return t.index},getEdgeSource:function(e){return e.start},getEdgeTarget:function(e){return e.end},getEdgeValue:function(e){return[e.times_by_hour[s]||1e6,e.distance,1]},mode:i,transition:!0,updateTriggers:{getEdgeValue:s}})]}))},te="https://uber-common-public.s3-us-west-2.amazonaws.com/svc-vis-prototype/vis-hackathon-isochronic-map";function ne(e){return ie.apply(this,arguments)}function ie(){return(ie=Object(c.a)(u.a.mark(function e(t){var n,i,o,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(te,"/").concat(t,"/edges-sm.csv")).then(function(e){return e.text()});case 2:return n=e.sent,e.next=5,fetch("".concat(te,"/").concat(t,"/nodes-sm.csv")).then(function(e){return e.text()});case 5:return i=e.sent,o=oe(i),a=oe(n),console.log("Loaded ".concat(t,". ").concat(o.length," nodes, ").concat(a.length," edges")),e.abrupt("return",{nodes:o,edges:a});case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function oe(e){var t=e.split("\n").filter(Boolean),n=t.shift().split(",");return t.map(function(e){for(var t=e.split(","),i={},o=0;o<n.length;o++){var a=n[o];i[a]="times_by_hour"===a?t[o].split("\t").map(Number):Number(t[o])}return i})}var ae=new f.a,re=Object(l.a)({graph:{},city:"san-francisco"},m["san-francisco"],{hour:0,mapType:1,loaded:!1});var se=function(){var e=Object(i.useState)(re),t=Object(d.a)(e,2),n=t[0],a=t[1],r=function(){var e=Object(c.a)(u.a.mark(function e(t){var n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ne(t);case 3:n=e.sent,a(function(e){return Object(l.a)({},e,{graph:n,loaded:!0})}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}();return Object(i.useEffect)(function(){n.loaded||r(n.city)}),o.a.createElement(h.Provider,{value:ae},o.a.createElement(g.BaseProvider,{theme:g.LightTheme},o.a.createElement("div",{style:{display:"flex",height:"100vh"}},o.a.createElement("div",{style:{width:"280px",height:"100vh"}},o.a.createElement(_,{city:n.city,mapType:n.mapType,setMapType:function(e){a(function(t){return Object(l.a)({},t,{mapType:e})})},hour:n.hour,setHour:function(e){a(function(t){return Object(l.a)({},t,{hour:e})})},setCity:function(e){a(function(t){return Object(l.a)({},t,{city:e},m[e],{loaded:!1})})}})),o.a.createElement("div",{style:{width:"calc(100vw - 280px)",height:"100vh"}},n.loaded?o.a.createElement(ee,{viewState:n.viewState,graph:n.graph,hour:n.hour,sourceIndex:n.sourceIndex,setSourceIndex:function(e){a(function(t){return Object(l.a)({},t,{sourceIndex:e})})},setViewState:function(e){a(function(t){return Object(l.a)({},t,{viewState:e})})},mode:n.mapType}):o.a.createElement("div",{style:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center"}},o.a.createElement(v.Spinner,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(se,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[215,1,2]]]);
//# sourceMappingURL=main.ba6baad8.chunk.js.map