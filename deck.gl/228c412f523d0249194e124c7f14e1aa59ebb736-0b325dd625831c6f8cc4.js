(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"49Am":function(e,t,r){"use strict";r.d(t,"a",(function(){return ji}));var n={};r.r(n),r.d(n,"decode",(function(){return Mr})),r.d(n,"encode",(function(){return Nr}));var i={};r.r(i),r.d(i,"decode",(function(){return zr})),r.d(i,"encode",(function(){return qr}));var a={};r.r(a),r.d(a,"decode",(function(){return Jr})),r.d(a,"encode",(function(){return Kr}));var s={};r.r(s),r.d(s,"decode",(function(){return Yr})),r.d(s,"encode",(function(){return Xr}));r("xtjI"),r("4DPX"),r("rzGZ"),r("Dq+y"),r("Ggvi"),r("6kNP"),r("8npG"),r("5irr");var o=r("o0o1"),u=r.n(o),c=(r("E5k/"),r("wcNg"),r("F7kj")),l=r("PPQy"),h=r.n(l),f=r("7G5M"),d=r("5VxJ"),y=r("mejf"),p=r("bZ2V"),v=r("ro6J"),b=r("Cdqv"),m=r("74We"),g=r("p1p/"),T=(r("sc67"),r("n7j8"),r("AqHK"),r("ToIb"),r("cxuS"),r("TAD1"),r("R48M"),r("+ar0"),r("JHok"),r("OeI1"),r("YbXK"),r("cFtU"),r("pJf4"),r("q8oJ"),r("C9fy"),r("MIFh"),r("m210"),r("HaE+")),_=r("rePB"),O=r("1OyB"),w=r("vuIU"),j=r("kh/P"),A=r("SDD5"),x=r("FlnL"),S=r("G+eI"),k=r("DYWF"),E=r("oCaT"),I=r("D430"),P=function e(t,r,n){Object(O.a)(this,e),this.item=t,this.previous=r,this.next=n},C=function(){function e(){Object(O.a)(this,e),this.head=null,this.tail=null,this._length=0}return Object(w.a)(e,[{key:"add",value:function(e){var t=new P(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}},{key:"remove",value:function(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}},{key:"splice",value:function(e,t){e!==t&&(this.remove(t),this._insert(e,t))}},{key:"_insert",value:function(e,t){var r=e.next;e.next=t,this.tail===e?this.tail=t:r.previous=t,t.next=r,t.previous=e,++this._length}},{key:"length",get:function(){return this._length}}]),e}();function M(e){return null!=e}var R=function(){function e(){Object(O.a)(this,e),this._list=new C,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}return Object(w.a)(e,[{key:"reset",value:function(){this._list.splice(this._list.tail,this._sentinel)}},{key:"touch",value:function(e){var t=e._cacheNode;M(t)&&this._list.splice(this._sentinel,t)}},{key:"add",value:function(e,t,r){M(t._cacheNode)||(t._cacheNode=this._list.add(t),r&&r(e,t))}},{key:"unloadTile",value:function(e,t,r){var n=t._cacheNode;M(n)&&(this._list.remove(n),t._cacheNode=void 0,r&&r(e,t))}},{key:"unloadTiles",value:function(e,t){var r=this._trimTiles;this._trimTiles=!1;for(var n=this._list,i=1024*e.maximumMemoryUsage*1024,a=this._sentinel,s=n.head;s!==a&&(e.gpuMemoryUsageInBytes>i||r);){var o=s.item;s=s.next,this.unloadTile(e,o,t)}}},{key:"trim",value:function(){this._trimTiles=!0}}]),e}();var N=r("DUak"),U=new A.a,L=new A.a,D=new N.c([new N.e,new N.e,new N.e,new N.e,new N.e,new N.e]);function V(e,t){var r=e.cameraDirection,n=e.cameraUp,i=e.height,a=e.distanceScales.metersPerUnit,s=[e.longitude,e.latitude,0],o=x.a.WGS84.cartographicToCartesian(s,new A.a),u=x.a.WGS84.eastNorthUpToFixedFrame(o),c=e.unprojectPosition(e.cameraPosition),l=x.a.WGS84.cartographicToCartesian(c,new A.a),h=new A.a(u.transformAsVector(new A.a(r).scale(a))).normalize(),f=new A.a(u.transformAsVector(new A.a(n).scale(a))).normalize();return function(e,t){var r=e.getFrustumPlanes(),n=0;for(var i in r){var a=r[i],s=a.normal.dot(e.center);L.copy(a.normal).scale(a.distance-s).add(e.center);var o=e.unprojectPosition(L),u=x.a.WGS84.cartographicToCartesian(o,new A.a);D.planes[n++].fromPointNormal(u,U.copy(t).subtract(u))}}(e,o),{camera:{position:l,direction:h,up:f},viewport:e,height:i,cullingVolume:D,frameNumber:t,sseDenominator:1.15}}r("QNMc");var B=new A.a;r("1dPr"),r("ofTv");var F=r("U8pU"),G=0,z=1,q=3,H=4,Q=5,J=1,K=2,W="empty",Z="scenegraph",Y="pointcloud",X="mesh",$="I3S",ee="TILES3D",te="geometricError",re=1,ne=r("ODXe"),ie=r("yeNo"),ae=r("T27a");function se(e){return null!=e}var oe=new A.a,ue=new A.a,ce=new A.a;new j.a;function le(e,t,r){if(Object(k.a)(e,"3D Tile: boundingVolume must be defined"),e.box)return function(e,t,r){var n=new A.a(e[0],e[1],e[2]);t.transform(n,n);var i=t.transformAsVector(e.slice(3,6)),a=t.transformAsVector(e.slice(6,9)),s=t.transformAsVector(e.slice(9,12)),o=new ae.a([i[0],i[1],i[2],a[0],a[1],a[2],s[0],s[1],s[2]]);if(se(r))return r.center=n,r.halfAxes=o,r;return new N.d(n,o)}(e.box,t,r);if(e.region){var n=Object(ne.a)(e.region,6),i=n[0],a=n[1],s=n[2],o=n[3],u=n[4],c=n[5],l=x.a.WGS84.cartographicToCartesian([Object(ie.c)(i),Object(ie.c)(o),u],ue),h=x.a.WGS84.cartographicToCartesian([Object(ie.c)(s),Object(ie.c)(a),c],ce),f=(new A.a).addVectors(l,h).multiplyScalar(.5),d=(new A.a).subVectors(l,h).len()/2;return he([f[0],f[1],f[2],d],new j.a)}if(e.sphere)return he(e.sphere,t,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function he(e,t,r){var n=new A.a(e[0],e[1],e[2]);t.transform(n,n);var i=t.getScale(oe),a=Math.max(Math.max(i[0],i[1]),i[2]),s=e[3]*a;return se(r)?(r.center=n,r.radius=s,r):new N.b(n,s)}new A.a,new A.a,new j.a,new A.a,new A.a,new A.a;function fe(e,t){if(e.dynamicScreenSpaceError&&e._dynamicScreenSpaceErrorComputedDensity){var r=e._dynamicScreenSpaceErrorComputedDensity,n=e.dynamicScreenSpaceErrorFactor;return function(e,t){var r=e*t;return 1-Math.exp(-r*r)}(t,r)*n}return 0}var de=Math.PI/2;function ye(e){var t=Object(ne.a)(e,3),r=t[0],n=t[1],i=t[2],a=Object(ie.i)(r),s=Object(ie.i)(n),o=1+i/6378137,u=o*Math.cos(s);return[r=u*Math.cos(a),n=u*Math.sin(a),i=o*Math.sin(s)]}function pe(e,t){var r=Object(ne.a)(e,3),n=r[0],i=r[1],a=r[2],s=void 0===a?0:a,o=Object(ne.a)(t,3),u=o[0],c=o[1],l=o[2],h=ye([u,c,void 0===l?0:l]),f=ye([n,i,s]),d=f[0]-h[0],y=f[1]-h[1],p=f[2]-h[2];return d*d+y*y+p*p}function ve(e,t){var r=t.viewport,n=e.header.mbs[1],i=[e.header.mbs[0],n,e.header.mbs[2]],a=e.header.mbs[3]/6378137,s=pe(r.unprojectPosition(r.cameraPosition),i)-a*a;if(s<=0)return 170141175e30;var o=function(e,t){var r=t.viewport,n=r.width,i=r.height,a=r.pixelProjectionMatrix,s=Math.tan(Math.atan(Math.sqrt(1/(a[0]*a[0])+1/(a[5]*a[5]))));return Math.sqrt(i*i+n*n)/s}(0,t);return o*=a/Math.sqrt(s)/r.scale}function be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?be(Object(r),!0).forEach((function(t){Object(_.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ge=new A.a;var Te=function(){function e(t,r,n){Object(O.a)(this,e),Object(k.a)("object"===Object(F.a)(r)),this.header=r,this.tileset=t,this.id=r.id,this.url=r.url,this.parent=n,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this.lodMetricType=null,this.lodMetricValue=null,this.boundingVolume=null,this.content=null,this.contentState=G,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,this._getPriority=this._getPriority.bind(this),Object.seal(this)}var t;return Object(w.a)(e,[{key:"destroy",value:function(){this.header=null}},{key:"isDestroyed",value:function(){return null===this.header}},{key:"getScreenSpaceError",value:function(e,t){switch(this.tileset.type){case $:return ve(this,e);case ee:return function(e,t,r){var n=e.tileset,i=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,a=r?i:e.lodMetricValue;if(0===a)return 0;var s=Math.max(e._distanceToCamera,1e-7),o=a*t.height/(s*t.sseDenominator);return o-=fe(n,s)}(this,e,t);default:return console.error("Unsupported tileset type"),null}}},{key:"_getPriority",value:function(){return this.isVisible?this.contentState===G?-1:Math.max(1e7-this._priority,0)||0:-1}},{key:"loadContent",value:(t=Object(T.a)(u.a.mark((function e(){var t,r,n,i,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasEmptyContent){e.next=2;break}return e.abrupt("return",!1);case 2:if(!this.content){e.next=4;break}return e.abrupt("return",!0);case 4:return this.contentExpired&&(this._expireDate=null),this.contentState=z,e.next=9,this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority);case 9:if(t=e.sent){e.next=13;break}return this.contentState=G,e.abrupt("return",!1);case 13:return e.prev=13,r=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.fetchOptions,i=this.tileset.loader,a=me(me({},n),{},Object(_.a)({},i.id,{tile:this.header,tileset:this.tileset.tileset,isTileset:"auto",isTileHeader:!1})),e.next=20,Object(g.a)(r,i,a);case 20:return this.content=e.sent,this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this,E.a.dirname(this.contentUrl)),this.contentState=q,this._onContentLoaded(),e.abrupt("return",!0);case 27:throw e.prev=27,e.t0=e.catch(13),this.contentState=Q,e.t0;case 31:return e.prev=31,t.done(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[13,27,31,34]])}))),function(){return t.apply(this,arguments)})},{key:"unloadContent",value:function(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.contentState=G,!0}},{key:"updateVisibility",value:function(e){if(this._frameNumber!==e.frameNumber){var t=this.parent,r=t?t.computedTransform:this.tileset.modelMatrix,n=t?t._visibilityPlaneMask:N.c.MASK_INDETERMINATE;this._updateTransform(r),this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==N.c.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._priority=this.lodMetricValue,this._frameNumber=e.frameNumber}}},{key:"visibility",value:function(e,t){var r=e.cullingVolume,n=this.boundingVolume;return r.computeVisibilityWithPlaneMask(n,t)}},{key:"contentVisibility",value:function(e){return!0}},{key:"distanceToTile",value:function(e){var t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}},{key:"cameraSpaceZDepth",value:function(e){var t=e.camera,r=this.boundingVolume;return ge.subVectors(r.center,t.position),t.direction.dot(ge)}},{key:"insideViewerRequestVolume",value:function(e){var t=this._viewerRequestVolume;return!t||0===t.distanceToCamera(e)}},{key:"_initializeLodMetric",value:function(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}},{key:"_initializeTransforms",value:function(e){this.transform=e.transform?new j.a(e.transform):new j.a;var t=this.parent,r=this.tileset,n=t&&t.computedTransform?t.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new j.a(n).multiplyRight(this.transform);var i=t&&t._initialTransform?t._initialTransform.clone():new j.a;this._initialTransform=new j.a(i).multiplyRight(this.transform)}},{key:"_initializeBoundingVolumes",value:function(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}},{key:"_initializeContent",value:function(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=G,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}},{key:"_initializeRenderingState",value:function(e){this.depth=e.level,this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=N.c.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}},{key:"_getRefine",value:function(e){return e||this.parent&&this.parent.refine||K}},{key:"_isTileset",value:function(){return-1!==this.contentUrl.indexOf(".json")}},{key:"_onContentLoaded",value:function(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset.traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}},{key:"_updateBoundingVolume",value:function(e){this.boundingVolume=le(e.boundingVolume,this.computedTransform,this.boundingVolume);var t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=le(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=le(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new j.a,t=e.clone().multiplyRight(this.transform),r=!t.equals(this.computedTransform);r&&(this.computedTransform=t,this._updateBoundingVolume(this.header))}},{key:"updateExpiration",value:function(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){var e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=H,this._expiredContent=this.content)}}},{key:"selected",get:function(){return this._selectedFrame===this.tileset._frameNumber}},{key:"isVisible",get:function(){return this._visible}},{key:"isVisibleAndInRequestVolume",get:function(){return this._visible&&this._inRequestVolume}},{key:"hasRenderContent",get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent}},{key:"hasChildren",get:function(){return this.children.length>0||this.header.children&&this.header.children.length>0}},{key:"contentReady",get:function(){return this.contentState===q||this.hasEmptyContent}},{key:"contentAvailable",get:function(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}},{key:"hasUnloadedContent",get:function(){return this.hasRenderContent&&this.contentUnloaded}},{key:"contentUnloaded",get:function(){return this.contentState===G}},{key:"contentExpired",get:function(){return this.contentState===H}},{key:"contentFailed",get:function(){return this.contentState===Q}},{key:"extras",get:function(){return this.header.extras}}]),e}(),_e=(r("nWfQ"),r("Ji7U")),Oe=r("md7G"),we=r("foSv"),je=(r("v9g0"),r("zGcK"),r("xJgp"),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(O.a)(this,e),this._array=new Array(t),this._map=new Map,this._length=t}return Object(w.a)(e,[{key:"get",value:function(e){return Object(k.a)(e<this._array.length),this._array[e]}},{key:"set",value:function(e,t){Object(k.a)(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}},{key:"delete",value:function(e){var t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}},{key:"peek",value:function(){return this._array[this._length-1]}},{key:"push",value:function(e){if(!this._map.has(e)){var t=this.length++;this._array[t]=e,this._map.set(e,t)}}},{key:"pop",value:function(){var e=this._array[--this.length];return this._map.delete(e),e}},{key:"reserve",value:function(e){Object(k.a)(e>=0),e>this._array.length&&(this._array.length=e)}},{key:"resize",value:function(e){Object(k.a)(e>=0),this.length=e}},{key:"trim",value:function(e){null==e&&(e=this.length),this._array.length=e}},{key:"reset",value:function(){this._array=[],this._map=new Map,this._length=0}},{key:"find",value:function(e){return this._map.has(e)}},{key:"length",get:function(){return this._length},set:function(e){this._length=e,e>this._array.length&&(this._array.length=e)}},{key:"values",get:function(){return this._array}}]),e}());function Ae(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return xe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xe(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ke(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(r),!0).forEach((function(t){Object(_.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ee={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2},Ie=function(){function e(t){Object(O.a)(this,e),this.options=ke(ke({},Ee),t),this._traversalStack=new je,this._emptyTraversalStack=new je,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}return Object(w.a)(e,[{key:"traverse",value:function(e,t,r){this.root=e,this.options=ke(ke({},this.options),r),this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}},{key:"reset",value:function(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}},{key:"executeTraversal",value:function(e,t){var r=this._traversalStack;for(r.push(e);r.length>0;){var n=r.pop(),i=!1;this.canTraverse(n,t)&&(this.updateChildTiles(n,t),i=this.updateAndPushChildren(n,t,r));var a=n.parent,s=Boolean(!a||a._shouldRefine),o=!i;n.hasRenderContent?n.refine===J?(this.loadTile(n,t),this.selectTile(n,t)):n.refine===K&&(this.loadTile(n,t),o&&this.selectTile(n,t)):(this.emptyTiles[n.id]=n,this.loadTile(n,t),o&&this.selectTile(n,t)),this.touchTile(n,t),n._shouldRefine=i&&s}this.options.onTraversalEnd&&this.options.onTraversalEnd(t)}},{key:"updateChildTiles",value:function(e,t){var r,n=Ae(e.children);try{for(n.s();!(r=n.n()).done;){var i=r.value;this.updateTile(i,t)}}catch(a){n.e(a)}finally{n.f()}return!0}},{key:"updateAndPushChildren",value:function(e,t,r){var n=this.options,i=n.loadSiblings,a=n.skipLevelOfDetail,s=e.children;s.sort(this.compareDistanceToCamera);var o,u=!a&&e.refine===K&&e.hasRenderContent,c=!1,l=Ae(s);try{for(l.s();!(o=l.n()).done;){var h=o.value;if(h.isVisibleAndInRequestVolume?(r.find(h)&&r.delete(h),r.push(h),c=!0):(u||i)&&(this.loadTile(h,t),this.touchTile(h,t)),u){var f=void 0;if(!(f=!!h._inRequestVolume&&(h.hasRenderContent?h.contentAvailable:this.executeEmptyTraversal(h,t))))return f}}}catch(d){l.e(d)}finally{l.f()}return c}},{key:"updateTile",value:function(e,t){this.updateTileVisibility(e,t)}},{key:"selectTile",value:function(e,t){this.shouldSelectTile(e,t)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}},{key:"loadTile",value:function(e,t){this.shouldLoadTile(e,t)&&(e._requestedFrame=t.frameNumber,e._priority=this.getPriority(e),this.requestedTiles[e.id]=e)}},{key:"touchTile",value:function(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}},{key:"canTraverse",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return!(!n&&!e.isVisibleAndInRequestVolume)&&(!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t,r)))}},{key:"shouldLoadTile",value:function(e,t){return e.hasUnloadedContent||e.contentExpired}},{key:"shouldSelectTile",value:function(e,t){return e.contentAvailable&&!this.options.skipLevelOfDetail}},{key:"shouldRefine",value:function(e,t,r){var n=e._screenSpaceError;return r&&(n=e.getScreenSpaceError(t,!0)),n>this.options.maximumScreenSpaceError}},{key:"updateTileVisibility",value:function(e,t){e.updateVisibility(t)}},{key:"compareDistanceToCamera",value:function(e,t){return e._distanceToCamera-t._distanceToCamera}},{key:"getPriority",value:function(e){var t=this.options;switch(e.refine){case J:return e._distanceToCamera;case K:var r=e.parent,n=r&&(!t.skipLevelOfDetail||0===e._screenSpaceError||r.hasTilesetContent)?r._screenSpaceError:e._screenSpaceError;return this.root._screenSpaceError-n;default:return Object(k.a)(!1)}}},{key:"anyChildrenVisible",value:function(e,t){var r,n=!1,i=Ae(e.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.updateVisibility(t),n=n||a.isVisibleAndInRequestVolume}}catch(s){i.e(s)}finally{i.f()}return n}},{key:"executeEmptyTraversal",value:function(e,t){for(var r=!0,n=this._emptyTraversalStack;n.length>0;){var i=n.pop();this.updateTile(i,t),i.isVisibleAndInRequestVolume||(this.loadTile(i,t),this.touchTile(i,t));var a=!i.hasRenderContent&&this.canTraverse(i,t,!1,!0);if(a||i.contentAvailable||(r=!1),a){var s,o=Ae(i.children.filter((function(e){return e})));try{for(o.s();!(s=o.n()).done;){var u=s.value;n.find(u)&&n.delete(u),n.push(u)}}catch(c){o.e(c)}finally{o.f()}}}return r}}]),e}();function Pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(we.a)(e);if(t){var i=Object(we.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(Oe.a)(this,r)}}var Ce=function(e){Object(_e.a)(r,e);var t=Pe(r);function r(){return Object(O.a)(this,r),t.apply(this,arguments)}return Object(w.a)(r,[{key:"compareDistanceToCamera",value:function(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}},{key:"updateTileVisibility",value:function(e,t){if(e.updateVisibility(t),e.isVisibleAndInRequestVolume){var r=e.children.length>0;if(e.hasTilesetContent&&r){var n=e.children[0];return this.updateTileVisibility(n,t),void(e._visible=n._visible)}if(this.meetsScreenSpaceErrorEarly(e,t))e._visible=!1;else{var i=e.refine===K,a=e._optimChildrenWithinParent===re;i&&a&&r&&!this.anyChildrenVisible(e,t)&&(e._visible=!1)}}}},{key:"meetsScreenSpaceErrorEarly",value:function(e,t){var r=e.parent;return!(!r||r.hasTilesetContent||r.refine!==J)&&!this.shouldRefine(e,t,!0)}}]),r}(Ie),Me="REQUESTED",Re="COMPLETED",Ne="ERROR",Ue=function(){function e(){Object(O.a)(this,e),this._statusMap={}}return Object(w.a)(e,[{key:"add",value:function(e,t,r,n){var i=this;this._statusMap[t]||(this._statusMap[t]={request:e,callback:r,key:t,frameState:n,status:Me},e().then((function(e){i._statusMap[t].status=Re,i._statusMap[t].callback(e,n)})).catch((function(e){i._statusMap[t].status=Ne,r(e)})))}},{key:"update",value:function(e,t){this._statusMap[e]&&(this._statusMap[e].frameState=t)}},{key:"find",value:function(e){return this._statusMap[e]}}]),e}();function Le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function De(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(r),!0).forEach((function(t){Object(_.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ve(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Be(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Be(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(we.a)(e);if(t){var i=Object(we.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(Oe.a)(this,r)}}var Ge=function(e){Object(_e.a)(n,e);var t,r=Fe(n);function n(e){var t;return Object(O.a)(this,n),(t=r.call(this,e))._tileManager=new Ue,t}return Object(w.a)(n,[{key:"shouldRefine",value:function(e,t){return e._lodJudge=function(e,t){var r=t.viewport,n=r.metersPerPixel,i=e.header.mbs[1],a=e.header.mbs[0],s=e.header.mbs[2],o=e.header.mbs[3],u=r.height,c=r.width,l=r.latitude,h=r.longitude,f=[h,l],d=[a,i,s],y=[h,i],p=[a,l],v=Math.sqrt(u*u+c*c)*n[0],b=.5*u+o/6378137,m=.5*c+o/6378137;if(pe(f,d)>v+o/6378137)return"OUT";if(pe(f,y)>b)return"OUT";if(pe(f,p)>m)return"OUT";if(0===e.lodMetricValue)return"DIG";var g=ve(e,t);return(g*=de)<.5?"OUT":!e.header.children||g<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}},{key:"updateChildTiles",value:function(e,t){var r,n=this,i=e.header.children||[],a=e.children,s=e.tileset,o=Ve(i);try{var u=function(){var i=r.value,o=a&&a.find((function(e){return e.id===i.id}));if(o)o&&n.updateTile(o,t);else{var u=function(){return n._loadTile(i.id,s)};n._tileManager.find(i.id)?n._tileManager.update(i.id,t):(s.tileset.nodePages&&(u=function(){return s.tileset.nodePagesTile.formTileFromNodePages(i.id)}),n._tileManager.add(u,i.id,(function(t){return n._onTileLoad(t,e)}),t))}};for(o.s();!(r=o.n()).done;)u()}catch(c){o.e(c)}finally{o.f()}}},{key:"_loadTile",value:(t=Object(T.a)(u.a.mark((function e(t,r){var n,i,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.loader,i=r.getTileUrl("".concat(r.url,"/nodes/").concat(t)),a={i3s:De(De({},r.fetchOptions),{},{isTileHeader:!0,loadContent:!1})},e.next=5,Object(g.a)(i,n,a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"_onTileLoad",value:function(e,t){var r=this.options.basePath,n=new Te(t.tileset,e,t,r);t.children.push(n);var i=this._tileManager.find(n.id).frameState;this.updateTile(n,i),this._frameNumber===i.frameNumber&&this.executeTraversal(n,i)}}]),n}(Ie);function ze(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return qe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qe(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function He(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?He(Object(r),!0).forEach((function(t){Object(_.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):He(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Je={ellipsoid:x.a.WGS84,modelMatrix:new j.a,throttleRequests:!1,maximumMemoryUsage:32,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(e,t,r){},maximumScreenSpaceError:8},Ke=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(O.a)(this,e),Object(k.a)(t),this.options=Qe(Qe({},Je),r),this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||E.a.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.fetchOptions=this.options.fetchOptions||{},this.options.headers&&(this.fetchOptions.headers=this.options.headers),this.options.token&&(this.fetchOptions.token=this.options.token),this.root=null,this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this._traverser=this._initializeTraverser(),this._cache=new R,this._requestScheduler=new I.a({throttleRequests:this.options.throttleRequests}),this._frameNumber=0,this._updateFrameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._queryParams={},this._queryParamsString=null,this.maximumMemoryUsage=this.options.maximumMemoryUsage,this.gpuMemoryUsageInBytes=0,this.stats=new S.a({id:this.url}),this._initializeStats(),this._hasMixedContent=!1,this._maximumScreenSpaceError=this.options.maximumScreenSpaceError,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description,this._defaultGeometrySchema=[],this._initializeTileSet(t,this.options)}var t;return Object(w.a)(e,[{key:"isLoaded",value:function(){return 0===this._pendingCount}},{key:"destroy",value:function(){this._destroy()}},{key:"getTileUrl",value:function(e){return e.startsWith("data:")?e:"".concat(e).concat(this.queryParams)}},{key:"update",value:function(e){this._cache.reset(),this._frameNumber++,this._frameState=V(e,this._frameNumber),this._traverser.traverse(this.root,this._frameState,this.options)}},{key:"_onTraversalEnd",value:function(){var e=Object.values(this._traverser.selectedTiles);this._tilesChanged(this.selectedTiles,e)&&this._updateFrameNumber++,this.selectedTiles=e;var t,r=ze(this.selectedTiles);try{for(r.s();!(t=r.n()).done;){var n=t.value;this._tiles[n.id]=n}}catch(i){r.e(i)}finally{r.f()}return this._requestedTiles=Object.values(this._traverser.requestedTiles),this._emptyTiles=Object.values(this._traverser.emptyTiles),this._loadTiles(this._frameState),this._unloadTiles(),this._updateStats(),this._updateFrameNumber}},{key:"_tilesChanged",value:function(e,t){if(e.length!==t.length)return!0;var r=new Set(e.map((function(e){return e.id}))),n=new Set(t.map((function(e){return e.id}))),i=e.filter((function(e){return!n.has(e.id)})).length>0;return i=i||t.filter((function(e){return!r.has(e.id)})).length>0}},{key:"_loadTiles",value:function(e){var t,r=ze(this._requestedTiles);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.contentUnloaded&&this._loadTile(n,e)}}catch(i){r.e(i)}finally{r.f()}}},{key:"_unloadTiles",value:function(){this._cache.unloadTiles(this,(function(e,t){return e._unloadTile(t)}))}},{key:"_updateStats",value:function(){var e,t=0,r=0,n=ze(this.selectedTiles);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.contentAvailable&&(t++,i.content.pointCount&&(r+=i.content.pointCount))}}catch(a){n.e(a)}finally{n.f()}this.stats.get("Tiles In View").count=this.selectedTiles.length,this.stats.get("Tiles To Render").count=t,this.stats.get("Points").count=r}},{key:"_initializeTileSet",value:function(e){this.root=this._initializeTileHeaders(e,null,this.basePath),this.type===ee&&this._initializeCesiumTileset(e),this.type===$&&this._initializeI3STileset(e),this._calculateViewProps()}},{key:"_calculateViewProps",value:function(){var e=this.root,t=e.boundingVolume.center;if(!t)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new A.a,void(this.zoom=1);this.cartographicCenter=x.a.WGS84.cartesianToCartographic(t,new A.a),this.cartesianCenter=t,this.zoom=function(e){var t=e.halfAxes,r=e.radius,n=e.width,i=e.height;if(t){t.getColumn(0,B);var a=B.len();t.getColumn(1,B);var s=B.len();t.getColumn(2,B);var o=a/2,u=s/2,c=B.len()/2;return(Math.log2(6378137/o)+Math.log2(6378137/u)+Math.log2(6356752.314245179/c))/3}return r?Math.log2(6356752.314245179/r):i&&n?(Math.log2(6378137/n)+Math.log2(6378137/i))/2:1}(e.boundingVolume)}},{key:"_initializeStats",value:function(){this.stats.get("Tiles In Tileset(s)"),this.stats.get("Tiles Loading"),this.stats.get("Tiles In Memory"),this.stats.get("Tiles In View"),this.stats.get("Tiles To Render"),this.stats.get("Tiles Loaded"),this.stats.get("Tiles Unloaded"),this.stats.get("Failed Tile Loads"),this.stats.get("Points","memory"),this.stats.get("Tile Memory Use","memory")}},{key:"_initializeTileHeaders",value:function(e,t,r){var n=new Te(this,e.root,t,r);if(t&&(t.children.push(n),n.depth=t.depth+1),this.type===ee){var i=[];for(i.push(n);i.length>0;){var a=i.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();var s,o=ze(a.header.children||[]);try{for(o.s();!(s=o.n()).done;){var u=s.value,c=new Te(this,u,a,r);a.children.push(c),c.depth=a.depth+1,i.push(c)}}catch(l){o.e(l)}finally{o.f()}}}return n}},{key:"_initializeTraverser",value:function(){var e;switch(this.type){case ee:e=Ce;break;case $:e=Ge;break;default:e=Ie}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}},{key:"_destroyTileHeaders",value:function(e){this._destroySubtree(e)}},{key:"_loadTile",value:(t=Object(T.a)(u.a.mark((function e(t,r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._onStartTileLoading(),e.next=4,t.loadContent(r);case 4:n=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this._onTileLoadError(t,e.t0);case 10:return e.prev=10,this._onEndTileLoading(),this._onTileLoad(t,n),e.finish(10);case 14:case"end":return e.stop()}}),e,this,[[0,7,10,14]])}))),function(e,r){return t.apply(this,arguments)})},{key:"_onTileLoadError",value:function(e,t){this.stats.get("Failed Tile Loads").incrementCount();var r=t.message||t.toString(),n=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(r)),this.options.onTileError(e,r,n)}},{key:"_onTileLoad",value:function(e,t){t&&(e&&e.content&&function(e,t){Object(k.a)(e),Object(k.a)(t);var r=t.rtcCenter,n=t.rotateYtoZ,i=e.computedTransform,a=e.boundingVolume.center,s=new j.a(i);if(r&&s.translate(r),n){var o=(new j.a).rotateX(Math.PI/2);s=s.multiplyRight(o)}t.isQuantized&&s.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);var u=new A.a(a);t.cartesianModelMatrix=s,t.cartesianOrigin=u;var c=x.a.WGS84.cartesianToCartographic(u,new A.a),l=x.a.WGS84.eastNorthUpToFixedFrame(u).invert();t.cartographicModelMatrix=l.multiplyRight(s),t.cartographicOrigin=c,t.modelMatrix=t.cartographicModelMatrix}(e,e.content),this._addTileToCache(e),this.options.onTileLoad(e))}},{key:"_onStartTileLoading",value:function(){this._pendingCount++,this.stats.get("Tiles Loading").incrementCount()}},{key:"_onEndTileLoading",value:function(){this._pendingCount--,this.stats.get("Tiles Loading").decrementCount()}},{key:"_addTileToCache",value:function(e){this._cache.add(this,e,(function(t){return t._updateCacheStats(e)}))}},{key:"_updateCacheStats",value:function(e){this.stats.get("Tiles Loaded").incrementCount(),this.stats.get("Tiles In Memory").incrementCount(),this.gpuMemoryUsageInBytes+=e.content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes}},{key:"_unloadTile",value:function(e){this.gpuMemoryUsageInBytes-=e.content.byteLength||0,this.stats.get("Tiles In Memory").decrementCount(),this.stats.get("Tiles Unloaded").incrementCount(),this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}},{key:"_destroy",value:function(){var e=[];for(this.root&&e.push(this.root);e.length>0;){var t,r=e.pop(),n=ze(r.children);try{for(n.s();!(t=n.n()).done;){var i=t.value;e.push(i)}}catch(a){n.e(a)}finally{n.f()}this._destroyTile(r)}this.root=null}},{key:"_destroySubtree",value:function(e){var t=e,r=[];for(r.push(t);r.length>0;){var n,i=ze((e=r.pop()).children);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.push(a)}}catch(s){i.e(s)}finally{i.f()}e!==t&&this._destroyTile(e)}t.children=[]}},{key:"_destroyTile",value:function(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}},{key:"_initializeCesiumTileset",value:function(e){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description,this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed,this.extras=e.extras}},{key:"_initializeI3STileset",value:function(e){"token"in this.options&&(this._queryParams.token=this.options.token),this._defaultGeometrySchema=e.store.defaultGeometrySchema}},{key:"hasExtension",value:function(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)}},{key:"tiles",get:function(){return Object.values(this._tiles)}},{key:"queryParams",get:function(){return this._queryParamsString||(this._queryParamsString=function(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];t.push("".concat(i,"=").concat(e[i]))}switch(t.length){case 0:return"";case 1:return"?".concat(t[0]);default:return"?".concat(t.join("&"))}}(this._queryParams)),this._queryParamsString}}]),e}(),We={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect"};Object.keys(We),r("t+I+"),r("CtJk");function Ze(e,t,r){Object(k.a)(e instanceof ArrayBuffer);var n=new TextDecoder("utf8"),i=new Uint8Array(e,t,r);return n.decode(i)}function Ye(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(e);return"".concat(String.fromCharCode(r.getUint8(t+0))).concat(String.fromCharCode(r.getUint8(t+1))).concat(String.fromCharCode(r.getUint8(t+2))).concat(String.fromCharCode(r.getUint8(t+3)))}r("YBKJ"),r("9ZhD");var Xe,$e=r("7UmL"),et=r("nGEl");function tt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function rt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tt(Object(r),!0).forEach((function(t){Object(_.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function nt(e){return it.apply(this,arguments)}function it(){return(it=Object(T.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.modules||{},Xe=r.draco3d?Xe||new Promise((function(e){var t=r.draco3d.createDecoderModule({onModuleLoaded:function(){e({draco:t})}})})):Xe||at(t),e.next=4,Xe;case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function at(e){return st.apply(this,arguments)}function st(){return(st=Object(T.a)(u.a.mark((function e(t){var r,n,i,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.draco&&t.draco.decoderType,e.next="js"===e.t0?3:(e.t0,7);break;case 3:return e.next=5,Object($e.a)("draco_decoder.js","draco",t);case 5:return r=e.sent,e.abrupt("break",21);case 7:return e.t1=Promise,e.next=10,Object($e.a)("draco_wasm_wrapper.js","draco",t);case 10:return e.t2=e.sent,e.next=13,Object($e.a)("draco_decoder.wasm","draco",t);case 13:return e.t3=e.sent,e.t4=[e.t2,e.t3],e.next=17,e.t1.all.call(e.t1,e.t4);case 17:i=e.sent,a=Object(ne.a)(i,2),r=a[0],n=a[1];case 21:return r=r||et.a.DracoDecoderModule,e.next=24,ot(r,n);case 24:return e.abrupt("return",e.sent);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ot(e,t){var r={};return t&&(r.wasmBinary=t),new Promise((function(t){e(rt(rt({},r),{},{onModuleLoaded:function(e){return t({draco:e})}}))}))}r("PZd/"),r("SIeT"),r("6nXr"),r("h3Sa"),r("AItV"),r("88iX");var ut=r("6V5v"),ct=0,lt=1,ht={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},ft={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},dt=function(){function e(t){Object(O.a)(this,e),this.draco=t,this.drawMode="TRIANGLE",this.metadataQuerier={}}return Object(w.a)(e,[{key:"destroy",value:function(){}},{key:"destroyGeometry",value:function(e){e&&this.draco.destroy(e.dracoGeometry)}},{key:"parseSync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.metadataQuerier=new this.draco.MetadataQuerier;var r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength);var n,i,a,s=new this.draco.Decoder,o={};try{var u=s.GetEncodedGeometryType(r);switch(u){case this.draco.TRIANGULAR_MESH:i=new this.draco.Mesh,n=s.DecodeBufferToMesh(r,i),a={type:ct,faceCount:i.num_faces(),attributeCount:i.num_attributes(),vertexCount:i.num_points()};break;case this.draco.POINT_CLOUD:i=new this.draco.PointCloud,n=s.DecodeBufferToPointCloud(r,i),a={type:lt,attributeCount:i.num_attributes(),vertexCount:i.num_points()};break;default:throw new Error("Unknown DRACO geometry type.")}if(!n.ok()||!i.ptr){var c="DRACO decompression failed: ".concat(n.error_msg());throw i&&this.draco.destroy(i),new Error(c)}o.loaderData={header:a},this._extractDRACOGeometry(s,i,u,o,t);var l=this._getGeometryMetadata(s,i);o.header={vertexCount:a.vertexCount,boundingBox:Object(ut.a)(o.attributes),metadata:l}}finally{this.draco.destroy(s),this.draco.destroy(r),this.draco.destroy(i),this.draco.destroy(this.metadataQuerier)}return o}},{key:"_extractDRACOGeometry",value:function(e,t,r,n,i){var a=this._getAttributes(e,t,i);if(!a.POSITION)throw new Error("DRACO decompressor: No position attribute found.");return r===this.draco.TRIANGULAR_MESH?(a.indices="TRIANGLE_STRIP"===this.drawMode?this._getMeshStripIndices(e,t):this._getMeshFaceIndices(e,t),n.mode="TRIANGLE_STRIP"===this.drawMode?5:4):n.mode=0,a.indices&&(n.indices={value:a.indices,size:1},delete a.indices),n.attributes=a,n}},{key:"getPositionAttributeMetadata",value:function(e){this.metadata=this.metadata||{},this.metadata.attributes=this.metadata.attributes||{};var t=new this.draco.AttributeQuantizationTransform;if(t.InitFromAttribute(e)){this.metadata.attributes.position.isQuantized=!0,this.metadata.attributes.position.maxRange=t.range(),this.metadata.attributes.position.numQuantizationBits=t.quantization_bits(),this.metadata.attributes.position.minValues=new Float32Array(3);for(var r=0;r<3;++r)this.metadata.attributes.position.minValues[r]=t.min_value(r)}this.draco.destroy(t)}},{key:"_getAttributes",value:function(e,t,r){for(var n={},i=t.num_points(),a=0;a<t.num_attributes();a++){var s=e.GetAttribute(t,a),o=this._getAttributeMetadata(e,t,a),u={uniqueId:s.unique_id(),attributeType:s.attribute_type(),dataType:ft[s.data_type()],size:s.size(),numComponents:s.num_components(),byteOffset:s.byte_offset(),byteStride:s.byte_stride(),normalized:s.normalized(),metadata:o},c=this._deduceAttributeName(u,r),l=this._getAttributeTypedArray(e,t,s,c).typedArray;n[c]={value:l,size:l.length/i,metadata:o}}return n}},{key:"_getMeshFaceIndices",value:function(e,t){for(var r=t.num_faces(),n=new Uint32Array(3*r),i=new this.draco.DracoInt32Array,a=0;a<r;++a){e.GetFaceFromMesh(t,a,i);var s=3*a;n[s]=i.GetValue(0),n[s+1]=i.GetValue(1),n[s+2]=i.GetValue(2)}return this.draco.destroy(i),n}},{key:"_getMeshStripIndices",value:function(e,t){var r=new this.draco.DracoInt32Array;e.GetTriangleStripsFromMesh(t,r);for(var n=new Uint32Array(r.size()),i=0;i<r.size();++i)n[i]=r.GetValue(i);return this.draco.destroy(r),n}},{key:"_getAttributeTypedArray",value:function(e,t,r,n){if(0===r.ptr){var i="DRACO decode bad attribute ".concat(n);throw new Error(i)}var a,s,o=ft[r.data_type()],u=r.num_components(),c=t.num_points()*u;switch(o){case Float32Array:a=new this.draco.DracoFloat32Array,e.GetAttributeFloatForAllPoints(t,r,a),s=new Float32Array(c);break;case Int8Array:a=new this.draco.DracoInt8Array,e.GetAttributeInt8ForAllPoints(t,r,a),s=new Int8Array(c);break;case Int16Array:a=new this.draco.DracoInt16Array,e.GetAttributeInt16ForAllPoints(t,r,a),s=new Int16Array(c);break;case Int32Array:a=new this.draco.DracoInt32Array,e.GetAttributeInt32ForAllPoints(t,r,a),s=new Int32Array(c);break;case Uint8Array:a=new this.draco.DracoUInt8Array,e.GetAttributeUInt8ForAllPoints(t,r,a),s=new Uint8Array(c);break;case Uint16Array:a=new this.draco.DracoUInt16Array,e.GetAttributeUInt16ForAllPoints(t,r,a),s=new Uint16Array(c);break;case Uint32Array:a=new this.draco.DracoUInt32Array,e.GetAttributeUInt32ForAllPoints(t,r,a),s=new Uint32Array(c);break;default:throw new Error("DRACO decoder: unexpected attribute type.")}for(var l=0;l<c;l++)s[l]=a.GetValue(l);return this.draco.destroy(a),{typedArray:s,components:u}}},{key:"_deduceAttributeName",value:function(e,t){var r=t.extraAttributes,n=void 0===r?{}:r;if(n&&"object"===Object(F.a)(n))for(var i=0,a=Object.entries(n);i<a.length;i++){var s=Object(ne.a)(a[i],2),o=s[0];if(s[1]===e.uniqueId)return o}for(var u in ht){var c=this.draco[u];if(e.attributeType===c)return ht[u]}if(e.metadata){var l=t.attributeNameEntry||"name";if(e.metadata[l])return e.metadata[l].string}return"CUSTOM_ATTRIBUTE_".concat(e.uniqueId)}},{key:"_getGeometryMetadata",value:function(e,t){var r=e.GetMetadata(t);return this._queryDracoMetadata(r)}},{key:"_getAttributeMetadata",value:function(e,t,r){var n=e.GetAttributeMetadata(t,r);return this._queryDracoMetadata(n)}},{key:"_queryDracoMetadata",value:function(e){if(!e||!e.ptr)return{};for(var t={},r=this.metadataQuerier.NumEntries(e),n=0;n<r;n++){var i=this.metadataQuerier.GetEntryName(e,n);t[i]={int:this.metadataQuerier.GetIntEntry(e,i),string:this.metadataQuerier.GetStringEntry(e,i),double:this.metadataQuerier.GetDoubleEntry(e,i),intArray:this.metadataQuerier.GetIntEntryArray(e,i)}}return t}},{key:"decode",value:function(e,t){return this.parseSync(e,t)}}]),e}();function yt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(r),!0).forEach((function(t){Object(_.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var vt=pt(pt({},{id:"draco",name:"Draco",version:"2.3.0-beta.3",extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"===("undefined"==typeof WebAssembly?"undefined":Object(F.a)(WebAssembly))?"wasm":"js",libraryPath:"libs/",workerUrl:"https://unpkg.com/@loaders.gl/draco@".concat("2.3.0-beta.3","/dist/draco-loader.worker.js"),localWorkerUrl:"modules/draco/dist/draco-loader.worker.dev.js",extraAttributes:{}}}}),{},{parse:function(e,t,r,n){return bt.apply(this,arguments)}});function bt(){return(bt=Object(T.a)(u.a.mark((function e(t,r,n,i){var a,s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt(r);case 2:return a=e.sent,s=a.draco,o=new dt(s),e.prev=5,e.abrupt("return",o.parseSync(t,pt({extraAttributes:r.draco&&r.draco.extraAttributes||null},r.parseOptions||{})));case 7:return e.prev=7,o.destroy(),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[5,,7,10]])})))).apply(this,arguments)}function mt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function gt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(r),!0).forEach((function(t){Object(_.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Tt,_t={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Ot=gt(gt({},{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6}),_t),wt=(r("zZTu"),Tt={},Object(_.a)(Tt,_t.DOUBLE,Float64Array),Object(_.a)(Tt,_t.FLOAT,Float32Array),Object(_.a)(Tt,_t.UNSIGNED_SHORT,Uint16Array),Object(_.a)(Tt,_t.UNSIGNED_INT,Uint32Array),Object(_.a)(Tt,_t.UNSIGNED_BYTE,Uint8Array),Object(_.a)(Tt,_t.BYTE,Int8Array),Object(_.a)(Tt,_t.SHORT,Int16Array),Object(_.a)(Tt,_t.INT,Int32Array),Tt),jt={DOUBLE:_t.DOUBLE,FLOAT:_t.FLOAT,UNSIGNED_SHORT:_t.UNSIGNED_SHORT,UNSIGNED_INT:_t.UNSIGNED_INT,UNSIGNED_BYTE:_t.UNSIGNED_BYTE,BYTE:_t.BYTE,SHORT:_t.SHORT,INT:_t.INT},At=function(){function e(){Object(O.a)(this,e)}return Object(w.a)(e,null,[{key:"fromTypedArray",value:function(e){for(var t in e=ArrayBuffer.isView(e)?e.constructor:e,wt){if(wt[t]===e)return t}throw new Error("Failed to convert GL type")}},{key:"fromName",value:function(e){var t=jt[e];if(!t)throw new Error("Failed to convert GL type");return t}},{key:"getArrayType",value:function(e){switch(e){case _t.UNSIGNED_SHORT_5_6_5:case _t.UNSIGNED_SHORT_4_4_4_4:case _t.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:var t=wt[e];if(!t)throw new Error("Failed to convert GL type");return t}}},{key:"getByteSize",value:function(t){return e.getArrayType(t).BYTES_PER_ELEMENT}},{key:"validate",value:function(t){return Boolean(e.getArrayType(t))}},{key:"createTypedArray",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;void 0===i&&(i=(r.byteLength-n)/e.getByteSize(t));var a=e.getArrayType(t);return new a(r,n,i)}}]),e}(),xt=function(){function e(t,r){Object(O.a)(this,e),this.json=t,this.buffer=r,this.featuresLength=0,this._cachedTypedArrays={}}return Object(w.a)(e,[{key:"getExtension",value:function(e){return this.json.extensions&&this.json.extensions[e]}},{key:"hasProperty",value:function(e){return Boolean(this.json[e])}},{key:"getGlobalProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ot.UNSIGNED_INT,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,n.byteOffset):n}},{key:"getPropertyArray",value:function(e,t,r){var n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=At.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)}},{key:"getProperty",value:function(e,t,r,n,i){var a=this.json[e];if(!a)return a;var s=this.getPropertyArray(e,t,r);if(1===r)return s[n];for(var o=0;o<r;++o)i[o]=s[r*n+o];return i}},{key:"_getTypedArrayFromBinary",value:function(e,t,r,n,i){var a=this._cachedTypedArrays,s=a[e];return s||(s=At.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+i,n*r),a[e]=s),s}},{key:"_getTypedArrayFromArray",value:function(e,t,r){var n=this._cachedTypedArrays,i=n[e];return i||(i=At.createTypedArray(t,r),n[e]=i),i}}]),e}(),St=r("KQm4"),kt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Et={SCALAR:function(e,t){return e[t]},VEC2:function(e,t){return[e[2*t+0],e[2*t+1]]},VEC3:function(e,t){return[e[3*t+0],e[3*t+1],e[3*t+2]]},VEC4:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT2:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT3:function(e,t){return[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]]},MAT4:function(e,t){return[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]}},It={SCALAR:function(e,t,r){t[r]=e},VEC2:function(e,t,r){t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:function(e,t,r){t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:function(e,t,r){t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:function(e,t,r){t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:function(e,t,r){t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:function(e,t,r){t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}};r("n0hJ");var Pt=r("sfiq"),Ct=function(e){return void 0!==e};function Mt(e,t,r){if(!t)return null;var n=e.getExtension("3DTILES_batch_table_hierarchy"),i=t.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?function(e,t){var r,n,i,a,s=e.instancesLength,o=e.classes,u=e.classIds,c=e.parentCounts,l=e.parentIds,h=s;Ct(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),Object(Pt.a)("classIds"),u=i.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,s));if(Ct(c))for(Ct(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),Object(Pt.a)("parentCounts"),c=i.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,s)),a=new Uint16Array(s),Object(Pt.a)("parentIdsLength"),h=0,r=0;r<s;++r)a[r]=h,h+=(Object(Pt.a)("parentIdsLength"),c[r]);Ct(l)&&Ct(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),Object(Pt.a)("parentIds"),l=i.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,h));var f=o.length;for(r=0;r<f;++r){var d=o[r].length,y=o[r].instances,p=getBinaryProperties(d,y,t);o[r].instances=combine(p,y)}var v=new Array(f).fill(0),b=new Uint16Array(s);for(r=0;r<s;++r)n=u[r],b[r]=v[n],++v[n];var m={classes:o,classIds:u,classIndexes:b,parentCounts:c,parentIndexes:a,parentIds:l};return function(e){for(var t=e.classIds.length,r=0;r<t;++r)Nt(e,r,stack)}(m),m}(n,r):null}function Rt(e,t,r){if(e){var n=e.parentCounts;return e.parentIds?r(e,t):n>0?function(e,t,r){var n=e.classIds,i=e.parentCounts,a=e.parentIds,s=e.parentIndexes,o=n.length,u=scratchVisited;u.length=Math.max(u.length,o);var c=++marker,l=scratchStack;l.length=0,l.push(t);for(;l.length>0;)if(t=l.pop(),u[t]!==c){u[t]=c;var h=r(e,t);if(Ct(h))return h;for(var f=i[t],d=s[t],y=0;y<f;++y){var p=a[d+y];p!==t&&l.push(p)}}return null}(e,t,r):function(e,t,r){var n=!0;for(;n;){var i=r(e,t);if(Ct(i))return i;var a=e.parentIds[t];n=a!==t,t=a}throw new Error("traverseHierarchySingleParent")}(e,t,r)}}function Nt(e,t,r){var n=e.parentCounts,i=e.parentIds,a=e.parentIndexes,s=e.classIds.length;if(Ct(i)){assert(t<s,"Parent index ".concat(t," exceeds the total number of instances: ").concat(s)),assert(-1===r.indexOf(t),"Circular dependency detected in the batch table hierarchy."),r.push(t);for(var o=Ct(n)?n[t]:1,u=Ct(n)?a[t]:t,c=0;c<o;++c){var l=i[u+c];l!==t&&Nt(e,l,r)}r.pop(t)}}function Ut(e){return null!=e}var Lt=function(e,t){return e},Dt={HIERARCHY:!0,extensions:!0,extras:!0},Vt=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};for(var a in Object(O.a)(this,e),Object(k.a)(n>=0),this.json=t||{},this.binary=r,this.featureCount=n,this._extensions=this.json&&this.json.extensions||{},this._properties={},this.json)Dt[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Mt(this,this.json,this.binary))}return Object(w.a)(e,[{key:"getExtension",value:function(e){return this.json&&this.json.extensions&&this.json.extensions[e]}},{key:"memorySizeInBytes",value:function(){return 0}},{key:"isClass",value:function(e,t){return this._checkBatchId(e),Object(k.a)("string"==typeof t,t),!!this._hierarchy&&Ut(Rt(this._hierarchy,e,(function(e,r){var n=e.classIds[r];return e.classes[n].name===t})))}},{key:"isExactClass",value:function(e,t){return Object(k.a)("string"==typeof t,t),this.getExactClassName(e)===t}},{key:"getExactClassName",value:function(e){if(this._checkBatchId(e),this._hierarchy){var t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}},{key:"hasProperty",value:function(e,t){return this._checkBatchId(e),Object(k.a)("string"==typeof t,t),Ut(this._properties[t])||this._hasPropertyInHierarchy(e,t)}},{key:"getPropertyNames",value:function(e,t){var r;this._checkBatchId(e),(t=Ut(t)?t:[]).length=0;var n=Object.keys(this._properties);return(r=t).push.apply(r,Object(St.a)(n)),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}},{key:"getProperty",value:function(e,t){if(this._checkBatchId(e),Object(k.a)("string"==typeof t,t),this._binaryProperties){var r=this._binaryProperties[t];if(Ut(r))return this._getBinaryProperty(r,e)}var n=this._properties[t];if(Ut(n))return Lt(n[e]);if(this._hierarchy){var i=this._getHierarchyProperty(e,t);if(Ut(i))return i}}},{key:"setProperty",value:function(e,t,r){var n=this.featureCount;if(this._checkBatchId(e),Object(k.a)("string"==typeof t,t),this._binaryProperties){var i=this._binaryProperties[t];if(i)return void this._setBinaryProperty(i,e,r)}if(!this._hierarchy||!this._setHierarchyProperty(this,e,t,r)){var a=this._properties[t];Ut(a)||(this._properties[t]=new Array(n),a=this._properties[t]),a[e]=Lt(r)}}},{key:"_checkBatchId",value:function(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}},{key:"_getBinaryProperty",value:function(e,t){return e.unpack(e.typedArray,t)}},{key:"_setBinaryProperty",value:function(e,t,r){e.pack(r,e.typedArray,t)}},{key:"_initializeBinaryProperties",value:function(){var e=null;for(var t in this._properties){var r=this._properties[t],n=this._initializeBinaryProperty(t,r);n&&((e=e||{})[t]=n)}return e}},{key:"_initializeBinaryProperty",value:function(e,t){if("byteOffset"in t){var r=t;Object(k.a)(this.binary,"Property ".concat(e," requires a batch table binary.")),Object(k.a)(r.type,"Property ".concat(e," requires a type."));var n=function(e,t,r,n){var i=e.componentType;Object(k.a)(e.componentType);var a="string"==typeof i?At.fromName(i):i,s=kt[e.type],o=Et[e.type],u=It[e.type];return r+=e.byteOffset,{values:At.createTypedArray(a,t,r,s*n),type:a,size:s,unpacker:o,packer:u}}(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}},{key:"_hasPropertyInHierarchy",value:function(e,t){if(!this._hierarchy)return!1;var r=Rt(this._hierarchy,e,(function(e,r){var n=e.classIds[r];return Ut(e.classes[n].instances[t])}));return Ut(r)}},{key:"_getPropertyNamesInHierarchy",value:function(e,t){Rt(this._hierarchy,e,(function(e,r){var n=e.classIds[r],i=e.classes[n].instances;for(var a in i)i.hasOwnProperty(a)&&-1===t.indexOf(a)&&t.push(a)}))}},{key:"_getHierarchyProperty",value:function(e,t){var r=this;return Rt(this._hierarchy,e,(function(e,n){var i=e.classIds[n],a=e.classes[i],s=e.classIndexes[n],o=a.instances[t];return Ut(o)?Ut(o.typedArray)?r._getBinaryProperty(o,s):Lt(o[s]):null}))}},{key:"_setHierarchyProperty",value:function(e,t,r,n){var i=this,a=Rt(this._hierarchy,t,(function(e,a){var s=e.classIds[a],o=e.classes[s],u=e.classIndexes[a],c=o.instances[r];return!!Ut(c)&&(Object(k.a)(a===t,'Inherited property "'.concat(r,'" is read-only.')),Ut(c.typedArray)?i._setBinaryProperty(c,u,n):c[u]=Lt(n),!0)}));return Ut(a)}}]),e}();function Bt(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=new DataView(t);if(e.magic=n.getUint32(r,!0),r+=4,e.version=n.getUint32(r,!0),r+=4,e.byteLength=n.getUint32(r,!0),r+=4,1!==e.version)throw new Error("3D Tile Version ".concat(e.version," not supported"));return r}function Ft(e,t,r){var n=new DataView(t);return e.header=e.header||{},e.header.featureTableJsonByteLength=n.getUint32(r,!0),r+=4,e.header.featureTableBinaryByteLength=n.getUint32(r,!0),r+=4,e.header.batchTableJsonByteLength=n.getUint32(r,!0),r+=4,e.header.batchTableBinaryByteLength=n.getUint32(r,!0),r+=4}function Gt(e,t,r,n){return r=function(e,t,r,n){var i=e.header,a=i.featureTableJsonByteLength,s=i.featureTableBinaryByteLength;if(e.featureTableJson={BATCH_LENGTH:0},a>0){var o=Ze(t,r,a);e.featureTableJson=JSON.parse(o)}return r+=a,e.featureTableBinary=new Uint8Array(t,r,s),r+=s}(e,t,r),r=function(e,t,r,n){var i=e.header,a=i.batchTableJsonByteLength,s=i.batchTableBinaryByteLength;if(a>0){var o=Ze(t,r,a);e.batchTableJson=JSON.parse(o),r+=a,s>0&&(e.batchTableBinary=new Uint8Array(t,r,s),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=s)}return r}(e,t,r)}r("HOSt");function zt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=e>>11&31,n=e>>5&63,i=31&e;return t[0]=r<<3,t[1]=n<<2,t[2]=i<<3,t}function qt(e,t,r){if(!(t||e&&e.batchIds&&r))return null;var n=e.batchIds,i=e.isRGB565,a=e.pointCount;if(n&&r){for(var s=new Uint8ClampedArray(3*a),o=0;o<a;o++){var u=n[o],c=r.getProperty(u,"dimensions").map((function(e){return 255*e}));s[3*o]=c[0],s[3*o+1]=c[1],s[3*o+2]=c[2]}return{type:Ot.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}if(i){for(var l=new Uint8ClampedArray(3*a),h=0;h<a;h++){var f=zt(t[h]);l[3*h]=f[0],l[3*h+1]=f[1],l[3*h+2]=f[2]}return{type:Ot.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}return t&&t.length===3*a?{type:Ot.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:Ot.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}var Ht=r("uJc0");r("V6u+");function Qt(e,t){if(!e)throw new Error("math.gl assertion failed. ".concat(t))}new Ht.a,new A.a,new Ht.a,new Ht.a,new Uint8Array(1);function Jt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return Object(ie.a)(e,0,t)/t*2-1}function Kt(e){return e<0?-1:1}function Wt(e,t,r,n){if(Qt(n),e<0||e>r||t<0||t>r)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(r));if(n.x=Jt(e,r),n.y=Jt(t,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){var i=n.x;n.x=(1-Math.abs(n.y))*Kt(i),n.y=(1-Math.abs(i))*Kt(n.y)}return n.normalize()}function Zt(e,t,r){return Wt(e,t,255,r)}var Yt=new A.a;function Xt(e,t,r){return e.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){for(var r=new A.a,n=new Float32Array(3*e.pointCount),i=0;i<e.pointCount;i++)r.set(t[3*i],t[3*i+1],t[3*i+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(n,3*i);return n}(e,t)):{type:Ot.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function $t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function er(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$t(Object(r),!0).forEach((function(t){Object(_.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function tr(e,t,r,n,i){return rr.apply(this,arguments)}function rr(){return(rr=Object(T.a)(u.a.mark((function e(t,r,n,i,a){var s,o,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Bt(t,r,n),n=Ft(t,r,n),n=Gt(t,r,n),nr(t),s=ir(t),o=s.featureTable,c=s.batchTable,e.next=7,ur(t,o,c,i,a);case 7:return ar(t,o,i),sr(t,o,c),or(t,o),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nr(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function ir(e){var t=new xt(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",Ot.FLOAT,3);var n=function(e,t){var r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",Ot.UNSIGNED_SHORT,1),e.batchIds)){var n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");var i=e.batchTableJson,a=e.batchTableBinary;r=new Vt(i,a,n)}return r}(e,t);return{featureTable:t,batchTable:n}}function ar(e,t,r){if(!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",Ot.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){var n=t.getPropertyArray("POSITION_QUANTIZED",Ot.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Ot.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Ot.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=Xt(e,n,r)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function sr(e,t,r){if(!e.attributes.colors){var n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",Ot.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",Ot.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",Ot.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=qt(e,n,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",Ot.UNSIGNED_BYTE,4))}function or(e,t){if(!e.attributes.normals){var r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",Ot.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",Ot.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){for(var r=new Float32Array(3*e.pointsLength),n=0;n<e.pointsLength;n++)Zt(t[2*n],t[2*n+1],Yt),Yt.toArray(r,3*n);return{type:Ot.FLOAT,size:2,value:r}}return{type:Ot.FLOAT,size:2,value:t}}(e,r)}}function ur(e,t,r,n,i){return cr.apply(this,arguments)}function cr(){return(cr=Object(T.a)(u.a.mark((function e(t,r,n,i,a){var s,o,c,l,h,f,d,y;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((l=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"])&&(c=l.properties),!(h=r.getExtension("3DTILES_draco_point_compression"))){e.next=15;break}if(o=h.properties,f=h.byteOffset,d=h.byteLength,o&&Number.isFinite(f)&&d){e.next=9;break}throw new Error("Draco properties, byteOffset, and byteLength must be defined");case 9:s=t.featureTableBinary.slice(f,f+d),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA);case 15:if(s){e.next=17;break}return e.abrupt("return",!0);case 17:return y={buffer:s,properties:er(er({},o),c),featureTableProperties:o,batchTableProperties:c,dequantizeInShader:!1},e.next=20,lr(t,y,i,a);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lr(e,t,r,n){return hr.apply(this,arguments)}function hr(){return(hr=Object(T.a)(u.a.mark((function e(t,r,n,i){var a,s,o,c,l,h,f,d,y,p,v,b,m,g;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.parse,e.next=3,a(r.buffer,vt,{draco:{extraAttributes:r.batchTableProperties||{}}});case 3:if(s=e.sent,o=s.attributes.POSITION&&s.attributes.POSITION.value,c=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,l=s.attributes.NORMAL&&s.attributes.NORMAL.value,h=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,f=o&&s.attributes.POSITION.value.quantization,d=l&&s.attributes.NORMAL.value.quantization,f&&(y=s.POSITION.data.quantization,p=y.range,t.quantizedVolumeScale=new A.a(p,p,p),t.quantizedVolumeOffset=new A.a(y.minValues),t.quantizedRange=(1<<y.quantizationBits)-1,t.isQuantizedDraco=!0),d&&(t.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0),v={},r.batchTableProperties)for(b=0,m=Object.keys(r.batchTableProperties);b<m.length;b++)g=m[b],s.attributes[g]&&s.attributes[g].value&&(v[g.toLowerCase()]=s.attributes[g].value);t.attributes=er({positions:o,colors:qt(t,c),normals:l,batchIds:h},v);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}r("sC2a");var fr=r("kEPd"),dr=r("sx9D"),yr=r("h5Ug");function pr(e,t){if(!e)throw new Error(t||"assert failed: gltf")}r("lFjb");function vr(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;var r=t.baseUri||t.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(e));return r.substr(0,r.lastIndexOf("/")+1)+e}function br(e,t,r){var n=e.bufferViews[r];pr(n);var i=t[n.buffer];pr(i);var a=(n.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,a,n.byteLength)}var mr=r("YkLe"),gr=["SCALAR","VEC2","VEC3","VEC4"],Tr=new Map([[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126]]),_r={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Or={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},wr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function jr(e){return gr[e-1]||gr[0]}function Ar(e){var t=Tr.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function xr(e,t){var r=wr[e.componentType],n=_r[e.type],i=Or[e.componentType],a=e.count*n,s=e.count*n*i;return pr(s>=0&&s<=t.byteLength),{ArrayType:r,length:a,byteLength:s}}var Sr=function(){function e(t){if(Object(O.a)(this,e),t instanceof e)return t;t||(t={json:{asset:{version:"2.0",generator:"loaders.gl"},buffers:[]},buffers:[]}),this.byteLength=0,this.gltf=t,pr(this.gltf.json)}return Object(w.a)(e,[{key:"getApplicationData",value:function(e){return this.json[e]}},{key:"getExtraData",value:function(e){return(this.json.extras||{})[e]}},{key:"getExtension",value:function(e){var t=this.getUsedExtensions().find((function(t){return t===e})),r=this.json.extensions||{};return t?r[e]||!0:null}},{key:"getRequiredExtension",value:function(e){return this.getRequiredExtensions().find((function(t){return t===e}))?this.getExtension(e):null}},{key:"getRequiredExtensions",value:function(){return this.json.extensionsRequired||[]}},{key:"getUsedExtensions",value:function(){return this.json.extensionsUsed||[]}},{key:"getObjectExtension",value:function(e,t){return(e.extensions||{})[t]}},{key:"getScene",value:function(e){return this.getObject("scenes",e)}},{key:"getNode",value:function(e){return this.getObject("nodes",e)}},{key:"getSkin",value:function(e){return this.getObject("skins",e)}},{key:"getMesh",value:function(e){return this.getObject("meshes",e)}},{key:"getMaterial",value:function(e){return this.getObject("materials",e)}},{key:"getAccessor",value:function(e){return this.getObject("accessors",e)}},{key:"getCamera",value:function(e){return null}},{key:"getTexture",value:function(e){return this.getObject("textures",e)}},{key:"getSampler",value:function(e){return this.getObject("samplers",e)}},{key:"getImage",value:function(e){return this.getObject("images",e)}},{key:"getBufferView",value:function(e){return this.getObject("bufferViews",e)}},{key:"getBuffer",value:function(e){return this.getObject("buffers",e)}},{key:"getObject",value:function(e,t){if("object"===Object(F.a)(t))return t;var r=this.json[e]&&this.json[e][t];if(!r)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return r}},{key:"getTypedArrayForBufferView",value:function(e){var t=(e=this.getBufferView(e)).buffer,r=this.gltf.buffers[t];pr(r);var n=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,e.byteLength)}},{key:"getTypedArrayForAccessor",value:function(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,n=xr(e,t),i=n.ArrayType,a=n.length;return new i(r,t.byteOffset+e.byteOffset,a)}},{key:"getTypedArrayForImageData",value:function(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,n=t.byteOffset||0;return new Uint8Array(r,n,t.byteLength)}},{key:"addApplicationData",value:function(e,t){return this.json[e]=t,this}},{key:"addExtraData",value:function(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}},{key:"addObjectExtension",value:function(e,t,r){return pr(r),e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}},{key:"setObjectExtension",value:function(e,t,r){(e.extensions||{})[t]=r}},{key:"removeObjectExtension",value:function(e,t){var r=e.extensions||{},n=r[t];return delete r[t],n}},{key:"addExtension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return pr(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}},{key:"addRequiredExtension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return pr(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}},{key:"registerUsedExtension",value:function(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((function(t){return t===e}))||this.json.extensionsUsed.push(e)}},{key:"registerRequiredExtension",value:function(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((function(t){return t===e}))||this.json.extensionsRequired.push(e)}},{key:"removeExtension",value:function(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}},{key:"addMesh",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=this._addAttributes(e),i={primitives:[{attributes:n,indices:t,mode:r}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}},{key:"addPointCloud",value:function(e){var t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}},{key:"addImage",value:function(e,t){t=t||Object(mr.a)(e);var r={bufferView:this.addBufferView(e),mimeType:t};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}},{key:"addBufferView",value:function(e){var t=e.byteLength;pr(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);var r={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=Object(yr.c)(t),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}},{key:"addAccessor",value:function(e,t){var r={bufferView:e,type:jr(t.size),componentType:t.componentType,count:t.count};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}},{key:"addBinaryBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:3},r=this.addBufferView(e),n={size:t.size,componentType:Ar(e),count:Math.round(e.length/t.size)};return this.addAccessor(r,Object.assign(n,t))}},{key:"createBinaryChunk",value:function(){if(!this.arrayBuffer){for(var e=this.byteLength,t=new ArrayBuffer(e),r=new Uint8Array(t),n=0,i=0;i<this.sourceBuffers.length;i++){var a=this.sourceBuffers[i];n=Object(yr.a)(a,r,n)}this.json.buffers[0].byteLength=e,this.arrayBuffer=t,this.sourceBuffers=[]}}},{key:"_removeStringFromArray",value:function(e,t){for(var r=!0;r;){var n=e.indexOf(t);n>-1?e.splice(n,1):r=!1}}},{key:"json",get:function(){return this.gltf.json}}]),e}();function kr(e){var t={};for(var r in e){var n=e[r];if("indices"!==r){var i=Er(n);t[r]=i}}return t}function Er(e,t){var r=function(e,t){var r=e,n=1,i=0;e&&e.value&&(r=e.value,n=e.size||1);r&&(ArrayBuffer.isView(r)||(r=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return null;if(Array.isArray(e))return new t(e);if(r&&!(e instanceof t))return new t(e);return e}(r,Float32Array)),i=r.length/n);return{buffer:r,size:n,count:i}}(e),n=r.buffer,i=r.size;return{value:n,size:i,bufferView:null,byteOffset:0,count:r.count,type:jr(i),componentType:Ar(n)}}var Ir=u.a.mark(Br);function Pr(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Cr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Cr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function Cr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Mr(e,t,r){return Rr.apply(this,arguments)}function Rr(){return(Rr=Object(T.a)(u.a.mark((function e(t,r,n){var i,a,s,o,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.gltf.decompressMeshes){e.next=2;break}return e.abrupt("return");case 2:i=new Sr(t),a=[],s=Pr(Br(i));try{for(s.s();!(o=s.n()).done;)c=o.value,i.getObjectExtension(c,"KHR_draco_mesh_compression")&&a.push(Ur(c,i,r,n))}catch(u){s.e(u)}finally{s.f()}return e.next=8,Promise.all(a);case 8:i.removeExtension("KHR_draco_mesh_compression");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nr(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new Sr(e),i=Pr(n.json.meshes||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;Dr(a,r),n.addRequiredExtension("KHR_draco_mesh_compression")}}catch(s){i.e(s)}finally{i.f()}}function Ur(e,t,r,n){return Lr.apply(this,arguments)}function Lr(){return(Lr=Object(T.a)(u.a.mark((function e(t,r,n,i){var a,s,o,c,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.getObjectExtension(t,"KHR_draco_mesh_compression"),s=r.getTypedArrayForBufferView(a.bufferView),o=Object(yr.b)(s.buffer,s.byteOffset),c=i.parse,e.next=6,c(o,vt,n,i);case 6:l=e.sent,t.attributes=kr(l.attributes),l.indices&&(t.indices=Er(l.indices)),Vr(t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dr(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter||!n.DracoLoader)throw new Error("DracoWriter/DracoLoader not available");var a=n.DracoWriter.encodeSync({attributes:e}),s=i.parseSync,o=s({attributes:e}),u=n._addFauxAttributes(o.attributes),c=n.addBufferView(a),l={primitives:[{attributes:u,mode:r,extensions:Object(_.a)({},"KHR_draco_mesh_compression",{bufferView:c,attributes:u})}]};return l}function Vr(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("Empty glTF primitive detected: Draco decompression failure?")}function Br(e){var t,r,n,i,a,s;return u.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:t=Pr(e.json.meshes||[]),o.prev=1,t.s();case 3:if((r=t.n()).done){o.next=24;break}n=r.value,i=Pr(n.primitives),o.prev=6,i.s();case 8:if((a=i.n()).done){o.next=14;break}return s=a.value,o.next=12,s;case 12:o.next=8;break;case 14:o.next=19;break;case 16:o.prev=16,o.t0=o.catch(6),i.e(o.t0);case 19:return o.prev=19,i.f(),o.finish(19);case 22:o.next=3;break;case 24:o.next=29;break;case 26:o.prev=26,o.t1=o.catch(1),t.e(o.t1);case 29:return o.prev=29,t.f(),o.finish(29);case 32:case"end":return o.stop()}}),Ir,null,[[1,26,29,32],[6,16,19,22]])}function Fr(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Gr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function Gr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function zr(e,t){var r=new Sr(e),n=r.json,i=r.getExtension("KHR_lights_punctual");i&&(r.json.lights=i.lights,r.removeExtension("KHR_lights_punctual"));var a,s=Fr(n.nodes||[]);try{for(s.s();!(a=s.n()).done;){var o=a.value,u=r.getObjectExtension(o,"KHR_lights_punctual");u&&(o.light=u.light),r.removeObjectExtension(o,"KHR_lights_punctual")}}catch(c){s.e(c)}finally{s.f()}}function qr(e,t){var r=new Sr(e),n=r.json;if(n.lights){var i=r.addExtension("KHR_lights_punctual");pr(!i.lights),i.lights=n.lights,delete n.lights}if(r.json.lights){var a,s=Fr(r.json.lights);try{for(s.s();!(a=s.n()).done;){var o=a.value,u=o.node;r.addObjectExtension(u,"KHR_lights_punctual",o)}}catch(c){s.e(c)}finally{s.f()}delete r.json.lights}}function Hr(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Qr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function Qr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Jr(e,t){var r=new Sr(e),n=r.json;r.removeExtension("KHR_materials_unlit");var i,a=Hr(n.materials||[]);try{for(a.s();!(i=a.n()).done;){var s=i.value;s.extensions&&s.extensions.KHR_materials_unlit&&(s.unlit=!0),r.removeObjectExtension(s,"KHR_materials_unlit")}}catch(o){a.e(o)}finally{a.f()}}function Kr(e,t){var r=new Sr(e),n=r.json;if(r.materials){var i,a=Hr(n.materials);try{for(a.s();!(i=a.n()).done;){var s=i.value;s.unlit&&(delete s.unlit,r.addObjectExtension(s,"KHR_materials_unlit",{}),r.addExtension("KHR_materials_unlit"))}}catch(o){a.e(o)}finally{a.f()}}}function Wr(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Zr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function Zr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Yr(e,t){var r=new Sr(e),n=r.json,i=r.getExtension("KHR_techniques_webgl");if(i){var a,s=function(e,t){var r=e.programs,n=void 0===r?[]:r,i=e.shaders,a=void 0===i?[]:i,s=e.techniques,o=void 0===s?[]:s,u=new TextDecoder;return a.forEach((function(e){if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=u.decode(t.getTypedArrayForBufferView(e.bufferView))})),n.forEach((function(e){e.fragmentShader=a[e.fragmentShader],e.vertexShader=a[e.vertexShader]})),o.forEach((function(e){e.program=n[e.program]})),o}(i,r),o=Wr(n.materials||[]);try{for(o.s();!(a=o.n()).done;){var u=a.value,c=r.getObjectExtension(u,"KHR_techniques_webgl");c&&(u.technique=Object.assign({},c,s[c.technique]),u.technique.values=$r(u.technique,r)),r.removeObjectExtension(u,"KHR_techniques_webgl")}}catch(l){o.e(l)}finally{o.f()}r.removeExtension("KHR_techniques_webgl")}}function Xr(e,t){}function $r(e,t){var r=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((function(t){e.uniforms[t].value&&!(t in r)&&(r[t]=e.uniforms[t].value)})),Object.keys(r).forEach((function(e){"object"===Object(F.a)(r[e])&&void 0!==r[e].index&&(r[e].texture=t.getTexture(r[e].index))})),r}var en={KHR_draco_mesh_compression:n,KHR_lights_punctual:i,KHR_materials_unlit:a,KHR_techniques_webgl:s};function tn(e){return rn.apply(this,arguments)}function rn(){return(rn=Object(T.a)(u.a.mark((function e(t){var r,n,i,a,s,o=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=o.length>1&&void 0!==o[1]?o[1]:{},n=o.length>2?o[2]:void 0,r.gltf=r.gltf||{},e.t0=u.a.keys(en);case 4:if((e.t1=e.t0()).done){e.next=14;break}if(i=e.t1.value,a=r.gltf.excludeExtensions||{},i in a&&!a[i]){e.next=12;break}return s=en[i],e.next=12,s.decode(t,r,n);case 12:e.next=4;break;case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}function an(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=new DataView(e),i=r.magic,a=void 0===i?1735152710:i,s=n.getUint32(t,!1);return s===a||1735152710===s}function sn(e,t,r,n){Object(k.a)(e.header.byteLength>20);var i=t.getUint32(r+0,!0),a=t.getUint32(r+4,!0);return r+=8,Object(k.a)(0===a),un(e,t,r,i,n),r+=i,r+=cn(e,t,r,e.header.byteLength,n)}function on(e,t,r,n){return Object(k.a)(e.header.byteLength>20),function(e,t,r,n){for(;r+8<=e.header.byteLength;){var i=t.getUint32(r+0,!0),a=t.getUint32(r+4,!0);switch(r+=8,a){case 1313821514:un(e,t,r,i,n);break;case 5130562:cn(e,t,r,i,n);break;case 0:n.glb.strict||un(e,t,r,i,n);break;case 1:n.glb.strict||cn(e,t,r,i,n)}r+=Object(yr.c)(i)}}(e,t,r,n),r+e.header.byteLength}function un(e,t,r,n,i){var a=new Uint8Array(t.buffer,r,n),s=new TextDecoder("utf8").decode(a);return e.json=JSON.parse(s),Object(yr.c)(n)}function cn(e,t,r,n,i){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:t.buffer}),Object(yr.c)(n)}function ln(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return hn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hn(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function hn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function fn(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return dn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dn(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function dn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var yn,pn={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},vn={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},bn=function(){function e(t){Object(O.a)(this,e),this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}}return Object(w.a)(e,[{key:"normalize",value:function(e,t){this.json=e.json;var r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn("glTF: Unknown version ".concat(r.asset.version))}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),function(e,t){var r,n=new Sr(e),i=n.json,a=ln(i.images||[]);try{for(a.s();!(r=a.n()).done;){var s=r.value,o=n.removeObjectExtension(s,"KHR_binary_glTF");o&&Object.assign(s,o)}}catch(u){a.e(u)}finally{a.f()}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,n.removeExtension("KHR_binary_glTF")}(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r)}},{key:"_addAsset",value:function(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}},{key:"_convertTopLevelObjectsToArrays",value:function(e){for(var t in pn)this._convertTopLevelObjectToArray(e,t)}},{key:"_convertTopLevelObjectToArray",value:function(e,t){var r=e[t];if(r&&!Array.isArray(r))for(var n in e[t]=[],r){var i=r[n];i.id=i.id||n;var a=e[t].length;e[t].push(i),this.idToIndexMap[t][n]=a}}},{key:"_convertObjectIdsToArrayIndices",value:function(e){for(var t in pn)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));var r,n=fn(e.textures);try{for(n.s();!(r=n.n()).done;){var i=r.value;this._convertTextureIds(i)}}catch(y){n.e(y)}finally{n.f()}var a,s=fn(e.meshes);try{for(s.s();!(a=s.n()).done;){var o=a.value;this._convertMeshIds(o)}}catch(y){s.e(y)}finally{s.f()}var u,c=fn(e.nodes);try{for(c.s();!(u=c.n()).done;){var l=u.value;this._convertNodeIds(l)}}catch(y){c.e(y)}finally{c.f()}var h,f=fn(e.scenes);try{for(f.s();!(h=f.n()).done;){var d=h.value;this._convertSceneIds(d)}}catch(y){f.e(y)}finally{f.f()}}},{key:"_convertTextureIds",value:function(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}},{key:"_convertMeshIds",value:function(e){var t,r=fn(e.primitives);try{for(r.s();!(t=r.n()).done;){var n=t.value,i=n.attributes,a=n.indices,s=n.material;for(var o in i)i[o]=this._convertIdToIndex(i[o],"accessor");a&&(n.indices=this._convertIdToIndex(a,"accessor")),s&&(n.material=this._convertIdToIndex(s,"material"))}}catch(u){r.e(u)}finally{r.f()}}},{key:"_convertNodeIds",value:function(e){var t=this;e.children&&(e.children=e.children.map((function(e){return t._convertIdToIndex(e,"node")})))}},{key:"_convertSceneIds",value:function(e){var t=this;e.nodes&&(e.nodes=e.nodes.map((function(e){return t._convertIdToIndex(e,"node")})))}},{key:"_convertIdsToIndices",value:function(e,t){var r,n=fn(e[t]);try{for(n.s();!(r=n.n()).done;){var i=r.value;for(var a in i){var s=i[a],o=this._convertIdToIndex(s,a);i[a]=o}}}catch(u){n.e(u)}finally{n.f()}}},{key:"_convertIdToIndex",value:function(e,t){var r=vn[t];if(r in this.idToIndexMap){var n=this.idToIndexMap[r][e];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return n}return e}},{key:"_updateObjects",value:function(e){var t,r=fn(this.json.buffers);try{for(r.s();!(t=r.n()).done;){delete t.value.type}}catch(n){r.e(n)}finally{r.f()}}}]),e}();function mn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new bn).normalize(e,t)}function gn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Tn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gn(Object(r),!0).forEach((function(t){Object(_.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var _n={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},On={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},wn={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},jn={magFilter:wn.TEXTURE_MAG_FILTER,minFilter:wn.TEXTURE_MIN_FILTER,wrapS:wn.TEXTURE_WRAP_S,wrapT:wn.TEXTURE_WRAP_T},An=(yn={},Object(_.a)(yn,wn.TEXTURE_MAG_FILTER,wn.LINEAR),Object(_.a)(yn,wn.TEXTURE_MIN_FILTER,wn.NEAREST_MIPMAP_LINEAR),Object(_.a)(yn,wn.TEXTURE_WRAP_S,wn.REPEAT),Object(_.a)(yn,wn.TEXTURE_WRAP_,wn.REPEAT),yn);var xn=function(){function e(){Object(O.a)(this,e)}return Object(w.a)(e,[{key:"postProcess",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.json,n=e.buffers,i=void 0===n?[]:n,a=e.images,s=void 0===a?[]:a,o=e.baseUri,u=void 0===o?"":o;return pr(r),this.baseUri=u,this.json=r,this.buffers=i,this.images=s,this._resolveTree(this.json,t),this.json}},{key:"_resolveTree",value:function(e){var t=this;e.bufferViews&&(e.bufferViews=e.bufferViews.map((function(e,r){return t._resolveBufferView(e,r)}))),e.images&&(e.images=e.images.map((function(e,r){return t._resolveImage(e,r)}))),e.samplers&&(e.samplers=e.samplers.map((function(e,r){return t._resolveSampler(e,r)}))),e.textures&&(e.textures=e.textures.map((function(e,r){return t._resolveTexture(e,r)}))),e.accessors&&(e.accessors=e.accessors.map((function(e,r){return t._resolveAccessor(e,r)}))),e.materials&&(e.materials=e.materials.map((function(e,r){return t._resolveMaterial(e,r)}))),e.meshes&&(e.meshes=e.meshes.map((function(e,r){return t._resolveMesh(e,r)}))),e.nodes&&(e.nodes=e.nodes.map((function(e,r){return t._resolveNode(e,r)}))),e.skins&&(e.skins=e.skins.map((function(e,r){return t._resolveSkin(e,r)}))),e.scenes&&(e.scenes=e.scenes.map((function(e,r){return t._resolveScene(e,r)}))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene])}},{key:"getScene",value:function(e){return this._get("scenes",e)}},{key:"getNode",value:function(e){return this._get("nodes",e)}},{key:"getSkin",value:function(e){return this._get("skins",e)}},{key:"getMesh",value:function(e){return this._get("meshes",e)}},{key:"getMaterial",value:function(e){return this._get("materials",e)}},{key:"getAccessor",value:function(e){return this._get("accessors",e)}},{key:"getCamera",value:function(e){return null}},{key:"getTexture",value:function(e){return this._get("textures",e)}},{key:"getSampler",value:function(e){return this._get("samplers",e)}},{key:"getImage",value:function(e){return this._get("images",e)}},{key:"getBufferView",value:function(e){return this._get("bufferViews",e)}},{key:"getBuffer",value:function(e){return this._get("buffers",e)}},{key:"_get",value:function(e,t){if("object"===Object(F.a)(t))return t;var r=this.json[e]&&this.json[e][t];return r||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),r}},{key:"_resolveScene",value:function(e,t){var r=this;return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map((function(e){return r.getNode(e)})),e}},{key:"_resolveNode",value:function(e,t){var r=this;return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map((function(e){return r.getNode(e)}))),void 0!==e.mesh&&(e.mesh=this.getMesh(e.mesh)),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}},{key:"_resolveSkin",value:function(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}},{key:"_resolveMesh",value:function(e,t){var r=this;return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map((function(e){var t=(e=Tn({},e)).attributes;for(var n in e.attributes={},t)e.attributes[n]=r.getAccessor(t[n]);return void 0!==e.indices&&(e.indices=r.getAccessor(e.indices)),void 0!==e.material&&(e.material=r.getMaterial(e.material)),e}))),e}},{key:"_resolveMaterial",value:function(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture=Tn({},e.normalTexture),e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture=Tn({},e.occlustionTexture),e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture=Tn({},e.emmisiveTexture),e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.pbrMetallicRoughness){e.pbrMetallicRoughness=Tn({},e.pbrMetallicRoughness);var r=e.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture=Tn({},r.baseColorTexture),r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture=Tn({},r.metallicRoughnessTexture),r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return e}},{key:"_resolveAccessor",value:function(e,t){var r,n;if(e.id=e.id||"accessor-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=(r=e.componentType,On[r]),e.components=(n=e.type,_n[n]),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){var i=e.bufferView.buffer,a=xr(e,e.bufferView),s=a.ArrayType,o=a.length,u=(e.bufferView.byteOffset||0)+i.byteOffset;e.value=new s(i.arrayBuffer,u,o)}return e}},{key:"_resolveTexture",value:function(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):An,e.source=this.getImage(e.source),e}},{key:"_resolveSampler",value:function(e,t){for(var r in e.id=e.id||"sampler-".concat(t),e.parameters={},e){var n=this._enumSamplerParameter(r);void 0!==n&&(e.parameters[n]=e[r])}return e}},{key:"_enumSamplerParameter",value:function(e){return jn[e]}},{key:"_resolveImage",value:function(e,t){e.id=e.id||"image-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));var r=this.images[t];return r&&(e.image=r),e}},{key:"_resolveBufferView",value:function(e,t){e.id=e.id||"bufferView-".concat(t);var r=e.buffer;e.buffer=this.buffers[r];var n=this.buffers[r].arrayBuffer,i=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(i+=e.byteOffset),e.data=new Uint8Array(n,i,e.byteLength),e}},{key:"_resolveCamera",value:function(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}]),e}();function Sn(e,t){return(new xn).postProcess(e,t)}function kn(e,t){return En.apply(this,arguments)}function En(){return(En=Object(T.a)(u.a.mark((function e(t,r){var n,i,a,s,o,c,l=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>2&&void 0!==l[2]?l[2]:0,i=l.length>3?l[3]:void 0,a=l.length>4?l[4]:void 0,In(t,r,n,i),mn(t,{normalize:i.gltf.normalize}),s=[],i.gltf.loadImages&&(o=Mn(t,i,a),s.push(o)),!i.gltf.loadBuffers){e.next=10;break}return e.next=10,Pn(t,i,a);case 10:return c=tn(t,i,a),s.push(c),e.next=14,Promise.all(s);case 14:return e.abrupt("return",i.gltf.postProcess?Sn(t,i):t);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function In(e,t,r,n){(n.uri&&(e.baseUri=n.uri),t instanceof ArrayBuffer&&!an(t,r,n))&&(t=(new TextDecoder).decode(t));if("string"==typeof t)e.json=Object(dr.a)(t);else if(t instanceof ArrayBuffer){var i={};r=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=new DataView(t);e.type=nn(n,r+0),e.version=n.getUint32(r+4,!0);var i=n.getUint32(r+8,!0);switch(e.header={byteOffset:r,byteLength:i},e.json={},e.binChunks=[],r+=12,e.version){case 1:return sn(e,n,r,{});case 2:return on(e,n,r,{});default:throw new Error("Invalid GLB version ".concat(e.version,". Only supports v1 and v2."))}}(i,t,r,n),pr("glTF"===i.type,"Invalid GLB magic string ".concat(i.type)),e._glb=i,e.json=i.json}else pr(!1,"GLTF: must be ArrayBuffer or string");var a=e.json.buffers||[];if(e.buffers=new Array(a.length).fill(null),e._glb&&e._glb.header.hasBinChunk){var s=e._glb.binChunks;e.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}var o=e.json.images||[];e.images=new Array(o.length).fill({})}function Pn(e,t,r){return Cn.apply(this,arguments)}function Cn(){return(Cn=Object(T.a)(u.a.mark((function e(t,r,n){var i,a,s,o,c,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<t.json.buffers.length)){e.next=18;break}if(!(a=t.json.buffers[i]).uri){e.next=15;break}return pr(s=n.fetch),o=vr(a.uri,r),e.next=9,s(o);case 9:return c=e.sent,e.next=12,c.arrayBuffer();case 12:l=e.sent,t.buffers[i]={arrayBuffer:l,byteOffset:0,byteLength:l.byteLength},delete a.uri;case 15:++i,e.next=1;break;case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mn(e,t,r){return Rn.apply(this,arguments)}function Rn(){return(Rn=Object(T.a)(u.a.mark((function e(t,r,n){var i,a,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=t.json.images||[],a=[],s=0;s<i.length;++s)a.push(Nn(t,i[s],s,r,n));return e.next=5,Promise.all(a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nn(e,t,r,n,i){return Un.apply(this,arguments)}function Un(){return(Un=Object(T.a)(u.a.mark((function e(t,r,n,i,a){var s,o,c,l,h,f,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=a.fetch,o=a.parse,!r.uri){e.next=9;break}return l=vr(r.uri,i),e.next=5,s(l);case 5:return h=e.sent,e.next=8,h.arrayBuffer();case 8:c=e.sent;case 9:return Number.isFinite(r.bufferView)&&(f=br(t.json,t.buffers,r.bufferView),c=Object(yr.b)(f.buffer,f.byteOffset,f.byteLength)),pr(c,"glTF image has no data"),e.next=13,o(c,fr.a,{},a);case 13:d=e.sent,t.images[n]=d;case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ln(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Dn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ln(Object(r),!0).forEach((function(t){Object(_.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ln(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Vn={id:"gltf",name:"glTF",version:"2.3.0-beta.3",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:function(e){return Fn.apply(this,arguments)},options:{gltf:{normalize:!1,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},uri:"",log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}},Bn=Vn;function Fn(){return(Fn=Object(T.a)(u.a.mark((function e(t){var r,n,i,a,s,o=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},n=o.length>2?o[2]:void 0,(r=Dn(Dn({},Vn.options),r)).gltf=Dn(Dn({},Vn.options.gltf),r.gltf),Gn(r),i=r.byteOffset,a=void 0===i?0:i,s={},e.next=9,kn(s,t,a,r,n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gn(e){"fetchImages"in e&&(e.gltf.loadImages=e.fetchImages),"createImages"in e&&(e.gltf.loadImages=e.createImages),"fetchLinkedResources"in e&&(e.gltf.fetchBuffers=e.fetchLinkedResources),"decompress"in e&&(e.gltf.decompressMeshes=e.decompress),"decompress"in e.gltf&&(e.gltf.decompressMeshes=e.gltf.decompress),"postProcess"in e&&(e.gltf.postProcess=e.postProcess)}var zn=0,qn=1;function Hn(e,t,r){e.rotateYtoZ=!0;var n=e.byteOffset+e.byteLength-r;if(0===n)throw new Error("glTF byte length must be greater than 0.");return e.gltfArrayBuffer=Object(yr.b)(t,r,n),e.gltfByteOffset=0,e.gltfByteLength=n,r%4==0||console.warn("".concat(e.type,": embedded glb is not aligned to a 4-byte boundary.")),e.byteOffset+e.byteLength}function Qn(e,t,r,n){return Jn.apply(this,arguments)}function Jn(){return(Jn=Object(T.a)(u.a.mark((function e(t,r,n,i){var a,s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n["3d-tiles"]||{},Kn(t,r,n),!a.loadGLTF){e.next=16;break}if(s=i.parse,o=i.fetch,!t.gltfUrl){e.next=9;break}return e.next=7,o(t.gltfUrl,n);case 7:t.gltfArrayBuffer=e.sent,t.gltfByteOffset=0;case 9:if(!t.gltfArrayBuffer){e.next=16;break}return e.next=12,s(t.gltfArrayBuffer,Bn,n,i);case 12:t.gltf=e.sent,delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kn(e,t,r){switch(t){case zn:var n=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=(new TextDecoder).decode(n);e.gltfUrl=i.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case qn:break;default:throw new Error("b3dm: Illegal glTF format field")}}function Wn(e,t,r,n,i){return Zn.apply(this,arguments)}function Zn(){return(Zn=Object(T.a)(u.a.mark((function e(t,r,n,i,a){var s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Yn(t,r,n,i,a),e.next=3,Qn(t,qn,i,a);case 3:return s=t.gltf||{},(o=s.extensions)&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yn(e,t,r,n,i){r=Hn(e,t,r=Gt(e,t,r=Ft(e,t,r=Bt(e,t,r))));var a=new xt(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=a.getGlobalProperty("RTC_CENTER",Ot.FLOAT,3),r}var Xn=r("PcVa");function $n(e,t,r,n,i){return ei.apply(this,arguments)}function ei(){return(ei=Object(T.a)(u.a.mark((function e(t,r,n,i,a){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ti(t,r,n,i,a),e.next=3,Qn(t,t.gltfFormat,i,a);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ti(e,t,r,n,i){if(r=Bt(e,t,r),1!==e.version)throw new Error("Instanced 3D Model version ".concat(e.version," is not supported"));r=Ft(e,t,r);var a=new DataView(t);if(e.gltfFormat=a.getUint32(r,!0),r=Hn(e,t,r=Gt(e,t,r+=4)),0===e.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");var s=new xt(e.featureTableJson,e.featureTableBinary),o=s.getGlobalProperty("INSTANCES_LENGTH");if(s.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=s.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=s.getGlobalProperty("RTC_CENTER",Ot.FLOAT,3);new Vt(e.batchTableJson,e.batchTableBinary,o);return function(e,t,r,n){for(var i=[new Array(n),e._batchTable][0],a=new A.a,s=(new A.a,new A.a,new A.a,new ae.a),o=new Xn.a,u=new A.a,c={},l=new j.a,h=[],f=[],d=new A.a,y=new A.a,p=0;p<n;p++){var v=void 0;if(t.hasProperty("POSITION"))v=t.getProperty("POSITION",Ot.FLOAT,3,p,a);else if(t.hasProperty("POSITION_QUANTIZED")){v=t.getProperty("POSITION_QUANTIZED",Ot.UNSIGNED_SHORT,3,p,a);var b=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Ot.FLOAT,3,d);if(!b)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var m=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Ot.FLOAT,3,y);if(!m)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var g=0;g<3;g++)v[g]=v[g]/65535*m[g]+b[g]}if(!v)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");a.copy(v),c.translation=a,e.normalUp=t.getProperty("NORMAL_UP",Ot.FLOAT,3,p,h),e.normalRight=t.getProperty("NORMAL_RIGHT",Ot.FLOAT,3,p,f);if(e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",Ot.UNSIGNED_SHORT,2,h),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",Ot.UNSIGNED_SHORT,2,f),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(x.a.WGS84.eastNorthUpToFixedFrame(a,l),l.getRotationMatrix3(s)):s.identity()}!1,o.fromMatrix3(s),c.rotation=o,u.set(1,1,1);var T=t.getProperty("SCALE",Ot.FLOAT,1,p);Number.isFinite(T)&&u.multiplyByScalar(T);var _=t.getProperty("SCALE_NON_UNIFORM",Ot.FLOAT,3,p,h);_&&u.scale(_),c.scale=u;var O=t.getProperty("BATCH_ID",Ot.UNSIGNED_SHORT,1,p);void 0===O&&(O=p);var w=(new j.a).fromQuaternion(c.rotation);l.identity(),l.translate(c.translation),l.multiplyRight(w),l.scale(c.scale);var S=l.clone();i[p]={modelMatrix:S,batchId:O}}e.instances=i}(e,s,0,o),r}function ri(e,t,r,n,i,a){return ni.apply(this,arguments)}function ni(){return(ni=Object(T.a)(u.a.mark((function e(t,r,n,i,a,s){var o,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Bt(t,r,n),o=new DataView(r),t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];case 5:if(!(t.tiles.length<t.tilesLength&&t.byteLength-n>12)){e.next=13;break}return c={},t.tiles.push(c),e.next=10,s(r,n,i,a,c);case 10:n=e.sent,e.next=5;break;case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ii(e){return ai.apply(this,arguments)}function ai(){return(ai=Object(T.a)(u.a.mark((function e(t){var r,n,i,a,s=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=s.length>1&&void 0!==s[1]?s[1]:0,n=s.length>2?s[2]:void 0,i=s.length>3?s[3]:void 0,(a=s.length>4&&void 0!==s[4]?s[4]:{}).byteOffset=r,a.type=Ye(t,r),e.t0=a.type,e.next=e.t0===We.COMPOSITE?9:e.t0===We.BATCHED_3D_MODEL?12:e.t0===We.INSTANCED_3D_MODEL?15:e.t0===We.POINT_CLOUD?18:21;break;case 9:return e.next=11,ri(a,t,r,n,i,ii);case 11:return e.abrupt("return",e.sent);case 12:return e.next=14,Wn(a,t,r,n,i);case 14:return e.abrupt("return",e.sent);case 15:return e.next=17,$n(a,t,r,n,i);case 17:return e.abrupt("return",e.sent);case 18:return e.next=20,tr(a,t,r,n,i);case 20:return e.abrupt("return",e.sent);case 21:throw new Error("3DTileLoader: unknown type ".concat(a.type));case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}r("HQhv");function si(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return oi(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oi(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function oi(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ui(e,t){if(e.content){var r=e.content.uri||e.content.url;e.contentUrl="".concat(t.basePath,"/").concat(r)}return e.id=e.contentUrl,e.lodMetricType=te,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=function(e){if(!e.contentUrl)return W;var t=e.contentUrl.split(".").pop();switch(t){case"pnts":return Y;case"i3dm":case"b3dm":return Z;default:return t}}(e),e.refine=function(e){switch(e){case"REPLACE":case"replace":return K;case"ADD":case"add":return J;default:return e}}(e.refine),e}function ci(e){var t=e.basePath,r=ui(e.root,e),n=[];for(n.push(r);n.length>0;){var i,a=si(n.pop().children||[]);try{for(a.s();!(i=a.n()).done;){var s=i.value;ui(s,{basePath:t}),n.push(s)}}catch(o){a.e(o)}finally{a.f()}}return r}function li(e){return E.a.dirname(e.url)}function hi(e,t,r){return fi.apply(this,arguments)}function fi(){return(fi=Object(T.a)(u.a.mark((function e(t,r,n){var i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i={}).content=i.content||{},0,e.next=5,ii(t,0,r,n,i.content);case 5:return e.abrupt("return",i.content);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function di(e,t,r){return yi.apply(this,arguments)}function yi(){return(yi=Object(T.a)(u.a.mark((function e(t,r,n){var i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=JSON.parse((new TextDecoder).decode(t))).loader=r.loader||vi,i.url=n.url,i.basePath=li(i),i.root=ci(i),i.type=ee,i.lodMetricType=te,i.lodMetricValue=i.root.lodMetricValue,e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pi(){return(pi=Object(T.a)(u.a.mark((function e(t,r,n,i){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r["3d-tiles"]||{},!("auto"===a.isTileset?n.url&&-1!==n.url.indexOf(".json"):a.isTileset)){e.next=8;break}return e.next=5,di(t,r,n);case 5:t=e.sent,e.next=11;break;case 8:return e.next=10,hi(t,r,n);case 10:t=e.sent;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var vi={id:"3d-tiles",name:"3D Tiles",version:"2.3.0-beta.3",extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:function(e,t,r,n){return pi.apply(this,arguments)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",tile:null,tileset:null}}},bi=vi;function mi(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function gi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mi(Object(r),!0).forEach((function(t){Ti(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mi(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ti(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _i(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(c){return void r(c)}o.done?t(u):Promise.resolve(u).then(n,i)}var Oi=new c.b,wi={getPointColor:[0,0,0],pointSize:1,data:null,loadOptions:{},loader:bi,onTilesetLoad:function(e){},onTileLoad:function(e){},onTileUnload:function(e){},onTileError:function(e,t,r){}},ji=function(e){var t,r;function n(){return e.apply(this,arguments)||this}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var i=n.prototype;return i.initializeState=function(){"onTileLoadFail"in this.props&&m.a.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null}},i.shouldUpdateState=function(e){return e.changeFlags.somethingChanged},i.updateState=function(e){var t=e.props,r=e.oldProps,n=e.changeFlags;if(t.data&&t.data!==r.data&&this._loadTileset(t.data),n.viewportChanged){var i=this.state.tileset3d;this._updateTileset(i)}},i.getPickingInfo=function(e){var t=e.info,r=e.sourceLayer,n=this.state.layerMap,i=r&&r.id;if(i){var a=i.substring(this.id.length+1),s=a.substring(a.indexOf("-")+1);t.object=n[s]&&n[s].tile}return t},i._loadTileset=function(){var e,t=(e=u.a.mark((function e(t){var r,n,i,a,s,o,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props,n=r.loader,i=r.loadOptions,a=gi({},i),!n.preload){e.next=7;break}return e.next=5,n.preload(t,i);case 5:s=e.sent,Object.assign(a,s);case 7:return e.next=9,Object(g.a)(t,n,a);case 9:o=e.sent,c=new Ke(o,gi({onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileLoadFail:this.props.onTileError},a)),this.setState({tileset3d:c,layerMap:{}}),this._updateTileset(c),this.props.onTilesetLoad(c);case 14:case"end":return e.stop()}}),e,this)})),function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){_i(a,n,i,s,o,"next",e)}function o(e){_i(a,n,i,s,o,"throw",e)}s(void 0)}))});return function(e){return t.apply(this,arguments)}}(),i._onTileLoad=function(e){this.props.onTileLoad(e),this._updateTileset(this.state.tileset3d),this.setNeedsUpdate()},i._onTileUnload=function(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)},i._updateTileset=function(e){var t=this.context,r=t.timeline,n=t.viewport;if(r&&n&&e){var i=e.update(n);this.state.frameNumber!==i&&this.setState({frameNumber:i})}},i._create3DTileLayer=function(e){if(!e.content)return null;switch(e.type){case Y:return this._createPointCloudTileLayer(e);case Z:return this._create3DModelTileLayer(e);case X:return this._createSimpleMeshLayer(e);default:throw new Error("Tile3DLayer: Failed to render layer of type "+e.content.type)}},i._createPointCloudTileLayer=function(e){var t=e.content,r=t.attributes,n=t.pointCount,i=t.constantRGBA,a=t.cartographicOrigin,s=t.modelMatrix,o=r.positions,u=r.normals,c=r.colors;if(!o)return null;var l=this.props,h=l.pointSize,f=l.getPointColor;return new(this.getSubLayerClass("pointcloud",p.a))({pointSize:h},this.getSubLayerProps({id:"pointcloud"}),{id:this.id+"-pointcloud-"+e.id,data:{header:{vertexCount:n},attributes:{POSITION:o,NORMAL:u,COLOR_0:c}},coordinateSystem:d.a.METER_OFFSETS,coordinateOrigin:a,modelMatrix:s,getColor:i||f})},i._create3DModelTileLayer=function(e){var t=e.content,r=t.gltf,n=t.instances,i=t.cartographicOrigin,a=t.modelMatrix;return new(this.getSubLayerClass("scenegraph",v.a))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:this.id+"-scenegraph-"+e.id,data:n||[{}],scenegraph:r,coordinateSystem:d.a.METER_OFFSETS,coordinateOrigin:i,modelMatrix:a,getTransformMatrix:function(e){return e.modelMatrix},getPosition:function(e){return[0,0,0]}})},i._createSimpleMeshLayer=function(e){for(var t=e.content,r=t.attributes,n=t.modelMatrix,i=t.cartographicOrigin,a=t.texture,s=r.normals,o=r.texCoords,u=new Float32Array(r.positions.value.length),c=0;c<u.length;c+=3)Oi.copy(r.positions.value.subarray(c,c+3)),u.set(Oi,c);var l=new f.a({drawMode:h.a.TRIANGLES,attributes:{positions:u,normals:s,texCoords:o}});return new(this.getSubLayerClass("mesh",b.a))(this.getSubLayerProps({id:"mesh"}),{id:this.id+"-mesh-"+e.id,mesh:l,data:[{}],getPosition:[0,0,0],getColor:[255,255,255],texture:a,modelMatrix:n,coordinateOrigin:i,coordinateSystem:d.a.METER_OFFSETS})},i.renderLayers=function(){var e=this,t=this.state,r=t.tileset3d,n=t.layerMap;return r?r.tiles.map((function(t){var r=n[t.id]&&n[t.id].layer;return t.selected?(r||(r=e._create3DTileLayer(t),n[t.id]={layer:r,tile:t}),r&&r.props&&!r.props.visible&&(r=r.clone({visible:!0}),n[t.id].layer=r),r):(r&&r.props&&r.props.visible&&(r=r.clone({visible:!1}),n[t.id].layer=r),r)})).filter(Boolean):null},n}(y.a);ji.layerName="Tile3DLayer",ji.defaultProps=wi},FlnL:function(e,t,r){"use strict";r.d(t,"a",(function(){return U}));r("EMED"),r("q8oJ"),r("C9fy"),r("8npG"),r("DrhF");var n=r("ODXe"),i=r("1OyB"),a=r("vuIU"),s=r("SDD5"),o=r("2plT"),u=r("V6u+"),c=r("kh/P"),l=r("yeNo"),h=r("MTwu"),f=(Math.max(6378137,6378137,6356752.314245179),function(e){return e}),d=new s.a;function y(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;return Object(l.f)(e)?(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]):"longitude"in e?(t[0]=r(e.longitude),t[1]=r(e.latitude),t[2]=e.height):(t[0]=r(e.x),t[1]=r(e.y),t[2]=e.z),t}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d;return y(e,t,l.b._cartographicRadians?f:l.i)}function v(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;return Object(l.f)(t)?(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]):"longitude"in t?(t.longitude=r(e[0]),t.latitude=r(e[1]),t.height=e[2]):(t.x=r(e[0]),t.y=r(e[1]),t.z=e[2]),t}function b(e,t){return v(e,t,l.b._cartographicRadians?f:l.h)}r("YBKJ"),r("9ZhD");var m=new s.a,g=new s.a,T=new s.a;var _=new s.a,O={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},w={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},j={east:new s.a,north:new s.a,up:new s.a,west:new s.a,south:new s.a,down:new s.a},A=new s.a,x=new s.a,S=new s.a;function k(e,t,r,n,i,a){var s,u,c,h=O[t]&&O[t][r];Object(o.a)(h&&(!n||n===h));var f=_.copy(i);if(Object(l.d)(f.x,0,1e-14)&&Object(l.d)(f.y,0,1e-14)){var d=Math.sign(f.z);s=A.fromArray(w[t]),"east"!==t&&"west"!==t&&s.scale(d),u=x.fromArray(w[r]),"east"!==r&&"west"!==r&&u.scale(d),c=S.fromArray(w[n]),"east"!==n&&"west"!==n&&c.scale(d)}else{var y=j.up,p=j.east,v=j.north;p.set(-f.y,f.x,0).normalize(),e.geodeticSurfaceNormal(f,y),v.copy(y).cross(p);var b=j.west,m=j.south;j.down.copy(y).scale(-1),b.copy(p).scale(-1),m.copy(v).scale(-1),s=j[t],u=j[r],c=j[n]}return a[0]=s.x,a[1]=s.y,a[2]=s.z,a[3]=0,a[4]=u.x,a[5]=u.y,a[6]=u.z,a[7]=0,a[8]=c.x,a[9]=c.y,a[10]=c.z,a[11]=0,a[12]=f.x,a[13]=f.y,a[14]=f.z,a[15]=1,a}var E,I=new s.a,P=new s.a,C=new s.a,M=new s.a,R=new s.a,N=new s.a,U=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(i.a)(this,e),Object(o.a)(t>=0),Object(o.a)(r>=0),Object(o.a)(n>=0),this.radii=new s.a(t,r,n),this.radiiSquared=new s.a(t*t,r*r,n*n),this.radiiToTheFourth=new s.a(t*t*t*t,r*r*r*r,n*n*n*n),this.oneOverRadii=new s.a(0===t?0:1/t,0===r?0:1/r,0===n?0:1/n),this.oneOverRadiiSquared=new s.a(0===t?0:1/(t*t),0===r?0:1/(r*r),0===n?0:1/(n*n)),this.minimumRadius=Math.min(t,r,n),this.maximumRadius=Math.max(t,r,n),this.centerToleranceSquared=u.a.EPSILON1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return Object(a.a)(e,null,[{key:"WGS84",get:function(){return E=E||new e(6378137,6378137,6356752.314245179)}}]),Object(a.a)(e,[{key:"equals",value:function(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=P,i=C,a=Object(n.a)(e,3),s=a[2];this.geodeticSurfaceNormalCartographic(e,r),i.copy(this.radiiSquared).scale(r);var o=Math.sqrt(r.dot(i));return i.scale(1/o),r.scale(s),i.add(r),i.to(t)}},{key:"cartesianToCartographic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];N.from(e);var r=this.scaleToGeodeticSurface(N,M);if(r){var n=this.geodeticSurfaceNormal(r,P),i=R;i.copy(N).subtract(r);var a=Math.atan2(n.y,n.x),s=Math.asin(n.z),o=Math.sign(h.d(i,N))*h.g(i);return b([a,s,o],t)}}},{key:"eastNorthUpToFixedFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c.a;return k(this,"east","north","up",e,t)}},{key:"localFrameToFixedFrame",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new c.a;return k(this,e,t,r,n,i)}},{key:"geocentricSurfaceNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return I.from(e).normalize().to(t)}},{key:"geodeticSurfaceNormalCartographic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=p(e),n=r[0],i=r[1],a=Math.cos(i);return I.set(a*Math.cos(n),a*Math.sin(n),Math.sin(i)).normalize(),I.to(t)}},{key:"geodeticSurfaceNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return I.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}},{key:"scaleToGeodeticSurface",value:function(e,t){return function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.a,n=t.oneOverRadii,i=t.oneOverRadiiSquared,a=t.centerToleranceSquared;m.from(e);var o=e.x,c=e.y,l=e.z,h=n.x,f=n.y,d=n.z,y=o*o*h*h,p=c*c*f*f,v=l*l*d*d,b=y+p+v,_=Math.sqrt(1/b);if(Number.isFinite(_)){var O=g;if(O.copy(e).scale(_),b<a)return O.to(r);var w=i.x,j=i.y,A=i.z,x=T;x.set(O.x*w*2,O.y*j*2,O.z*A*2);var S,k,E,I,P=(1-_)*e.len()/(.5*x.len()),C=0;do{var M=(S=1/(1+(P-=C)*w))*S,R=(k=1/(1+P*j))*k,N=(E=1/(1+P*A))*E,U=M*S,L=R*k,D=N*E,V=y*U*w+p*L*j+v*D*A,B=-2*V;C=(I=y*M+p*R+v*N-1)/B}while(Math.abs(I)>u.a.EPSILON12);return m.scale([S,k,E]).to(r)}}(e,this,t)}},{key:"scaleToGeocentricSurface",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];M.from(e);var r=M.x,n=M.y,i=M.z,a=this.oneOverRadiiSquared,s=1/Math.sqrt(r*r*a.x+n*n*a.y+i*i*a.z);return M.multiplyScalar(s).to(t)}},{key:"transformPositionToScaledSpace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return M.from(e).scale(this.oneOverRadii).to(t)}},{key:"transformPositionFromScaledSpace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return M.from(e).scale(this.radii).to(t)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];Object(o.a)(Object(l.d)(this.radii.x,this.radii.y,u.a.EPSILON15)),Object(o.a)(this.radii.z>0),M.from(e);var n=M.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-t))return M.set(0,0,n).to(r)}}]),e}()},oCaT:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n={};r.r(n),r.d(n,"dirname",(function(){return i}));r("lFjb");function i(e){var t=e&&e.lastIndexOf("/");return t>=0?e.substr(0,t):""}},sfiq:function(e,t,r){"use strict";function n(e){throw new Error('"'+e+'" is read-only')}r.d(t,"a",(function(){return n}))}}]);